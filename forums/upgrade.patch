From 6090bfe5c5bc0804dac8644cfa7e879b1c8a8712 Mon Sep 17 00:00:00 2001
From: Franz Liedke <franz@develophp.org>
Date: Tue, 27 Mar 2012 13:25:53 +0200
Subject: [PATCH 01/75] #647: Add database fields for promoting users in user
 groups.

---
 db_update.php      |    8 ++++++--
 include/common.php |    4 ++--
 install.php        |   14 ++++++++++++--
 3 files changed, 20 insertions(+), 6 deletions(-)

diff --git a/db_update.php b/db_update.php
index 5e27a67..98293bf 100644
--- a/db_update.php
+++ b/db_update.php
@@ -7,9 +7,9 @@
  */
 
 // The FluxBB version this script updates to
-define('UPDATE_TO', '1.4.8');
+define('UPDATE_TO', '1.5-dev');
 
-define('UPDATE_TO_DB_REVISION', 15);
+define('UPDATE_TO_DB_REVISION', 16);
 define('UPDATE_TO_SI_REVISION', 2);
 define('UPDATE_TO_PARSER_REVISION', 2);
 
@@ -1022,6 +1022,10 @@ function convert_table_utf8($table, $callback, $old_charset, $key = null, $start
 		// Change the search_data field to mediumtext
 		$db->alter_field('search_cache', 'search_data', 'MEDIUMTEXT', true) or error('Unable to alter search_data field', __FILE__, __LINE__, $db->error());
 
+		// Add the group promotion fields to the groups table
+		$db->add_field('groups', 'g_promote_min_posts', 'INT(10) UNSIGNED', false, 0, 'g_user_title') or error('Unable to add g_promote_min_posts field', __FILE__, __LINE__, $db->error());
+		$db->add_field('groups', 'g_promote_next_group', 'INT(10) UNSIGNED', false, 0, 'g_promote_min_posts') or error('Unable to add g_promote_next_group field', __FILE__, __LINE__, $db->error());
+
 		// Incase we had the fulltext search extension installed (1.3-legacy), remove it
 		$db->drop_index('topics', 'subject_idx') or error('Unable to drop subject_idx index', __FILE__, __LINE__, $db->error());
 		$db->drop_index('posts', 'message_idx') or error('Unable to drop message_idx index', __FILE__, __LINE__, $db->error());
diff --git a/include/common.php b/include/common.php
index f6e3a4e..6323106 100644
--- a/include/common.php
+++ b/include/common.php
@@ -10,9 +10,9 @@
 	exit('The constant PUN_ROOT must be defined and point to a valid FluxBB installation root directory.');
 
 // Define the version and database revision that this code was written for
-define('FORUM_VERSION', '1.4.8');
+define('FORUM_VERSION', '1.5-dev');
 
-define('FORUM_DB_REVISION', 15);
+define('FORUM_DB_REVISION', 16);
 define('FORUM_SI_REVISION', 2);
 define('FORUM_PARSER_REVISION', 2);
 
diff --git a/install.php b/install.php
index 3c8baf0..35b85aa 100644
--- a/install.php
+++ b/install.php
@@ -7,9 +7,9 @@
  */
 
 // The FluxBB version this script installs
-define('FORUM_VERSION', '1.4.8');
+define('FORUM_VERSION', '1.5-dev');
 
-define('FORUM_DB_REVISION', 15);
+define('FORUM_DB_REVISION', 16);
 define('FORUM_SI_REVISION', 2);
 define('FORUM_PARSER_REVISION', 2);
 
@@ -849,6 +849,16 @@ function process_form(the_form)
 				'datatype'		=> 'VARCHAR(50)',
 				'allow_null'	=> true
 			),
+			'g_promote_min_posts'		=> array(
+				'datatype'		=> 'INT(10) UNSIGNED',
+				'allow_null'	=> false,
+				'default'		=> '0'
+			),
+			'g_promote_next_group'		=> array(
+				'datatype'		=> 'INT(10) UNSIGNED',
+				'allow_null'	=> false,
+				'default'		=> '0'
+			),
 			'g_moderator'				=> array(
 				'datatype'		=> 'TINYINT(1)',
 				'allow_null'	=> false,
-- 
1.7.10


From 7c4ef3874a9363a5a41b41b56123b7dfa8e2bede Mon Sep 17 00:00:00 2001
From: Franz Liedke <franz@develophp.org>
Date: Tue, 27 Mar 2012 14:14:39 +0200
Subject: [PATCH 02/75] #647: Add admin management of promoting users to new
 groups.

---
 admin_groups.php              |  128 +++++++++++++++++++++++++----------------
 lang/English/admin_groups.php |    5 +-
 2 files changed, 81 insertions(+), 52 deletions(-)

diff --git a/admin_groups.php b/admin_groups.php
index fa00b4f..e6c2975 100644
--- a/admin_groups.php
+++ b/admin_groups.php
@@ -20,29 +20,30 @@
 // Load the admin_censoring.php language file
 require PUN_ROOT.'lang/'.$admin_language.'/admin_groups.php';
 
+
+// Fetch all groups
+$result = $db->query('SELECT * FROM '.$db->prefix.'groups ORDER BY g_id') or error('Unable to fetch user groups', __FILE__, __LINE__, $db->error());
+$groups = array();
+while ($cur_group = $db->fetch_assoc($result))
+	$groups[$cur_group['g_id']] = $cur_group;
+
 // Add/edit a group (stage 1)
 if (isset($_POST['add_group']) || isset($_GET['edit_group']))
 {
 	if (isset($_POST['add_group']))
 	{
 		$base_group = intval($_POST['base_group']);
-
-		$result = $db->query('SELECT * FROM '.$db->prefix.'groups WHERE g_id='.$base_group) or error('Unable to fetch user group info', __FILE__, __LINE__, $db->error());
-		$group = $db->fetch_assoc($result);
+		$group = $groups[$base_group];
 
 		$mode = 'add';
 	}
 	else // We are editing a group
 	{
 		$group_id = intval($_GET['edit_group']);
-		if ($group_id < 1)
+		if ($group_id < 1 || !isset($groups[$group_id]))
 			message($lang_common['Bad request']);
 
-		$result = $db->query('SELECT * FROM '.$db->prefix.'groups WHERE g_id='.$group_id) or error('Unable to fetch user group info', __FILE__, __LINE__, $db->error());
-		if (!$db->num_rows($result))
-			message($lang_common['Bad request']);
-
-		$group = $db->fetch_assoc($result);
+		$group = $groups[$group_id];
 
 		$mode = 'edit';
 	}
@@ -84,143 +85,167 @@
 										<span><?php echo $lang_admin_groups['User title help'] ?></span>
 									</td>
 								</tr>
+								<tr>
+									<th scope="row"><?php echo $lang_admin_groups['Promote users label'] ?></th>
+									<td>
+										<select name="promote_next_group" tabindex="4">
+											<option value="0"><?php echo $lang_admin_groups['Disable promotion'] ?></option>
+<?php
+
+foreach ($groups as $cur_group)
+{
+	if ($cur_group['g_id'] != $group['g_id'])
+	{
+		if ($cur_group['g_id'] == $group['g_promote_next_group'])
+			echo "\t\t\t\t\t\t\t\t\t\t\t".'<option value="'.$cur_group['g_id'].'" selected="selected">'.pun_htmlspecialchars($cur_group['g_title']).'</option>'."\n";
+		else
+			echo "\t\t\t\t\t\t\t\t\t\t\t".'<option value="'.$cur_group['g_id'].'">'.pun_htmlspecialchars($cur_group['g_title']).'</option>'."\n";
+	}
+}
+
+?>
+										</select>
+										<input type="text" name="promote_min_posts" size="5" maxlength="10" value="<?php echo pun_htmlspecialchars($group['g_promote_min_posts']) ?>" tabindex="3" />
+										<span><?php printf($lang_admin_groups['Promote users help'], $lang_admin_groups['Disable promotion']) ?></span>
+									</td>
+								</tr>
 <?php if ($group['g_id'] != PUN_ADMIN): if ($group['g_id'] != PUN_GUEST): if ($mode != 'edit' || $pun_config['o_default_user_group'] != $group['g_id']): ?>								<tr>
 									<th scope="row"> <?php echo $lang_admin_groups['Mod privileges label'] ?></th>
 									<td>
-										<input type="radio" name="moderator" value="1"<?php if ($group['g_moderator'] == '1') echo ' checked="checked"' ?> tabindex="3" />&#160;<strong><?php echo $lang_admin_common['Yes'] ?></strong>&#160;&#160;&#160;<input type="radio" name="moderator" value="0"<?php if ($group['g_moderator'] == '0') echo ' checked="checked"' ?> tabindex="4" />&#160;<strong><?php echo $lang_admin_common['No'] ?></strong>
+										<input type="radio" name="moderator" value="1"<?php if ($group['g_moderator'] == '1') echo ' checked="checked"' ?> tabindex="5" />&#160;<strong><?php echo $lang_admin_common['Yes'] ?></strong>&#160;&#160;&#160;<input type="radio" name="moderator" value="0"<?php if ($group['g_moderator'] == '0') echo ' checked="checked"' ?> tabindex="6" />&#160;<strong><?php echo $lang_admin_common['No'] ?></strong>
 										<span><?php echo $lang_admin_groups['Mod privileges help'] ?></span>
 									</td>
 								</tr>
 								<tr>
 									<th scope="row"><?php echo $lang_admin_groups['Edit profile label'] ?></th>
 									<td>
-										<input type="radio" name="mod_edit_users" value="1"<?php if ($group['g_mod_edit_users'] == '1') echo ' checked="checked"' ?> tabindex="5" />&#160;<strong><?php echo $lang_admin_common['Yes'] ?></strong>&#160;&#160;&#160;<input type="radio" name="mod_edit_users" value="0"<?php if ($group['g_mod_edit_users'] == '0') echo ' checked="checked"' ?> tabindex="6" />&#160;<strong><?php echo $lang_admin_common['No'] ?></strong>
+										<input type="radio" name="mod_edit_users" value="1"<?php if ($group['g_mod_edit_users'] == '1') echo ' checked="checked"' ?> tabindex="7" />&#160;<strong><?php echo $lang_admin_common['Yes'] ?></strong>&#160;&#160;&#160;<input type="radio" name="mod_edit_users" value="0"<?php if ($group['g_mod_edit_users'] == '0') echo ' checked="checked"' ?> tabindex="8" />&#160;<strong><?php echo $lang_admin_common['No'] ?></strong>
 										<span><?php echo $lang_admin_groups['Edit profile help'] ?></span>
 									</td>
 								</tr>
 								<tr>
 									<th scope="row"><?php echo $lang_admin_groups['Rename users label'] ?></th>
 									<td>
-										<input type="radio" name="mod_rename_users" value="1"<?php if ($group['g_mod_rename_users'] == '1') echo ' checked="checked"' ?> tabindex="7" />&#160;<strong><?php echo $lang_admin_common['Yes'] ?></strong>&#160;&#160;&#160;<input type="radio" name="mod_rename_users" value="0"<?php if ($group['g_mod_rename_users'] == '0') echo ' checked="checked"' ?> tabindex="8" />&#160;<strong><?php echo $lang_admin_common['No'] ?></strong>
+										<input type="radio" name="mod_rename_users" value="1"<?php if ($group['g_mod_rename_users'] == '1') echo ' checked="checked"' ?> tabindex="9" />&#160;<strong><?php echo $lang_admin_common['Yes'] ?></strong>&#160;&#160;&#160;<input type="radio" name="mod_rename_users" value="0"<?php if ($group['g_mod_rename_users'] == '0') echo ' checked="checked"' ?> tabindex="10" />&#160;<strong><?php echo $lang_admin_common['No'] ?></strong>
 										<span><?php echo $lang_admin_groups['Rename users help'] ?></span>
 									</td>
 								</tr>
 								<tr>
 									<th scope="row"><?php echo $lang_admin_groups['Change passwords label'] ?></th>
 									<td>
-										<input type="radio" name="mod_change_passwords" value="1"<?php if ($group['g_mod_change_passwords'] == '1') echo ' checked="checked"' ?> tabindex="9" />&#160;<strong><?php echo $lang_admin_common['Yes'] ?></strong>&#160;&#160;&#160;<input type="radio" name="mod_change_passwords" value="0"<?php if ($group['g_mod_change_passwords'] == '0') echo ' checked="checked"' ?> tabindex="10" />&#160;<strong><?php echo $lang_admin_common['No'] ?></strong>
+										<input type="radio" name="mod_change_passwords" value="1"<?php if ($group['g_mod_change_passwords'] == '1') echo ' checked="checked"' ?> tabindex="11" />&#160;<strong><?php echo $lang_admin_common['Yes'] ?></strong>&#160;&#160;&#160;<input type="radio" name="mod_change_passwords" value="0"<?php if ($group['g_mod_change_passwords'] == '0') echo ' checked="checked"' ?> tabindex="12" />&#160;<strong><?php echo $lang_admin_common['No'] ?></strong>
 										<span><?php echo $lang_admin_groups['Change passwords help'] ?></span>
 									</td>
 								</tr>
 								<tr>
 									<th scope="row"><?php echo $lang_admin_groups['Ban users label'] ?></th>
 									<td>
-										<input type="radio" name="mod_ban_users" value="1"<?php if ($group['g_mod_ban_users'] == '1') echo ' checked="checked"' ?> tabindex="11" />&#160;<strong><?php echo $lang_admin_common['Yes'] ?></strong>&#160;&#160;&#160;<input type="radio" name="mod_ban_users" value="0"<?php if ($group['g_mod_ban_users'] == '0') echo ' checked="checked"' ?> tabindex="12" />&#160;<strong><?php echo $lang_admin_common['No'] ?></strong>
+										<input type="radio" name="mod_ban_users" value="1"<?php if ($group['g_mod_ban_users'] == '1') echo ' checked="checked"' ?> tabindex="13" />&#160;<strong><?php echo $lang_admin_common['Yes'] ?></strong>&#160;&#160;&#160;<input type="radio" name="mod_ban_users" value="0"<?php if ($group['g_mod_ban_users'] == '0') echo ' checked="checked"' ?> tabindex="14" />&#160;<strong><?php echo $lang_admin_common['No'] ?></strong>
 										<span><?php echo $lang_admin_groups['Ban users help'] ?></span>
 									</td>
 								</tr>
 <?php endif; endif; ?>								<tr>
 									<th scope="row"><?php echo $lang_admin_groups['Read board label'] ?></th>
 									<td>
-										<input type="radio" name="read_board" value="1"<?php if ($group['g_read_board'] == '1') echo ' checked="checked"' ?> tabindex="13" />&#160;<strong><?php echo $lang_admin_common['Yes'] ?></strong>&#160;&#160;&#160;<input type="radio" name="read_board" value="0"<?php if ($group['g_read_board'] == '0') echo ' checked="checked"' ?> tabindex="14" />&#160;<strong><?php echo $lang_admin_common['No'] ?></strong>
+										<input type="radio" name="read_board" value="1"<?php if ($group['g_read_board'] == '1') echo ' checked="checked"' ?> tabindex="15" />&#160;<strong><?php echo $lang_admin_common['Yes'] ?></strong>&#160;&#160;&#160;<input type="radio" name="read_board" value="0"<?php if ($group['g_read_board'] == '0') echo ' checked="checked"' ?> tabindex="16" />&#160;<strong><?php echo $lang_admin_common['No'] ?></strong>
 										<span><?php echo $lang_admin_groups['Read board help'] ?></span>
 									</td>
 								</tr>
 								<tr>
 									<th scope="row"><?php echo $lang_admin_groups['View user info label'] ?></th>
 									<td>
-										<input type="radio" name="view_users" value="1"<?php if ($group['g_view_users'] == '1') echo ' checked="checked"' ?> tabindex="15" />&#160;<strong><?php echo $lang_admin_common['Yes'] ?></strong>&#160;&#160;&#160;<input type="radio" name="view_users" value="0"<?php if ($group['g_view_users'] == '0') echo ' checked="checked"' ?> tabindex="16" />&#160;<strong><?php echo $lang_admin_common['No'] ?></strong>
+										<input type="radio" name="view_users" value="1"<?php if ($group['g_view_users'] == '1') echo ' checked="checked"' ?> tabindex="17" />&#160;<strong><?php echo $lang_admin_common['Yes'] ?></strong>&#160;&#160;&#160;<input type="radio" name="view_users" value="0"<?php if ($group['g_view_users'] == '0') echo ' checked="checked"' ?> tabindex="18" />&#160;<strong><?php echo $lang_admin_common['No'] ?></strong>
 										<span><?php echo $lang_admin_groups['View user info help'] ?></span>
 									</td>
 								</tr>
 								<tr>
 									<th scope="row"><?php echo $lang_admin_groups['Post replies label'] ?></th>
 									<td>
-										<input type="radio" name="post_replies" value="1"<?php if ($group['g_post_replies'] == '1') echo ' checked="checked"' ?> tabindex="17" />&#160;<strong><?php echo $lang_admin_common['Yes'] ?></strong>&#160;&#160;&#160;<input type="radio" name="post_replies" value="0"<?php if ($group['g_post_replies'] == '0') echo ' checked="checked"' ?> tabindex="18" />&#160;<strong><?php echo $lang_admin_common['No'] ?></strong>
+										<input type="radio" name="post_replies" value="1"<?php if ($group['g_post_replies'] == '1') echo ' checked="checked"' ?> tabindex="19" />&#160;<strong><?php echo $lang_admin_common['Yes'] ?></strong>&#160;&#160;&#160;<input type="radio" name="post_replies" value="0"<?php if ($group['g_post_replies'] == '0') echo ' checked="checked"' ?> tabindex="20" />&#160;<strong><?php echo $lang_admin_common['No'] ?></strong>
 										<span><?php echo $lang_admin_groups['Post replies help'] ?></span>
 									</td>
 								</tr>
 								<tr>
 									<th scope="row"><?php echo $lang_admin_groups['Post topics label'] ?></th>
 									<td>
-										<input type="radio" name="post_topics" value="1"<?php if ($group['g_post_topics'] == '1') echo ' checked="checked"' ?> tabindex="19" />&#160;<strong><?php echo $lang_admin_common['Yes'] ?></strong>&#160;&#160;&#160;<input type="radio" name="post_topics" value="0"<?php if ($group['g_post_topics'] == '0') echo ' checked="checked"' ?> tabindex="20" />&#160;<strong><?php echo $lang_admin_common['No'] ?></strong>
+										<input type="radio" name="post_topics" value="1"<?php if ($group['g_post_topics'] == '1') echo ' checked="checked"' ?> tabindex="21" />&#160;<strong><?php echo $lang_admin_common['Yes'] ?></strong>&#160;&#160;&#160;<input type="radio" name="post_topics" value="0"<?php if ($group['g_post_topics'] == '0') echo ' checked="checked"' ?> tabindex="22" />&#160;<strong><?php echo $lang_admin_common['No'] ?></strong>
 										<span><?php echo $lang_admin_groups['Post topics help'] ?></span>
 									</td>
 								</tr>
 <?php if ($group['g_id'] != PUN_GUEST): ?>								<tr>
 									<th scope="row"><?php echo $lang_admin_groups['Edit posts label'] ?></th>
 									<td>
-										<input type="radio" name="edit_posts" value="1"<?php if ($group['g_edit_posts'] == '1') echo ' checked="checked"' ?> tabindex="21" />&#160;<strong><?php echo $lang_admin_common['Yes'] ?></strong>&#160;&#160;&#160;<input type="radio" name="edit_posts" value="0"<?php if ($group['g_edit_posts'] == '0') echo ' checked="checked"' ?> tabindex="22" />&#160;<strong><?php echo $lang_admin_common['No'] ?></strong>
+										<input type="radio" name="edit_posts" value="1"<?php if ($group['g_edit_posts'] == '1') echo ' checked="checked"' ?> tabindex="23" />&#160;<strong><?php echo $lang_admin_common['Yes'] ?></strong>&#160;&#160;&#160;<input type="radio" name="edit_posts" value="0"<?php if ($group['g_edit_posts'] == '0') echo ' checked="checked"' ?> tabindex="24" />&#160;<strong><?php echo $lang_admin_common['No'] ?></strong>
 										<span><?php echo $lang_admin_groups['Edit posts help'] ?></span>
 									</td>
 								</tr>
 								<tr>
 									<th scope="row"><?php echo $lang_admin_groups['Delete posts label'] ?></th>
 									<td>
-										<input type="radio" name="delete_posts" value="1"<?php if ($group['g_delete_posts'] == '1') echo ' checked="checked"' ?> tabindex="23" />&#160;<strong><?php echo $lang_admin_common['Yes'] ?></strong>&#160;&#160;&#160;<input type="radio" name="delete_posts" value="0"<?php if ($group['g_delete_posts'] == '0') echo ' checked="checked"' ?> tabindex="24" />&#160;<strong><?php echo $lang_admin_common['No'] ?></strong>
+										<input type="radio" name="delete_posts" value="1"<?php if ($group['g_delete_posts'] == '1') echo ' checked="checked"' ?> tabindex="25" />&#160;<strong><?php echo $lang_admin_common['Yes'] ?></strong>&#160;&#160;&#160;<input type="radio" name="delete_posts" value="0"<?php if ($group['g_delete_posts'] == '0') echo ' checked="checked"' ?> tabindex="26" />&#160;<strong><?php echo $lang_admin_common['No'] ?></strong>
 										<span><?php echo $lang_admin_groups['Delete posts help'] ?></span>
 									</td>
 								</tr>
 								<tr>
 									<th scope="row"><?php echo $lang_admin_groups['Delete topics label'] ?></th>
 									<td>
-										<input type="radio" name="delete_topics" value="1"<?php if ($group['g_delete_topics'] == '1') echo ' checked="checked"' ?> tabindex="25" />&#160;<strong><?php echo $lang_admin_common['Yes'] ?></strong>&#160;&#160;&#160;<input type="radio" name="delete_topics" value="0"<?php if ($group['g_delete_topics'] == '0') echo ' checked="checked"' ?> tabindex="26" />&#160;<strong><?php echo $lang_admin_common['No'] ?></strong>
+										<input type="radio" name="delete_topics" value="1"<?php if ($group['g_delete_topics'] == '1') echo ' checked="checked"' ?> tabindex="27" />&#160;<strong><?php echo $lang_admin_common['Yes'] ?></strong>&#160;&#160;&#160;<input type="radio" name="delete_topics" value="0"<?php if ($group['g_delete_topics'] == '0') echo ' checked="checked"' ?> tabindex="28" />&#160;<strong><?php echo $lang_admin_common['No'] ?></strong>
 										<span><?php echo $lang_admin_groups['Delete topics help'] ?></span>
 									</td>
 								</tr>
 								<tr>
 									<th scope="row"><?php echo $lang_admin_groups['Set own title label'] ?></th>
 									<td>
-										<input type="radio" name="set_title" value="1"<?php if ($group['g_set_title'] == '1') echo ' checked="checked"' ?> tabindex="27" />&#160;<strong><?php echo $lang_admin_common['Yes'] ?></strong>&#160;&#160;&#160;<input type="radio" name="set_title" value="0"<?php if ($group['g_set_title'] == '0') echo ' checked="checked"' ?> tabindex="28" />&#160;<strong><?php echo $lang_admin_common['No'] ?></strong>
+										<input type="radio" name="set_title" value="1"<?php if ($group['g_set_title'] == '1') echo ' checked="checked"' ?> tabindex="29" />&#160;<strong><?php echo $lang_admin_common['Yes'] ?></strong>&#160;&#160;&#160;<input type="radio" name="set_title" value="0"<?php if ($group['g_set_title'] == '0') echo ' checked="checked"' ?> tabindex="30" />&#160;<strong><?php echo $lang_admin_common['No'] ?></strong>
 										<span><?php echo $lang_admin_groups['Set own title help'] ?></span>
 									</td>
 								</tr>
 <?php endif; ?>								<tr>
 									<th scope="row"><?php echo $lang_admin_groups['User search label'] ?></th>
 									<td>
-										<input type="radio" name="search" value="1"<?php if ($group['g_search'] == '1') echo ' checked="checked"' ?> tabindex="29" />&#160;<strong><?php echo $lang_admin_common['Yes'] ?></strong>&#160;&#160;&#160;<input type="radio" name="search" value="0"<?php if ($group['g_search'] == '0') echo ' checked="checked"' ?> tabindex="30" />&#160;<strong><?php echo $lang_admin_common['No'] ?></strong>
+										<input type="radio" name="search" value="1"<?php if ($group['g_search'] == '1') echo ' checked="checked"' ?> tabindex="31" />&#160;<strong><?php echo $lang_admin_common['Yes'] ?></strong>&#160;&#160;&#160;<input type="radio" name="search" value="0"<?php if ($group['g_search'] == '0') echo ' checked="checked"' ?> tabindex="32" />&#160;<strong><?php echo $lang_admin_common['No'] ?></strong>
 										<span><?php echo $lang_admin_groups['User search help'] ?></span>
 									</td>
 								</tr>
 								<tr>
 									<th scope="row"><?php echo $lang_admin_groups['User list search label'] ?></th>
 									<td>
-										<input type="radio" name="search_users" value="1"<?php if ($group['g_search_users'] == '1') echo ' checked="checked"' ?> tabindex="31" />&#160;<strong><?php echo $lang_admin_common['Yes'] ?></strong>&#160;&#160;&#160;<input type="radio" name="search_users" value="0"<?php if ($group['g_search_users'] == '0') echo ' checked="checked"' ?> tabindex="32" />&#160;<strong><?php echo $lang_admin_common['No'] ?></strong>
+										<input type="radio" name="search_users" value="1"<?php if ($group['g_search_users'] == '1') echo ' checked="checked"' ?> tabindex="33" />&#160;<strong><?php echo $lang_admin_common['Yes'] ?></strong>&#160;&#160;&#160;<input type="radio" name="search_users" value="0"<?php if ($group['g_search_users'] == '0') echo ' checked="checked"' ?> tabindex="34" />&#160;<strong><?php echo $lang_admin_common['No'] ?></strong>
 										<span><?php echo $lang_admin_groups['User list search help'] ?></span>
 									</td>
 								</tr>
 <?php if ($group['g_id'] != PUN_GUEST): ?>								<tr>
 									<th scope="row"><?php echo $lang_admin_groups['Send e-mails label'] ?></th>
 									<td>
-										<input type="radio" name="send_email" value="1"<?php if ($group['g_send_email'] == '1') echo ' checked="checked"' ?> tabindex="33" />&#160;<strong><?php echo $lang_admin_common['Yes'] ?></strong>&#160;&#160;&#160;<input type="radio" name="send_email" value="0"<?php if ($group['g_send_email'] == '0') echo ' checked="checked"' ?> tabindex="34" />&#160;<strong><?php echo $lang_admin_common['No'] ?></strong>
+										<input type="radio" name="send_email" value="1"<?php if ($group['g_send_email'] == '1') echo ' checked="checked"' ?> tabindex="35" />&#160;<strong><?php echo $lang_admin_common['Yes'] ?></strong>&#160;&#160;&#160;<input type="radio" name="send_email" value="0"<?php if ($group['g_send_email'] == '0') echo ' checked="checked"' ?> tabindex="36" />&#160;<strong><?php echo $lang_admin_common['No'] ?></strong>
 										<span><?php echo $lang_admin_groups['Send e-mails help'] ?></span>
 									</td>
 								</tr>
 <?php endif; ?>								<tr>
 									<th scope="row"><?php echo $lang_admin_groups['Post flood label'] ?></th>
 									<td>
-										<input type="text" name="post_flood" size="5" maxlength="4" value="<?php echo $group['g_post_flood'] ?>" tabindex="35" />
+										<input type="text" name="post_flood" size="5" maxlength="4" value="<?php echo $group['g_post_flood'] ?>" tabindex="37" />
 										<span><?php echo $lang_admin_groups['Post flood help'] ?></span>
 									</td>
 								</tr>
 								<tr>
 									<th scope="row"><?php echo $lang_admin_groups['Search flood label'] ?></th>
 									<td>
-										<input type="text" name="search_flood" size="5" maxlength="4" value="<?php echo $group['g_search_flood'] ?>" tabindex="36" />
+										<input type="text" name="search_flood" size="5" maxlength="4" value="<?php echo $group['g_search_flood'] ?>" tabindex="38" />
 										<span><?php echo $lang_admin_groups['Search flood help'] ?></span>
 									</td>
 								</tr>
 <?php if ($group['g_id'] != PUN_GUEST): ?>								<tr>
 									<th scope="row"><?php echo $lang_admin_groups['E-mail flood label'] ?></th>
 									<td>
-										<input type="text" name="email_flood" size="5" maxlength="4" value="<?php echo $group['g_email_flood'] ?>" tabindex="37" />
+										<input type="text" name="email_flood" size="5" maxlength="4" value="<?php echo $group['g_email_flood'] ?>" tabindex="39" />
 										<span><?php echo $lang_admin_groups['E-mail flood help'] ?></span>
 									</td>
 								</tr>
 								<tr>
 									<th scope="row"><?php echo $lang_admin_groups['Report flood label'] ?></th>
 									<td>
-										<input type="text" name="report_flood" size="5" maxlength="4" value="<?php echo $group['g_report_flood'] ?>" tabindex="38" />
+										<input type="text" name="report_flood" size="5" maxlength="4" value="<?php echo $group['g_report_flood'] ?>" tabindex="40" />
 										<span><?php echo $lang_admin_groups['Report flood help'] ?></span>
 									</td>
 								</tr>
@@ -229,7 +254,7 @@
 <?php endif; ?>						</div>
 					</fieldset>
 				</div>
-				<p class="submitend"><input type="submit" name="add_edit_group" value="<?php echo $lang_admin_common['Save'] ?>" tabindex="39" /></p>
+				<p class="submitend"><input type="submit" name="add_edit_group" value="<?php echo $lang_admin_common['Save'] ?>" tabindex="41" /></p>
 			</form>
 		</div>
 	</div>
@@ -251,6 +276,8 @@
 
 	$title = pun_trim($_POST['req_title']);
 	$user_title = pun_trim($_POST['user_title']);
+	$promote_min_posts = isset($_POST['promote_min_posts']) ? intval($_POST['promote_min_posts']) : '0';
+	$promote_next_group = isset($_POST['promote_next_group']) && isset($groups[$_POST['promote_next_group']]) ? $_POST['promote_next_group'] : '0';
 	$moderator = isset($_POST['moderator']) && $_POST['moderator'] == '1' ? '1' : '0';
 	$mod_edit_users = $moderator == '1' && isset($_POST['mod_edit_users']) && $_POST['mod_edit_users'] == '1' ? '1' : '0';
 	$mod_rename_users = $moderator == '1' && isset($_POST['mod_rename_users']) && $_POST['mod_rename_users'] == '1' ? '1' : '0';
@@ -283,7 +310,7 @@
 		if ($db->num_rows($result))
 			message(sprintf($lang_admin_groups['Title already exists message'], pun_htmlspecialchars($title)));
 
-		$db->query('INSERT INTO '.$db->prefix.'groups (g_title, g_user_title, g_moderator, g_mod_edit_users, g_mod_rename_users, g_mod_change_passwords, g_mod_ban_users, g_read_board, g_view_users, g_post_replies, g_post_topics, g_edit_posts, g_delete_posts, g_delete_topics, g_set_title, g_search, g_search_users, g_send_email, g_post_flood, g_search_flood, g_email_flood, g_report_flood) VALUES(\''.$db->escape($title).'\', '.$user_title.', '.$moderator.', '.$mod_edit_users.', '.$mod_rename_users.', '.$mod_change_passwords.', '.$mod_ban_users.', '.$read_board.', '.$view_users.', '.$post_replies.', '.$post_topics.', '.$edit_posts.', '.$delete_posts.', '.$delete_topics.', '.$set_title.', '.$search.', '.$search_users.', '.$send_email.', '.$post_flood.', '.$search_flood.', '.$email_flood.', '.$report_flood.')') or error('Unable to add group', __FILE__, __LINE__, $db->error());
+		$db->query('INSERT INTO '.$db->prefix.'groups (g_title, g_user_title, g_promote_min_posts, g_promote_next_group, g_moderator, g_mod_edit_users, g_mod_rename_users, g_mod_change_passwords, g_mod_ban_users, g_read_board, g_view_users, g_post_replies, g_post_topics, g_edit_posts, g_delete_posts, g_delete_topics, g_set_title, g_search, g_search_users, g_send_email, g_post_flood, g_search_flood, g_email_flood, g_report_flood) VALUES(\''.$db->escape($title).'\', '.$user_title.', '.$promote_min_posts.', '.$promote_next_group.', '.$moderator.', '.$mod_edit_users.', '.$mod_rename_users.', '.$mod_change_passwords.', '.$mod_ban_users.', '.$read_board.', '.$view_users.', '.$post_replies.', '.$post_topics.', '.$edit_posts.', '.$delete_posts.', '.$delete_topics.', '.$set_title.', '.$search.', '.$search_users.', '.$send_email.', '.$post_flood.', '.$search_flood.', '.$email_flood.', '.$report_flood.')') or error('Unable to add group', __FILE__, __LINE__, $db->error());
 		$new_group_id = $db->insert_id();
 
 		// Now lets copy the forum specific permissions from the group which this group is based on
@@ -297,7 +324,7 @@
 		if ($db->num_rows($result))
 			message(sprintf($lang_admin_groups['Title already exists message'], pun_htmlspecialchars($title)));
 
-		$db->query('UPDATE '.$db->prefix.'groups SET g_title=\''.$db->escape($title).'\', g_user_title='.$user_title.', g_moderator='.$moderator.', g_mod_edit_users='.$mod_edit_users.', g_mod_rename_users='.$mod_rename_users.', g_mod_change_passwords='.$mod_change_passwords.', g_mod_ban_users='.$mod_ban_users.', g_read_board='.$read_board.', g_view_users='.$view_users.', g_post_replies='.$post_replies.', g_post_topics='.$post_topics.', g_edit_posts='.$edit_posts.', g_delete_posts='.$delete_posts.', g_delete_topics='.$delete_topics.', g_set_title='.$set_title.', g_search='.$search.', g_search_users='.$search_users.', g_send_email='.$send_email.', g_post_flood='.$post_flood.', g_search_flood='.$search_flood.', g_email_flood='.$email_flood.', g_report_flood='.$report_flood.' WHERE g_id='.intval($_POST['group_id'])) or error('Unable to update group', __FILE__, __LINE__, $db->error());
+		$db->query('UPDATE '.$db->prefix.'groups SET g_title=\''.$db->escape($title).'\', g_user_title='.$user_title.', g_promote_min_posts='.$promote_min_posts.', g_promote_next_group='.$promote_next_group.', g_moderator='.$moderator.', g_mod_edit_users='.$mod_edit_users.', g_mod_rename_users='.$mod_rename_users.', g_mod_change_passwords='.$mod_change_passwords.', g_mod_ban_users='.$mod_ban_users.', g_read_board='.$read_board.', g_view_users='.$view_users.', g_post_replies='.$post_replies.', g_post_topics='.$post_topics.', g_edit_posts='.$edit_posts.', g_delete_posts='.$delete_posts.', g_delete_topics='.$delete_topics.', g_set_title='.$set_title.', g_search='.$search.', g_search_users='.$search_users.', g_send_email='.$send_email.', g_post_flood='.$post_flood.', g_search_flood='.$search_flood.', g_email_flood='.$email_flood.', g_report_flood='.$report_flood.' WHERE g_id='.intval($_POST['group_id'])) or error('Unable to update group', __FILE__, __LINE__, $db->error());
 	}
 
 	// Regenerate the quick jump cache
@@ -326,8 +353,7 @@
 		message($lang_common['Bad request']);
 
 	// Make sure it's not a moderator group
-	$result = $db->query('SELECT 1 FROM '.$db->prefix.'groups WHERE g_id='.$group_id.' AND g_moderator=0') or error('Unable to check group moderator status', __FILE__, __LINE__, $db->error());
-	if (!$db->num_rows($result))
+	if ($groups[$group_id]['g_moderator'] != 0)
 		message($lang_common['Bad request']);
 
 	$db->query('UPDATE '.$db->prefix.'config SET conf_value='.$group_id.' WHERE conf_name=\'o_default_user_group\'') or error('Unable to update board config', __FILE__, __LINE__, $db->error());
@@ -485,14 +511,15 @@
 										<select id="base_group" name="base_group" tabindex="1">
 <?php
 
-$result = $db->query('SELECT g_id, g_title FROM '.$db->prefix.'groups WHERE g_id!='.PUN_ADMIN.' AND g_id!='.PUN_GUEST.' ORDER BY g_title') or error('Unable to fetch user group list', __FILE__, __LINE__, $db->error());
-
-while ($cur_group = $db->fetch_assoc($result))
+foreach ($groups as $cur_group)
 {
-	if ($cur_group['g_id'] == $pun_config['o_default_user_group'])
-		echo "\t\t\t\t\t\t\t\t\t\t\t".'<option value="'.$cur_group['g_id'].'" selected="selected">'.pun_htmlspecialchars($cur_group['g_title']).'</option>'."\n";
-	else
-		echo "\t\t\t\t\t\t\t\t\t\t\t".'<option value="'.$cur_group['g_id'].'">'.pun_htmlspecialchars($cur_group['g_title']).'</option>'."\n";
+	if ($cur_group['g_id'] != PUN_ADMIN && $cur_group['g_id'] != PUN_GUEST)
+	{
+		if ($cur_group['g_id'] == $pun_config['o_default_user_group'])
+			echo "\t\t\t\t\t\t\t\t\t\t\t".'<option value="'.$cur_group['g_id'].'" selected="selected">'.pun_htmlspecialchars($cur_group['g_title']).'</option>'."\n";
+		else
+			echo "\t\t\t\t\t\t\t\t\t\t\t".'<option value="'.$cur_group['g_id'].'">'.pun_htmlspecialchars($cur_group['g_title']).'</option>'."\n";
+	}
 }
 
 ?>
@@ -515,14 +542,15 @@
 										<select id="default_group" name="default_group" tabindex="3">
 <?php
 
-$result = $db->query('SELECT g_id, g_title FROM '.$db->prefix.'groups WHERE g_id>'.PUN_GUEST.' AND g_moderator=0 ORDER BY g_title') or error('Unable to fetch user group list', __FILE__, __LINE__, $db->error());
-
-while ($cur_group = $db->fetch_assoc($result))
+foreach ($groups as $cur_group)
 {
-	if ($cur_group['g_id'] == $pun_config['o_default_user_group'])
-		echo "\t\t\t\t\t\t\t\t\t\t\t".'<option value="'.$cur_group['g_id'].'" selected="selected">'.pun_htmlspecialchars($cur_group['g_title']).'</option>'."\n";
-	else
-		echo "\t\t\t\t\t\t\t\t\t\t\t".'<option value="'.$cur_group['g_id'].'">'.pun_htmlspecialchars($cur_group['g_title']).'</option>'."\n";
+	if ($cur_group['g_id'] > PUN_GUEST && $cur_group['g_moderator'] == 0)
+	{
+		if ($cur_group['g_id'] == $pun_config['o_default_user_group'])
+			echo "\t\t\t\t\t\t\t\t\t\t\t".'<option value="'.$cur_group['g_id'].'" selected="selected">'.pun_htmlspecialchars($cur_group['g_title']).'</option>'."\n";
+		else
+			echo "\t\t\t\t\t\t\t\t\t\t\t".'<option value="'.$cur_group['g_id'].'">'.pun_htmlspecialchars($cur_group['g_title']).'</option>'."\n";
+	}
 }
 
 ?>
@@ -550,9 +578,7 @@
 
 $cur_index = 5;
 
-$result = $db->query('SELECT g_id, g_title FROM '.$db->prefix.'groups ORDER BY g_id') or error('Unable to fetch user group list', __FILE__, __LINE__, $db->error());
-
-while ($cur_group = $db->fetch_assoc($result))
+foreach ($groups as $cur_group)
 	echo "\t\t\t\t\t\t\t\t".'<tr><th scope="row"><a href="admin_groups.php?edit_group='.$cur_group['g_id'].'" tabindex="'.$cur_index++.'">'.$lang_admin_groups['Edit link'].'</a>'.(($cur_group['g_id'] > PUN_MEMBER) ? ' | <a href="admin_groups.php?del_group='.$cur_group['g_id'].'" tabindex="'.$cur_index++.'">'.$lang_admin_groups['Delete link'].'</a>' : '').'</th><td>'.pun_htmlspecialchars($cur_group['g_title']).'</td></tr>'."\n";
 
 ?>
diff --git a/lang/English/admin_groups.php b/lang/English/admin_groups.php
index 4b1b4ad..af5a8d2 100644
--- a/lang/English/admin_groups.php
+++ b/lang/English/admin_groups.php
@@ -38,7 +38,10 @@
 'Group settings info'			=>	'Below options and permissions are the default permissions for the user group. These options apply if no forum specific permissions are in effect.',
 'Group title label'				=>	'Group title',
 'User title label'				=>	'User title',
-'User title help'				=>	'This title will override any rank users in this group have attained. Leave blank to use default title or rank.',
+'User title help'				=>	'The rank users in this group have attained. Leave blank to use default title.',
+'Promote users label'			=>	'Promote users',
+'Promote users help'			=>	'You can promote users to a new group automatically if they reach a certain number of posts. Select "%s" to disable.',
+'Disable promotion'				=>	'Disable promoting',
 'Mod privileges label'			=>	'Allow users moderator privileges',
 'Mod privileges help'			=>	'In order for a user in this group to have moderator abilities, he/she must be assigned to moderate one or more forums. This is done via the user administration page of the user\'s profile.',
 'Edit profile label'			=>	'Allow moderators to edit user profiles',
-- 
1.7.10


From 0de401d263a3f2740c267a3b9b85b43c8c5be48d Mon Sep 17 00:00:00 2001
From: Franz Liedke <franz@develophp.org>
Date: Tue, 27 Mar 2012 14:44:57 +0200
Subject: [PATCH 03/75] Do not allow user group promotion for and to admins.

Related to #647.
---
 admin_groups.php              |   13 +++++++++----
 lang/English/admin_groups.php |    2 +-
 2 files changed, 10 insertions(+), 5 deletions(-)

diff --git a/admin_groups.php b/admin_groups.php
index e6c2975..d99dc43 100644
--- a/admin_groups.php
+++ b/admin_groups.php
@@ -85,7 +85,7 @@
 										<span><?php echo $lang_admin_groups['User title help'] ?></span>
 									</td>
 								</tr>
-								<tr>
+<?php if ($group['g_id'] != PUN_ADMIN): if ($group['g_id'] != PUN_GUEST): ?>								<tr>
 									<th scope="row"><?php echo $lang_admin_groups['Promote users label'] ?></th>
 									<td>
 										<select name="promote_next_group" tabindex="4">
@@ -94,7 +94,7 @@
 
 foreach ($groups as $cur_group)
 {
-	if ($cur_group['g_id'] != $group['g_id'])
+	if ($cur_group['g_id'] != $group['g_id'] && $cur_group['g_id'] != PUN_ADMIN)
 	{
 		if ($cur_group['g_id'] == $group['g_promote_next_group'])
 			echo "\t\t\t\t\t\t\t\t\t\t\t".'<option value="'.$cur_group['g_id'].'" selected="selected">'.pun_htmlspecialchars($cur_group['g_title']).'</option>'."\n";
@@ -109,7 +109,7 @@
 										<span><?php printf($lang_admin_groups['Promote users help'], $lang_admin_groups['Disable promotion']) ?></span>
 									</td>
 								</tr>
-<?php if ($group['g_id'] != PUN_ADMIN): if ($group['g_id'] != PUN_GUEST): if ($mode != 'edit' || $pun_config['o_default_user_group'] != $group['g_id']): ?>								<tr>
+<?php if ($mode != 'edit' || $pun_config['o_default_user_group'] != $group['g_id']): ?>								<tr>
 									<th scope="row"> <?php echo $lang_admin_groups['Mod privileges label'] ?></th>
 									<td>
 										<input type="radio" name="moderator" value="1"<?php if ($group['g_moderator'] == '1') echo ' checked="checked"' ?> tabindex="5" />&#160;<strong><?php echo $lang_admin_common['Yes'] ?></strong>&#160;&#160;&#160;<input type="radio" name="moderator" value="0"<?php if ($group['g_moderator'] == '0') echo ' checked="checked"' ?> tabindex="6" />&#160;<strong><?php echo $lang_admin_common['No'] ?></strong>
@@ -276,8 +276,13 @@
 
 	$title = pun_trim($_POST['req_title']);
 	$user_title = pun_trim($_POST['user_title']);
+
 	$promote_min_posts = isset($_POST['promote_min_posts']) ? intval($_POST['promote_min_posts']) : '0';
-	$promote_next_group = isset($_POST['promote_next_group']) && isset($groups[$_POST['promote_next_group']]) ? $_POST['promote_next_group'] : '0';
+	if (isset($_POST['promote_next_group']) && isset($groups[$_POST['promote_next_group']]) && !in_array($_POST['promote_next_group'], array(PUN_ADMIN, $_POST['group_id'])))
+		$promote_next_group = $_POST['promote_next_group'];
+	else
+		$promote_next_group = '0';
+
 	$moderator = isset($_POST['moderator']) && $_POST['moderator'] == '1' ? '1' : '0';
 	$mod_edit_users = $moderator == '1' && isset($_POST['mod_edit_users']) && $_POST['mod_edit_users'] == '1' ? '1' : '0';
 	$mod_rename_users = $moderator == '1' && isset($_POST['mod_rename_users']) && $_POST['mod_rename_users'] == '1' ? '1' : '0';
diff --git a/lang/English/admin_groups.php b/lang/English/admin_groups.php
index af5a8d2..1011509 100644
--- a/lang/English/admin_groups.php
+++ b/lang/English/admin_groups.php
@@ -40,7 +40,7 @@
 'User title label'				=>	'User title',
 'User title help'				=>	'The rank users in this group have attained. Leave blank to use default title.',
 'Promote users label'			=>	'Promote users',
-'Promote users help'			=>	'You can promote users to a new group automatically if they reach a certain number of posts. Select "%s" to disable.',
+'Promote users help'			=>	'You can promote users to a new group automatically if they reach a certain number of posts. Select "%s" to disable. For security reasons, you are not allowed to select an administrator group here.',
 'Disable promotion'				=>	'Disable promoting',
 'Mod privileges label'			=>	'Allow users moderator privileges',
 'Mod privileges help'			=>	'In order for a user in this group to have moderator abilities, he/she must be assigned to moderate one or more forums. This is done via the user administration page of the user\'s profile.',
-- 
1.7.10


From 98678f3faf16ca8d7c65dbebbc6e723253567126 Mon Sep 17 00:00:00 2001
From: Franz Liedke <franz@develophp.org>
Date: Tue, 27 Mar 2012 14:54:15 +0200
Subject: [PATCH 04/75] Don't promote users to a group if that group is being
 deleted.

Related to #647.
---
 admin_groups.php |    3 +++
 1 file changed, 3 insertions(+)

diff --git a/admin_groups.php b/admin_groups.php
index d99dc43..8001697 100644
--- a/admin_groups.php
+++ b/admin_groups.php
@@ -404,6 +404,9 @@
 			$db->query('DELETE FROM '.$db->prefix.'groups WHERE g_id='.$group_id) or error('Unable to delete group', __FILE__, __LINE__, $db->error());
 			$db->query('DELETE FROM '.$db->prefix.'forum_perms WHERE group_id='.$group_id) or error('Unable to delete group forum permissions', __FILE__, __LINE__, $db->error());
 
+			// Don't let users be promoted to this group
+			$db->query('UPDATE '.$db->prefix.'groups SET g_promote_next_group=0 WHERE g_promote_next_group='.$group_id) or error('Unable to remove group as promotion target', __FILE__, __LINE__, $db->error());
+
 			redirect('admin_groups.php', $lang_admin_groups['Group removed redirect']);
 		}
 		else
-- 
1.7.10


From b7f3c0ec69d494629a2d2a909a8bc4acef3ed11e Mon Sep 17 00:00:00 2001
From: Franz Liedke <franz@develophp.org>
Date: Tue, 27 Mar 2012 14:56:54 +0200
Subject: [PATCH 05/75] #647: Promote user to new group after posting, if
 enabled.

---
 post.php |   10 +++++++++-
 1 file changed, 9 insertions(+), 1 deletion(-)

diff --git a/post.php b/post.php
index e0b7192..a782f5d 100644
--- a/post.php
+++ b/post.php
@@ -152,7 +152,7 @@
 	$hide_smilies = isset($_POST['hide_smilies']) ? '1' : '0';
 	$subscribe = isset($_POST['subscribe']) ? '1' : '0';
 	$stick_topic = isset($_POST['stick_topic']) && $is_admmod ? '1' : '0';
-	
+
 	// Replace four-byte characters (MySQL cannot handle them)
 	$message = strip_bad_multibyte_chars($message);
 
@@ -418,6 +418,14 @@
 		{
 			$db->query('UPDATE '.$db->prefix.'users SET num_posts=num_posts+1, last_post='.$now.' WHERE id='.$pun_user['id']) or error('Unable to update user', __FILE__, __LINE__, $db->error());
 
+			// Promote this user to a new group if enabled
+			if ($pun_user['g_promote_next_group'] != 0 && $pun_user['num_posts'] + 1 >= $pun_user['g_promote_min_posts'])
+			{
+				$new_group_id = $pun_user['g_promote_next_group'];
+				$db->query('UPDATE '.$db->prefix.'users SET group_id='.$new_group_id) or error('Unable to promote user to new group', __FILE__, __LINE__, $db->error());
+			}
+
+			// Topic tracking stuff...
 			$tracked_topics = get_tracked_topics();
 			$tracked_topics['topics'][$new_tid] = time();
 			set_tracked_topics($tracked_topics);
-- 
1.7.10


From 919fdc03e2979892a0b0db59972a977a1d35a36c Mon Sep 17 00:00:00 2001
From: Franz Liedke <franz@develophp.org>
Date: Tue, 27 Mar 2012 15:22:46 +0200
Subject: [PATCH 06/75] #648: Completely remove ranks feature.

---
 admin_options.php              |    8 --
 admin_ranks.php                |  186 ----------------------------------------
 db_update.php                  |   30 +++----
 include/cache.php              |   28 ------
 include/common.php             |    2 +-
 include/common_admin.php       |    1 -
 include/functions.php          |   35 +-------
 install.php                    |   32 +------
 lang/English/admin_common.php  |    1 -
 lang/English/admin_index.php   |    2 +-
 lang/English/admin_options.php |    4 +-
 lang/English/admin_ranks.php   |   23 -----
 lang/English/install.php       |    2 -
 lang/English/update.php        |    1 -
 style/Air/base_admin.css       |    2 +-
 style/Earth/base_admin.css     |    2 +-
 style/Fire/base_admin.css      |    2 +-
 style/imports/base_admin.css   |    2 +-
 18 files changed, 21 insertions(+), 342 deletions(-)
 delete mode 100644 admin_ranks.php
 delete mode 100644 lang/English/admin_ranks.php

diff --git a/admin_options.php b/admin_options.php
index 3e8581e..36ba066 100644
--- a/admin_options.php
+++ b/admin_options.php
@@ -52,7 +52,6 @@
 		'users_online'			=> $_POST['form']['users_online'] != '1' ? '0' : '1',
 		'censoring'				=> $_POST['form']['censoring'] != '1' ? '0' : '1',
 		'signatures'			=> $_POST['form']['signatures'] != '1' ? '0' : '1',
-		'ranks'					=> $_POST['form']['ranks'] != '1' ? '0' : '1',
 		'show_dot'				=> $_POST['form']['show_dot'] != '1' ? '0' : '1',
 		'topic_views'			=> $_POST['form']['topic_views'] != '1' ? '0' : '1',
 		'quickjump'				=> $_POST['form']['quickjump'] != '1' ? '0' : '1',
@@ -523,13 +522,6 @@
 									</td>
 								</tr>
 								<tr>
-									<th scope="row"><a name="ranks"><?php echo $lang_admin_options['User ranks label'] ?></a></th>
-									<td>
-										<input type="radio" name="form[ranks]" value="1"<?php if ($pun_config['o_ranks'] == '1') echo ' checked="checked"' ?> />&#160;<strong><?php echo $lang_admin_common['Yes'] ?></strong>&#160;&#160;&#160;<input type="radio" name="form[ranks]" value="0"<?php if ($pun_config['o_ranks'] == '0') echo ' checked="checked"' ?> />&#160;<strong><?php echo $lang_admin_common['No'] ?></strong>
-										<span><?php printf($lang_admin_options['User ranks help'], '<a href="admin_ranks.php">'.$lang_admin_common['Ranks'].'</a>') ?></span>
-									</td>
-								</tr>
-								<tr>
 									<th scope="row"><?php echo $lang_admin_options['User has posted label'] ?></th>
 									<td>
 										<input type="radio" name="form[show_dot]" value="1"<?php if ($pun_config['o_show_dot'] == '1') echo ' checked="checked"' ?> />&#160;<strong><?php echo $lang_admin_common['Yes'] ?></strong>&#160;&#160;&#160;<input type="radio" name="form[show_dot]" value="0"<?php if ($pun_config['o_show_dot'] == '0') echo ' checked="checked"' ?> />&#160;<strong><?php echo $lang_admin_common['No'] ?></strong>
diff --git a/admin_ranks.php b/admin_ranks.php
deleted file mode 100644
index 37e7e18..0000000
--- a/admin_ranks.php
+++ /dev/null
@@ -1,186 +0,0 @@
-<?php
-
-/**
- * Copyright (C) 2008-2012 FluxBB
- * based on code by Rickard Andersson copyright (C) 2002-2008 PunBB
- * License: http://www.gnu.org/licenses/gpl.html GPL version 2 or higher
- */
-
-// Tell header.php to use the admin template
-define('PUN_ADMIN_CONSOLE', 1);
-
-define('PUN_ROOT', dirname(__FILE__).'/');
-require PUN_ROOT.'include/common.php';
-require PUN_ROOT.'include/common_admin.php';
-
-
-if ($pun_user['g_id'] != PUN_ADMIN)
-	message($lang_common['No permission']);
-
-// Load the admin_ranks.php language file
-require PUN_ROOT.'lang/'.$admin_language.'/admin_ranks.php';
-
-// Add a rank
-if (isset($_POST['add_rank']))
-{
-	confirm_referrer('admin_ranks.php');
-
-	$rank = pun_trim($_POST['new_rank']);
-	$min_posts = trim($_POST['new_min_posts']);
-
-	if ($rank == '')
-		message($lang_admin_ranks['Must enter title message']);
-
-	if ($min_posts == '' || preg_match('%[^0-9]%', $min_posts))
-		message($lang_admin_ranks['Must be integer message']);
-
-	// Make sure there isn't already a rank with the same min_posts value
-	$result = $db->query('SELECT 1 FROM '.$db->prefix.'ranks WHERE min_posts='.$min_posts) or error('Unable to fetch rank info', __FILE__, __LINE__, $db->error());
-	if ($db->num_rows($result))
-		message(sprintf($lang_admin_ranks['Dupe min posts message'], $min_posts));
-
-	$db->query('INSERT INTO '.$db->prefix.'ranks (rank, min_posts) VALUES(\''.$db->escape($rank).'\', '.$min_posts.')') or error('Unable to add rank', __FILE__, __LINE__, $db->error());
-
-	// Regenerate the ranks cache
-	if (!defined('FORUM_CACHE_FUNCTIONS_LOADED'))
-		require PUN_ROOT.'include/cache.php';
-
-	generate_ranks_cache();
-
-	redirect('admin_ranks.php', $lang_admin_ranks['Rank added redirect']);
-}
-
-
-// Update a rank
-else if (isset($_POST['update']))
-{
-	confirm_referrer('admin_ranks.php');
-
-	$id = intval(key($_POST['update']));
-
-	$rank = pun_trim($_POST['rank'][$id]);
-	$min_posts = trim($_POST['min_posts'][$id]);
-
-	if ($rank == '')
-		message($lang_admin_ranks['Must enter title message']);
-
-	if ($min_posts == '' || preg_match('%[^0-9]%', $min_posts))
-		message($lang_admin_ranks['Must be integer message']);
-
-	// Make sure there isn't already a rank with the same min_posts value
-	$result = $db->query('SELECT 1 FROM '.$db->prefix.'ranks WHERE id!='.$id.' AND min_posts='.$min_posts) or error('Unable to fetch rank info', __FILE__, __LINE__, $db->error());
-	if ($db->num_rows($result))
-		message(sprintf($lang_admin_ranks['Dupe min posts message'], $min_posts));
-
-	$db->query('UPDATE '.$db->prefix.'ranks SET rank=\''.$db->escape($rank).'\', min_posts='.$min_posts.' WHERE id='.$id) or error('Unable to update rank', __FILE__, __LINE__, $db->error());
-
-	// Regenerate the ranks cache
-	if (!defined('FORUM_CACHE_FUNCTIONS_LOADED'))
-		require PUN_ROOT.'include/cache.php';
-
-	generate_ranks_cache();
-
-	redirect('admin_ranks.php', $lang_admin_ranks['Rank updated redirect']);
-}
-
-
-// Remove a rank
-else if (isset($_POST['remove']))
-{
-	confirm_referrer('admin_ranks.php');
-
-	$id = intval(key($_POST['remove']));
-
-	$db->query('DELETE FROM '.$db->prefix.'ranks WHERE id='.$id) or error('Unable to delete rank', __FILE__, __LINE__, $db->error());
-
-	// Regenerate the ranks cache
-	if (!defined('FORUM_CACHE_FUNCTIONS_LOADED'))
-		require PUN_ROOT.'include/cache.php';
-
-	generate_ranks_cache();
-
-	redirect('admin_ranks.php', $lang_admin_ranks['Rank removed redirect']);
-}
-
-$page_title = array(pun_htmlspecialchars($pun_config['o_board_title']), $lang_admin_common['Admin'], $lang_admin_common['Ranks']);
-$focus_element = array('ranks', 'new_rank');
-define('PUN_ACTIVE_PAGE', 'admin');
-require PUN_ROOT.'header.php';
-
-generate_admin_menu('ranks');
-
-?>
-	<div class="blockform">
-		<h2><span><?php echo $lang_admin_ranks['Ranks head'] ?></span></h2>
-		<div class="box">
-			<form id="ranks" method="post" action="admin_ranks.php">
-				<div class="inform">
-					<fieldset>
-						<legend><?php echo $lang_admin_ranks['Add rank subhead'] ?></legend>
-						<div class="infldset">
-							<p><?php echo $lang_admin_ranks['Add rank info'].' '.($pun_config['o_ranks'] == '1' ? sprintf($lang_admin_ranks['Ranks enabled'], '<a href="admin_options.php#ranks">'.$lang_admin_common['Options'].'</a>') : sprintf($lang_admin_ranks['Ranks disabled'], '<a href="admin_options.php#ranks">'.$lang_admin_common['Options'].'</a>')) ?></p>
-							<table cellspacing="0">
-							<thead>
-								<tr>
-									<th class="tcl" scope="col"><?php echo $lang_admin_ranks['Rank title label'] ?></th>
-									<th class="tc2" scope="col"><?php echo $lang_admin_ranks['Minimum posts label'] ?></th>
-									<th class="hidehead" scope="col"><?php echo $lang_admin_ranks['Actions label'] ?></th>
-								</tr>
-							</thead>
-							<tbody>
-								<tr>
-									<td class="tcl"><input type="text" name="new_rank" size="24" maxlength="50" tabindex="1" /></td>
-									<td class="tc2"><input type="text" name="new_min_posts" size="7" maxlength="7" tabindex="2" /></td>
-									<td><input type="submit" name="add_rank" value="<?php echo $lang_admin_common['Add'] ?>" tabindex="3" /></td>
-								</tr>
-							</tbody>
-							</table>
-						</div>
-					</fieldset>
-				</div>
-				<div class="inform">
-					<fieldset>
-						<legend><?php echo $lang_admin_ranks['Edit remove subhead'] ?></legend>
-						<div class="infldset">
-<?php
-
-$result = $db->query('SELECT id, rank, min_posts FROM '.$db->prefix.'ranks ORDER BY min_posts') or error('Unable to fetch rank list', __FILE__, __LINE__, $db->error());
-if ($db->num_rows($result))
-{
-
-?>
-							<table cellspacing="0">
-							<thead>
-								<tr>
-									<th class="tcl" scope="col"><?php echo $lang_admin_ranks['Rank title label'] ?></th>
-									<th class="tc2" scope="col"><?php echo $lang_admin_ranks['Minimum posts label'] ?></th>
-									<th class="hidehead" scope="col"><?php echo $lang_admin_ranks['Actions label'] ?></th>
-								</tr>
-							</thead>
-							<tbody>
-<?php
-
-	while ($cur_rank = $db->fetch_assoc($result))
-		echo "\t\t\t\t\t\t\t\t".'<tr><td class="tcl"><input type="text" name="rank['.$cur_rank['id'].']" value="'.pun_htmlspecialchars($cur_rank['rank']).'" size="24" maxlength="50" /></td><td class="tc2"><input type="text" name="min_posts['.$cur_rank['id'].']" value="'.$cur_rank['min_posts'].'" size="7" maxlength="7" /></td><td><input type="submit" name="update['.$cur_rank['id'].']" value="'.$lang_admin_common['Update'].'" />&#160;<input type="submit" name="remove['.$cur_rank['id'].']" value="'.$lang_admin_common['Remove'].'" /></td></tr>'."\n";
-
-?>
-							</tbody>
-							</table>
-<?php
-
-}
-else
-	echo "\t\t\t\t\t\t\t".'<p>'.$lang_admin_ranks['No ranks in list'].'</p>'."\n";
-
-?>
-						</div>
-					</fieldset>
-				</div>
-			</form>
-		</div>
-	</div>
-	<div class="clearer"></div>
-</div>
-<?php
-
-require PUN_ROOT.'footer.php';
diff --git a/db_update.php b/db_update.php
index 98293bf..aa0c9e9 100644
--- a/db_update.php
+++ b/db_update.php
@@ -9,7 +9,7 @@
 // The FluxBB version this script updates to
 define('UPDATE_TO', '1.5-dev');
 
-define('UPDATE_TO_DB_REVISION', 16);
+define('UPDATE_TO_DB_REVISION', 17);
 define('UPDATE_TO_SI_REVISION', 2);
 define('UPDATE_TO_PARSER_REVISION', 2);
 
@@ -1167,6 +1167,14 @@ function convert_table_utf8($table, $callback, $old_charset, $key = null, $start
 		if ($db_type == 'mysql' || $db_type == 'mysqli')
 			$db->query('ALTER TABLE '.$db->prefix.'online ENGINE = MyISAM') or error('Unable to change engine type of online table to MyISAM', __FILE__, __LINE__, $db->error());
 
+		// Remove config option o_ranks
+		if (array_key_exists('o_ranks', $pun_config))
+			$db->query('DELETE FROM '.$db->prefix.'config WHERE conf_name=\'o_ranks\'') or error('Unable to remove config value \'o_ranks\'', __FILE__, __LINE__, $db->error());
+
+		// Remove the ranks table
+		if ($db->table_exists('ranks'))
+			$db->drop_table('ranks') or error('Unable to drop ranks table', __FILE__, __LINE__, $db->error());
+
 		// Should we do charset conversion or not?
 		if (strpos($cur_version, '1.2') === 0 && isset($_POST['convert_charset']))
 			$query_str = '?stage=conv_bans&req_old_charset='.$old_charset;
@@ -1325,7 +1333,7 @@ function _conv_groups($cur_item, $old_charset)
 
 	// Convert posts
 	case 'conv_posts':
-		$query_str = '?stage=conv_ranks&req_old_charset='.$old_charset;
+		$query_str = '?stage=conv_reports&req_old_charset='.$old_charset;
 
 		function _conv_posts($cur_item, $old_charset)
 		{
@@ -1348,24 +1356,6 @@ function _conv_posts($cur_item, $old_charset)
 		break;
 
 
-	// Convert ranks
-	case 'conv_ranks':
-		$query_str = '?stage=conv_reports&req_old_charset='.$old_charset;
-
-		echo sprintf($lang_update['Converting'], $lang_update['ranks']).'<br />'."\n";
-
-		function _conv_ranks($cur_item, $old_charset)
-		{
-			convert_to_utf8($cur_item['rank'], $old_charset);
-
-			return $cur_item;
-		}
-
-		convert_table_utf8($db->prefix.'ranks', '_conv_ranks', $old_charset, 'id');
-
-		break;
-
-
 	// Convert reports
 	case 'conv_reports':
 		$query_str = '?stage=conv_search_cache&req_old_charset='.$old_charset;
diff --git a/include/cache.php b/include/cache.php
index e4b9112..276aaa4 100644
--- a/include/cache.php
+++ b/include/cache.php
@@ -68,34 +68,6 @@ function generate_bans_cache()
 
 
 //
-// Generate the ranks cache PHP script
-//
-function generate_ranks_cache()
-{
-	global $db;
-
-	// Get the rank list from the DB
-	$result = $db->query('SELECT * FROM '.$db->prefix.'ranks ORDER BY min_posts', true) or error('Unable to fetch rank list', __FILE__, __LINE__, $db->error());
-
-	$output = array();
-	while ($cur_rank = $db->fetch_assoc($result))
-		$output[] = $cur_rank;
-
-	// Output ranks list as PHP code
-	$fh = @fopen(FORUM_CACHE_DIR.'cache_ranks.php', 'wb');
-	if (!$fh)
-		error('Unable to write ranks cache file to cache directory. Please make sure PHP has write access to the directory \''.pun_htmlspecialchars(FORUM_CACHE_DIR).'\'', __FILE__, __LINE__);
-
-	fwrite($fh, '<?php'."\n\n".'define(\'PUN_RANKS_LOADED\', 1);'."\n\n".'$pun_ranks = '.var_export($output, true).';'."\n\n".'?>');
-
-	fclose($fh);
-
-	if (function_exists('apc_delete_file'))
-		@apc_delete_file(FORUM_CACHE_DIR.'cache_ranks.php');
-}
-
-
-//
 // Generate quick jump cache PHP scripts
 //
 function generate_quickjump_cache($group_id = false)
diff --git a/include/common.php b/include/common.php
index 6323106..b12d43b 100644
--- a/include/common.php
+++ b/include/common.php
@@ -12,7 +12,7 @@
 // Define the version and database revision that this code was written for
 define('FORUM_VERSION', '1.5-dev');
 
-define('FORUM_DB_REVISION', 16);
+define('FORUM_DB_REVISION', 17);
 define('FORUM_SI_REVISION', 2);
 define('FORUM_PARSER_REVISION', 2);
 
diff --git a/include/common_admin.php b/include/common_admin.php
index 594b401..7bbcb59 100644
--- a/include/common_admin.php
+++ b/include/common_admin.php
@@ -60,7 +60,6 @@ function generate_admin_menu($page = '')
 					<li<?php if ($page == 'forums') echo ' class="isactive"'; ?>><a href="admin_forums.php"><?php echo $lang_admin_common['Forums'] ?></a></li>
 					<li<?php if ($page == 'groups') echo ' class="isactive"'; ?>><a href="admin_groups.php"><?php echo $lang_admin_common['User groups'] ?></a></li>
 					<li<?php if ($page == 'censoring') echo ' class="isactive"'; ?>><a href="admin_censoring.php"><?php echo $lang_admin_common['Censoring'] ?></a></li>
-					<li<?php if ($page == 'ranks') echo ' class="isactive"'; ?>><a href="admin_ranks.php"><?php echo $lang_admin_common['Ranks'] ?></a></li>
 					<li<?php if ($page == 'maintenance') echo ' class="isactive"'; ?>><a href="admin_maintenance.php"><?php echo $lang_admin_common['Maintenance'] ?></a></li>
 				</ul>
 			</div>
diff --git a/include/functions.php b/include/functions.php
index e2a5c5f..302a755 100644
--- a/include/functions.php
+++ b/include/functions.php
@@ -799,7 +799,7 @@ function censor_words($text)
 function get_title($user)
 {
 	global $db, $pun_config, $pun_bans, $lang_common;
-	static $ban_list, $pun_ranks;
+	static $ban_list;
 
 	// If not already built in a previous call, build an array of lowercase banned usernames
 	if (empty($ban_list))
@@ -810,22 +810,6 @@ function get_title($user)
 			$ban_list[] = strtolower($cur_ban['username']);
 	}
 
-	// If not already loaded in a previous call, load the cached ranks
-	if ($pun_config['o_ranks'] == '1' && !defined('PUN_RANKS_LOADED'))
-	{
-		if (file_exists(FORUM_CACHE_DIR.'cache_ranks.php'))
-			include FORUM_CACHE_DIR.'cache_ranks.php';
-
-		if (!defined('PUN_RANKS_LOADED'))
-		{
-			if (!defined('FORUM_CACHE_FUNCTIONS_LOADED'))
-				require PUN_ROOT.'include/cache.php';
-
-			generate_ranks_cache();
-			require FORUM_CACHE_DIR.'cache_ranks.php';
-		}
-	}
-
 	// If the user has a custom title
 	if ($user['title'] != '')
 		$user_title = pun_htmlspecialchars($user['title']);
@@ -838,22 +822,9 @@ function get_title($user)
 	// If the user is a guest
 	else if ($user['g_id'] == PUN_GUEST)
 		$user_title = $lang_common['Guest'];
+	// If nothing else helps, we assign the default
 	else
-	{
-		// Are there any ranks?
-		if ($pun_config['o_ranks'] == '1' && !empty($pun_ranks))
-		{
-			foreach ($pun_ranks as $cur_rank)
-			{
-				if ($user['num_posts'] >= $cur_rank['min_posts'])
-					$user_title = pun_htmlspecialchars($cur_rank['rank']);
-			}
-		}
-
-		// If the user didn't "reach" any rank (or if ranks are disabled), we assign the default
-		if (!isset($user_title))
-			$user_title = $lang_common['Member'];
-	}
+		$user_title = $lang_common['Member'];
 
 	return $user_title;
 }
diff --git a/install.php b/install.php
index 35b85aa..dfa51f1 100644
--- a/install.php
+++ b/install.php
@@ -9,7 +9,7 @@
 // The FluxBB version this script installs
 define('FORUM_VERSION', '1.5-dev');
 
-define('FORUM_DB_REVISION', 16);
+define('FORUM_DB_REVISION', 17);
 define('FORUM_SI_REVISION', 2);
 define('FORUM_PARSER_REVISION', 2);
 
@@ -1086,29 +1086,6 @@ function process_form(the_form)
 				'datatype'		=> 'SERIAL',
 				'allow_null'	=> false
 			),
-			'rank'			=> array(
-				'datatype'		=> 'VARCHAR(50)',
-				'allow_null'	=> false,
-				'default'		=> '\'\''
-			),
-			'min_posts'		=> array(
-				'datatype'		=> 'MEDIUMINT(8) UNSIGNED',
-				'allow_null'	=> false,
-				'default'		=> '0'
-			)
-		),
-		'PRIMARY KEY'	=> array('id')
-	);
-
-	$db->create_table('ranks', $schema) or error('Unable to create ranks table', __FILE__, __LINE__, $db->error());
-
-
-	$schema = array(
-		'FIELDS'		=> array(
-			'id'			=> array(
-				'datatype'		=> 'SERIAL',
-				'allow_null'	=> false
-			),
 			'post_id'		=> array(
 				'datatype'		=> 'INT(10) UNSIGNED',
 				'allow_null'	=> false,
@@ -1621,7 +1598,6 @@ function process_form(the_form)
 		'o_quickpost'				=> 1,
 		'o_users_online'			=> 1,
 		'o_censoring'				=> 0,
-		'o_ranks'					=> 1,
 		'o_show_dot'				=> 0,
 		'o_topic_views'				=> 1,
 		'o_quickjump'				=> 1,
@@ -1681,12 +1657,6 @@ function process_form(the_form)
 	$subject = $lang_install['Test post'];
 	$message = $lang_install['Message'];
 
-	$db->query('INSERT INTO '.$db_prefix.'ranks (rank, min_posts) VALUES(\''.$db->escape($lang_install['New member']).'\', 0)')
-		or error('Unable to insert into table '.$db_prefix.'ranks. Please check your configuration and try again', __FILE__, __LINE__, $db->error());
-
-	$db->query('INSERT INTO '.$db_prefix.'ranks (rank, min_posts) VALUES(\''.$db->escape($lang_install['Member']).'\', 10)')
-		or error('Unable to insert into table '.$db_prefix.'ranks. Please check your configuration and try again', __FILE__, __LINE__, $db->error());
-
 	$db->query('INSERT INTO '.$db_prefix.'categories (cat_name, disp_position) VALUES(\''.$db->escape($lang_install['Test category']).'\', 1)')
 		or error('Unable to insert into table '.$db_prefix.'categories. Please check your configuration and try again', __FILE__, __LINE__, $db->error());
 
diff --git a/lang/English/admin_common.php b/lang/English/admin_common.php
index a87616c..7172658 100644
--- a/lang/English/admin_common.php
+++ b/lang/English/admin_common.php
@@ -15,7 +15,6 @@
 'Options'				=>	'Options',
 'Permissions'			=>	'Permissions',
 'Censoring'				=>	'Censoring',
-'Ranks'					=>	'Ranks',
 'Bans'					=>	'Bans',
 'Prune'					=>	'Prune',
 'Maintenance'			=>	'Maintenance',
diff --git a/lang/English/admin_index.php b/lang/English/admin_index.php
index bd2cd97..4b0a5d8 100644
--- a/lang/English/admin_index.php
+++ b/lang/English/admin_index.php
@@ -18,7 +18,7 @@
 'Welcome 4'							=>	'View IP statistics for users.',
 'Welcome 5'							=>	'Ban users.',
 'Welcome 6'							=>	'Censor words.',
-'Welcome 7'							=>	'Set up user ranks.',
+'Welcome 7'							=>	'Set up user groups and promotions.',
 'Welcome 8'							=>	'Prune old posts.',
 'Welcome 9'							=>	'Handle post reports.',
 'Statistics head'					=>	'Statistics',
diff --git a/lang/English/admin_options.php b/lang/English/admin_options.php
index 0274bdf..0d5f211 100644
--- a/lang/English/admin_options.php
+++ b/lang/English/admin_options.php
@@ -123,8 +123,6 @@
 'Censor words help'					=>	'Enable this to censor specific words in the board. See %s for more info.',
 'Signatures label'					=>	'Signatures',
 'Signatures help'					=>	'Allow users to attach a signature to their posts.',
-'User ranks label'					=>	'User ranks',
-'User ranks help'					=>	'Enable this to use user ranks. See %s for more info.',
 'User has posted label'				=>	'User has posted earlier',
 'User has posted help'				=>	'This feature displays a dot in front of topics in viewforum.php in case the currently logged in user has posted in that topic earlier. Disable if you are experiencing high server load.',
 'Topic views label'					=>	'Topic views',
@@ -163,7 +161,7 @@
 // Avatars section
 'Avatars subhead'					=>	'Avatars',
 'Use avatars label'					=>	'Use avatars',
-'Use avatars help'					=>	'When enabled, users will be able to upload an avatar which will be displayed under their title/rank.',
+'Use avatars help'					=>	'When enabled, users will be able to upload an avatar which will be displayed under their title.',
 'Upload directory label'			=>	'Upload directory',
 'Upload directory help'				=>	'The upload directory for avatars (relative to the FluxBB root directory). PHP must have write permissions to this directory.',
 'Max width label'					=>	'Max width',
diff --git a/lang/English/admin_ranks.php b/lang/English/admin_ranks.php
deleted file mode 100644
index de53834..0000000
--- a/lang/English/admin_ranks.php
+++ /dev/null
@@ -1,23 +0,0 @@
-<?php
-
-// Language definitions used in admin_ranks.php
-$lang_admin_ranks = array(
-
-'Must be integer message'	=>	'Minimum posts must be a positive integer value.',
-'Dupe min posts message'	=>	'There is already a rank with a minimun posts value of %s.',
-'Must enter title message'	=>	'You must enter a rank title.',
-'Rank added redirect'		=>	'Rank added. Redirecting ',
-'Rank updated redirect'		=>	'Rank updated. Redirecting ',
-'Rank removed redirect'		=>	'Rank removed. Redirecting ',
-'Ranks head'				=>	'Ranks',
-'Add rank subhead'			=>	'Add rank',
-'Add rank info'				=>	'Enter a rank and the minimum number of posts a user must have made to attain the rank. Different ranks cannot have the same value for minimum posts. If a title is set for a user, the title will be displayed instead of any rank.',
-'Ranks enabled'				=>	'<strong>User ranks is enabled in %s.</strong>',
-'Ranks disabled'			=>	'<strong>User ranks is disabled in %s.</strong>',
-'Rank title label'			=>	'Rank title',
-'Minimum posts label'		=>	'Minimum posts',
-'Actions label'				=>	'Actions',
-'Edit remove subhead'		=>	'Edit/remove ranks',
-'No ranks in list'			=>	'No ranks in list',
-
-);
diff --git a/lang/English/install.php b/lang/English/install.php
index 4077d21..45d9ef1 100644
--- a/lang/English/install.php
+++ b/lang/English/install.php
@@ -96,9 +96,7 @@
 'Moderator'						=>	'Moderator',
 'Guests'						=>	'Guests',
 'Guest'							=>	'Guest',
-'New member'					=>	'New member',
 'Members'						=>	'Members',
-'Member'						=>	'Member',
 'Announcement'					=>	'Enter your announcement here.',
 'Rules'							=>	'Enter your rules here',
 'Maintenance message'			=>	'The forums are temporarily down for maintenance. Please try again in a few minutes.',
diff --git a/lang/English/update.php b/lang/English/update.php
index 437e7fe..c6073e5 100644
--- a/lang/English/update.php
+++ b/lang/English/update.php
@@ -59,7 +59,6 @@
 'forums'						=>	'forums',
 'groups'						=>	'groups',
 'post'							=>	'post',
-'ranks'							=>	'ranks',
 'report'						=>	'report',
 'topic'							=>	'topic',
 'user'							=>	'user',
diff --git a/style/Air/base_admin.css b/style/Air/base_admin.css
index 2948b81..8a1c33f 100644
--- a/style/Air/base_admin.css
+++ b/style/Air/base_admin.css
@@ -82,7 +82,7 @@
 	width: 25%;
 }
 
-#censoring .tcl, #censoring .tc2, #ranks .tcl, #ranks .tc2 {
+#censoring .tcl, #censoring .tc2 {
 	width: 20%;
 }
 
diff --git a/style/Earth/base_admin.css b/style/Earth/base_admin.css
index 2948b81..8a1c33f 100644
--- a/style/Earth/base_admin.css
+++ b/style/Earth/base_admin.css
@@ -82,7 +82,7 @@
 	width: 25%;
 }
 
-#censoring .tcl, #censoring .tc2, #ranks .tcl, #ranks .tc2 {
+#censoring .tcl, #censoring .tc2 {
 	width: 20%;
 }
 
diff --git a/style/Fire/base_admin.css b/style/Fire/base_admin.css
index 2948b81..8a1c33f 100644
--- a/style/Fire/base_admin.css
+++ b/style/Fire/base_admin.css
@@ -82,7 +82,7 @@
 	width: 25%;
 }
 
-#censoring .tcl, #censoring .tc2, #ranks .tcl, #ranks .tc2 {
+#censoring .tcl, #censoring .tc2 {
 	width: 20%;
 }
 
diff --git a/style/imports/base_admin.css b/style/imports/base_admin.css
index 26a29c4..a6ef40c 100644
--- a/style/imports/base_admin.css
+++ b/style/imports/base_admin.css
@@ -27,7 +27,7 @@
 
 /*** Particular table settings ***/
 #categoryedit .tcl {WIDTH: 25%}
-#censoring .tcl, #censoring .tc2, #ranks .tcl, #ranks .tc2 {WIDTH: 20%}
+#censoring .tcl, #censoring .tc2 {WIDTH: 20%}
 #edforum .tcl, #edforum .tc2 {WIDTH: 8%}
 #edforum .tc2 {WIDTH: 6%}
 
-- 
1.7.10


From c977f9837348dbf88acf577fb4ae0763da44dce9 Mon Sep 17 00:00:00 2001
From: Franz Liedke <franz@develophp.org>
Date: Tue, 27 Mar 2012 15:42:31 +0200
Subject: [PATCH 07/75] #646: Add database field for per-group setting to post
 links.

---
 db_update.php      |    5 ++++-
 include/common.php |    2 +-
 install.php        |    7 ++++++-
 3 files changed, 11 insertions(+), 3 deletions(-)

diff --git a/db_update.php b/db_update.php
index aa0c9e9..4f75c97 100644
--- a/db_update.php
+++ b/db_update.php
@@ -9,7 +9,7 @@
 // The FluxBB version this script updates to
 define('UPDATE_TO', '1.5-dev');
 
-define('UPDATE_TO_DB_REVISION', 17);
+define('UPDATE_TO_DB_REVISION', 18);
 define('UPDATE_TO_SI_REVISION', 2);
 define('UPDATE_TO_PARSER_REVISION', 2);
 
@@ -1026,6 +1026,9 @@ function convert_table_utf8($table, $callback, $old_charset, $key = null, $start
 		$db->add_field('groups', 'g_promote_min_posts', 'INT(10) UNSIGNED', false, 0, 'g_user_title') or error('Unable to add g_promote_min_posts field', __FILE__, __LINE__, $db->error());
 		$db->add_field('groups', 'g_promote_next_group', 'INT(10) UNSIGNED', false, 0, 'g_promote_min_posts') or error('Unable to add g_promote_next_group field', __FILE__, __LINE__, $db->error());
 
+		// Add a field for the per-group permission to post links
+		$db->add_field('groups', 'g_post_links', 'TINYINT(1)', false, 1, 'g_delete_topics') or error('Unable to add per-group permission to post links', __FILE__, __LINE__, $db->error());
+
 		// Incase we had the fulltext search extension installed (1.3-legacy), remove it
 		$db->drop_index('topics', 'subject_idx') or error('Unable to drop subject_idx index', __FILE__, __LINE__, $db->error());
 		$db->drop_index('posts', 'message_idx') or error('Unable to drop message_idx index', __FILE__, __LINE__, $db->error());
diff --git a/include/common.php b/include/common.php
index b12d43b..015acd7 100644
--- a/include/common.php
+++ b/include/common.php
@@ -12,7 +12,7 @@
 // Define the version and database revision that this code was written for
 define('FORUM_VERSION', '1.5-dev');
 
-define('FORUM_DB_REVISION', 17);
+define('FORUM_DB_REVISION', 18);
 define('FORUM_SI_REVISION', 2);
 define('FORUM_PARSER_REVISION', 2);
 
diff --git a/install.php b/install.php
index dfa51f1..510385d 100644
--- a/install.php
+++ b/install.php
@@ -9,7 +9,7 @@
 // The FluxBB version this script installs
 define('FORUM_VERSION', '1.5-dev');
 
-define('FORUM_DB_REVISION', 17);
+define('FORUM_DB_REVISION', 18);
 define('FORUM_SI_REVISION', 2);
 define('FORUM_PARSER_REVISION', 2);
 
@@ -919,6 +919,11 @@ function process_form(the_form)
 				'allow_null'	=> false,
 				'default'		=> '1'
 			),
+			'g_post_links'				=> array(
+				'datatype'		=> 'TINYINT(1)',
+				'allow_null'	=> false,
+				'default'		=> '1'
+			),
 			'g_set_title'				=> array(
 				'datatype'		=> 'TINYINT(1)',
 				'allow_null'	=> false,
-- 
1.7.10


From c35d95b40e446b4a7380205000b0d073cc176f22 Mon Sep 17 00:00:00 2001
From: Franz Liedke <franz@develophp.org>
Date: Tue, 27 Mar 2012 16:07:25 +0200
Subject: [PATCH 08/75] #646: Add admin management for per-group setting for
 allowing links in posts/signatures.

---
 admin_groups.php              |   32 ++++++++++++++++++++------------
 lang/English/admin_groups.php |    2 ++
 2 files changed, 22 insertions(+), 12 deletions(-)

diff --git a/admin_groups.php b/admin_groups.php
index 8001697..90ec4bd 100644
--- a/admin_groups.php
+++ b/admin_groups.php
@@ -193,59 +193,66 @@
 										<span><?php echo $lang_admin_groups['Delete topics help'] ?></span>
 									</td>
 								</tr>
-								<tr>
+<?php endif; ?>								<tr>
+									<th scope="row"><?php echo $lang_admin_groups['Post links label'] ?></th>
+									<td>
+										<input type="radio" name="post_links" value="1"<?php if ($group['g_post_links'] == '1') echo ' checked="checked"' ?> tabindex="29" />&#160;<strong><?php echo $lang_admin_common['Yes'] ?></strong>&#160;&#160;&#160;<input type="radio" name="post_links" value="0"<?php if ($group['g_post_links'] == '0') echo ' checked="checked"' ?> tabindex="30" />&#160;<strong><?php echo $lang_admin_common['No'] ?></strong>
+										<span><?php echo $lang_admin_groups['Post links help'] ?></span>
+									</td>
+								</tr>
+<?php if ($group['g_id'] != PUN_GUEST): ?>								<tr>
 									<th scope="row"><?php echo $lang_admin_groups['Set own title label'] ?></th>
 									<td>
-										<input type="radio" name="set_title" value="1"<?php if ($group['g_set_title'] == '1') echo ' checked="checked"' ?> tabindex="29" />&#160;<strong><?php echo $lang_admin_common['Yes'] ?></strong>&#160;&#160;&#160;<input type="radio" name="set_title" value="0"<?php if ($group['g_set_title'] == '0') echo ' checked="checked"' ?> tabindex="30" />&#160;<strong><?php echo $lang_admin_common['No'] ?></strong>
+										<input type="radio" name="set_title" value="1"<?php if ($group['g_set_title'] == '1') echo ' checked="checked"' ?> tabindex="31" />&#160;<strong><?php echo $lang_admin_common['Yes'] ?></strong>&#160;&#160;&#160;<input type="radio" name="set_title" value="0"<?php if ($group['g_set_title'] == '0') echo ' checked="checked"' ?> tabindex="32" />&#160;<strong><?php echo $lang_admin_common['No'] ?></strong>
 										<span><?php echo $lang_admin_groups['Set own title help'] ?></span>
 									</td>
 								</tr>
 <?php endif; ?>								<tr>
 									<th scope="row"><?php echo $lang_admin_groups['User search label'] ?></th>
 									<td>
-										<input type="radio" name="search" value="1"<?php if ($group['g_search'] == '1') echo ' checked="checked"' ?> tabindex="31" />&#160;<strong><?php echo $lang_admin_common['Yes'] ?></strong>&#160;&#160;&#160;<input type="radio" name="search" value="0"<?php if ($group['g_search'] == '0') echo ' checked="checked"' ?> tabindex="32" />&#160;<strong><?php echo $lang_admin_common['No'] ?></strong>
+										<input type="radio" name="search" value="1"<?php if ($group['g_search'] == '1') echo ' checked="checked"' ?> tabindex="33" />&#160;<strong><?php echo $lang_admin_common['Yes'] ?></strong>&#160;&#160;&#160;<input type="radio" name="search" value="0"<?php if ($group['g_search'] == '0') echo ' checked="checked"' ?> tabindex="34" />&#160;<strong><?php echo $lang_admin_common['No'] ?></strong>
 										<span><?php echo $lang_admin_groups['User search help'] ?></span>
 									</td>
 								</tr>
 								<tr>
 									<th scope="row"><?php echo $lang_admin_groups['User list search label'] ?></th>
 									<td>
-										<input type="radio" name="search_users" value="1"<?php if ($group['g_search_users'] == '1') echo ' checked="checked"' ?> tabindex="33" />&#160;<strong><?php echo $lang_admin_common['Yes'] ?></strong>&#160;&#160;&#160;<input type="radio" name="search_users" value="0"<?php if ($group['g_search_users'] == '0') echo ' checked="checked"' ?> tabindex="34" />&#160;<strong><?php echo $lang_admin_common['No'] ?></strong>
+										<input type="radio" name="search_users" value="1"<?php if ($group['g_search_users'] == '1') echo ' checked="checked"' ?> tabindex="35" />&#160;<strong><?php echo $lang_admin_common['Yes'] ?></strong>&#160;&#160;&#160;<input type="radio" name="search_users" value="0"<?php if ($group['g_search_users'] == '0') echo ' checked="checked"' ?> tabindex="36" />&#160;<strong><?php echo $lang_admin_common['No'] ?></strong>
 										<span><?php echo $lang_admin_groups['User list search help'] ?></span>
 									</td>
 								</tr>
 <?php if ($group['g_id'] != PUN_GUEST): ?>								<tr>
 									<th scope="row"><?php echo $lang_admin_groups['Send e-mails label'] ?></th>
 									<td>
-										<input type="radio" name="send_email" value="1"<?php if ($group['g_send_email'] == '1') echo ' checked="checked"' ?> tabindex="35" />&#160;<strong><?php echo $lang_admin_common['Yes'] ?></strong>&#160;&#160;&#160;<input type="radio" name="send_email" value="0"<?php if ($group['g_send_email'] == '0') echo ' checked="checked"' ?> tabindex="36" />&#160;<strong><?php echo $lang_admin_common['No'] ?></strong>
+										<input type="radio" name="send_email" value="1"<?php if ($group['g_send_email'] == '1') echo ' checked="checked"' ?> tabindex="37" />&#160;<strong><?php echo $lang_admin_common['Yes'] ?></strong>&#160;&#160;&#160;<input type="radio" name="send_email" value="0"<?php if ($group['g_send_email'] == '0') echo ' checked="checked"' ?> tabindex="38" />&#160;<strong><?php echo $lang_admin_common['No'] ?></strong>
 										<span><?php echo $lang_admin_groups['Send e-mails help'] ?></span>
 									</td>
 								</tr>
 <?php endif; ?>								<tr>
 									<th scope="row"><?php echo $lang_admin_groups['Post flood label'] ?></th>
 									<td>
-										<input type="text" name="post_flood" size="5" maxlength="4" value="<?php echo $group['g_post_flood'] ?>" tabindex="37" />
+										<input type="text" name="post_flood" size="5" maxlength="4" value="<?php echo $group['g_post_flood'] ?>" tabindex="39" />
 										<span><?php echo $lang_admin_groups['Post flood help'] ?></span>
 									</td>
 								</tr>
 								<tr>
 									<th scope="row"><?php echo $lang_admin_groups['Search flood label'] ?></th>
 									<td>
-										<input type="text" name="search_flood" size="5" maxlength="4" value="<?php echo $group['g_search_flood'] ?>" tabindex="38" />
+										<input type="text" name="search_flood" size="5" maxlength="4" value="<?php echo $group['g_search_flood'] ?>" tabindex="40" />
 										<span><?php echo $lang_admin_groups['Search flood help'] ?></span>
 									</td>
 								</tr>
 <?php if ($group['g_id'] != PUN_GUEST): ?>								<tr>
 									<th scope="row"><?php echo $lang_admin_groups['E-mail flood label'] ?></th>
 									<td>
-										<input type="text" name="email_flood" size="5" maxlength="4" value="<?php echo $group['g_email_flood'] ?>" tabindex="39" />
+										<input type="text" name="email_flood" size="5" maxlength="4" value="<?php echo $group['g_email_flood'] ?>" tabindex="41" />
 										<span><?php echo $lang_admin_groups['E-mail flood help'] ?></span>
 									</td>
 								</tr>
 								<tr>
 									<th scope="row"><?php echo $lang_admin_groups['Report flood label'] ?></th>
 									<td>
-										<input type="text" name="report_flood" size="5" maxlength="4" value="<?php echo $group['g_report_flood'] ?>" tabindex="40" />
+										<input type="text" name="report_flood" size="5" maxlength="4" value="<?php echo $group['g_report_flood'] ?>" tabindex="42" />
 										<span><?php echo $lang_admin_groups['Report flood help'] ?></span>
 									</td>
 								</tr>
@@ -254,7 +261,7 @@
 <?php endif; ?>						</div>
 					</fieldset>
 				</div>
-				<p class="submitend"><input type="submit" name="add_edit_group" value="<?php echo $lang_admin_common['Save'] ?>" tabindex="41" /></p>
+				<p class="submitend"><input type="submit" name="add_edit_group" value="<?php echo $lang_admin_common['Save'] ?>" tabindex="43" /></p>
 			</form>
 		</div>
 	</div>
@@ -295,6 +302,7 @@
 	$edit_posts = isset($_POST['edit_posts']) ? intval($_POST['edit_posts']) : ($is_admin_group) ? '1' : '0';
 	$delete_posts = isset($_POST['delete_posts']) ? intval($_POST['delete_posts']) : ($is_admin_group) ? '1' : '0';
 	$delete_topics = isset($_POST['delete_topics']) ? intval($_POST['delete_topics']) : ($is_admin_group) ? '1' : '0';
+	$post_links = isset($_POST['post_links']) ? intval($_POST['post_links']) : '1';
 	$set_title = isset($_POST['set_title']) ? intval($_POST['set_title']) : ($is_admin_group) ? '1' : '0';
 	$search = isset($_POST['search']) ? intval($_POST['search']) : '1';
 	$search_users = isset($_POST['search_users']) ? intval($_POST['search_users']) : '1';
@@ -315,7 +323,7 @@
 		if ($db->num_rows($result))
 			message(sprintf($lang_admin_groups['Title already exists message'], pun_htmlspecialchars($title)));
 
-		$db->query('INSERT INTO '.$db->prefix.'groups (g_title, g_user_title, g_promote_min_posts, g_promote_next_group, g_moderator, g_mod_edit_users, g_mod_rename_users, g_mod_change_passwords, g_mod_ban_users, g_read_board, g_view_users, g_post_replies, g_post_topics, g_edit_posts, g_delete_posts, g_delete_topics, g_set_title, g_search, g_search_users, g_send_email, g_post_flood, g_search_flood, g_email_flood, g_report_flood) VALUES(\''.$db->escape($title).'\', '.$user_title.', '.$promote_min_posts.', '.$promote_next_group.', '.$moderator.', '.$mod_edit_users.', '.$mod_rename_users.', '.$mod_change_passwords.', '.$mod_ban_users.', '.$read_board.', '.$view_users.', '.$post_replies.', '.$post_topics.', '.$edit_posts.', '.$delete_posts.', '.$delete_topics.', '.$set_title.', '.$search.', '.$search_users.', '.$send_email.', '.$post_flood.', '.$search_flood.', '.$email_flood.', '.$report_flood.')') or error('Unable to add group', __FILE__, __LINE__, $db->error());
+		$db->query('INSERT INTO '.$db->prefix.'groups (g_title, g_user_title, g_promote_min_posts, g_promote_next_group, g_moderator, g_mod_edit_users, g_mod_rename_users, g_mod_change_passwords, g_mod_ban_users, g_read_board, g_view_users, g_post_replies, g_post_topics, g_edit_posts, g_delete_posts, g_delete_topics, g_post_links, g_set_title, g_search, g_search_users, g_send_email, g_post_flood, g_search_flood, g_email_flood, g_report_flood) VALUES(\''.$db->escape($title).'\', '.$user_title.', '.$promote_min_posts.', '.$promote_next_group.', '.$moderator.', '.$mod_edit_users.', '.$mod_rename_users.', '.$mod_change_passwords.', '.$mod_ban_users.', '.$read_board.', '.$view_users.', '.$post_replies.', '.$post_topics.', '.$edit_posts.', '.$delete_posts.', '.$delete_topics.', '.$post_links.', '.$set_title.', '.$search.', '.$search_users.', '.$send_email.', '.$post_flood.', '.$search_flood.', '.$email_flood.', '.$report_flood.')') or error('Unable to add group', __FILE__, __LINE__, $db->error());
 		$new_group_id = $db->insert_id();
 
 		// Now lets copy the forum specific permissions from the group which this group is based on
@@ -329,7 +337,7 @@
 		if ($db->num_rows($result))
 			message(sprintf($lang_admin_groups['Title already exists message'], pun_htmlspecialchars($title)));
 
-		$db->query('UPDATE '.$db->prefix.'groups SET g_title=\''.$db->escape($title).'\', g_user_title='.$user_title.', g_promote_min_posts='.$promote_min_posts.', g_promote_next_group='.$promote_next_group.', g_moderator='.$moderator.', g_mod_edit_users='.$mod_edit_users.', g_mod_rename_users='.$mod_rename_users.', g_mod_change_passwords='.$mod_change_passwords.', g_mod_ban_users='.$mod_ban_users.', g_read_board='.$read_board.', g_view_users='.$view_users.', g_post_replies='.$post_replies.', g_post_topics='.$post_topics.', g_edit_posts='.$edit_posts.', g_delete_posts='.$delete_posts.', g_delete_topics='.$delete_topics.', g_set_title='.$set_title.', g_search='.$search.', g_search_users='.$search_users.', g_send_email='.$send_email.', g_post_flood='.$post_flood.', g_search_flood='.$search_flood.', g_email_flood='.$email_flood.', g_report_flood='.$report_flood.' WHERE g_id='.intval($_POST['group_id'])) or error('Unable to update group', __FILE__, __LINE__, $db->error());
+		$db->query('UPDATE '.$db->prefix.'groups SET g_title=\''.$db->escape($title).'\', g_user_title='.$user_title.', g_promote_min_posts='.$promote_min_posts.', g_promote_next_group='.$promote_next_group.', g_moderator='.$moderator.', g_mod_edit_users='.$mod_edit_users.', g_mod_rename_users='.$mod_rename_users.', g_mod_change_passwords='.$mod_change_passwords.', g_mod_ban_users='.$mod_ban_users.', g_read_board='.$read_board.', g_view_users='.$view_users.', g_post_replies='.$post_replies.', g_post_topics='.$post_topics.', g_edit_posts='.$edit_posts.', g_delete_posts='.$delete_posts.', g_delete_topics='.$delete_topics.', g_post_links='.$post_links.', g_set_title='.$set_title.', g_search='.$search.', g_search_users='.$search_users.', g_send_email='.$send_email.', g_post_flood='.$post_flood.', g_search_flood='.$search_flood.', g_email_flood='.$email_flood.', g_report_flood='.$report_flood.' WHERE g_id='.intval($_POST['group_id'])) or error('Unable to update group', __FILE__, __LINE__, $db->error());
 	}
 
 	// Regenerate the quick jump cache
diff --git a/lang/English/admin_groups.php b/lang/English/admin_groups.php
index 1011509..115578a 100644
--- a/lang/English/admin_groups.php
+++ b/lang/English/admin_groups.php
@@ -66,6 +66,8 @@
 'Delete posts help'				=>	'Allow users in this group to delete their own posts.',
 'Delete topics label'			=>	'Delete topics',
 'Delete topics help'			=>	'Allow users in this group to delete their own topics (including any replies).',
+'Post links label'				=>	'Post links',
+'Post links help'				=>	'Allow users in this group to include links in their posts. This setting also applies to signatures and the website field in users\' profiles.',
 'Set own title label'			=>	'Set own user title',
 'Set own title help'			=>	'Allow users in this group to set their own user title.',
 'User search label'				=>	'Use search',
-- 
1.7.10


From e4674703e60eaa1fb5d2ae5ecc4bfa65603461ae Mon Sep 17 00:00:00 2001
From: Franz Liedke <franz@develophp.org>
Date: Tue, 27 Mar 2012 16:10:31 +0200
Subject: [PATCH 09/75] Fix tab order and list of selectable promotion target
 groups when editing user groups.

Related to #647.
---
 admin_groups.php              |    8 ++++----
 lang/English/admin_groups.php |    2 +-
 2 files changed, 5 insertions(+), 5 deletions(-)

diff --git a/admin_groups.php b/admin_groups.php
index 90ec4bd..d755cc2 100644
--- a/admin_groups.php
+++ b/admin_groups.php
@@ -82,19 +82,19 @@
 									<th scope="row"><?php echo $lang_admin_groups['User title label'] ?></th>
 									<td>
 										<input type="text" name="user_title" size="25" maxlength="50" value="<?php echo pun_htmlspecialchars($group['g_user_title']) ?>" tabindex="2" />
-										<span><?php echo $lang_admin_groups['User title help'] ?></span>
+										<span><?php printf($lang_admin_groups['User title help'], $lang_common['Member']) ?></span>
 									</td>
 								</tr>
 <?php if ($group['g_id'] != PUN_ADMIN): if ($group['g_id'] != PUN_GUEST): ?>								<tr>
 									<th scope="row"><?php echo $lang_admin_groups['Promote users label'] ?></th>
 									<td>
-										<select name="promote_next_group" tabindex="4">
+										<select name="promote_next_group" tabindex="3">
 											<option value="0"><?php echo $lang_admin_groups['Disable promotion'] ?></option>
 <?php
 
 foreach ($groups as $cur_group)
 {
-	if ($cur_group['g_id'] != $group['g_id'] && $cur_group['g_id'] != PUN_ADMIN)
+	if (($cur_group['g_id'] != $group['g_id'] || $mode == 'add') && $cur_group['g_id'] != PUN_ADMIN)
 	{
 		if ($cur_group['g_id'] == $group['g_promote_next_group'])
 			echo "\t\t\t\t\t\t\t\t\t\t\t".'<option value="'.$cur_group['g_id'].'" selected="selected">'.pun_htmlspecialchars($cur_group['g_title']).'</option>'."\n";
@@ -105,7 +105,7 @@
 
 ?>
 										</select>
-										<input type="text" name="promote_min_posts" size="5" maxlength="10" value="<?php echo pun_htmlspecialchars($group['g_promote_min_posts']) ?>" tabindex="3" />
+										<input type="text" name="promote_min_posts" size="5" maxlength="10" value="<?php echo pun_htmlspecialchars($group['g_promote_min_posts']) ?>" tabindex="4" />
 										<span><?php printf($lang_admin_groups['Promote users help'], $lang_admin_groups['Disable promotion']) ?></span>
 									</td>
 								</tr>
diff --git a/lang/English/admin_groups.php b/lang/English/admin_groups.php
index 115578a..5059640 100644
--- a/lang/English/admin_groups.php
+++ b/lang/English/admin_groups.php
@@ -38,7 +38,7 @@
 'Group settings info'			=>	'Below options and permissions are the default permissions for the user group. These options apply if no forum specific permissions are in effect.',
 'Group title label'				=>	'Group title',
 'User title label'				=>	'User title',
-'User title help'				=>	'The rank users in this group have attained. Leave blank to use default title.',
+'User title help'				=>	'The rank users in this group have attained. Leave blank to use default title ("%s").',
 'Promote users label'			=>	'Promote users',
 'Promote users help'			=>	'You can promote users to a new group automatically if they reach a certain number of posts. Select "%s" to disable. For security reasons, you are not allowed to select an administrator group here.',
 'Disable promotion'				=>	'Disable promoting',
-- 
1.7.10


From 5f0a532fcb3369904f45c3dfe7ea565ae71a492b Mon Sep 17 00:00:00 2001
From: Franz Liedke <franz@develophp.org>
Date: Tue, 27 Mar 2012 16:38:07 +0200
Subject: [PATCH 10/75] #646: Make setting for posting links visible in help
 area underneath textareas.

---
 edit.php                |    3 ++-
 help.php                |    2 +-
 lang/English/common.php |    1 +
 post.php                |    1 +
 profile.php             |    1 +
 viewtopic.php           |    1 +
 6 files changed, 7 insertions(+), 2 deletions(-)

diff --git a/edit.php b/edit.php
index 58f8be3..8347e52 100644
--- a/edit.php
+++ b/edit.php
@@ -108,7 +108,7 @@
 	$stick_topic = isset($_POST['stick_topic']) ? '1' : '0';
 	if (!$is_admmod)
 		$stick_topic = $cur_post['sticky'];
-	
+
 	// Replace four-byte characters (MySQL cannot handle them)
 	$message = strip_bad_multibyte_chars($message);
 
@@ -226,6 +226,7 @@
 						<textarea name="req_message" rows="20" cols="95" tabindex="<?php echo $cur_index++ ?>"><?php echo pun_htmlspecialchars(isset($_POST['req_message']) ? $message : $cur_post['message']) ?></textarea><br /></label>
 						<ul class="bblinks">
 							<li><span><a href="help.php#bbcode" onclick="window.open(this.href); return false;"><?php echo $lang_common['BBCode'] ?></a> <?php echo ($pun_config['p_message_bbcode'] == '1') ? $lang_common['on'] : $lang_common['off']; ?></span></li>
+							<li><span><a href="help.php#url" onclick="window.open(this.href); return false;"><?php echo $lang_common['url tag'] ?></a> <?php echo ($pun_config['p_message_bbcode'] == '1' && $pun_user['g_post_links'] == '1') ? $lang_common['on'] : $lang_common['off']; ?></span>
 							<li><span><a href="help.php#img" onclick="window.open(this.href); return false;"><?php echo $lang_common['img tag'] ?></a> <?php echo ($pun_config['p_message_bbcode'] == '1' && $pun_config['p_message_img_tag'] == '1') ? $lang_common['on'] : $lang_common['off']; ?></span></li>
 							<li><span><a href="help.php#smilies" onclick="window.open(this.href); return false;"><?php echo $lang_common['Smilies'] ?></a> <?php echo ($pun_config['o_smilies'] == '1') ? $lang_common['on'] : $lang_common['off']; ?></span></li>
 						</ul>
diff --git a/help.php b/help.php
index 39e5d07..77569d1 100644
--- a/help.php
+++ b/help.php
@@ -53,7 +53,7 @@
 <div class="box">
 	<div class="inbox">
 		<p><?php echo $lang_help['Links info'] ?></p>
-		<p><code>[url=<?php echo pun_htmlspecialchars(get_base_url(true).'/') ?>]<?php echo pun_htmlspecialchars($pun_config['o_board_title']) ?>[/url]</code> <?php echo $lang_help['produces'] ?> <samp><a href="<?php echo pun_htmlspecialchars(get_base_url(true).'/') ?>"><?php echo pun_htmlspecialchars($pun_config['o_board_title']) ?></a></samp></p>
+		<p><a name="url"></a><code>[url=<?php echo pun_htmlspecialchars(get_base_url(true).'/') ?>]<?php echo pun_htmlspecialchars($pun_config['o_board_title']) ?>[/url]</code> <?php echo $lang_help['produces'] ?> <samp><a href="<?php echo pun_htmlspecialchars(get_base_url(true).'/') ?>"><?php echo pun_htmlspecialchars($pun_config['o_board_title']) ?></a></samp></p>
 		<p><code>[url]<?php echo pun_htmlspecialchars(get_base_url(true).'/') ?>[/url]</code> <?php echo $lang_help['produces'] ?> <samp><a href="<?php echo pun_htmlspecialchars(get_base_url(true).'/') ?>"><?php echo pun_htmlspecialchars(get_base_url(true).'/') ?></a></samp></p>
 		<p><code>[url=/help.php]<?php echo $lang_help['This help page'] ?>[/url]</code> <?php echo $lang_help['produces'] ?> <samp><a href="<?php echo pun_htmlspecialchars(get_base_url(true).'/help.php') ?>"><?php echo $lang_help['This help page'] ?></a></samp></p>
 		<p><code>[email]myname@mydomain.com[/email]</code> <?php echo $lang_help['produces'] ?> <samp><a href="mailto:myname@mydomain.com">myname@mydomain.com</a></samp></p>
diff --git a/lang/English/common.php b/lang/English/common.php
index 6a0c85e..f15fa2e 100644
--- a/lang/English/common.php
+++ b/lang/English/common.php
@@ -59,6 +59,7 @@
 'Pages'								=>	'Pages:',
 'Page'								=>	'Page %s',
 'BBCode'							=>	'BBCode:', // You probably shouldn't change this
+'url tag'							=>	'[url] tag:',
 'img tag'							=>	'[img] tag:',
 'Smilies'							=>	'Smilies:',
 'and'								=>	'and',
diff --git a/post.php b/post.php
index a782f5d..4359061 100644
--- a/post.php
+++ b/post.php
@@ -642,6 +642,7 @@
 						<textarea name="req_message" rows="20" cols="95" tabindex="<?php echo $cur_index++ ?>"><?php echo isset($_POST['req_message']) ? pun_htmlspecialchars($orig_message) : (isset($quote) ? $quote : ''); ?></textarea><br /></label>
 						<ul class="bblinks">
 							<li><span><a href="help.php#bbcode" onclick="window.open(this.href); return false;"><?php echo $lang_common['BBCode'] ?></a> <?php echo ($pun_config['p_message_bbcode'] == '1') ? $lang_common['on'] : $lang_common['off']; ?></span></li>
+							<li><span><a href="help.php#url" onclick="window.open(this.href); return false;"><?php echo $lang_common['url tag'] ?></a> <?php echo ($pun_config['p_message_bbcode'] == '1' && $pun_user['g_post_links'] == '1') ? $lang_common['on'] : $lang_common['off']; ?></span>
 							<li><span><a href="help.php#img" onclick="window.open(this.href); return false;"><?php echo $lang_common['img tag'] ?></a> <?php echo ($pun_config['p_message_bbcode'] == '1' && $pun_config['p_message_img_tag'] == '1') ? $lang_common['on'] : $lang_common['off']; ?></span></li>
 							<li><span><a href="help.php#smilies" onclick="window.open(this.href); return false;"><?php echo $lang_common['Smilies'] ?></a> <?php echo ($pun_config['o_smilies'] == '1') ? $lang_common['on'] : $lang_common['off']; ?></span></li>
 						</ul>
diff --git a/profile.php b/profile.php
index 6229c27..2aa951f 100644
--- a/profile.php
+++ b/profile.php
@@ -1524,6 +1524,7 @@
 							</div>
 							<ul class="bblinks">
 								<li><span><a href="help.php#bbcode" onclick="window.open(this.href); return false;"><?php echo $lang_common['BBCode'] ?></a> <?php echo ($pun_config['p_sig_bbcode'] == '1') ? $lang_common['on'] : $lang_common['off']; ?></span></li>
+								<li><span><a href="help.php#url" onclick="window.open(this.href); return false;"><?php echo $lang_common['url tag'] ?></a> <?php echo ($pun_config['p_sig_bbcode'] == '1' && $pun_user['g_post_links'] == '1') ? $lang_common['on'] : $lang_common['off']; ?></span>
 								<li><span><a href="help.php#img" onclick="window.open(this.href); return false;"><?php echo $lang_common['img tag'] ?></a> <?php echo ($pun_config['p_sig_bbcode'] == '1' && $pun_config['p_sig_img_tag'] == '1') ? $lang_common['on'] : $lang_common['off']; ?></span></li>
 								<li><span><a href="help.php#smilies" onclick="window.open(this.href); return false;"><?php echo $lang_common['Smilies'] ?></a> <?php echo ($pun_config['o_smilies_sig'] == '1') ? $lang_common['on'] : $lang_common['off']; ?></span></li>
 							</ul>
diff --git a/viewtopic.php b/viewtopic.php
index febe0e0..4640f76 100644
--- a/viewtopic.php
+++ b/viewtopic.php
@@ -435,6 +435,7 @@
 <textarea name="req_message" rows="7" cols="75" tabindex="<?php echo $cur_index++ ?>"></textarea></label>
 						<ul class="bblinks">
 							<li><span><a href="help.php#bbcode" onclick="window.open(this.href); return false;"><?php echo $lang_common['BBCode'] ?></a> <?php echo ($pun_config['p_message_bbcode'] == '1') ? $lang_common['on'] : $lang_common['off']; ?></span></li>
+							<li><span><a href="help.php#url" onclick="window.open(this.href); return false;"><?php echo $lang_common['url tag'] ?></a> <?php echo ($pun_config['p_message_bbcode'] == '1' && $pun_user['g_post_links'] == '1') ? $lang_common['on'] : $lang_common['off']; ?></span>
 							<li><span><a href="help.php#img" onclick="window.open(this.href); return false;"><?php echo $lang_common['img tag'] ?></a> <?php echo ($pun_config['p_message_bbcode'] == '1' && $pun_config['p_message_img_tag'] == '1') ? $lang_common['on'] : $lang_common['off']; ?></span></li>
 							<li><span><a href="help.php#smilies" onclick="window.open(this.href); return false;"><?php echo $lang_common['Smilies'] ?></a> <?php echo ($pun_config['o_smilies'] == '1') ? $lang_common['on'] : $lang_common['off']; ?></span></li>
 						</ul>
-- 
1.7.10


From bfcc11a05881809731adc08f7b2e44839f3baa35 Mon Sep 17 00:00:00 2001
From: Franz Liedke <franz@develophp.org>
Date: Thu, 29 Mar 2012 21:29:32 +0200
Subject: [PATCH 11/75] #647: Don't promote all users to a new group when only
 one should be.

---
 post.php |    2 +-
 1 file changed, 1 insertion(+), 1 deletion(-)

diff --git a/post.php b/post.php
index 4359061..d5ae220 100644
--- a/post.php
+++ b/post.php
@@ -422,7 +422,7 @@
 			if ($pun_user['g_promote_next_group'] != 0 && $pun_user['num_posts'] + 1 >= $pun_user['g_promote_min_posts'])
 			{
 				$new_group_id = $pun_user['g_promote_next_group'];
-				$db->query('UPDATE '.$db->prefix.'users SET group_id='.$new_group_id) or error('Unable to promote user to new group', __FILE__, __LINE__, $db->error());
+				$db->query('UPDATE '.$db->prefix.'users SET group_id='.$new_group_id.' WHERE id='.$pun_user['id']) or error('Unable to promote user to new group', __FILE__, __LINE__, $db->error());
 			}
 
 			// Topic tracking stuff...
-- 
1.7.10


From dd401482c443758656b4f8d7b8275e584b460607 Mon Sep 17 00:00:00 2001
From: Franz Liedke <franz@develophp.org>
Date: Thu, 29 Mar 2012 21:33:49 +0200
Subject: [PATCH 12/75] #647: Don't allow promoting to guest group.

---
 admin_groups.php |    4 ++--
 1 file changed, 2 insertions(+), 2 deletions(-)

diff --git a/admin_groups.php b/admin_groups.php
index d755cc2..0523b92 100644
--- a/admin_groups.php
+++ b/admin_groups.php
@@ -94,7 +94,7 @@
 
 foreach ($groups as $cur_group)
 {
-	if (($cur_group['g_id'] != $group['g_id'] || $mode == 'add') && $cur_group['g_id'] != PUN_ADMIN)
+	if (($cur_group['g_id'] != $group['g_id'] || $mode == 'add') && $cur_group['g_id'] != PUN_ADMIN && $cur_group['g_id'] != PUN_GUEST)
 	{
 		if ($cur_group['g_id'] == $group['g_promote_next_group'])
 			echo "\t\t\t\t\t\t\t\t\t\t\t".'<option value="'.$cur_group['g_id'].'" selected="selected">'.pun_htmlspecialchars($cur_group['g_title']).'</option>'."\n";
@@ -285,7 +285,7 @@
 	$user_title = pun_trim($_POST['user_title']);
 
 	$promote_min_posts = isset($_POST['promote_min_posts']) ? intval($_POST['promote_min_posts']) : '0';
-	if (isset($_POST['promote_next_group']) && isset($groups[$_POST['promote_next_group']]) && !in_array($_POST['promote_next_group'], array(PUN_ADMIN, $_POST['group_id'])))
+	if (isset($_POST['promote_next_group']) && isset($groups[$_POST['promote_next_group']]) && !in_array($_POST['promote_next_group'], array(PUN_ADMIN, PUN_GUEST, $_POST['group_id'])))
 		$promote_next_group = $_POST['promote_next_group'];
 	else
 		$promote_next_group = '0';
-- 
1.7.10


From 3856d0a355d7aac6d11c4a641c82bc866de6763b Mon Sep 17 00:00:00 2001
From: Franz Liedke <franz@develophp.org>
Date: Thu, 29 Mar 2012 21:39:48 +0200
Subject: [PATCH 13/75] #647: Fix undefined index error.

---
 admin_groups.php |    5 ++++-
 1 file changed, 4 insertions(+), 1 deletion(-)

diff --git a/admin_groups.php b/admin_groups.php
index 0523b92..8e31d52 100644
--- a/admin_groups.php
+++ b/admin_groups.php
@@ -285,7 +285,10 @@
 	$user_title = pun_trim($_POST['user_title']);
 
 	$promote_min_posts = isset($_POST['promote_min_posts']) ? intval($_POST['promote_min_posts']) : '0';
-	if (isset($_POST['promote_next_group']) && isset($groups[$_POST['promote_next_group']]) && !in_array($_POST['promote_next_group'], array(PUN_ADMIN, PUN_GUEST, $_POST['group_id'])))
+	if (isset($_POST['promote_next_group']) &&
+			isset($groups[$_POST['promote_next_group']]) &&
+			!in_array($_POST['promote_next_group'], array(PUN_ADMIN, PUN_GUEST)) &&
+			(!isset($_POST['group_id']) || $_POST['promote_next_group'] != $_POST['group_id']))
 		$promote_next_group = $_POST['promote_next_group'];
 	else
 		$promote_next_group = '0';
-- 
1.7.10


From ccf00d15d4a42094e4c8c21d223fbaf0a5eccddc Mon Sep 17 00:00:00 2001
From: Franz Liedke <franz@develophp.org>
Date: Fri, 30 Mar 2012 00:16:39 +0200
Subject: [PATCH 14/75] #646: Implement disallowing links (if that feature is
 enabled) in post.php.

---
 include/parser.php      |   15 ++++++++++++++-
 lang/English/common.php |    1 +
 2 files changed, 15 insertions(+), 1 deletion(-)

diff --git a/include/parser.php b/include/parser.php
index 238932d..6ecb5e8 100644
--- a/include/parser.php
+++ b/include/parser.php
@@ -183,7 +183,7 @@ function strip_empty_bbcode($text)
 //
 function preparse_tags($text, &$errors, $is_signature = false)
 {
-	global $lang_common, $pun_config;
+	global $lang_common, $pun_config, $pun_user;
 
 	// Start off by making some arrays of bbcode tags and what we need to do with each one
 
@@ -197,6 +197,8 @@ function preparse_tags($text, &$errors, $is_signature = false)
 	$tags_nested = array('quote' => $pun_config['o_quote_depth'], 'list' => 5, '*' => 5);
 	// Tags to ignore the contents of completely (just code)
 	$tags_ignore = array('code');
+	// Tags not allowed
+	$tags_forbidden = array();
 	// Block tags, block tags can only go within another block tag, they cannot be in a normal tag
 	$tags_block = array('quote', 'code', 'list', 'h', '*');
 	// Inline tags, we do not allow new lines in these
@@ -221,6 +223,10 @@ function preparse_tags($text, &$errors, $is_signature = false)
 	// Tags we can automatically fix bad nesting
 	$tags_fix = array('quote', 'b', 'i', 'u', 's', 'ins', 'del', 'em', 'color', 'colour', 'url', 'email', 'h', 'topic', 'post', 'forum', 'user');
 
+	// Disallow URL tags
+	if ($pun_user['g_post_links'] != '1')
+		$tags_forbidden[] = 'url';
+
 	$split_text = preg_split('%(\[[\*a-zA-Z0-9-/]*?(?:=.*?)?\])%', $text, -1, PREG_SPLIT_DELIM_CAPTURE|PREG_SPLIT_NO_EMPTY);
 
 	$open_tags = array('fluxbb-bbcode');
@@ -378,6 +384,13 @@ function preparse_tags($text, &$errors, $is_signature = false)
 			continue;
 		}
 
+		// Is the tag forbidden?
+		if (in_array($current_tag, $tags_forbidden))
+		{
+			$errors[] = sprintf($lang_common['BBCode error tag not allowed'], $current_tag);
+			return false;
+		}
+
 		if ($current_nest)
 		{
 			// We are currently too deeply nested so lets see if we are closing the tag or not
diff --git a/lang/English/common.php b/lang/English/common.php
index f15fa2e..0cd2660 100644
--- a/lang/English/common.php
+++ b/lang/English/common.php
@@ -86,6 +86,7 @@
 'BBCode error invalid self-nesting'	=>	'[%s] was opened within itself, this is not allowed',
 'BBCode error no closing tag'		=>	'[%1$s] was found without a matching [/%1$s]',
 'BBCode error empty attribute'		=>	'[%s] tag had an empty attribute section',
+'BBCode error tag not allowed'		=>	'You are not allowed to use [%s] tags',
 'BBCode code problem'				=>	'There is a problem with your [code] tags',
 'BBCode list size error'			=>	'Your list was too long to parse, please make it smaller!',
 
-- 
1.7.10


From 096f4b41ee05842f905cb9c342dacf50507d0fb9 Mon Sep 17 00:00:00 2001
From: Franz Liedke <franz@develophp.org>
Date: Sat, 31 Mar 2012 00:19:01 +0200
Subject: [PATCH 15/75] Use more specific error messages for illegal url tags
 if links are automatically made clickable.

Related to #646.
---
 include/parser.php      |    6 +++++-
 lang/English/common.php |    1 +
 2 files changed, 6 insertions(+), 1 deletion(-)

diff --git a/include/parser.php b/include/parser.php
index 6ecb5e8..9ba708b 100644
--- a/include/parser.php
+++ b/include/parser.php
@@ -387,7 +387,11 @@ function preparse_tags($text, &$errors, $is_signature = false)
 		// Is the tag forbidden?
 		if (in_array($current_tag, $tags_forbidden))
 		{
-			$errors[] = sprintf($lang_common['BBCode error tag not allowed'], $current_tag);
+			if (isset($lang_common['BBCode error tag '.$current_tag.' not allowed']))
+				$errors[] = sprintf($lang_common['BBCode error tag '.$current_tag.' not allowed']);
+			else
+				$errors[] = sprintf($lang_common['BBCode error tag not allowed'], $current_tag);
+
 			return false;
 		}
 
diff --git a/lang/English/common.php b/lang/English/common.php
index 0cd2660..626ea95 100644
--- a/lang/English/common.php
+++ b/lang/English/common.php
@@ -87,6 +87,7 @@
 'BBCode error no closing tag'		=>	'[%1$s] was found without a matching [/%1$s]',
 'BBCode error empty attribute'		=>	'[%s] tag had an empty attribute section',
 'BBCode error tag not allowed'		=>	'You are not allowed to use [%s] tags',
+'BBCode error tag url not allowed'	=>	'You are not allowed to post links',
 'BBCode code problem'				=>	'There is a problem with your [code] tags',
 'BBCode list size error'			=>	'Your list was too long to parse, please make it smaller!',
 
-- 
1.7.10


From bb3e8d91d0be1986fcd8cddd9c1c1c3d2455b9ca Mon Sep 17 00:00:00 2001
From: Franz Liedke <franz@develophp.org>
Date: Sun, 8 Apr 2012 15:44:33 +0200
Subject: [PATCH 16/75] #653: Disallow links in user profile's website field
 if they are not allowed to post links.

---
 lang/English/profile.php |    3 ++-
 profile.php              |   23 +++++++++++++++++------
 2 files changed, 19 insertions(+), 7 deletions(-)

diff --git a/lang/English/profile.php b/lang/English/profile.php
index 5687e35..bca8141 100644
--- a/lang/English/profile.php
+++ b/lang/English/profile.php
@@ -81,7 +81,8 @@
 'Realname'						=>	'Real name',
 'Location'						=>	'Location',
 'Website'						=>	'Website',
-'Invalid website URL'					=>	'The website URL you entered is invalid.',
+'Invalid website URL'			=>	'The website URL you entered is invalid.',
+'Website not allowed'			=>	'You are not allowed to add a website to your profile yet.',
 'Jabber'						=>	'Jabber',
 'ICQ'							=>	'ICQ',
 'MSN'							=>	'MSN Messenger',
diff --git a/profile.php b/profile.php
index 93abc81..0f17b82 100644
--- a/profile.php
+++ b/profile.php
@@ -767,14 +767,24 @@
 			);
 
 			// Add http:// if the URL doesn't contain it already (while allowing https://, too)
-			if ($form['url'] != '')
+			if ($pun_user['g_post_links'] == '1')
 			{
-				$url = url_valid($form['url']);
+				if ($form['url'] != '')
+				{
+					$url = url_valid($form['url']);
 
-				if ($url === false)
-					message($lang_profile['Invalid website URL']);
+					if ($url === false)
+						message($lang_profile['Invalid website URL']);
 
-				$form['url'] = $url['url'];
+					$form['url'] = $url['url'];
+				}
+			}
+			else
+			{
+				if (!empty($form['url']))
+					message($lang_profile['Website not allowed']);
+
+				$form['url'] = '';
 			}
 
 			if ($pun_user['g_id'] == PUN_ADMIN)
@@ -1427,7 +1437,8 @@
 							<label><?php echo $lang_profile['Realname'] ?><br /><input type="text" name="form[realname]" value="<?php echo pun_htmlspecialchars($user['realname']) ?>" size="40" maxlength="40" /><br /></label>
 <?php if (isset($title_field)): ?>							<?php echo $title_field ?>
 <?php endif; ?>							<label><?php echo $lang_profile['Location'] ?><br /><input type="text" name="form[location]" value="<?php echo pun_htmlspecialchars($user['location']) ?>" size="30" maxlength="30" /><br /></label>
-							<label><?php echo $lang_profile['Website'] ?><br /><input type="text" name="form[url]" value="<?php echo pun_htmlspecialchars($user['url']) ?>" size="50" maxlength="80" /><br /></label>
+<?php if ($pun_user['g_post_links'] == '1' || $pun_user['g_id'] == PUN_ADMIN) : ?>							<label><?php echo $lang_profile['Website'] ?><br /><input type="text" name="form[url]" value="<?php echo pun_htmlspecialchars($user['url']) ?>" size="50" maxlength="80" /><br /></label>
+<?php endif; ?>
 						</div>
 					</fieldset>
 				</div>
-- 
1.7.10


From d77f959bdabd779cf43825a1392cabc967980542 Mon Sep 17 00:00:00 2001
From: Franz Liedke <franz@develophp.org>
Date: Sun, 8 Apr 2012 17:31:52 +0200
Subject: [PATCH 17/75] Fix possible undefined index errors in profile.php.

Loosely related to #653.
---
 profile.php |    6 +++---
 1 file changed, 3 insertions(+), 3 deletions(-)

diff --git a/profile.php b/profile.php
index 0f17b82..e95d67c 100644
--- a/profile.php
+++ b/profile.php
@@ -761,9 +761,9 @@
 		case 'personal':
 		{
 			$form = array(
-				'realname'		=> pun_trim($_POST['form']['realname']),
-				'url'			=> pun_trim($_POST['form']['url']),
-				'location'		=> pun_trim($_POST['form']['location']),
+				'realname'		=> isset($_POST['form']['realname']) ? pun_trim($_POST['form']['realname']) : '',
+				'url'			=> isset($_POST['form']['url']) ? pun_trim($_POST['form']['url']) : '',
+				'location'		=> isset($_POST['form']['location']) ? pun_trim($_POST['form']['location']) : '',
 			);
 
 			// Add http:// if the URL doesn't contain it already (while allowing https://, too)
-- 
1.7.10


From b0b7a60c6b5e1c7d2b64884bc2c7ca8141e0c915 Mon Sep 17 00:00:00 2001
From: Franz Liedke <franz@develophp.org>
Date: Sun, 8 Apr 2012 23:30:32 +0200
Subject: [PATCH 18/75] Add some more text explaining that user group changes
 may have to wait until users' next post.

Related to #647.
---
 lang/English/admin_groups.php |    2 +-
 1 file changed, 1 insertion(+), 1 deletion(-)

diff --git a/lang/English/admin_groups.php b/lang/English/admin_groups.php
index 5059640..55d2f50 100644
--- a/lang/English/admin_groups.php
+++ b/lang/English/admin_groups.php
@@ -40,7 +40,7 @@
 'User title label'				=>	'User title',
 'User title help'				=>	'The rank users in this group have attained. Leave blank to use default title ("%s").',
 'Promote users label'			=>	'Promote users',
-'Promote users help'			=>	'You can promote users to a new group automatically if they reach a certain number of posts. Select "%s" to disable. For security reasons, you are not allowed to select an administrator group here.',
+'Promote users help'			=>	'You can promote users to a new group automatically if they reach a certain number of posts. Select "%s" to disable. For security reasons, you are not allowed to select an administrator group here. Also note that group changes for users affected by this setting may only take effect after their next post.',
 'Disable promotion'				=>	'Disable promoting',
 'Mod privileges label'			=>	'Allow users moderator privileges',
 'Mod privileges help'			=>	'In order for a user in this group to have moderator abilities, he/she must be assigned to moderate one or more forums. This is done via the user administration page of the user\'s profile.',
-- 
1.7.10


From 14df42fae074d55ea06ce2905b6fe4d48e4ed018 Mon Sep 17 00:00:00 2001
From: Franz Liedke <franz@develophp.org>
Date: Sun, 15 Apr 2012 00:17:37 +0200
Subject: [PATCH 19/75] Adapt README for 1.5 branch.

---
 README |    4 ++--
 1 file changed, 2 insertions(+), 2 deletions(-)

diff --git a/README b/README
index d40b397..f29a62c 100644
--- a/README
+++ b/README
@@ -1,5 +1,5 @@
 	=====================
-	  FluxBB 1.4 Readme
+	  FluxBB 1.5 Readme
 	=====================
 
 	   About
@@ -24,7 +24,7 @@ of the other forums have whilst not sacrificing essential functionality or usabi
 	---------
 
  - Homepage: http://fluxbb.org
- - Documentation: http://fluxbb.org/docs/
+ - Documentation: http://fluxbb.org/docs/v1.5
  - Community: http://fluxbb.org/forums/
  - Resources: http://fluxbb.org/resources/
  - IRC: irc://irc.freenode.net/fluxbb
-- 
1.7.10


From 82742f5f6dc8fdfd784286112c96820330cd9d45 Mon Sep 17 00:00:00 2001
From: Franz Liedke <franz@develophp.org>
Date: Tue, 24 Apr 2012 16:48:26 +0200
Subject: [PATCH 20/75] Tag the 1.5-beta release.

---
 db_update.php      |    4 ++--
 include/common.php |    2 +-
 install.php        |    2 +-
 3 files changed, 4 insertions(+), 4 deletions(-)

diff --git a/db_update.php b/db_update.php
index 396b1be..9609f5a 100644
--- a/db_update.php
+++ b/db_update.php
@@ -7,7 +7,7 @@
  */
 
 // The FluxBB version this script updates to
-define('UPDATE_TO', '1.5-dev');
+define('UPDATE_TO', '1.5-beta');
 
 define('UPDATE_TO_DB_REVISION', 18);
 define('UPDATE_TO_SI_REVISION', 2);
@@ -1022,7 +1022,7 @@ function convert_table_utf8($table, $callback, $old_charset, $key = null, $start
 		// Change the search_data field to mediumtext
 		$db->alter_field('search_cache', 'search_data', 'MEDIUMTEXT', true) or error('Unable to alter search_data field', __FILE__, __LINE__, $db->error());
 
-		// Add the group promotion fields to the groups table
+		// Add the group promotion fields to the groups table
 		$db->add_field('groups', 'g_promote_min_posts', 'INT(10) UNSIGNED', false, 0, 'g_user_title') or error('Unable to add g_promote_min_posts field', __FILE__, __LINE__, $db->error());
 		$db->add_field('groups', 'g_promote_next_group', 'INT(10) UNSIGNED', false, 0, 'g_promote_min_posts') or error('Unable to add g_promote_next_group field', __FILE__, __LINE__, $db->error());
 
diff --git a/include/common.php b/include/common.php
index 015acd7..79a112b 100644
--- a/include/common.php
+++ b/include/common.php
@@ -10,7 +10,7 @@
 	exit('The constant PUN_ROOT must be defined and point to a valid FluxBB installation root directory.');
 
 // Define the version and database revision that this code was written for
-define('FORUM_VERSION', '1.5-dev');
+define('FORUM_VERSION', '1.5-beta');
 
 define('FORUM_DB_REVISION', 18);
 define('FORUM_SI_REVISION', 2);
diff --git a/install.php b/install.php
index e5e46bb..8b0646e 100644
--- a/install.php
+++ b/install.php
@@ -7,7 +7,7 @@
  */
 
 // The FluxBB version this script installs
-define('FORUM_VERSION', '1.5-dev');
+define('FORUM_VERSION', '1.5-beta');
 
 define('FORUM_DB_REVISION', 18);
 define('FORUM_SI_REVISION', 2);
-- 
1.7.10


From 505f7d878189fbeb629fc252d79b8287eaff1c77 Mon Sep 17 00:00:00 2001
From: Franz Liedke <franz@develophp.org>
Date: Sat, 5 May 2012 12:21:37 +0200
Subject: [PATCH 21/75] Tag the final release of v1.5.0.

---
 db_update.php      |    2 +-
 include/common.php |    2 +-
 install.php        |    2 +-
 3 files changed, 3 insertions(+), 3 deletions(-)

diff --git a/db_update.php b/db_update.php
index 9609f5a..7ebc989 100644
--- a/db_update.php
+++ b/db_update.php
@@ -7,7 +7,7 @@
  */
 
 // The FluxBB version this script updates to
-define('UPDATE_TO', '1.5-beta');
+define('UPDATE_TO', '1.5.0');
 
 define('UPDATE_TO_DB_REVISION', 18);
 define('UPDATE_TO_SI_REVISION', 2);
diff --git a/include/common.php b/include/common.php
index 79a112b..2bab0f0 100644
--- a/include/common.php
+++ b/include/common.php
@@ -10,7 +10,7 @@
 	exit('The constant PUN_ROOT must be defined and point to a valid FluxBB installation root directory.');
 
 // Define the version and database revision that this code was written for
-define('FORUM_VERSION', '1.5-beta');
+define('FORUM_VERSION', '1.5.0');
 
 define('FORUM_DB_REVISION', 18);
 define('FORUM_SI_REVISION', 2);
diff --git a/install.php b/install.php
index 78eb530..efe5de5 100644
--- a/install.php
+++ b/install.php
@@ -7,7 +7,7 @@
  */
 
 // The FluxBB version this script installs
-define('FORUM_VERSION', '1.5-beta');
+define('FORUM_VERSION', '1.5.0');
 
 define('FORUM_DB_REVISION', 18);
 define('FORUM_SI_REVISION', 2);
-- 
1.7.10


From 3d5d5acd352809dedc87b9a0a77feff90edebf8d Mon Sep 17 00:00:00 2001
From: Arw <arw.contact@gmail.com>
Date: Wed, 9 May 2012 14:26:09 +0200
Subject: [PATCH 22/75] #668: fix html structure for admin_options.php so it's
 ok with old styles

---
 admin_options.php |  152 ++++++++++++++++++++++++++++++++---------------------
 1 file changed, 91 insertions(+), 61 deletions(-)

diff --git a/admin_options.php b/admin_options.php
index deea52c..5178fd7 100644
--- a/admin_options.php
+++ b/admin_options.php
@@ -302,8 +302,9 @@
 								<tr>
 									<th scope="row"><?php echo $lang_admin_options['DST label'] ?></th>
 									<td>
-										<input type="radio" name="form[default_dst]" id="form_default_dst_1" value="1"<?php if ($pun_config['o_default_dst'] == '1') echo ' checked="checked"' ?> />&#160;<label class="conl" for="form_default_dst_1"><strong><?php echo $lang_admin_common['Yes'] ?></strong></label>&#160;&#160;&#160;<input type="radio" name="form[default_dst]" id="form_default_dst_0" value="0"<?php if ($pun_config['o_default_dst'] == '0') echo ' checked="checked"' ?> />&#160;<label class="conl" for="form_default_dst_0"><strong><?php echo $lang_admin_common['No'] ?></strong></label>
-										<span><?php echo $lang_admin_options['DST help'] ?></span>
+										<label class="conl"><input type="radio" name="form[default_dst]" value="1"<?php if ($pun_config['o_default_dst'] == '1') echo ' checked="checked"' ?> />&#160;<strong><?php echo $lang_admin_common['Yes'] ?></strong></label>
+										<label class="conl"><input type="radio" name="form[default_dst]" value="0"<?php if ($pun_config['o_default_dst'] == '0') echo ' checked="checked"' ?> />&#160;<strong><?php echo $lang_admin_common['No'] ?></strong></label>
+										<span class="clearb"><?php echo $lang_admin_options['DST help'] ?></span>
 									</td>
 								</tr>
 								<tr>
@@ -410,43 +411,49 @@
 								<tr>
 									<th scope="row"><?php echo $lang_admin_options['Version number label'] ?></th>
 									<td>
-										<input type="radio" name="form[show_version]" id="form_show_version_1" value="1"<?php if ($pun_config['o_show_version'] == '1') echo ' checked="checked"' ?> />&#160;<label class="conl" for="form_show_version_1"><strong><?php echo $lang_admin_common['Yes'] ?></strong></label>&#160;&#160;&#160;<input type="radio" name="form[show_version]" id="form_show_version_0" value="0"<?php if ($pun_config['o_show_version'] == '0') echo ' checked="checked"' ?> />&#160;<label class="conl" for="form_show_version_0"><strong><?php echo $lang_admin_common['No'] ?></strong></label>
-										<span><?php echo $lang_admin_options['Version number help'] ?></span>
+										<label class="conl"><input type="radio" name="form[show_version]" value="1"<?php if ($pun_config['o_show_version'] == '1') echo ' checked="checked"' ?> />&#160;<strong><?php echo $lang_admin_common['Yes'] ?></strong></label>
+										<label class="conl"><input type="radio" name="form[show_version]" value="0"<?php if ($pun_config['o_show_version'] == '0') echo ' checked="checked"' ?> />&#160;<strong><?php echo $lang_admin_common['No'] ?></strong></label>
+										<span class="clearb"><?php echo $lang_admin_options['Version number help'] ?></span>
 									</td>
 								</tr>
 								<tr>
 									<th scope="row"><?php echo $lang_admin_options['Info in posts label'] ?></th>
 									<td>
-										<input type="radio" name="form[show_user_info]" id="form_show_user_info_1" value="1"<?php if ($pun_config['o_show_user_info'] == '1') echo ' checked="checked"' ?> />&#160;<label class="conl" for="form_show_user_info_1"><strong><?php echo $lang_admin_common['Yes'] ?></strong></label>&#160;&#160;&#160;<input type="radio" name="form[show_user_info]" id="form_show_user_info_0" value="0"<?php if ($pun_config['o_show_user_info'] == '0') echo ' checked="checked"' ?> />&#160;<label class="conl" for="form_show_user_info_0"><strong><?php echo $lang_admin_common['No'] ?></strong></label>
-										<span><?php echo $lang_admin_options['Info in posts help'] ?></span>
+										<label class="conl"><input type="radio" name="form[show_user_info]" value="1"<?php if ($pun_config['o_show_user_info'] == '1') echo ' checked="checked"' ?> />&#160;<strong><?php echo $lang_admin_common['Yes'] ?></strong></label>
+										<label class="conl"><input type="radio" name="form[show_user_info]" value="0"<?php if ($pun_config['o_show_user_info'] == '0') echo ' checked="checked"' ?> />&#160;<strong><?php echo $lang_admin_common['No'] ?></strong></label>
+										<span class="clearb"><?php echo $lang_admin_options['Info in posts help'] ?></span>
 									</td>
 								</tr>
 								<tr>
 									<th scope="row"><?php echo $lang_admin_options['Post count label'] ?></th>
 									<td>
-										<input type="radio" name="form[show_post_count]" id="form_show_post_count_1" value="1"<?php if ($pun_config['o_show_post_count'] == '1') echo ' checked="checked"' ?> />&#160;<label class="conl" for="form_show_post_count_1"><strong><?php echo $lang_admin_common['Yes'] ?></strong></label>&#160;&#160;&#160;<input type="radio" name="form[show_post_count]" id="form_show_post_count_0" value="0"<?php if ($pun_config['o_show_post_count'] == '0') echo ' checked="checked"' ?> />&#160;<label class="conl" for="form_show_post_count_0"><strong><?php echo $lang_admin_common['No'] ?></strong></label>
-										<span><?php echo $lang_admin_options['Post count help'] ?></span>
+										<label class="conl"><input type="radio" name="form[show_post_count]" value="1"<?php if ($pun_config['o_show_post_count'] == '1') echo ' checked="checked"' ?> />&#160;<strong><?php echo $lang_admin_common['Yes'] ?></strong></label>
+										<label class="conl"><input type="radio" name="form[show_post_count]" value="0"<?php if ($pun_config['o_show_post_count'] == '0') echo ' checked="checked"' ?> />&#160;<strong><?php echo $lang_admin_common['No'] ?></strong></label>
+										<span class="clearb"><?php echo $lang_admin_options['Post count help'] ?></span>
 									</td>
 								</tr>
 								<tr>
 									<th scope="row"><?php echo $lang_admin_options['Smilies label'] ?></th>
 									<td>
-										<input type="radio" name="form[smilies]" id="form_smilies_1" value="1"<?php if ($pun_config['o_smilies'] == '1') echo ' checked="checked"' ?> />&#160;<label class="conl" for="form_smilies_1"><strong><?php echo $lang_admin_common['Yes'] ?></strong></label>&#160;&#160;&#160;<input type="radio" name="form[smilies]" id="form_smilies_0" value="0"<?php if ($pun_config['o_smilies'] == '0') echo ' checked="checked"' ?> />&#160;<label class="conl" for="form_smilies_0"><strong><?php echo $lang_admin_common['No'] ?></strong></label>
-										<span><?php echo $lang_admin_options['Smilies help'] ?></span>
+										<label class="conl"><input type="radio" name="form[smilies]" value="1"<?php if ($pun_config['o_smilies'] == '1') echo ' checked="checked"' ?> />&#160;<strong><?php echo $lang_admin_common['Yes'] ?></strong></label>
+										<label class="conl"><input type="radio" name="form[smilies]" value="0"<?php if ($pun_config['o_smilies'] == '0') echo ' checked="checked"' ?> />&#160;<strong><?php echo $lang_admin_common['No'] ?></strong></label>
+										<span class="conl"><?php echo $lang_admin_options['Smilies help'] ?></span>
 									</td>
 								</tr>
 								<tr>
 									<th scope="row"><?php echo $lang_admin_options['Smilies sigs label'] ?></th>
 									<td>
-										<input type="radio" name="form[smilies_sig]" id="form_smilies_sig_1" value="1"<?php if ($pun_config['o_smilies_sig'] == '1') echo ' checked="checked"' ?> />&#160;<label class="conl" for="form_smilies_sig_1"><strong><?php echo $lang_admin_common['Yes'] ?></strong></label>&#160;&#160;&#160;<input type="radio" name="form[smilies_sig]" id="form_smilies_sig_0" value="0"<?php if ($pun_config['o_smilies_sig'] == '0') echo ' checked="checked"' ?> />&#160;<label class="conl" for="form_smilies_sig_0"><strong><?php echo $lang_admin_common['No'] ?></strong></label>
-										<span><?php echo $lang_admin_options['Smilies sigs help'] ?></span>
+										<label class="conl"><input type="radio" name="form[smilies_sig]" value="1"<?php if ($pun_config['o_smilies_sig'] == '1') echo ' checked="checked"' ?> />&#160;<strong><?php echo $lang_admin_common['Yes'] ?></strong></label>
+										<label class="conl"><input type="radio" name="form[smilies_sig]" value="0"<?php if ($pun_config['o_smilies_sig'] == '0') echo ' checked="checked"' ?> />&#160;<strong><?php echo $lang_admin_common['No'] ?></strong></label>
+										<span class="clearb"><?php echo $lang_admin_options['Smilies sigs help'] ?></span>
 									</td>
 								</tr>
 								<tr>
 									<th scope="row"><?php echo $lang_admin_options['Clickable links label'] ?></th>
 									<td>
-										<input type="radio" name="form[make_links]" id="form_make_links_1" value="1"<?php if ($pun_config['o_make_links'] == '1') echo ' checked="checked"' ?> />&#160;<label class="conl" for="form_make_links_1"><strong><?php echo $lang_admin_common['Yes'] ?></strong></label>&#160;&#160;&#160;<input type="radio" name="form[make_links]" id="form_make_links_0" value="0"<?php if ($pun_config['o_make_links'] == '0') echo ' checked="checked"' ?> />&#160;<label class="conl" for="form_make_links_0"><strong><?php echo $lang_admin_common['No'] ?></strong></label>
-										<span><?php echo $lang_admin_options['Clickable links help'] ?></span>
+										<label class="conl"><input type="radio" name="form[make_links]" value="1"<?php if ($pun_config['o_make_links'] == '1') echo ' checked="checked"' ?> />&#160;<strong><?php echo $lang_admin_common['Yes'] ?></strong></label>
+										<label class="conl"><input type="radio" name="form[make_links]" value="0"<?php if ($pun_config['o_make_links'] == '0') echo ' checked="checked"' ?> />&#160;<strong><?php echo $lang_admin_common['No'] ?></strong></label>
+										<span class="clearb"><?php echo $lang_admin_options['Clickable links help'] ?></span>
 									</td>
 								</tr>
 								<tr>
@@ -496,64 +503,73 @@
 								<tr>
 									<th scope="row"><?php echo $lang_admin_options['Quick post label'] ?></th>
 									<td>
-										<input type="radio" name="form[quickpost]" id="form_quickpost_1" value="1"<?php if ($pun_config['o_quickpost'] == '1') echo ' checked="checked"' ?> />&#160;<label class="conl" for="form_quickpost_1"><strong><?php echo $lang_admin_common['Yes'] ?></strong></label>&#160;&#160;&#160;<input type="radio" name="form[quickpost]" id="form_quickpost_0" value="0"<?php if ($pun_config['o_quickpost'] == '0') echo ' checked="checked"' ?> />&#160;<label class="conl" for="form_quickpost_0"><strong><?php echo $lang_admin_common['No'] ?></strong></label>
-										<span><?php echo $lang_admin_options['Quick post help'] ?></span>
+										<label class="conl"><input type="radio" name="form[quickpost]" value="1"<?php if ($pun_config['o_quickpost'] == '1') echo ' checked="checked"' ?> />&#160;<strong><?php echo $lang_admin_common['Yes'] ?></strong></label>
+										<label class="conl"><input type="radio" name="form[quickpost]" value="0"<?php if ($pun_config['o_quickpost'] == '0') echo ' checked="checked"' ?> />&#160;<strong><?php echo $lang_admin_common['No'] ?></strong></label>
+										<span class="clearb"><?php echo $lang_admin_options['Quick post help'] ?></span>
 									</td>
 								</tr>
 								<tr>
 									<th scope="row"><?php echo $lang_admin_options['Users online label'] ?></th>
 									<td>
-										<input type="radio" name="form[users_online]" id="form_users_online_1" value="1"<?php if ($pun_config['o_users_online'] == '1') echo ' checked="checked"' ?> />&#160;<label class="conl" for="form_users_online_1"><strong><?php echo $lang_admin_common['Yes'] ?></strong></label>&#160;&#160;&#160;<input type="radio" name="form[users_online]" id="form_users_online_0" value="0"<?php if ($pun_config['o_users_online'] == '0') echo ' checked="checked"' ?> />&#160;<label class="conl" for="form_users_online_0"><strong><?php echo $lang_admin_common['No'] ?></strong></label>
-										<span><?php echo $lang_admin_options['Users online help'] ?></span>
+										<label class="conl"><input type="radio" name="form[users_online]" value="1"<?php if ($pun_config['o_users_online'] == '1') echo ' checked="checked"' ?> />&#160;<strong><?php echo $lang_admin_common['Yes'] ?></strong></label>
+										<label class="conl"><input type="radio" name="form[users_online]" value="0"<?php if ($pun_config['o_users_online'] == '0') echo ' checked="checked"' ?> />&#160;<strong><?php echo $lang_admin_common['No'] ?></strong></label>
+										<span class="clearb"><?php echo $lang_admin_options['Users online help'] ?></span>
 									</td>
 								</tr>
 								<tr>
 									<th scope="row"><a name="censoring"></a><?php echo $lang_admin_options['Censor words label'] ?></th>
 									<td>
-										<input type="radio" name="form[censoring]" id="form_censoring_1" value="1"<?php if ($pun_config['o_censoring'] == '1') echo ' checked="checked"' ?> />&#160;<label class="conl" for="form_censoring_1"><strong><?php echo $lang_admin_common['Yes'] ?></strong></label>&#160;&#160;&#160;<input type="radio" name="form[censoring]" id="form_censoring_0" value="0"<?php if ($pun_config['o_censoring'] == '0') echo ' checked="checked"' ?> />&#160;<label class="conl" for="form_censoring_0"><strong><?php echo $lang_admin_common['No'] ?></strong></label>
-										<span><?php printf($lang_admin_options['Censor words help'], '<a href="admin_censoring.php">'.$lang_admin_common['Censoring'].'</a>') ?></span>
+										<label class="conl"><input type="radio" name="form[censoring]" value="1"<?php if ($pun_config['o_censoring'] == '1') echo ' checked="checked"' ?> />&#160;<strong><?php echo $lang_admin_common['Yes'] ?></strong></label>
+										<label class="conl"><input type="radio" name="form[censoring]" value="0"<?php if ($pun_config['o_censoring'] == '0') echo ' checked="checked"' ?> />&#160;<strong><?php echo $lang_admin_common['No'] ?></strong></label>
+										<span class="clearb"><?php printf($lang_admin_options['Censor words help'], '<a href="admin_censoring.php">'.$lang_admin_common['Censoring'].'</a>') ?></span>
 									</td>
 								</tr>
 								<tr>
 									<th scope="row"><a name="signatures"></a><?php echo $lang_admin_options['Signatures label'] ?></th>
 									<td>
-										<input type="radio" name="form[signatures]" id="form_signatures_1" value="1"<?php if ($pun_config['o_signatures'] == '1') echo ' checked="checked"' ?> />&#160;<label class="conl" for="form_signatures_1"><strong><?php echo $lang_admin_common['Yes'] ?></strong></label>&#160;&#160;&#160;<input type="radio" name="form[signatures]" id="form_signatures_0" value="0"<?php if ($pun_config['o_signatures'] == '0') echo ' checked="checked"' ?> />&#160;<label class="conl" for="form_signatures_0"><strong><?php echo $lang_admin_common['No'] ?></strong></label>
-										<span><?php echo $lang_admin_options['Signatures help'] ?></span>
+										<label class="conl"><input type="radio" name="form[signatures]" value="1"<?php if ($pun_config['o_signatures'] == '1') echo ' checked="checked"' ?> />&#160;<strong><?php echo $lang_admin_common['Yes'] ?></strong></label>
+										<label class="conl"><input type="radio" name="form[signatures]" value="0"<?php if ($pun_config['o_signatures'] == '0') echo ' checked="checked"' ?> />&#160;<strong><?php echo $lang_admin_common['No'] ?></strong></label>
+										<span class="clearb"><?php echo $lang_admin_options['Signatures help'] ?></span>
 									</td>
 								</tr>
 								<tr>
 									<th scope="row"><?php echo $lang_admin_options['User has posted label'] ?></th>
 									<td>
-										<input type="radio" name="form[show_dot]" id="form_show_dot_1" value="1"<?php if ($pun_config['o_show_dot'] == '1') echo ' checked="checked"' ?> />&#160;<label class="conl" for="form_show_dot_1"><strong><?php echo $lang_admin_common['Yes'] ?></strong></label>&#160;&#160;&#160;<input type="radio" name="form[show_dot]" id="form_show_dot_0" value="0"<?php if ($pun_config['o_show_dot'] == '0') echo ' checked="checked"' ?> />&#160;<label class="conl" for="form_show_dot_0"><strong><?php echo $lang_admin_common['No'] ?></strong></label>
-										<span><?php echo $lang_admin_options['User has posted help'] ?></span>
+										<label class="conl"><input type="radio" name="form[show_dot]" value="1"<?php if ($pun_config['o_show_dot'] == '1') echo ' checked="checked"' ?> />&#160;<strong><?php echo $lang_admin_common['Yes'] ?></strong></label>
+										<label class="conl"><input type="radio" name="form[show_dot]" value="0"<?php if ($pun_config['o_show_dot'] == '0') echo ' checked="checked"' ?> />&#160;<strong><?php echo $lang_admin_common['No'] ?></strong></label>
+										<span class="clearb"><?php echo $lang_admin_options['User has posted help'] ?></span>
 									</td>
 								</tr>
 								<tr>
 									<th scope="row"><?php echo $lang_admin_options['Topic views label'] ?></th>
 									<td>
-										<input type="radio" name="form[topic_views]" id="form_topic_views_1" value="1"<?php if ($pun_config['o_topic_views'] == '1') echo ' checked="checked"' ?> />&#160;<label class="conl" for="form_topic_views_1"><strong><?php echo $lang_admin_common['Yes'] ?></strong></label>&#160;&#160;&#160;<input type="radio" name="form[topic_views]" id="form_topic_views_0" value="0"<?php if ($pun_config['o_topic_views'] == '0') echo ' checked="checked"' ?> />&#160;<label class="conl" for="form_topic_views_0"><strong><?php echo $lang_admin_common['No'] ?></strong></label>
-										<span><?php echo $lang_admin_options['Topic views help'] ?></span>
+										<label class="conl"><input type="radio" name="form[topic_views]" value="1"<?php if ($pun_config['o_topic_views'] == '1') echo ' checked="checked"' ?> />&#160;<strong><?php echo $lang_admin_common['Yes'] ?></strong></label>
+										<label class="conl"><input type="radio" name="form[topic_views]" value="0"<?php if ($pun_config['o_topic_views'] == '0') echo ' checked="checked"' ?> />&#160;<strong><?php echo $lang_admin_common['No'] ?></strong></label>
+										<span class="clearb"><?php echo $lang_admin_options['Topic views help'] ?></span>
 									</td>
 								</tr>
 								<tr>
 									<th scope="row"><?php echo $lang_admin_options['Quick jump label'] ?></th>
 									<td>
-										<input type="radio" name="form[quickjump]" id="form_quickjump_1" value="1"<?php if ($pun_config['o_quickjump'] == '1') echo ' checked="checked"' ?> />&#160;<label class="conl" for="form_quickjump_1"><strong><?php echo $lang_admin_common['Yes'] ?></strong></label>&#160;&#160;&#160;<input type="radio" name="form[quickjump]" id="form_quickjump_0" value="0"<?php if ($pun_config['o_quickjump'] == '0') echo ' checked="checked"' ?> />&#160;<label class="conl" for="form_quickjump_0"><strong><?php echo $lang_admin_common['No'] ?></strong></label>
-										<span><?php echo $lang_admin_options['Quick jump help'] ?></span>
+										<label class="conl"><input type="radio" name="form[quickjump]" value="1"<?php if ($pun_config['o_quickjump'] == '1') echo ' checked="checked"' ?> />&#160;<strong><?php echo $lang_admin_common['Yes'] ?></strong></label>
+										<label class="conl"><input type="radio" name="form[quickjump]" value="0"<?php if ($pun_config['o_quickjump'] == '0') echo ' checked="checked"' ?> />&#160;<strong><?php echo $lang_admin_common['No'] ?></strong></label>
+										<span class="clearb"><?php echo $lang_admin_options['Quick jump help'] ?></span>
 									</td>
 								</tr>
 								<tr>
 									<th scope="row"><?php echo $lang_admin_options['GZip label'] ?></th>
 									<td>
-										<input type="radio" name="form[gzip]" id="form_gzip_1" value="1"<?php if ($pun_config['o_gzip'] == '1') echo ' checked="checked"' ?> />&#160;<label class="conl" for="form_gzip_1"><strong><?php echo $lang_admin_common['Yes'] ?></strong></label>&#160;&#160;&#160;<input type="radio" name="form[gzip]" id="form_gzip_0" value="0"<?php if ($pun_config['o_gzip'] == '0') echo ' checked="checked"' ?> />&#160;<label class="conl" for="form_gzip_0"><strong><?php echo $lang_admin_common['No'] ?></strong></label>
-										<span><?php echo $lang_admin_options['GZip help'] ?></span>
+										<label class="conl"><input type="radio" name="form[gzip]" value="1"<?php if ($pun_config['o_gzip'] == '1') echo ' checked="checked"' ?> />&#160;<strong><?php echo $lang_admin_common['Yes'] ?></strong></label>
+										<label class="conl"><input type="radio" name="form[gzip]" value="0"<?php if ($pun_config['o_gzip'] == '0') echo ' checked="checked"' ?> />&#160;<strong><?php echo $lang_admin_common['No'] ?></strong></label>
+										<span class="clearb"><?php echo $lang_admin_options['GZip help'] ?></span>
 									</td>
 								</tr>
 								<tr>
 									<th scope="row"><?php echo $lang_admin_options['Search all label'] ?></th>
 									<td>
-										<input type="radio" name="form[search_all_forums]" id="form_search_all_forums_1" value="1"<?php if ($pun_config['o_search_all_forums'] == '1') echo ' checked="checked"' ?> />&#160;<label class="conl" for="form_search_all_forums_1"><strong><?php echo $lang_admin_common['Yes'] ?></strong></label>&#160;&#160;&#160;<input type="radio" name="form[search_all_forums]" id="form_search_all_forums_0" value="0"<?php if ($pun_config['o_search_all_forums'] == '0') echo ' checked="checked"' ?> />&#160;<label class="conl" for="form_search_all_forums_0"><strong><?php echo $lang_admin_common['No'] ?></strong></label>
-										<span><?php echo $lang_admin_options['Search all help'] ?></span>
+										<label class="conl"><input type="radio" name="form[search_all_forums]" value="1"<?php if ($pun_config['o_search_all_forums'] == '1') echo ' checked="checked"' ?> />&#160;<strong><?php echo $lang_admin_common['Yes'] ?></strong></label>
+										<label class="conl"><input type="radio" name="form[search_all_forums]" value="0"<?php if ($pun_config['o_search_all_forums'] == '0') echo ' checked="checked"' ?> />&#160;<strong><?php echo $lang_admin_common['No'] ?></strong></label>
+										<span class="clearb"><?php echo $lang_admin_options['Search all help'] ?></span>
 									</td>
 								</tr>
 								<tr>
@@ -575,8 +591,10 @@
 								<tr>
 									<th scope="row"><?php echo $lang_admin_options['Default feed label'] ?></th>
 									<td>
-										<input type="radio" name="form[feed_type]" id="form_feed_type_0" value="0"<?php if ($pun_config['o_feed_type'] == '0') echo ' checked="checked"' ?> />&#160;<strong><?php echo $lang_admin_options['None'] ?></strong>&#160;&#160;&#160;<input type="radio" name="form[feed_type]" id="form_feed_type_1" value="1"<?php if ($pun_config['o_feed_type'] == '1') echo ' checked="checked"' ?> />&#160;<label class="conl" for="form_feed_type_0"><strong><?php echo $lang_admin_options['RSS'] ?></strong></label>&#160;&#160;&#160;<input type="radio" name="form[feed_type]" id="form_feed_type_2" value="2"<?php if ($pun_config['o_feed_type'] == '2') echo ' checked="checked"' ?> />&#160;<label class="conl" for="form_feed_type_1"><strong><?php echo $lang_admin_options['Atom'] ?></strong></label>
-										<span><?php echo $lang_admin_options['Default feed help'] ?></span>
+										<label class="conl"><input type="radio" name="form[feed_type]" value="0"<?php if ($pun_config['o_feed_type'] == '0') echo ' checked="checked"' ?> />&#160;<strong><?php echo $lang_admin_options['None'] ?></strong></label>
+										<label class="conl"><input type="radio" name="form[feed_type]" value="1"<?php if ($pun_config['o_feed_type'] == '1') echo ' checked="checked"' ?> />&#160;<strong><?php echo $lang_admin_options['RSS'] ?></strong></label>
+										<label class="conl"><input type="radio" name="form[feed_type]" value="2"<?php if ($pun_config['o_feed_type'] == '2') echo ' checked="checked"' ?> />&#160;<strong><?php echo $lang_admin_options['Atom'] ?></strong></label>
+										<span class="clearb"><?php echo $lang_admin_options['Default feed help'] ?></span>
 									</td>
 								</tr>
 								<tr>
@@ -608,8 +626,10 @@
 								<tr>
 									<th scope="row"><?php echo $lang_admin_options['Reporting method label'] ?></th>
 									<td>
-										<input type="radio" name="form[report_method]" id="form_report_method_0" value="0"<?php if ($pun_config['o_report_method'] == '0') echo ' checked="checked"' ?> />&#160;<strong><?php echo $lang_admin_options['Internal'] ?></strong>&#160;&#160;&#160;<input type="radio" name="form[report_method]" id="form_report_method_1" value="1"<?php if ($pun_config['o_report_method'] == '1') echo ' checked="checked"' ?> />&#160;<label class="conl" for="form_report_method_0"><strong><?php echo $lang_admin_options['By e-mail'] ?></strong></label>&#160;&#160;&#160;<input type="radio" name="form[report_method]" id="form_report_method_2" value="2"<?php if ($pun_config['o_report_method'] == '2') echo ' checked="checked"' ?> />&#160;<label class="conl" for="form_report_method_1"><strong><?php echo $lang_admin_options['Both'] ?></strong></label>
-										<span><?php echo $lang_admin_options['Reporting method help'] ?></span>
+										<label class="conl"><input type="radio" name="form[report_method]" value="0"<?php if ($pun_config['o_report_method'] == '0') echo ' checked="checked"' ?> />&#160;<strong><?php echo $lang_admin_options['Internal'] ?></strong></label>
+										<label class="conl"><input type="radio" name="form[report_method]" value="1"<?php if ($pun_config['o_report_method'] == '1') echo ' checked="checked"' ?> />&#160;<strong><?php echo $lang_admin_options['By e-mail'] ?></strong></label>
+										<label class="conl"><input type="radio" name="form[report_method]" value="2"<?php if ($pun_config['o_report_method'] == '2') echo ' checked="checked"' ?> />&#160;<strong><?php echo $lang_admin_options['Both'] ?></strong></label>
+										<span class="clearb"><?php echo $lang_admin_options['Reporting method help'] ?></span>
 									</td>
 								</tr>
 								<tr>
@@ -631,8 +651,9 @@
 								<tr>
 									<th scope="row"><?php echo $lang_admin_options['Use avatars label'] ?></th>
 									<td>
-										<input type="radio" name="form[avatars]" id="form_avatars_1" value="1"<?php if ($pun_config['o_avatars'] == '1') echo ' checked="checked"' ?> />&#160;<label class="conl" for="form_avatars_1"><strong><?php echo $lang_admin_common['Yes'] ?></strong></label>&#160;&#160;&#160;<input type="radio" name="form[avatars]" id="form_avatars_0" value="0"<?php if ($pun_config['o_avatars'] == '0') echo ' checked="checked"' ?> />&#160;<label class="conl" for="form_avatars_0"><strong><?php echo $lang_admin_common['No'] ?></strong></label>
-										<span><?php echo $lang_admin_options['Use avatars help'] ?></span>
+										<label class="conl"><input type="radio" name="form[avatars]" value="1"<?php if ($pun_config['o_avatars'] == '1') echo ' checked="checked"' ?> />&#160;<strong><?php echo $lang_admin_common['Yes'] ?></strong></label>
+										<label class="conl"><input type="radio" name="form[avatars]" value="0"<?php if ($pun_config['o_avatars'] == '0') echo ' checked="checked"' ?> />&#160;<strong><?php echo $lang_admin_common['No'] ?></strong></label>
+										<span class="clearb"><?php echo $lang_admin_options['Use avatars help'] ?></span>
 									</td>
 								</tr>
 								<tr>
@@ -689,15 +710,17 @@
 								<tr>
 									<th scope="row"><?php echo $lang_admin_options['Forum subscriptions label'] ?></th>
 									<td>
-										<input type="radio" name="form[forum_subscriptions]" id="form_forum_subscriptions_1" value="1"<?php if ($pun_config['o_forum_subscriptions'] == '1') echo ' checked="checked"' ?> />&#160;<label class="conl" for="form_forum_subscriptions_1"><strong><?php echo $lang_admin_common['Yes'] ?></strong></label>&#160;&#160;&#160;<input type="radio" name="form[forum_subscriptions]" id="form_forum_subscriptions_0" value="0"<?php if ($pun_config['o_forum_subscriptions'] == '0') echo ' checked="checked"' ?> />&#160;<label class="conl" for="form_forum_subscriptions_0"><strong><?php echo $lang_admin_common['No'] ?></strong></label>
-										<span><?php echo $lang_admin_options['Forum subscriptions help'] ?></span>
+										<label class="conl"><input type="radio" name="form[forum_subscriptions]" value="1"<?php if ($pun_config['o_forum_subscriptions'] == '1') echo ' checked="checked"' ?> />&#160;<strong><?php echo $lang_admin_common['Yes'] ?></strong></label>
+										<label class="conl"><input type="radio" name="form[forum_subscriptions]" value="0"<?php if ($pun_config['o_forum_subscriptions'] == '0') echo ' checked="checked"' ?> />&#160;<strong><?php echo $lang_admin_common['No'] ?></strong></label>
+										<span class="clearb"><?php echo $lang_admin_options['Forum subscriptions help'] ?></span>
 									</td>
 								</tr>
 								<tr>
 									<th scope="row"><?php echo $lang_admin_options['Topic subscriptions label'] ?></th>
 									<td>
-										<input type="radio" name="form[topic_subscriptions]" id="form_topic_subscriptions_1" value="1"<?php if ($pun_config['o_topic_subscriptions'] == '1') echo ' checked="checked"' ?> />&#160;<label class="conl" for="form_topic_subscriptions_1"><strong><?php echo $lang_admin_common['Yes'] ?></strong></label>&#160;&#160;&#160;<input type="radio" name="form[topic_subscriptions]" id="form_topic_subscriptions_0" value="0"<?php if ($pun_config['o_topic_subscriptions'] == '0') echo ' checked="checked"' ?> />&#160;<label class="conl" for="form_topic_subscriptions_0"><strong><?php echo $lang_admin_common['No'] ?></strong></label>
-										<span><?php echo $lang_admin_options['Topic subscriptions help'] ?></span>
+										<label class="conl"><input type="radio" name="form[topic_subscriptions]" value="1"<?php if ($pun_config['o_topic_subscriptions'] == '1') echo ' checked="checked"' ?> />&#160;<strong><?php echo $lang_admin_common['Yes'] ?></strong></label>
+										<label class="conl"><input type="radio" name="form[topic_subscriptions]" value="0"<?php if ($pun_config['o_topic_subscriptions'] == '0') echo ' checked="checked"' ?> />&#160;<strong><?php echo $lang_admin_common['No'] ?></strong></label>
+										<span class="clearb"><?php echo $lang_admin_options['Topic subscriptions help'] ?></span>
 									</td>
 								</tr>
 								<tr>
@@ -717,7 +740,7 @@
 								<tr>
 									<th scope="row"><?php echo $lang_admin_options['SMTP password label'] ?></th>
 									<td>
-										<span><input type="checkbox" name="form[smtp_change_pass]" id="form_smtp_change_pass" value="1" />&#160;&#160;<label class="conl" for="form_smtp_change_pass"><?php echo $lang_admin_options['SMTP change password help'] ?></label></span>
+										<label><input type="checkbox" name="form[smtp_change_pass]" value="1" />&#160;<?php echo $lang_admin_options['SMTP change password help'] ?></label>
 <?php $smtp_pass = !empty($pun_config['o_smtp_pass']) ? random_key(pun_strlen($pun_config['o_smtp_pass']), true) : ''; ?>
 										<input type="password" name="form[smtp_pass1]" size="25" maxlength="50" value="<?php echo $smtp_pass ?>" />
 										<input type="password" name="form[smtp_pass2]" size="25" maxlength="50" value="<?php echo $smtp_pass ?>" />
@@ -727,8 +750,9 @@
 								<tr>
 									<th scope="row"><?php echo $lang_admin_options['SMTP SSL label'] ?></th>
 									<td>
-										<input type="radio" name="form[smtp_ssl]" id="form_smtp_ssl_1" value="1"<?php if ($pun_config['o_smtp_ssl'] == '1') echo ' checked="checked"' ?> />&#160;<label class="conl" for="form_smtp_ssl_1"><strong><?php echo $lang_admin_common['Yes'] ?></strong></label>&#160;&#160;&#160;<input type="radio" name="form[smtp_ssl]" id="form_smtp_ssl_0" value="0"<?php if ($pun_config['o_smtp_ssl'] == '0') echo ' checked="checked"' ?> />&#160;<label class="conl" for="form_smtp_ssl_0"><strong><?php echo $lang_admin_common['No'] ?></strong></label>
-										<span><?php echo $lang_admin_options['SMTP SSL help'] ?></span>
+										<label class="conl"><input type="radio" name="form[smtp_ssl]" value="1"<?php if ($pun_config['o_smtp_ssl'] == '1') echo ' checked="checked"' ?> />&#160;<strong><?php echo $lang_admin_common['Yes'] ?></strong></label>
+										<label class="conl"><input type="radio" name="form[smtp_ssl]" value="0"<?php if ($pun_config['o_smtp_ssl'] == '0') echo ' checked="checked"' ?> />&#160;<strong><?php echo $lang_admin_common['No'] ?></strong></label>
+										<span class="clearb"><?php echo $lang_admin_options['SMTP SSL help'] ?></span>
 									</td>
 								</tr>
 							</table>
@@ -743,29 +767,33 @@
 								<tr>
 									<th scope="row"><?php echo $lang_admin_options['Allow new label'] ?></th>
 									<td>
-										<input type="radio" name="form[regs_allow]" id="form_regs_allow_1" value="1"<?php if ($pun_config['o_regs_allow'] == '1') echo ' checked="checked"' ?> />&#160;<label class="conl" for="form_regs_allow_1"><strong><?php echo $lang_admin_common['Yes'] ?></strong></label>&#160;&#160;&#160;<input type="radio" name="form[regs_allow]" id="form_regs_allow_0" value="0"<?php if ($pun_config['o_regs_allow'] == '0') echo ' checked="checked"' ?> />&#160;<label class="conl" for="form_regs_allow_0"><strong><?php echo $lang_admin_common['No'] ?></strong></label>
-										<span><?php echo $lang_admin_options['Allow new help'] ?></span>
-									</td>
+										<label class="conl"><input type="radio" name="form[regs_allow]" value="1"<?php if ($pun_config['o_regs_allow'] == '1') echo ' checked="checked"' ?> />&#160;<strong><?php echo $lang_admin_common['Yes'] ?></strong></label>
+										<label class="conl"><input type="radio" name="form[regs_allow]" value="0"<?php if ($pun_config['o_regs_allow'] == '0') echo ' checked="checked"' ?> />&#160;<strong><?php echo $lang_admin_common['No'] ?></strong></label>
+										<span class="clearb"><?php echo $lang_admin_options['Allow new help'] ?></span>
+									</td> 
 								</tr>
 								<tr>
 									<th scope="row"><?php echo $lang_admin_options['Verify label'] ?></th>
 									<td>
-										<input type="radio" name="form[regs_verify]" id="form_regs_verify_1" value="1"<?php if ($pun_config['o_regs_verify'] == '1') echo ' checked="checked"' ?> />&#160;<label class="conl" for="form_regs_verify_1"><strong><?php echo $lang_admin_common['Yes'] ?></strong></label>&#160;&#160;&#160;<input type="radio" name="form[regs_verify]" id="form_regs_verify_0" value="0"<?php if ($pun_config['o_regs_verify'] == '0') echo ' checked="checked"' ?> />&#160;<label class="conl" for="form_regs_verify_0"><strong><?php echo $lang_admin_common['No'] ?></strong></label>
-										<span><?php echo $lang_admin_options['Verify help'] ?></span>
+										<label class="conl"><input type="radio" name="form[regs_verify]" value="1"<?php if ($pun_config['o_regs_verify'] == '1') echo ' checked="checked"' ?> />&#160;<strong><?php echo $lang_admin_common['Yes'] ?></strong></label>
+										<label class="conl"><input type="radio" name="form[regs_verify]" value="0"<?php if ($pun_config['o_regs_verify'] == '0') echo ' checked="checked"' ?> />&#160;<strong><?php echo $lang_admin_common['No'] ?></strong></label>
+										<span class="clearb"><?php echo $lang_admin_options['Verify help'] ?></span>
 									</td>
 								</tr>
 								<tr>
 									<th scope="row"><?php echo $lang_admin_options['Report new label'] ?></th>
 									<td>
-										<input type="radio" name="form[regs_report]" id="form_regs_report_1" value="1"<?php if ($pun_config['o_regs_report'] == '1') echo ' checked="checked"' ?> />&#160;<label class="conl" for="form_regs_report_1"><strong><?php echo $lang_admin_common['Yes'] ?></strong></label>&#160;&#160;&#160;<input type="radio" name="form[regs_report]" id="form_regs_report_0" value="0"<?php if ($pun_config['o_regs_report'] == '0') echo ' checked="checked"' ?> />&#160;<label class="conl" for="form_regs_report_0"><strong><?php echo $lang_admin_common['No'] ?></strong></label>
-										<span><?php echo $lang_admin_options['Report new help'] ?></span>
+										<label class="conl"><input type="radio" name="form[regs_report]" value="1"<?php if ($pun_config['o_regs_report'] == '1') echo ' checked="checked"' ?> />&#160;<strong><?php echo $lang_admin_common['Yes'] ?></strong></label>
+										<label class="conl"><input type="radio" name="form[regs_report]" value="0"<?php if ($pun_config['o_regs_report'] == '0') echo ' checked="checked"' ?> />&#160;<strong><?php echo $lang_admin_common['No'] ?></strong></label>
+										<span class="clearb"><?php echo $lang_admin_options['Report new help'] ?></span>
 									</td>
 								</tr>
 								<tr>
 									<th scope="row"><?php echo $lang_admin_options['Use rules label'] ?></th>
 									<td>
-										<input type="radio" name="form[rules]" id="form_rules_1" value="1"<?php if ($pun_config['o_rules'] == '1') echo ' checked="checked"' ?> />&#160;<label class="conl" for="form_rules_1"><strong><?php echo $lang_admin_common['Yes'] ?></strong></label>&#160;&#160;&#160;<input type="radio" name="form[rules]" id="form_rules_0" value="0"<?php if ($pun_config['o_rules'] == '0') echo ' checked="checked"' ?> />&#160;<label class="conl" for="form_rules_0"><strong><?php echo $lang_admin_common['No'] ?></strong></label>
-										<span><?php echo $lang_admin_options['Use rules help'] ?></span>
+										<label class="conl"><input type="radio" name="form[rules]" value="1"<?php if ($pun_config['o_rules'] == '1') echo ' checked="checked"' ?> />&#160;<strong><?php echo $lang_admin_common['Yes'] ?></strong></label>
+										<label class="conl"><input type="radio" name="form[rules]" value="0"<?php if ($pun_config['o_rules'] == '0') echo ' checked="checked"' ?> />&#160;<strong><?php echo $lang_admin_common['No'] ?></strong></label>
+										<span class="clearb"><?php echo $lang_admin_options['Use rules help'] ?></span>
 									</td>
 								</tr>
 								<tr>
@@ -779,9 +807,9 @@
 									<th scope="row"><?php echo $lang_admin_options['E-mail default label'] ?></th>
 									<td>
 										<span><?php echo $lang_admin_options['E-mail default help'] ?></span>
-										<input type="radio" name="form[default_email_setting]" id="form_default_email_setting_0" value="0"<?php if ($pun_config['o_default_email_setting'] == '0') echo ' checked="checked"' ?> />&#160;<?php echo $lang_admin_options['Display e-mail label'] ?><br />
-										<input type="radio" name="form[default_email_setting]" id="form_default_email_setting_1" value="1"<?php if ($pun_config['o_default_email_setting'] == '1') echo ' checked="checked"' ?> />&#160;<?php echo $lang_admin_options['Hide allow form label'] ?><br />
-										<input type="radio" name="form[default_email_setting]" id="form_default_email_setting_2" value="2"<?php if ($pun_config['o_default_email_setting'] == '2') echo ' checked="checked"' ?> />&#160;<?php echo $lang_admin_options['Hide both label'] ?><br />
+										<label><input type="radio" name="form[default_email_setting]" id="form_default_email_setting_0" value="0"<?php if ($pun_config['o_default_email_setting'] == '0') echo ' checked="checked"' ?> />&#160;<?php echo $lang_admin_options['Display e-mail label'] ?></label>
+										<label><input type="radio" name="form[default_email_setting]" id="form_default_email_setting_1" value="1"<?php if ($pun_config['o_default_email_setting'] == '1') echo ' checked="checked"' ?> />&#160;<?php echo $lang_admin_options['Hide allow form label'] ?></label>
+										<label><input type="radio" name="form[default_email_setting]" id="form_default_email_setting_2" value="2"<?php if ($pun_config['o_default_email_setting'] == '2') echo ' checked="checked"' ?> />&#160;<?php echo $lang_admin_options['Hide both label'] ?></label>
 									</td>
 								</tr>
 							</table>
@@ -796,8 +824,9 @@
 								<tr>
 									<th scope="row"><?php echo $lang_admin_options['Display announcement label'] ?></th>
 									<td>
-										<input type="radio" name="form[announcement]" id="form_announcement_1" value="1"<?php if ($pun_config['o_announcement'] == '1') echo ' checked="checked"' ?> />&#160;<label class="conl" for="form_announcement_1"><strong><?php echo $lang_admin_common['Yes'] ?></strong></label>&#160;&#160;&#160;<input type="radio" name="form[announcement]" id="form_announcement_0" value="0"<?php if ($pun_config['o_announcement'] == '0') echo ' checked="checked"' ?> />&#160;<label class="conl" for="form_announcement_0"><strong><?php echo $lang_admin_common['No'] ?></strong></label>
-										<span><?php echo $lang_admin_options['Display announcement help'] ?></span>
+										<label class="conl"><input type="radio" name="form[announcement]" value="1"<?php if ($pun_config['o_announcement'] == '1') echo ' checked="checked"' ?> />&#160;<strong><?php echo $lang_admin_common['Yes'] ?></strong></label>
+										<label class="conl"><input type="radio" name="form[announcement]" value="0"<?php if ($pun_config['o_announcement'] == '0') echo ' checked="checked"' ?> />&#160;<strong><?php echo $lang_admin_common['No'] ?></strong></label>
+										<span class="clearb"><?php echo $lang_admin_options['Display announcement help'] ?></span>
 									</td>
 								</tr>
 								<tr>
@@ -819,8 +848,9 @@
 								<tr>
 									<th scope="row"><a name="maintenance"></a><?php echo $lang_admin_options['Maintenance mode label'] ?></th>
 									<td>
-										<input type="radio" name="form[maintenance]" id="form_maintenance_1" value="1"<?php if ($pun_config['o_maintenance'] == '1') echo ' checked="checked"' ?> />&#160;<label class="conl" for="form_maintenance_1"><strong><?php echo $lang_admin_common['Yes'] ?></strong></label>&#160;&#160;&#160;<input type="radio" name="form[maintenance]" id="form_maintenance_0" value="0"<?php if ($pun_config['o_maintenance'] == '0') echo ' checked="checked"' ?> />&#160;<label class="conl" for="form_maintenance_0"><strong><?php echo $lang_admin_common['No'] ?></strong></label>
-										<span><?php echo $lang_admin_options['Maintenance mode help'] ?></span>
+										<label class="conl"><input type="radio" name="form[maintenance]" value="1"<?php if ($pun_config['o_maintenance'] == '1') echo ' checked="checked"' ?> />&#160;<strong><?php echo $lang_admin_common['Yes'] ?></strong></label>
+										<label class="conl"><input type="radio" name="form[maintenance]" value="0"<?php if ($pun_config['o_maintenance'] == '0') echo ' checked="checked"' ?> />&#160;<strong><?php echo $lang_admin_common['No'] ?></strong></label>
+										<span class="clearb"><?php echo $lang_admin_options['Maintenance mode help'] ?></span>
 									</td>
 								</tr>
 								<tr>
-- 
1.7.10


From 6397e51eb621b504d91f108edb802d4352a59668 Mon Sep 17 00:00:00 2001
From: Franz Liedke <franz@develophp.org>
Date: Wed, 9 May 2012 15:08:57 +0200
Subject: [PATCH 23/75] Fix missing closing tag in help section below post
 area.

Closes #669. Reported by Otomatic.
---
 edit.php      |    2 +-
 post.php      |    2 +-
 profile.php   |    2 +-
 viewtopic.php |    2 +-
 4 files changed, 4 insertions(+), 4 deletions(-)

diff --git a/edit.php b/edit.php
index b2f3e50..1b51699 100644
--- a/edit.php
+++ b/edit.php
@@ -226,7 +226,7 @@
 						<textarea name="req_message" rows="20" cols="95" tabindex="<?php echo $cur_index++ ?>"><?php echo pun_htmlspecialchars(isset($_POST['req_message']) ? $message : $cur_post['message']) ?></textarea><br /></label>
 						<ul class="bblinks">
 							<li><span><a href="help.php#bbcode" onclick="window.open(this.href); return false;"><?php echo $lang_common['BBCode'] ?></a> <?php echo ($pun_config['p_message_bbcode'] == '1') ? $lang_common['on'] : $lang_common['off']; ?></span></li>
-							<li><span><a href="help.php#url" onclick="window.open(this.href); return false;"><?php echo $lang_common['url tag'] ?></a> <?php echo ($pun_config['p_message_bbcode'] == '1' && $pun_user['g_post_links'] == '1') ? $lang_common['on'] : $lang_common['off']; ?></span>
+							<li><span><a href="help.php#url" onclick="window.open(this.href); return false;"><?php echo $lang_common['url tag'] ?></a> <?php echo ($pun_config['p_message_bbcode'] == '1' && $pun_user['g_post_links'] == '1') ? $lang_common['on'] : $lang_common['off']; ?></span></li>
 							<li><span><a href="help.php#img" onclick="window.open(this.href); return false;"><?php echo $lang_common['img tag'] ?></a> <?php echo ($pun_config['p_message_bbcode'] == '1' && $pun_config['p_message_img_tag'] == '1') ? $lang_common['on'] : $lang_common['off']; ?></span></li>
 							<li><span><a href="help.php#smilies" onclick="window.open(this.href); return false;"><?php echo $lang_common['Smilies'] ?></a> <?php echo ($pun_config['o_smilies'] == '1') ? $lang_common['on'] : $lang_common['off']; ?></span></li>
 						</ul>
diff --git a/post.php b/post.php
index f2c2d65..0283557 100644
--- a/post.php
+++ b/post.php
@@ -638,7 +638,7 @@
 						<textarea name="req_message" rows="20" cols="95" tabindex="<?php echo $cur_index++ ?>"><?php echo isset($_POST['req_message']) ? pun_htmlspecialchars($orig_message) : (isset($quote) ? $quote : ''); ?></textarea><br /></label>
 						<ul class="bblinks">
 							<li><span><a href="help.php#bbcode" onclick="window.open(this.href); return false;"><?php echo $lang_common['BBCode'] ?></a> <?php echo ($pun_config['p_message_bbcode'] == '1') ? $lang_common['on'] : $lang_common['off']; ?></span></li>
-							<li><span><a href="help.php#url" onclick="window.open(this.href); return false;"><?php echo $lang_common['url tag'] ?></a> <?php echo ($pun_config['p_message_bbcode'] == '1' && $pun_user['g_post_links'] == '1') ? $lang_common['on'] : $lang_common['off']; ?></span>
+							<li><span><a href="help.php#url" onclick="window.open(this.href); return false;"><?php echo $lang_common['url tag'] ?></a> <?php echo ($pun_config['p_message_bbcode'] == '1' && $pun_user['g_post_links'] == '1') ? $lang_common['on'] : $lang_common['off']; ?></span></li>
 							<li><span><a href="help.php#img" onclick="window.open(this.href); return false;"><?php echo $lang_common['img tag'] ?></a> <?php echo ($pun_config['p_message_bbcode'] == '1' && $pun_config['p_message_img_tag'] == '1') ? $lang_common['on'] : $lang_common['off']; ?></span></li>
 							<li><span><a href="help.php#smilies" onclick="window.open(this.href); return false;"><?php echo $lang_common['Smilies'] ?></a> <?php echo ($pun_config['o_smilies'] == '1') ? $lang_common['on'] : $lang_common['off']; ?></span></li>
 						</ul>
diff --git a/profile.php b/profile.php
index 451fd29..d0ba16f 100644
--- a/profile.php
+++ b/profile.php
@@ -1535,7 +1535,7 @@
 							</div>
 							<ul class="bblinks">
 								<li><span><a href="help.php#bbcode" onclick="window.open(this.href); return false;"><?php echo $lang_common['BBCode'] ?></a> <?php echo ($pun_config['p_sig_bbcode'] == '1') ? $lang_common['on'] : $lang_common['off']; ?></span></li>
-								<li><span><a href="help.php#url" onclick="window.open(this.href); return false;"><?php echo $lang_common['url tag'] ?></a> <?php echo ($pun_config['p_sig_bbcode'] == '1' && $pun_user['g_post_links'] == '1') ? $lang_common['on'] : $lang_common['off']; ?></span>
+								<li><span><a href="help.php#url" onclick="window.open(this.href); return false;"><?php echo $lang_common['url tag'] ?></a> <?php echo ($pun_config['p_sig_bbcode'] == '1' && $pun_user['g_post_links'] == '1') ? $lang_common['on'] : $lang_common['off']; ?></span></li>
 								<li><span><a href="help.php#img" onclick="window.open(this.href); return false;"><?php echo $lang_common['img tag'] ?></a> <?php echo ($pun_config['p_sig_bbcode'] == '1' && $pun_config['p_sig_img_tag'] == '1') ? $lang_common['on'] : $lang_common['off']; ?></span></li>
 								<li><span><a href="help.php#smilies" onclick="window.open(this.href); return false;"><?php echo $lang_common['Smilies'] ?></a> <?php echo ($pun_config['o_smilies_sig'] == '1') ? $lang_common['on'] : $lang_common['off']; ?></span></li>
 							</ul>
diff --git a/viewtopic.php b/viewtopic.php
index 79fd6ce..8c2e811 100644
--- a/viewtopic.php
+++ b/viewtopic.php
@@ -435,7 +435,7 @@
 <textarea name="req_message" rows="7" cols="75" tabindex="<?php echo $cur_index++ ?>"></textarea></label>
 						<ul class="bblinks">
 							<li><span><a href="help.php#bbcode" onclick="window.open(this.href); return false;"><?php echo $lang_common['BBCode'] ?></a> <?php echo ($pun_config['p_message_bbcode'] == '1') ? $lang_common['on'] : $lang_common['off']; ?></span></li>
-							<li><span><a href="help.php#url" onclick="window.open(this.href); return false;"><?php echo $lang_common['url tag'] ?></a> <?php echo ($pun_config['p_message_bbcode'] == '1' && $pun_user['g_post_links'] == '1') ? $lang_common['on'] : $lang_common['off']; ?></span>
+							<li><span><a href="help.php#url" onclick="window.open(this.href); return false;"><?php echo $lang_common['url tag'] ?></a> <?php echo ($pun_config['p_message_bbcode'] == '1' && $pun_user['g_post_links'] == '1') ? $lang_common['on'] : $lang_common['off']; ?></span></li>
 							<li><span><a href="help.php#img" onclick="window.open(this.href); return false;"><?php echo $lang_common['img tag'] ?></a> <?php echo ($pun_config['p_message_bbcode'] == '1' && $pun_config['p_message_img_tag'] == '1') ? $lang_common['on'] : $lang_common['off']; ?></span></li>
 							<li><span><a href="help.php#smilies" onclick="window.open(this.href); return false;"><?php echo $lang_common['Smilies'] ?></a> <?php echo ($pun_config['o_smilies'] == '1') ? $lang_common['on'] : $lang_common['off']; ?></span></li>
 						</ul>
-- 
1.7.10


From bc8dd3e7644c7f5e0fc381c51428ee3fcff357fc Mon Sep 17 00:00:00 2001
From: Arw <arw.contact@gmail.com>
Date: Wed, 9 May 2012 15:14:05 +0200
Subject: [PATCH 24/75] #668: one span class=conl instead of span class=clearb

---
 admin_options.php |    2 +-
 1 file changed, 1 insertion(+), 1 deletion(-)

diff --git a/admin_options.php b/admin_options.php
index 5178fd7..a2c73cc 100644
--- a/admin_options.php
+++ b/admin_options.php
@@ -437,7 +437,7 @@
 									<td>
 										<label class="conl"><input type="radio" name="form[smilies]" value="1"<?php if ($pun_config['o_smilies'] == '1') echo ' checked="checked"' ?> />&#160;<strong><?php echo $lang_admin_common['Yes'] ?></strong></label>
 										<label class="conl"><input type="radio" name="form[smilies]" value="0"<?php if ($pun_config['o_smilies'] == '0') echo ' checked="checked"' ?> />&#160;<strong><?php echo $lang_admin_common['No'] ?></strong></label>
-										<span class="conl"><?php echo $lang_admin_options['Smilies help'] ?></span>
+										<span class="clearb"><?php echo $lang_admin_options['Smilies help'] ?></span>
 									</td>
 								</tr>
 								<tr>
-- 
1.7.10


From fe4cc4dd41d5c9dbefa9ebaded09e82184d471de Mon Sep 17 00:00:00 2001
From: Franz Liedke <franz@develophp.org>
Date: Wed, 4 Jul 2012 13:00:18 +0300
Subject: [PATCH 25/75] Fix wrong CSS selector in style/Air.css.

---
 style/Air.css |    2 +-
 1 file changed, 1 insertion(+), 1 deletion(-)

diff --git a/style/Air.css b/style/Air.css
index cab49c9..7659059 100644
--- a/style/Air.css
+++ b/style/Air.css
@@ -424,7 +424,7 @@ html, body, .pun table, .pun div, .pun form, .pun p, .pun h1, .pun h2, .pun h3,
 /* Breadcrumbs, Postlink, Pagination
 ----------------------------------------------------------------*/
 
-.pun .linkst .inbox, .pun linksb .inbox, .pun .postlinksb .inbox {
+.pun .linkst .inbox, .pun .linksb .inbox, .pun .postlinksb .inbox {
 	overflow: hidden;
 }
 
-- 
1.7.10


From 61b6902ab1800bdad2b519df4c72934e76ac9064 Mon Sep 17 00:00:00 2001
From: Franz Liedke <franz@develophp.org>
Date: Wed, 4 Jul 2012 13:00:48 +0300
Subject: [PATCH 26/75] Fix wrong CSS selector in style/Earth.css.

---
 style/Earth.css |    2 +-
 1 file changed, 1 insertion(+), 1 deletion(-)

diff --git a/style/Earth.css b/style/Earth.css
index d886bbe..540f999 100644
--- a/style/Earth.css
+++ b/style/Earth.css
@@ -423,7 +423,7 @@ html, body, .pun table, .pun div, .pun form, .pun p, .pun h1, .pun h2, .pun h3,
 /* Breadcrumbs, Postlink, Pagination
 ----------------------------------------------------------------*/
 
-.pun .linkst .inbox, .pun linksb .inbox, .pun .postlinksb .inbox {
+.pun .linkst .inbox, .pun .linksb .inbox, .pun .postlinksb .inbox {
 	overflow: hidden;
 }
 
-- 
1.7.10


From 31e3d33899bf286d780900ec911561f51d347030 Mon Sep 17 00:00:00 2001
From: Franz Liedke <franz@develophp.org>
Date: Wed, 4 Jul 2012 13:01:31 +0300
Subject: [PATCH 27/75] Fix wrong CSS selector in style/Fire.css.

Fixes #690.
---
 style/Fire.css |    2 +-
 1 file changed, 1 insertion(+), 1 deletion(-)

diff --git a/style/Fire.css b/style/Fire.css
index 33ee9f7..51de44d 100644
--- a/style/Fire.css
+++ b/style/Fire.css
@@ -423,7 +423,7 @@ html, body, .pun table, .pun div, .pun form, .pun p, .pun h1, .pun h2, .pun h3,
 /* Breadcrumbs, Postlink, Pagination
 ----------------------------------------------------------------*/
 
-.pun .linkst .inbox, .pun linksb .inbox, .pun .postlinksb .inbox {
+.pun .linkst .inbox, .pun .linksb .inbox, .pun .postlinksb .inbox {
 	overflow: hidden;
 }
 
-- 
1.7.10


From f58e11002099165ca2c557b41e97be9ea8e7a82f Mon Sep 17 00:00:00 2001
From: Quy Ton <quy@fluxbb.org>
Date: Fri, 6 Jul 2012 23:48:06 -0700
Subject: [PATCH 28/75] #689: Fixed errors in comments

---
 admin_categories.php               |    2 +-
 admin_forums.php                   |    2 +-
 admin_loader.php                   |    2 +-
 db_update.php                      |   18 +++++++++---------
 delete.php                         |    2 +-
 header.php                         |    2 +-
 include/email.php                  |    6 +++---
 include/functions.php              |    2 +-
 include/search_idx.php             |    2 +-
 lang/English/admin_categories.php  |    2 +-
 lang/English/admin_forums.php      |    2 +-
 lang/English/admin_groups.php      |    2 +-
 lang/English/admin_options.php     |    2 +-
 lang/English/admin_permissions.php |    2 +-
 lang/English/admin_users.php       |    2 +-
 lang/English/common.php            |    2 +-
 login.php                          |    2 +-
 profile.php                        |    4 ++--
 search.php                         |    4 ++--
 viewtopic.php                      |    2 +-
 20 files changed, 32 insertions(+), 32 deletions(-)

diff --git a/admin_categories.php b/admin_categories.php
index ab4d430..e1ca62e 100644
--- a/admin_categories.php
+++ b/admin_categories.php
@@ -84,7 +84,7 @@
 
 		redirect('admin_categories.php', $lang_admin_categories['Category deleted redirect']);
 	}
-	else // If the user hasn't comfirmed the delete
+	else // If the user hasn't confirmed the delete
 	{
 		$result = $db->query('SELECT cat_name FROM '.$db->prefix.'categories WHERE id='.$cat_to_delete) or error('Unable to fetch category info', __FILE__, __LINE__, $db->error());
 		$cat_name = $db->result($result);
diff --git a/admin_forums.php b/admin_forums.php
index 1f1c13f..ad96234 100644
--- a/admin_forums.php
+++ b/admin_forums.php
@@ -185,7 +185,7 @@
 				// Check if the new settings differ from the old
 				if ($read_forum_new != $_POST['read_forum_old'][$cur_group['g_id']] || $post_replies_new != $_POST['post_replies_old'][$cur_group['g_id']] || $post_topics_new != $_POST['post_topics_old'][$cur_group['g_id']])
 				{
-					// If the new settings are identical to the default settings for this group, delete it's row in forum_perms
+					// If the new settings are identical to the default settings for this group, delete its row in forum_perms
 					if ($read_forum_new == '1' && $post_replies_new == $cur_group['g_post_replies'] && $post_topics_new == $cur_group['g_post_topics'])
 						$db->query('DELETE FROM '.$db->prefix.'forum_perms WHERE group_id='.$cur_group['g_id'].' AND forum_id='.$forum_id) or error('Unable to delete group forum permissions', __FILE__, __LINE__, $db->error());
 					else
diff --git a/admin_loader.php b/admin_loader.php
index 0eedc47..36801dd 100644
--- a/admin_loader.php
+++ b/admin_loader.php
@@ -39,7 +39,7 @@
 define('PUN_ACTIVE_PAGE', 'admin');
 require PUN_ROOT.'header.php';
 
-// Attempt to load the plugin. We don't use @ here to supress error messages,
+// Attempt to load the plugin. We don't use @ here to suppress error messages,
 // because if we did and a parse error occurred in the plugin, we would only
 // get the "blank page of death"
 include PUN_ROOT.'plugins/'.$plugin;
diff --git a/db_update.php b/db_update.php
index 7ebc989..cdabdfd 100644
--- a/db_update.php
+++ b/db_update.php
@@ -358,7 +358,7 @@ function convert_table_utf8($table, $callback, $old_charset, $key = null, $start
 	$end_at = 0;
 	if ($mysql)
 	{
-		// Only set up the tables if we are doing this in 1 go, or its the first go
+		// Only set up the tables if we are doing this in 1 go, or it's the first go
 		if (is_null($start_at) || $start_at == 0)
 		{
 			// Drop any temp table that exists, in-case it's left over from a failed update
@@ -400,7 +400,7 @@ function convert_table_utf8($table, $callback, $old_charset, $key = null, $start
 			$finished = $db->num_rows($result) == 0;
 		}
 
-		// Only swap the tables if we are doing this in 1 go, or its the last go
+		// Only swap the tables if we are doing this in 1 go, or it's the last go
 		if ($finished)
 		{
 			// Delete old table
@@ -713,10 +713,10 @@ function convert_table_utf8($table, $callback, $old_charset, $key = null, $start
 		// Add the DST option to the users table
 		$db->add_field('users', 'dst', 'TINYINT(1)', false, 0, 'timezone') or error('Unable to add dst field', __FILE__, __LINE__, $db->error());
 
-		// Add the last_post field to the online table
+		// Add the last_post column to the online table
 		$db->add_field('online', 'last_post', 'INT(10) UNSIGNED', true, null, null) or error('Unable to add last_post field', __FILE__, __LINE__, $db->error());
 
-		// Add the last_search field to the online table
+		// Add the last_search column to the online table
 		$db->add_field('online', 'last_search', 'INT(10) UNSIGNED', true, null, null) or error('Unable to add last_search field', __FILE__, __LINE__, $db->error());
 
 		// Add the last_search column to the users table
@@ -975,7 +975,7 @@ function convert_table_utf8($table, $callback, $old_charset, $key = null, $start
 		if (!$db->add_index('users', 'username_idx', array($field), true))
 			$db->add_index('users', 'username_idx', array($field)) or error('Unable to add username_idx field', __FILE__, __LINE__, $db->error());
 
-		// Add g_view_users field to groups table
+		// Add g_view_users column to groups table
 		$db->add_field('groups', 'g_view_users', 'TINYINT(1)', false, 1, 'g_read_board') or error('Unable to add g_view_users field', __FILE__, __LINE__, $db->error());
 
 		// Add the last_email_sent column to the users table and the g_send_email and
@@ -1019,20 +1019,20 @@ function convert_table_utf8($table, $callback, $old_charset, $key = null, $start
 		$db->add_field('users', 'time_format', 'TINYINT(1)', false, 0, 'dst') or error('Unable to add time_format field', __FILE__, __LINE__, $db->error());
 		$db->add_field('users', 'date_format', 'TINYINT(1)', false, 0, 'dst') or error('Unable to add date_format field', __FILE__, __LINE__, $db->error());
 
-		// Change the search_data field to mediumtext
+		// Change the search_data column to mediumtext
 		$db->alter_field('search_cache', 'search_data', 'MEDIUMTEXT', true) or error('Unable to alter search_data field', __FILE__, __LINE__, $db->error());
 
-		// Add the group promotion fields to the groups table
+		// Add the group promotion columns to the groups table
 		$db->add_field('groups', 'g_promote_min_posts', 'INT(10) UNSIGNED', false, 0, 'g_user_title') or error('Unable to add g_promote_min_posts field', __FILE__, __LINE__, $db->error());
 		$db->add_field('groups', 'g_promote_next_group', 'INT(10) UNSIGNED', false, 0, 'g_promote_min_posts') or error('Unable to add g_promote_next_group field', __FILE__, __LINE__, $db->error());
 
 		// Add a field for the per-group permission to post links
 		$db->add_field('groups', 'g_post_links', 'TINYINT(1)', false, 1, 'g_delete_topics') or error('Unable to add per-group permission to post links', __FILE__, __LINE__, $db->error());
 
-		// Incase we had the fulltext search extension installed (1.3-legacy), remove it
+		// In case we had the fulltext search extension installed (1.3-legacy), remove it
 		$db->drop_index('topics', 'subject_idx') or error('Unable to drop subject_idx index', __FILE__, __LINE__, $db->error());
 		$db->drop_index('posts', 'message_idx') or error('Unable to drop message_idx index', __FILE__, __LINE__, $db->error());
-		// Incase we had the fulltext search mod installed (1.2), remove it
+		// In case we had the fulltext search mod installed (1.2), remove it
 		$db->drop_index('topics', 'subject_fulltext_search') or error('Unable to drop subject_fulltext_search index', __FILE__, __LINE__, $db->error());
 		$db->drop_index('posts', 'message_fulltext_search') or error('Unable to drop message_fulltext_search index', __FILE__, __LINE__, $db->error());
 
diff --git a/delete.php b/delete.php
index f022f53..88bab6d 100644
--- a/delete.php
+++ b/delete.php
@@ -55,7 +55,7 @@
 
 	if ($is_topic_post)
 	{
-		// Delete the topic and all of it's posts
+		// Delete the topic and all of its posts
 		delete_topic($cur_post['tid']);
 		update_forum($cur_post['fid']);
 
diff --git a/header.php b/header.php
index b4905aa..5ad1ca0 100644
--- a/header.php
+++ b/header.php
@@ -75,7 +75,7 @@
 // START SUBST - <pun_head>
 ob_start();
 
-// Define $p if its not set to avoid a PHP notice
+// Define $p if it's not set to avoid a PHP notice
 $p = isset($p) ? $p : null;
 
 // Is this a page that we want search index spiders to index?
diff --git a/include/email.php b/include/email.php
index 85543d1..c4b0db3 100644
--- a/include/email.php
+++ b/include/email.php
@@ -158,7 +158,7 @@ function bbcode2email($text, $wrap_length = 72)
 				$replacement = '['.str_replace('$1', $matches[3], $url).']';
 		}
 
-		// Update the main text if there is a replacment
+		// Update the main text if there is a replacement
 		if (!is_null($replacement))
 		{
 			$text = str_replace($matches[0], $replacement, $text);
@@ -260,7 +260,7 @@ function pun_mail($to, $subject, $message, $reply_to_email = '', $reply_to_name
 
 //
 // This function was originally a part of the phpBB Group forum software phpBB2 (http://www.phpbb.com)
-// They deserve all the credit for writing it. I made small modifications for it to suit PunBB and it's coding standards
+// They deserve all the credit for writing it. I made small modifications for it to suit PunBB and its coding standards
 //
 function server_parse($socket, $expected_response)
 {
@@ -278,7 +278,7 @@ function server_parse($socket, $expected_response)
 
 //
 // This function was originally a part of the phpBB Group forum software phpBB2 (http://www.phpbb.com)
-// They deserve all the credit for writing it. I made small modifications for it to suit PunBB and it's coding standards.
+// They deserve all the credit for writing it. I made small modifications for it to suit PunBB and its coding standards.
 //
 function smtp_mail($to, $subject, $message, $headers = '')
 {
diff --git a/include/functions.php b/include/functions.php
index f4dcd04..8c1fbeb 100644
--- a/include/functions.php
+++ b/include/functions.php
@@ -681,7 +681,7 @@ function delete_avatar($user_id)
 
 
 //
-// Delete a topic and all of it's posts
+// Delete a topic and all of its posts
 //
 function delete_topic($topic_id)
 {
diff --git a/include/search_idx.php b/include/search_idx.php
index 550f348..49fe257 100644
--- a/include/search_idx.php
+++ b/include/search_idx.php
@@ -104,7 +104,7 @@ function validate_search_word($word, $idx)
 	if (in_array($word, $stopwords))
 		return false;
 
-	// If the word if CJK we don't want to index it, but we do want to be allowed to search it
+	// If the word is CJK we don't want to index it, but we do want to be allowed to search it
 	if (is_cjk($word))
 		return !$idx;
 
diff --git a/lang/English/admin_categories.php b/lang/English/admin_categories.php
index 311a5af..f19054d 100644
--- a/lang/English/admin_categories.php
+++ b/lang/English/admin_categories.php
@@ -1,6 +1,6 @@
 <?php
 
-// Language definitions used in admin-categories.php
+// Language definitions used in admin_categories.php
 $lang_admin_categories = array(
 
 'Must enter name message'		=>	'You must enter a name for the category',
diff --git a/lang/English/admin_forums.php b/lang/English/admin_forums.php
index c933602..15accaa 100644
--- a/lang/English/admin_forums.php
+++ b/lang/English/admin_forums.php
@@ -1,6 +1,6 @@
 <?php
 
-// Language definitions used in admin-forums.php
+// Language definitions used in admin_forums.php
 $lang_admin_forums = array(
 
 'Forum added redirect'		=>	'Forum added. Redirecting ',
diff --git a/lang/English/admin_groups.php b/lang/English/admin_groups.php
index 55d2f50..edfd439 100644
--- a/lang/English/admin_groups.php
+++ b/lang/English/admin_groups.php
@@ -1,6 +1,6 @@
 <?php
 
-// Language definitions used in admin-groups.php
+// Language definitions used in admin_groups.php
 $lang_admin_groups = array(
 
 'Must enter title message'		=>	'You must enter a group title.',
diff --git a/lang/English/admin_options.php b/lang/English/admin_options.php
index 0d5f211..78962e9 100644
--- a/lang/English/admin_options.php
+++ b/lang/English/admin_options.php
@@ -1,6 +1,6 @@
 <?php
 
-// Language definitions used in admin-options.php
+// Language definitions used in admin_options.php
 $lang_admin_options = array(
 
 'Bad HTTP Referer message'			=>	'Bad HTTP_REFERER. If you have moved these forums from one location to another or switched domains, you need to update the Base URL manually in the database (look for o_base_url in the config table) and then clear the cache by deleting all .php files in the /cache directory.',
diff --git a/lang/English/admin_permissions.php b/lang/English/admin_permissions.php
index 3c3600c..8324eda 100644
--- a/lang/English/admin_permissions.php
+++ b/lang/English/admin_permissions.php
@@ -1,6 +1,6 @@
 <?php
 
-// Language definitions used in admin-permissions.php
+// Language definitions used in admin_permissions.php
 $lang_admin_permissions = array(
 
 'Perms updated redirect'	=>	'Permissions updated. Redirecting ',
diff --git a/lang/English/admin_users.php b/lang/English/admin_users.php
index 49fad72..9da2095 100644
--- a/lang/English/admin_users.php
+++ b/lang/English/admin_users.php
@@ -1,6 +1,6 @@
 <?php
 
-// Language definitions used in admin-users.php
+// Language definitions used in admin_users.php
 $lang_admin_users = array(
 
 'Non numeric message'		=>	'You entered a non-numeric value into a numeric only column.',
diff --git a/lang/English/common.php b/lang/English/common.php
index 626ea95..edc7a80 100644
--- a/lang/English/common.php
+++ b/lang/English/common.php
@@ -41,7 +41,7 @@
 'Required'							=>	'(Required)',
 'required field'					=>	'is a required field in this form.', // For javascript form validation
 'Last post'							=>	'Last post',
-'by'								=>	'by', // As in last post by someuser
+'by'								=>	'by', // As in last post by some user
 'New posts'							=>	'New posts', // The link that leads to the first new post
 'New posts info'					=>	'Go to the first new post in this topic.', // The popup text for new posts links
 'Username'							=>	'Username',
diff --git a/login.php b/login.php
index 0497ad6..6cd498c 100644
--- a/login.php
+++ b/login.php
@@ -35,7 +35,7 @@
 	{
 		$form_password_hash = pun_hash($form_password); // Will result in a SHA-1 hash
 
-		// If there is a salt in the database we have upgraded from 1.3-legacy though havent yet logged in
+		// If there is a salt in the database we have upgraded from 1.3-legacy though haven't yet logged in
 		if (!empty($cur_user['salt']))
 		{
 			if (sha1($cur_user['salt'].sha1($form_password)) == $cur_user['password']) // 1.3 used sha1(salt.sha1(pass))
diff --git a/profile.php b/profile.php
index d0ba16f..cbb5901 100644
--- a/profile.php
+++ b/profile.php
@@ -683,7 +683,7 @@
 
 	list($old_username, $group_id, $is_moderator) = $db->fetch_row($result);
 
-	if ($pun_user['id'] != $id &&																	// If we arent the user (i.e. editing your own profile)
+	if ($pun_user['id'] != $id &&																	// If we aren't the user (i.e. editing your own profile)
 		(!$pun_user['is_admmod'] ||																	// and we are not an admin or mod
 		($pun_user['g_id'] != PUN_ADMIN &&															// or we aren't an admin and ...
 		($pun_user['g_mod_edit_users'] == '0' ||													// mods aren't allowed to edit users
@@ -1005,7 +1005,7 @@
 
 
 // View or edit?
-if ($pun_user['id'] != $id &&																	// If we arent the user (i.e. editing your own profile)
+if ($pun_user['id'] != $id &&																	// If we aren't the user (i.e. editing your own profile)
 	(!$pun_user['is_admmod'] ||																	// and we are not an admin or mod
 	($pun_user['g_id'] != PUN_ADMIN &&															// or we aren't an admin and ...
 	($pun_user['g_mod_edit_users'] == '0' ||													// mods aren't allowed to edit users
diff --git a/search.php b/search.php
index 8d092af..85c8ce5 100644
--- a/search.php
+++ b/search.php
@@ -360,7 +360,7 @@
 				if (!$num_hits)
 					message($lang_search['No user posts']);
 
-				// Pass on the user ID so that we can later know whos posts we're searching for
+				// Pass on the user ID so that we can later know whose posts we're searching for
 				$search_type[2] = $user_id;
 			}
 			// If it's a search for topics by a specific user ID
@@ -372,7 +372,7 @@
 				if (!$num_hits)
 					message($lang_search['No user topics']);
 
-				// Pass on the user ID so that we can later know whos topics we're searching for
+				// Pass on the user ID so that we can later know whose topics we're searching for
 				$search_type[2] = $user_id;
 			}
 			// If it's a search for subscribed topics
diff --git a/viewtopic.php b/viewtopic.php
index 8c2e811..df3cb14 100644
--- a/viewtopic.php
+++ b/viewtopic.php
@@ -33,7 +33,7 @@
 
 	list($id, $posted) = $db->fetch_row($result);
 
-	// Determine on what page the post is located (depending on $forum_user['disp_posts'])
+	// Determine on which page the post is located (depending on $forum_user['disp_posts'])
 	$result = $db->query('SELECT COUNT(id) FROM '.$db->prefix.'posts WHERE topic_id='.$id.' AND posted<'.$posted) or error('Unable to count previous posts', __FILE__, __LINE__, $db->error());
 	$num_posts = $db->result($result) + 1;
 
-- 
1.7.10


From 81df45ce7d674aefe4efbe7d88a6480fb423cb16 Mon Sep 17 00:00:00 2001
From: Quy Ton <quy@fluxbb.org>
Date: Fri, 3 Aug 2012 09:06:05 -0700
Subject: [PATCH 29/75] #711: Use guest title string in help text for Guest
 group. Reported by Visman.

---
 admin_groups.php |    2 +-
 1 file changed, 1 insertion(+), 1 deletion(-)

diff --git a/admin_groups.php b/admin_groups.php
index f403efd..aedcf08 100644
--- a/admin_groups.php
+++ b/admin_groups.php
@@ -82,7 +82,7 @@
 									<th scope="row"><?php echo $lang_admin_groups['User title label'] ?></th>
 									<td>
 										<input type="text" name="user_title" size="25" maxlength="50" value="<?php echo pun_htmlspecialchars($group['g_user_title']) ?>" tabindex="2" />
-										<span><?php printf($lang_admin_groups['User title help'], $lang_common['Member']) ?></span>
+										<span><?php printf($lang_admin_groups['User title help'], ($group['g_id'] != PUN_GUEST ? $lang_common['Member'] : $lang_common['Guest'])) ?></span>
 									</td>
 								</tr>
 <?php if ($group['g_id'] != PUN_ADMIN): if ($group['g_id'] != PUN_GUEST): ?>								<tr>
-- 
1.7.10


From 44a23b7b4ad28b0ad94cef1d341f55e734a19d33 Mon Sep 17 00:00:00 2001
From: Quy Ton <quy@fluxbb.org>
Date: Fri, 3 Aug 2012 19:51:11 -0700
Subject: [PATCH 30/75] #681: Added exit after redirect header. Reported by
 yoorick.

---
 include/functions.php |    3 +++
 login.php             |    6 ++++++
 2 files changed, 9 insertions(+)

diff --git a/include/functions.php b/include/functions.php
index 8c1fbeb..7f36e53 100644
--- a/include/functions.php
+++ b/include/functions.php
@@ -1297,7 +1297,10 @@ function redirect($destination_url, $message)
 
 	// If the delay is 0 seconds, we might as well skip the redirect all together
 	if ($pun_config['o_redirect_delay'] == '0')
+	{
 		header('Location: '.str_replace('&amp;', '&', $destination_url));
+		exit;
+	}
 
 	// Send no-cache headers
 	header('Expires: Thu, 21 Jul 1977 07:30:00 GMT'); // When yours truly first set eyes on this world! :)
diff --git a/login.php b/login.php
index 6cd498c..94dec22 100644
--- a/login.php
+++ b/login.php
@@ -112,7 +112,10 @@
 else if ($action == 'forget' || $action == 'forget_2')
 {
 	if (!$pun_user['is_guest'])
+	{
 		header('Location: index.php');
+		exit;
+	}
 
 	if (isset($_POST['form_sent']))
 	{
@@ -228,7 +231,10 @@
 
 
 if (!$pun_user['is_guest'])
+{
 	header('Location: index.php');
+	exit;
+}
 
 // Try to determine if the data in HTTP_REFERER is valid (if not, we redirect to index.php after login)
 if (!empty($_SERVER['HTTP_REFERER']))
-- 
1.7.10


From 7d84b49e5a3cc95aa8e5611d4b4a866488254871 Mon Sep 17 00:00:00 2001
From: Quy Ton <quy@fluxbb.org>
Date: Mon, 6 Aug 2012 10:43:47 -0700
Subject: [PATCH 31/75] #689: Fixed more errors in comments

---
 edit.php                      |    2 +-
 include/dblayer/mysqli.php    |    2 +-
 include/dblayer/pgsql.php     |    2 +-
 include/dblayer/sqlite.php    |    2 +-
 lang/English/admin_common.php |    2 +-
 login.php                     |    2 +-
 misc.php                      |    2 +-
 post.php                      |    2 +-
 profile.php                   |   14 +++++++-------
 search.php                    |    2 +-
 10 files changed, 16 insertions(+), 16 deletions(-)

diff --git a/edit.php b/edit.php
index 1b51699..328598d 100644
--- a/edit.php
+++ b/edit.php
@@ -44,7 +44,7 @@
 	!$is_admmod)
 	message($lang_common['No permission'], false, '403 Forbidden');
 
-// Load the post.php/edit.php language file
+// Load the post.php/edit.php language files
 require PUN_ROOT.'lang/'.$pun_user['language'].'/post.php';
 
 // Start with a clean slate
diff --git a/include/dblayer/mysqli.php b/include/dblayer/mysqli.php
index 8b2675b..906a7ac 100644
--- a/include/dblayer/mysqli.php
+++ b/include/dblayer/mysqli.php
@@ -310,7 +310,7 @@ function drop_table($table_name, $no_prefix = false)
 
 	function rename_table($old_table, $new_table, $no_prefix = false)
 	{
-		// If there new table exists and the old one doesn't, then we're happy
+		// If the new table exists and the old one doesn't, then we're happy
 		if ($this->table_exists($new_table, $no_prefix) && !$this->table_exists($old_table, $no_prefix))
 			return true;
 
diff --git a/include/dblayer/pgsql.php b/include/dblayer/pgsql.php
index 3a73118..a3d7574 100644
--- a/include/dblayer/pgsql.php
+++ b/include/dblayer/pgsql.php
@@ -354,7 +354,7 @@ function drop_table($table_name, $no_prefix = false)
 
 	function rename_table($old_table, $new_table, $no_prefix = false)
 	{
-		// If there new table exists and the old one doesn't, then we're happy
+		// If the new table exists and the old one doesn't, then we're happy
 		if ($this->table_exists($new_table, $no_prefix) && !$this->table_exists($old_table, $no_prefix))
 			return true;
 
diff --git a/include/dblayer/sqlite.php b/include/dblayer/sqlite.php
index e83ec70..8d917c7 100644
--- a/include/dblayer/sqlite.php
+++ b/include/dblayer/sqlite.php
@@ -351,7 +351,7 @@ function drop_table($table_name, $no_prefix = false)
 
 	function rename_table($old_name, $new_name, $no_prefix = false)
 	{
-		// If there new table exists and the old one doesn't, then we're happy
+		// If the new table exists and the old one doesn't, then we're happy
 		if ($this->table_exists($new_table, $no_prefix) && !$this->table_exists($old_table, $no_prefix))
 			return true;
 
diff --git a/lang/English/admin_common.php b/lang/English/admin_common.php
index 7172658..826cd35 100644
--- a/lang/English/admin_common.php
+++ b/lang/English/admin_common.php
@@ -1,6 +1,6 @@
 <?php
 
-// Language definitions used in admin_common
+// Language definitions used in admin_common.php
 $lang_admin_common = array(
 
 // The menu
diff --git a/login.php b/login.php
index 94dec22..1b11631 100644
--- a/login.php
+++ b/login.php
@@ -75,7 +75,7 @@
 		generate_users_info_cache();
 	}
 
-	// Remove this users guest entry from the online list
+	// Remove this user's guest entry from the online list
 	$db->query('DELETE FROM '.$db->prefix.'online WHERE ident=\''.$db->escape(get_remote_address()).'\'') or error('Unable to delete from online list', __FILE__, __LINE__, $db->error());
 
 	$expire = ($save_pass == '1') ? time() + 1209600 : time() + $pun_config['o_timeout_visit'];
diff --git a/misc.php b/misc.php
index 46d2707..691cce9 100644
--- a/misc.php
+++ b/misc.php
@@ -137,7 +137,7 @@
 	}
 
 
-	// Try to determine if the data in HTTP_REFERER is valid (if not, we redirect to the users profile after the email is sent)
+	// Try to determine if the data in HTTP_REFERER is valid (if not, we redirect to the user's profile after the email is sent)
 	if (!empty($_SERVER['HTTP_REFERER']))
 	{
 		$referrer = parse_url($_SERVER['HTTP_REFERER']);
diff --git a/post.php b/post.php
index 0283557..1c407e6 100644
--- a/post.php
+++ b/post.php
@@ -108,7 +108,7 @@
 				$errors[] = $lang_common['Invalid email'];
 
 			// Check if it's a banned email address
-			// we should only check guests because members addresses are already verified
+			// we should only check guests because members' addresses are already verified
 			if ($pun_user['is_guest'] && is_banned_email($email))
 			{
 				if ($pun_config['p_allow_banned_email'] == '0')
diff --git a/profile.php b/profile.php
index cbb5901..f4bc70b 100644
--- a/profile.php
+++ b/profile.php
@@ -28,7 +28,7 @@
 		message($lang_common['No permission'], false, '403 Forbidden');
 }
 
-// Load the profile.php/register.php language file
+// Load the profile.php/register.php language files
 require PUN_ROOT.'lang/'.$pun_user['language'].'/prof_reg.php';
 
 // Load the profile.php language file
@@ -61,12 +61,12 @@
 		}
 	}
 
-	// Make sure we are allowed to change this users password
+	// Make sure we are allowed to change this user's password
 	if ($pun_user['id'] != $id)
 	{
-		if (!$pun_user['is_admmod']) // A regular user trying to change another users password?
+		if (!$pun_user['is_admmod']) // A regular user trying to change another user's password?
 			message($lang_common['No permission'], false, '403 Forbidden');
-		else if ($pun_user['g_moderator'] == '1') // A moderator trying to change a users password?
+		else if ($pun_user['g_moderator'] == '1') // A moderator trying to change a user's password?
 		{
 			$result = $db->query('SELECT u.group_id, g.g_moderator FROM '.$db->prefix.'users AS u INNER JOIN '.$db->prefix.'groups AS g ON (g.g_id=u.group_id) WHERE u.id='.$id) or error('Unable to fetch user info', __FILE__, __LINE__, $db->error());
 			if (!$db->num_rows($result))
@@ -157,12 +157,12 @@
 
 else if ($action == 'change_email')
 {
-	// Make sure we are allowed to change this users email
+	// Make sure we are allowed to change this user's email
 	if ($pun_user['id'] != $id)
 	{
-		if (!$pun_user['is_admmod']) // A regular user trying to change another users email?
+		if (!$pun_user['is_admmod']) // A regular user trying to change another user's email?
 			message($lang_common['No permission'], false, '403 Forbidden');
-		else if ($pun_user['g_moderator'] == '1') // A moderator trying to change a users email?
+		else if ($pun_user['g_moderator'] == '1') // A moderator trying to change a user's email?
 		{
 			$result = $db->query('SELECT u.group_id, g.g_moderator FROM '.$db->prefix.'users AS u INNER JOIN '.$db->prefix.'groups AS g ON (g.g_id=u.group_id) WHERE u.id='.$id) or error('Unable to fetch user info', __FILE__, __LINE__, $db->error());
 			if (!$db->num_rows($result))
diff --git a/search.php b/search.php
index 85c8ce5..0133411 100644
--- a/search.php
+++ b/search.php
@@ -238,7 +238,7 @@
 					}
 				}
 
-				// Sort the results - annoyingly array_multisort re-indexes arrays with numeric keys, so we need to split the keys out into a seperate array then combine them again after
+				// Sort the results - annoyingly array_multisort re-indexes arrays with numeric keys, so we need to split the keys out into a separate array then combine them again after
 				$post_ids = array_keys($keyword_results);
 				$topic_ids = array_values($keyword_results);
 
-- 
1.7.10


From 64267207d96e9b9341b688dd2a9152cf5e57f713 Mon Sep 17 00:00:00 2001
From: Quy Ton <quy@fluxbb.org>
Date: Mon, 6 Aug 2012 10:51:52 -0700
Subject: [PATCH 32/75] #689: Fixed more errors in comments

---
 edit.php    |    2 +-
 profile.php |    2 +-
 2 files changed, 2 insertions(+), 2 deletions(-)

diff --git a/edit.php b/edit.php
index 328598d..f3346cf 100644
--- a/edit.php
+++ b/edit.php
@@ -44,7 +44,7 @@
 	!$is_admmod)
 	message($lang_common['No permission'], false, '403 Forbidden');
 
-// Load the post.php/edit.php language files
+// Load the post.php language file
 require PUN_ROOT.'lang/'.$pun_user['language'].'/post.php';
 
 // Start with a clean slate
diff --git a/profile.php b/profile.php
index f4bc70b..40bf420 100644
--- a/profile.php
+++ b/profile.php
@@ -28,7 +28,7 @@
 		message($lang_common['No permission'], false, '403 Forbidden');
 }
 
-// Load the profile.php/register.php language files
+// Load the prof_reg.php language file
 require PUN_ROOT.'lang/'.$pun_user['language'].'/prof_reg.php';
 
 // Load the profile.php language file
-- 
1.7.10


From 5751ae2c312ae9fcc5ce4bfad3b282254e68a8c3 Mon Sep 17 00:00:00 2001
From: Franz Liedke <franz@develophp.org>
Date: Wed, 8 Aug 2012 17:37:48 +0200
Subject: [PATCH 33/75] #667: Use PHP_EOL to separate headers when sending
 email.

---
 include/email.php |    4 ++--
 1 file changed, 2 insertions(+), 2 deletions(-)

diff --git a/include/email.php b/include/email.php
index c4b0db3..20354b7 100644
--- a/include/email.php
+++ b/include/email.php
@@ -229,14 +229,14 @@ function pun_mail($to, $subject, $message, $reply_to_email = '', $reply_to_name
 	$from = '"'.encode_mail_text($from_name).'" <'.$from_email.'>';
 	$subject = encode_mail_text($subject);
 
-	$headers = 'From: '.$from."\r\n".'Date: '.gmdate('r')."\r\n".'MIME-Version: 1.0'."\r\n".'Content-transfer-encoding: 8bit'."\r\n".'Content-type: text/plain; charset=utf-8'."\r\n".'X-Mailer: FluxBB Mailer';
+	$headers = 'From: '.$from.PHP_EOL.'Date: '.gmdate('r').PHP_EOL.'MIME-Version: 1.0'.PHP_EOL.'Content-transfer-encoding: 8bit'.PHP_EOL.'Content-type: text/plain; charset=utf-8'.PHP_EOL.'X-Mailer: FluxBB Mailer';
 
 	// If we specified a reply-to email, we deal with it here
 	if (!empty($reply_to_email))
 	{
 		$reply_to = '"'.encode_mail_text($reply_to_name).'" <'.$reply_to_email.'>';
 
-		$headers .= "\r\n".'Reply-To: '.$reply_to;
+		$headers .= PHP_EOL.'Reply-To: '.$reply_to;
 	}
 
 	// Make sure all linebreaks are LF in message (and strip out any NULL bytes)
-- 
1.7.10


From 672c69cdde279e5ca07ea0e31944988c73650396 Mon Sep 17 00:00:00 2001
From: daris <daris91@gmail.com>
Date: Sat, 18 Aug 2012 19:37:09 +0200
Subject: [PATCH 34/75] #717: Adding missing labels for radio buttons in admin
 panel

---
 admin_groups.php      |   51 ++++++++++++++++++++++++++++++++-----------------
 admin_maintenance.php |    3 ++-
 admin_permissions.php |   30 +++++++++++++++++++----------
 admin_users.php       |    3 ++-
 4 files changed, 58 insertions(+), 29 deletions(-)

diff --git a/admin_groups.php b/admin_groups.php
index aedcf08..de72118 100644
--- a/admin_groups.php
+++ b/admin_groups.php
@@ -112,119 +112,136 @@
 <?php if ($mode != 'edit' || $pun_config['o_default_user_group'] != $group['g_id']): ?>								<tr>
 									<th scope="row"> <?php echo $lang_admin_groups['Mod privileges label'] ?></th>
 									<td>
-										<input type="radio" name="moderator" value="1"<?php if ($group['g_moderator'] == '1') echo ' checked="checked"' ?> tabindex="5" />&#160;<strong><?php echo $lang_admin_common['Yes'] ?></strong>&#160;&#160;&#160;<input type="radio" name="moderator" value="0"<?php if ($group['g_moderator'] == '0') echo ' checked="checked"' ?> tabindex="6" />&#160;<strong><?php echo $lang_admin_common['No'] ?></strong>
+										<label class="conl"><input type="radio" name="moderator" value="1"<?php if ($group['g_moderator'] == '1') echo ' checked="checked"' ?> tabindex="5" />&#160;<strong><?php echo $lang_admin_common['Yes'] ?></strong></label>
+										<label class="conl"><input type="radio" name="moderator" value="0"<?php if ($group['g_moderator'] == '0') echo ' checked="checked"' ?> tabindex="6" />&#160;<strong><?php echo $lang_admin_common['No'] ?></strong></label>
 										<span><?php echo $lang_admin_groups['Mod privileges help'] ?></span>
 									</td>
 								</tr>
 								<tr>
 									<th scope="row"><?php echo $lang_admin_groups['Edit profile label'] ?></th>
 									<td>
-										<input type="radio" name="mod_edit_users" value="1"<?php if ($group['g_mod_edit_users'] == '1') echo ' checked="checked"' ?> tabindex="7" />&#160;<strong><?php echo $lang_admin_common['Yes'] ?></strong>&#160;&#160;&#160;<input type="radio" name="mod_edit_users" value="0"<?php if ($group['g_mod_edit_users'] == '0') echo ' checked="checked"' ?> tabindex="8" />&#160;<strong><?php echo $lang_admin_common['No'] ?></strong>
+										<label class="conl"><input type="radio" name="mod_edit_users" value="1"<?php if ($group['g_mod_edit_users'] == '1') echo ' checked="checked"' ?> tabindex="7" />&#160;<strong><?php echo $lang_admin_common['Yes'] ?></strong></label>
+										<label class="conl"><input type="radio" name="mod_edit_users" value="0"<?php if ($group['g_mod_edit_users'] == '0') echo ' checked="checked"' ?> tabindex="8" />&#160;<strong><?php echo $lang_admin_common['No'] ?></strong></label>
 										<span><?php echo $lang_admin_groups['Edit profile help'] ?></span>
 									</td>
 								</tr>
 								<tr>
 									<th scope="row"><?php echo $lang_admin_groups['Rename users label'] ?></th>
 									<td>
-										<input type="radio" name="mod_rename_users" value="1"<?php if ($group['g_mod_rename_users'] == '1') echo ' checked="checked"' ?> tabindex="9" />&#160;<strong><?php echo $lang_admin_common['Yes'] ?></strong>&#160;&#160;&#160;<input type="radio" name="mod_rename_users" value="0"<?php if ($group['g_mod_rename_users'] == '0') echo ' checked="checked"' ?> tabindex="10" />&#160;<strong><?php echo $lang_admin_common['No'] ?></strong>
+										<label class="conl"><input type="radio" name="mod_rename_users" value="1"<?php if ($group['g_mod_rename_users'] == '1') echo ' checked="checked"' ?> tabindex="9" />&#160;<strong><?php echo $lang_admin_common['Yes'] ?></strong></label>
+										<label class="conl"><input type="radio" name="mod_rename_users" value="0"<?php if ($group['g_mod_rename_users'] == '0') echo ' checked="checked"' ?> tabindex="10" />&#160;<strong><?php echo $lang_admin_common['No'] ?></strong></label>
 										<span><?php echo $lang_admin_groups['Rename users help'] ?></span>
 									</td>
 								</tr>
 								<tr>
 									<th scope="row"><?php echo $lang_admin_groups['Change passwords label'] ?></th>
 									<td>
-										<input type="radio" name="mod_change_passwords" value="1"<?php if ($group['g_mod_change_passwords'] == '1') echo ' checked="checked"' ?> tabindex="11" />&#160;<strong><?php echo $lang_admin_common['Yes'] ?></strong>&#160;&#160;&#160;<input type="radio" name="mod_change_passwords" value="0"<?php if ($group['g_mod_change_passwords'] == '0') echo ' checked="checked"' ?> tabindex="12" />&#160;<strong><?php echo $lang_admin_common['No'] ?></strong>
+										<label class="conl"><input type="radio" name="mod_change_passwords" value="1"<?php if ($group['g_mod_change_passwords'] == '1') echo ' checked="checked"' ?> tabindex="11" />&#160;<strong><?php echo $lang_admin_common['Yes'] ?></strong></label>
+										<label class="conl"><input type="radio" name="mod_change_passwords" value="0"<?php if ($group['g_mod_change_passwords'] == '0') echo ' checked="checked"' ?> tabindex="12" />&#160;<strong><?php echo $lang_admin_common['No'] ?></strong></label>
 										<span><?php echo $lang_admin_groups['Change passwords help'] ?></span>
 									</td>
 								</tr>
 								<tr>
 									<th scope="row"><?php echo $lang_admin_groups['Ban users label'] ?></th>
 									<td>
-										<input type="radio" name="mod_ban_users" value="1"<?php if ($group['g_mod_ban_users'] == '1') echo ' checked="checked"' ?> tabindex="13" />&#160;<strong><?php echo $lang_admin_common['Yes'] ?></strong>&#160;&#160;&#160;<input type="radio" name="mod_ban_users" value="0"<?php if ($group['g_mod_ban_users'] == '0') echo ' checked="checked"' ?> tabindex="14" />&#160;<strong><?php echo $lang_admin_common['No'] ?></strong>
+										<label class="conl"><input type="radio" name="mod_ban_users" value="1"<?php if ($group['g_mod_ban_users'] == '1') echo ' checked="checked"' ?> tabindex="13" />&#160;<strong><?php echo $lang_admin_common['Yes'] ?></strong></label>
+										<label class="conl"><input type="radio" name="mod_ban_users" value="0"<?php if ($group['g_mod_ban_users'] == '0') echo ' checked="checked"' ?> tabindex="14" />&#160;<strong><?php echo $lang_admin_common['No'] ?></strong></label>
 										<span><?php echo $lang_admin_groups['Ban users help'] ?></span>
 									</td>
 								</tr>
 <?php endif; endif; ?>								<tr>
 									<th scope="row"><?php echo $lang_admin_groups['Read board label'] ?></th>
 									<td>
-										<input type="radio" name="read_board" value="1"<?php if ($group['g_read_board'] == '1') echo ' checked="checked"' ?> tabindex="15" />&#160;<strong><?php echo $lang_admin_common['Yes'] ?></strong>&#160;&#160;&#160;<input type="radio" name="read_board" value="0"<?php if ($group['g_read_board'] == '0') echo ' checked="checked"' ?> tabindex="16" />&#160;<strong><?php echo $lang_admin_common['No'] ?></strong>
+										<label class="conl"><input type="radio" name="read_board" value="1"<?php if ($group['g_read_board'] == '1') echo ' checked="checked"' ?> tabindex="15" />&#160;<strong><?php echo $lang_admin_common['Yes'] ?></strong></label>
+										<label class="conl"><input type="radio" name="read_board" value="0"<?php if ($group['g_read_board'] == '0') echo ' checked="checked"' ?> tabindex="16" />&#160;<strong><?php echo $lang_admin_common['No'] ?></strong></label>
 										<span><?php echo $lang_admin_groups['Read board help'] ?></span>
 									</td>
 								</tr>
 								<tr>
 									<th scope="row"><?php echo $lang_admin_groups['View user info label'] ?></th>
 									<td>
-										<input type="radio" name="view_users" value="1"<?php if ($group['g_view_users'] == '1') echo ' checked="checked"' ?> tabindex="17" />&#160;<strong><?php echo $lang_admin_common['Yes'] ?></strong>&#160;&#160;&#160;<input type="radio" name="view_users" value="0"<?php if ($group['g_view_users'] == '0') echo ' checked="checked"' ?> tabindex="18" />&#160;<strong><?php echo $lang_admin_common['No'] ?></strong>
+										<label class="conl"><input type="radio" name="view_users" value="1"<?php if ($group['g_view_users'] == '1') echo ' checked="checked"' ?> tabindex="17" />&#160;<strong><?php echo $lang_admin_common['Yes'] ?></strong></label>
+										<label class="conl"><input type="radio" name="view_users" value="0"<?php if ($group['g_view_users'] == '0') echo ' checked="checked"' ?> tabindex="18" />&#160;<strong><?php echo $lang_admin_common['No'] ?></strong></label>
 										<span><?php echo $lang_admin_groups['View user info help'] ?></span>
 									</td>
 								</tr>
 								<tr>
 									<th scope="row"><?php echo $lang_admin_groups['Post replies label'] ?></th>
 									<td>
-										<input type="radio" name="post_replies" value="1"<?php if ($group['g_post_replies'] == '1') echo ' checked="checked"' ?> tabindex="19" />&#160;<strong><?php echo $lang_admin_common['Yes'] ?></strong>&#160;&#160;&#160;<input type="radio" name="post_replies" value="0"<?php if ($group['g_post_replies'] == '0') echo ' checked="checked"' ?> tabindex="20" />&#160;<strong><?php echo $lang_admin_common['No'] ?></strong>
+										<label class="conl"><input type="radio" name="post_replies" value="1"<?php if ($group['g_post_replies'] == '1') echo ' checked="checked"' ?> tabindex="19" />&#160;<strong><?php echo $lang_admin_common['Yes'] ?></strong></label>
+										<label class="conl"><input type="radio" name="post_replies" value="0"<?php if ($group['g_post_replies'] == '0') echo ' checked="checked"' ?> tabindex="20" />&#160;<strong><?php echo $lang_admin_common['No'] ?></strong></label>
 										<span><?php echo $lang_admin_groups['Post replies help'] ?></span>
 									</td>
 								</tr>
 								<tr>
 									<th scope="row"><?php echo $lang_admin_groups['Post topics label'] ?></th>
 									<td>
-										<input type="radio" name="post_topics" value="1"<?php if ($group['g_post_topics'] == '1') echo ' checked="checked"' ?> tabindex="21" />&#160;<strong><?php echo $lang_admin_common['Yes'] ?></strong>&#160;&#160;&#160;<input type="radio" name="post_topics" value="0"<?php if ($group['g_post_topics'] == '0') echo ' checked="checked"' ?> tabindex="22" />&#160;<strong><?php echo $lang_admin_common['No'] ?></strong>
+										<label class="conl"><input type="radio" name="post_topics" value="1"<?php if ($group['g_post_topics'] == '1') echo ' checked="checked"' ?> tabindex="21" />&#160;<strong><?php echo $lang_admin_common['Yes'] ?></strong></label>
+										<label class="conl"><input type="radio" name="post_topics" value="0"<?php if ($group['g_post_topics'] == '0') echo ' checked="checked"' ?> tabindex="22" />&#160;<strong><?php echo $lang_admin_common['No'] ?></strong></label>
 										<span><?php echo $lang_admin_groups['Post topics help'] ?></span>
 									</td>
 								</tr>
 <?php if ($group['g_id'] != PUN_GUEST): ?>								<tr>
 									<th scope="row"><?php echo $lang_admin_groups['Edit posts label'] ?></th>
 									<td>
-										<input type="radio" name="edit_posts" value="1"<?php if ($group['g_edit_posts'] == '1') echo ' checked="checked"' ?> tabindex="23" />&#160;<strong><?php echo $lang_admin_common['Yes'] ?></strong>&#160;&#160;&#160;<input type="radio" name="edit_posts" value="0"<?php if ($group['g_edit_posts'] == '0') echo ' checked="checked"' ?> tabindex="24" />&#160;<strong><?php echo $lang_admin_common['No'] ?></strong>
+										<label class="conl"><input type="radio" name="edit_posts" value="1"<?php if ($group['g_edit_posts'] == '1') echo ' checked="checked"' ?> tabindex="23" />&#160;<strong><?php echo $lang_admin_common['Yes'] ?></strong></label>
+										<label class="conl"><input type="radio" name="edit_posts" value="0"<?php if ($group['g_edit_posts'] == '0') echo ' checked="checked"' ?> tabindex="24" />&#160;<strong><?php echo $lang_admin_common['No'] ?></strong></label>
 										<span><?php echo $lang_admin_groups['Edit posts help'] ?></span>
 									</td>
 								</tr>
 								<tr>
 									<th scope="row"><?php echo $lang_admin_groups['Delete posts label'] ?></th>
 									<td>
-										<input type="radio" name="delete_posts" value="1"<?php if ($group['g_delete_posts'] == '1') echo ' checked="checked"' ?> tabindex="25" />&#160;<strong><?php echo $lang_admin_common['Yes'] ?></strong>&#160;&#160;&#160;<input type="radio" name="delete_posts" value="0"<?php if ($group['g_delete_posts'] == '0') echo ' checked="checked"' ?> tabindex="26" />&#160;<strong><?php echo $lang_admin_common['No'] ?></strong>
+										<label class="conl"><input type="radio" name="delete_posts" value="1"<?php if ($group['g_delete_posts'] == '1') echo ' checked="checked"' ?> tabindex="25" />&#160;<strong><?php echo $lang_admin_common['Yes'] ?></strong></label>
+										<label class="conl"><input type="radio" name="delete_posts" value="0"<?php if ($group['g_delete_posts'] == '0') echo ' checked="checked"' ?> tabindex="26" />&#160;<strong><?php echo $lang_admin_common['No'] ?></strong></label>
 										<span><?php echo $lang_admin_groups['Delete posts help'] ?></span>
 									</td>
 								</tr>
 								<tr>
 									<th scope="row"><?php echo $lang_admin_groups['Delete topics label'] ?></th>
 									<td>
-										<input type="radio" name="delete_topics" value="1"<?php if ($group['g_delete_topics'] == '1') echo ' checked="checked"' ?> tabindex="27" />&#160;<strong><?php echo $lang_admin_common['Yes'] ?></strong>&#160;&#160;&#160;<input type="radio" name="delete_topics" value="0"<?php if ($group['g_delete_topics'] == '0') echo ' checked="checked"' ?> tabindex="28" />&#160;<strong><?php echo $lang_admin_common['No'] ?></strong>
+										<label class="conl"><input type="radio" name="delete_topics" value="1"<?php if ($group['g_delete_topics'] == '1') echo ' checked="checked"' ?> tabindex="27" />&#160;<strong><?php echo $lang_admin_common['Yes'] ?></strong></label>
+										<label class="conl"><input type="radio" name="delete_topics" value="0"<?php if ($group['g_delete_topics'] == '0') echo ' checked="checked"' ?> tabindex="28" />&#160;<strong><?php echo $lang_admin_common['No'] ?></strong></label>
 										<span><?php echo $lang_admin_groups['Delete topics help'] ?></span>
 									</td>
 								</tr>
 <?php endif; ?>								<tr>
 									<th scope="row"><?php echo $lang_admin_groups['Post links label'] ?></th>
 									<td>
-										<input type="radio" name="post_links" value="1"<?php if ($group['g_post_links'] == '1') echo ' checked="checked"' ?> tabindex="29" />&#160;<strong><?php echo $lang_admin_common['Yes'] ?></strong>&#160;&#160;&#160;<input type="radio" name="post_links" value="0"<?php if ($group['g_post_links'] == '0') echo ' checked="checked"' ?> tabindex="30" />&#160;<strong><?php echo $lang_admin_common['No'] ?></strong>
+										<label class="conl"><input type="radio" name="post_links" value="1"<?php if ($group['g_post_links'] == '1') echo ' checked="checked"' ?> tabindex="29" />&#160;<strong><?php echo $lang_admin_common['Yes'] ?></strong></label>
+										<label class="conl"><input type="radio" name="post_links" value="0"<?php if ($group['g_post_links'] == '0') echo ' checked="checked"' ?> tabindex="30" />&#160;<strong><?php echo $lang_admin_common['No'] ?></strong></label>
 										<span><?php echo $lang_admin_groups['Post links help'] ?></span>
 									</td>
 								</tr>
 <?php if ($group['g_id'] != PUN_GUEST): ?>								<tr>
 									<th scope="row"><?php echo $lang_admin_groups['Set own title label'] ?></th>
 									<td>
-										<input type="radio" name="set_title" value="1"<?php if ($group['g_set_title'] == '1') echo ' checked="checked"' ?> tabindex="31" />&#160;<strong><?php echo $lang_admin_common['Yes'] ?></strong>&#160;&#160;&#160;<input type="radio" name="set_title" value="0"<?php if ($group['g_set_title'] == '0') echo ' checked="checked"' ?> tabindex="32" />&#160;<strong><?php echo $lang_admin_common['No'] ?></strong>
+										<label class="conl"><input type="radio" name="set_title" value="1"<?php if ($group['g_set_title'] == '1') echo ' checked="checked"' ?> tabindex="31" />&#160;<strong><?php echo $lang_admin_common['Yes'] ?></strong></label>
+										<label class="conl"><input type="radio" name="set_title" value="0"<?php if ($group['g_set_title'] == '0') echo ' checked="checked"' ?> tabindex="32" />&#160;<strong><?php echo $lang_admin_common['No'] ?></strong></label>
 										<span><?php echo $lang_admin_groups['Set own title help'] ?></span>
 									</td>
 								</tr>
 <?php endif; ?>								<tr>
 									<th scope="row"><?php echo $lang_admin_groups['User search label'] ?></th>
 									<td>
-										<input type="radio" name="search" value="1"<?php if ($group['g_search'] == '1') echo ' checked="checked"' ?> tabindex="33" />&#160;<strong><?php echo $lang_admin_common['Yes'] ?></strong>&#160;&#160;&#160;<input type="radio" name="search" value="0"<?php if ($group['g_search'] == '0') echo ' checked="checked"' ?> tabindex="34" />&#160;<strong><?php echo $lang_admin_common['No'] ?></strong>
+										<label class="conl"><input type="radio" name="search" value="1"<?php if ($group['g_search'] == '1') echo ' checked="checked"' ?> tabindex="33" />&#160;<strong><?php echo $lang_admin_common['Yes'] ?></strong></label>
+										<label class="conl"><input type="radio" name="search" value="0"<?php if ($group['g_search'] == '0') echo ' checked="checked"' ?> tabindex="34" />&#160;<strong><?php echo $lang_admin_common['No'] ?></strong></label>
 										<span><?php echo $lang_admin_groups['User search help'] ?></span>
 									</td>
 								</tr>
 								<tr>
 									<th scope="row"><?php echo $lang_admin_groups['User list search label'] ?></th>
 									<td>
-										<input type="radio" name="search_users" value="1"<?php if ($group['g_search_users'] == '1') echo ' checked="checked"' ?> tabindex="35" />&#160;<strong><?php echo $lang_admin_common['Yes'] ?></strong>&#160;&#160;&#160;<input type="radio" name="search_users" value="0"<?php if ($group['g_search_users'] == '0') echo ' checked="checked"' ?> tabindex="36" />&#160;<strong><?php echo $lang_admin_common['No'] ?></strong>
+										<label class="conl"><input type="radio" name="search_users" value="1"<?php if ($group['g_search_users'] == '1') echo ' checked="checked"' ?> tabindex="35" />&#160;<strong><?php echo $lang_admin_common['Yes'] ?></strong></label>
+										<label class="conl"><input type="radio" name="search_users" value="0"<?php if ($group['g_search_users'] == '0') echo ' checked="checked"' ?> tabindex="36" />&#160;<strong><?php echo $lang_admin_common['No'] ?></strong></label>
 										<span><?php echo $lang_admin_groups['User list search help'] ?></span>
 									</td>
 								</tr>
 <?php if ($group['g_id'] != PUN_GUEST): ?>								<tr>
 									<th scope="row"><?php echo $lang_admin_groups['Send e-mails label'] ?></th>
 									<td>
-										<input type="radio" name="send_email" value="1"<?php if ($group['g_send_email'] == '1') echo ' checked="checked"' ?> tabindex="37" />&#160;<strong><?php echo $lang_admin_common['Yes'] ?></strong>&#160;&#160;&#160;<input type="radio" name="send_email" value="0"<?php if ($group['g_send_email'] == '0') echo ' checked="checked"' ?> tabindex="38" />&#160;<strong><?php echo $lang_admin_common['No'] ?></strong>
+										<label class="conl"><input type="radio" name="send_email" value="1"<?php if ($group['g_send_email'] == '1') echo ' checked="checked"' ?> tabindex="37" />&#160;<strong><?php echo $lang_admin_common['Yes'] ?></strong></label>
+										<label class="conl"><input type="radio" name="send_email" value="0"<?php if ($group['g_send_email'] == '0') echo ' checked="checked"' ?> tabindex="38" />&#160;<strong><?php echo $lang_admin_common['No'] ?></strong></label>
 										<span><?php echo $lang_admin_groups['Send e-mails help'] ?></span>
 									</td>
 								</tr>
diff --git a/admin_maintenance.php b/admin_maintenance.php
index aff2958..471b3a5 100644
--- a/admin_maintenance.php
+++ b/admin_maintenance.php
@@ -308,7 +308,8 @@
 								<tr>
 									<th scope="row"><?php echo $lang_admin_maintenance['Prune sticky label'] ?></th>
 									<td>
-										<input type="radio" name="prune_sticky" value="1" tabindex="6" checked="checked" />&#160;<strong><?php echo $lang_admin_common['Yes'] ?></strong>&#160;&#160;&#160;<input type="radio" name="prune_sticky" value="0" />&#160;<strong><?php echo $lang_admin_common['No'] ?></strong>
+										<label class="conl"><input type="radio" name="prune_sticky" value="1" tabindex="6" checked="checked" />&#160;<strong><?php echo $lang_admin_common['Yes'] ?></strong></label>
+										<label class="conl"><input type="radio" name="prune_sticky" value="0" />&#160;<strong><?php echo $lang_admin_common['No'] ?></strong></label>
 										<span><?php echo $lang_admin_maintenance['Prune sticky help'] ?></span>
 									</td>
 								</tr>
diff --git a/admin_permissions.php b/admin_permissions.php
index a239979..d660de5 100644
--- a/admin_permissions.php
+++ b/admin_permissions.php
@@ -67,35 +67,40 @@
 								<tr>
 									<th scope="row"><?php echo $lang_admin_permissions['BBCode label'] ?></th>
 									<td>
-										<input type="radio" name="form[message_bbcode]" value="1"<?php if ($pun_config['p_message_bbcode'] == '1') echo ' checked="checked"' ?> />&#160;<strong><?php echo $lang_admin_common['Yes'] ?></strong>&#160;&#160;&#160;<input type="radio" name="form[message_bbcode]" value="0"<?php if ($pun_config['p_message_bbcode'] == '0') echo ' checked="checked"' ?> />&#160;<strong><?php echo $lang_admin_common['No'] ?></strong>
+										<label class="conl"><input type="radio" name="form[message_bbcode]" value="1"<?php if ($pun_config['p_message_bbcode'] == '1') echo ' checked="checked"' ?> />&#160;<strong><?php echo $lang_admin_common['Yes'] ?></strong></label>
+										<label class="conl"><input type="radio" name="form[message_bbcode]" value="0"<?php if ($pun_config['p_message_bbcode'] == '0') echo ' checked="checked"' ?> />&#160;<strong><?php echo $lang_admin_common['No'] ?></strong></label>
 										<span><?php echo $lang_admin_permissions['BBCode help'] ?></span>
 									</td>
 								</tr>
 								<tr>
 									<th scope="row"><?php echo $lang_admin_permissions['Image tag label'] ?></th>
 									<td>
-										<input type="radio" name="form[message_img_tag]" value="1"<?php if ($pun_config['p_message_img_tag'] == '1') echo ' checked="checked"' ?> />&#160;<strong><?php echo $lang_admin_common['Yes'] ?></strong>&#160;&#160;&#160;<input type="radio" name="form[message_img_tag]" value="0"<?php if ($pun_config['p_message_img_tag'] == '0') echo ' checked="checked"' ?> />&#160;<strong><?php echo $lang_admin_common['No'] ?></strong>
+										<label class="conl"><input type="radio" name="form[message_img_tag]" value="1"<?php if ($pun_config['p_message_img_tag'] == '1') echo ' checked="checked"' ?> />&#160;<strong><?php echo $lang_admin_common['Yes'] ?></strong></label>
+										<label class="conl"><input type="radio" name="form[message_img_tag]" value="0"<?php if ($pun_config['p_message_img_tag'] == '0') echo ' checked="checked"' ?> />&#160;<strong><?php echo $lang_admin_common['No'] ?></strong></label>
 										<span><?php echo $lang_admin_permissions['Image tag help'] ?></span>
 									</td>
 								</tr>
 								<tr>
 									<th scope="row"><?php echo $lang_admin_permissions['All caps message label'] ?></th>
 									<td>
-										<input type="radio" name="form[message_all_caps]" value="1"<?php if ($pun_config['p_message_all_caps'] == '1') echo ' checked="checked"' ?> />&#160;<strong><?php echo $lang_admin_common['Yes'] ?></strong>&#160;&#160;&#160;<input type="radio" name="form[message_all_caps]" value="0"<?php if ($pun_config['p_message_all_caps'] == '0') echo ' checked="checked"' ?> />&#160;<strong><?php echo $lang_admin_common['No'] ?></strong>
+										<label class="conl"><input type="radio" name="form[message_all_caps]" value="1"<?php if ($pun_config['p_message_all_caps'] == '1') echo ' checked="checked"' ?> />&#160;<strong><?php echo $lang_admin_common['Yes'] ?></strong></label>
+										<label class="conl"><input type="radio" name="form[message_all_caps]" value="0"<?php if ($pun_config['p_message_all_caps'] == '0') echo ' checked="checked"' ?> />&#160;<strong><?php echo $lang_admin_common['No'] ?></strong></label>
 										<span><?php echo $lang_admin_permissions['All caps message help'] ?></span>
 									</td>
 								</tr>
 								<tr>
 									<th scope="row"><?php echo $lang_admin_permissions['All caps subject label'] ?></th>
 									<td>
-										<input type="radio" name="form[subject_all_caps]" value="1"<?php if ($pun_config['p_subject_all_caps'] == '1') echo ' checked="checked"' ?> />&#160;<strong><?php echo $lang_admin_common['Yes'] ?></strong>&#160;&#160;&#160;<input type="radio" name="form[subject_all_caps]" value="0"<?php if ($pun_config['p_subject_all_caps'] == '0') echo ' checked="checked"' ?> />&#160;<strong><?php echo $lang_admin_common['No'] ?></strong>
+										<label class="conl"><input type="radio" name="form[subject_all_caps]" value="1"<?php if ($pun_config['p_subject_all_caps'] == '1') echo ' checked="checked"' ?> />&#160;<strong><?php echo $lang_admin_common['Yes'] ?></strong></label>
+										<label class="conl"><input type="radio" name="form[subject_all_caps]" value="0"<?php if ($pun_config['p_subject_all_caps'] == '0') echo ' checked="checked"' ?> />&#160;<strong><?php echo $lang_admin_common['No'] ?></strong></label>
 										<span><?php echo $lang_admin_permissions['All caps subject help'] ?></span>
 									</td>
 								</tr>
 								<tr>
 									<th scope="row"><?php echo $lang_admin_permissions['Require e-mail label'] ?></th>
 									<td>
-										<input type="radio" name="form[force_guest_email]" value="1"<?php if ($pun_config['p_force_guest_email'] == '1') echo ' checked="checked"' ?> />&#160;<strong><?php echo $lang_admin_common['Yes'] ?></strong>&#160;&#160;&#160;<input type="radio" name="form[force_guest_email]" value="0"<?php if ($pun_config['p_force_guest_email'] == '0') echo ' checked="checked"' ?> />&#160;<strong><?php echo $lang_admin_common['No'] ?></strong>
+										<label class="conl"><input type="radio" name="form[force_guest_email]" value="1"<?php if ($pun_config['p_force_guest_email'] == '1') echo ' checked="checked"' ?> />&#160;<strong><?php echo $lang_admin_common['Yes'] ?></strong></label>
+										<label class="conl"><input type="radio" name="form[force_guest_email]" value="0"<?php if ($pun_config['p_force_guest_email'] == '0') echo ' checked="checked"' ?> />&#160;<strong><?php echo $lang_admin_common['No'] ?></strong></label>
 										<span><?php echo $lang_admin_permissions['Require e-mail help'] ?></span>
 									</td>
 								</tr>
@@ -111,21 +116,24 @@
 								<tr>
 									<th scope="row"><?php echo $lang_admin_permissions['BBCode sigs label'] ?></th>
 									<td>
-										<input type="radio" name="form[sig_bbcode]" value="1"<?php if ($pun_config['p_sig_bbcode'] == '1') echo ' checked="checked"' ?> />&#160;<strong><?php echo $lang_admin_common['Yes'] ?></strong>&#160;&#160;&#160;<input type="radio" name="form[sig_bbcode]" value="0"<?php if ($pun_config['p_sig_bbcode'] == '0') echo ' checked="checked"' ?> />&#160;<strong><?php echo $lang_admin_common['No'] ?></strong>
+										<label class="conl"><input type="radio" name="form[sig_bbcode]" value="1"<?php if ($pun_config['p_sig_bbcode'] == '1') echo ' checked="checked"' ?> />&#160;<strong><?php echo $lang_admin_common['Yes'] ?></strong></label>
+										<label class="conl"><input type="radio" name="form[sig_bbcode]" value="0"<?php if ($pun_config['p_sig_bbcode'] == '0') echo ' checked="checked"' ?> />&#160;<strong><?php echo $lang_admin_common['No'] ?></strong></label>
 										<span><?php echo $lang_admin_permissions['BBCode sigs help'] ?></span>
 									</td>
 								</tr>
 								<tr>
 									<th scope="row"><?php echo $lang_admin_permissions['Image tag sigs label'] ?></th>
 									<td>
-										<input type="radio" name="form[sig_img_tag]" value="1"<?php if ($pun_config['p_sig_img_tag'] == '1') echo ' checked="checked"' ?> />&#160;<strong><?php echo $lang_admin_common['Yes'] ?></strong>&#160;&#160;&#160;<input type="radio" name="form[sig_img_tag]" value="0"<?php if ($pun_config['p_sig_img_tag'] == '0') echo ' checked="checked"' ?> />&#160;<strong><?php echo $lang_admin_common['No'] ?></strong>
+										<label class="conl"><input type="radio" name="form[sig_img_tag]" value="1"<?php if ($pun_config['p_sig_img_tag'] == '1') echo ' checked="checked"' ?> />&#160;<strong><?php echo $lang_admin_common['Yes'] ?></strong></label>
+										<label class="conl"><input type="radio" name="form[sig_img_tag]" value="0"<?php if ($pun_config['p_sig_img_tag'] == '0') echo ' checked="checked"' ?> />&#160;<strong><?php echo $lang_admin_common['No'] ?></strong></label>
 										<span><?php echo $lang_admin_permissions['Image tag sigs help'] ?></span>
 									</td>
 								</tr>
 								<tr>
 									<th scope="row"><?php echo $lang_admin_permissions['All caps sigs label'] ?></th>
 									<td>
-										<input type="radio" name="form[sig_all_caps]" value="1"<?php if ($pun_config['p_sig_all_caps'] == '1') echo ' checked="checked"' ?> />&#160;<strong><?php echo $lang_admin_common['Yes'] ?></strong>&#160;&#160;&#160;<input type="radio" name="form[sig_all_caps]" value="0"<?php if ($pun_config['p_sig_all_caps'] == '0') echo ' checked="checked"' ?> />&#160;<strong><?php echo $lang_admin_common['No'] ?></strong>
+										<label class="conl"><input type="radio" name="form[sig_all_caps]" value="1"<?php if ($pun_config['p_sig_all_caps'] == '1') echo ' checked="checked"' ?> />&#160;<strong><?php echo $lang_admin_common['Yes'] ?></strong></label>
+										<label class="conl"><input type="radio" name="form[sig_all_caps]" value="0"<?php if ($pun_config['p_sig_all_caps'] == '0') echo ' checked="checked"' ?> />&#160;<strong><?php echo $lang_admin_common['No'] ?></strong></label>
 										<span><?php echo $lang_admin_permissions['All caps sigs help'] ?></span>
 									</td>
 								</tr>
@@ -155,14 +163,16 @@
 								<tr>
 									<th scope="row"><?php echo $lang_admin_permissions['Banned e-mail label'] ?></th>
 									<td>
-										<input type="radio" name="form[allow_banned_email]" value="1"<?php if ($pun_config['p_allow_banned_email'] == '1') echo ' checked="checked"' ?> />&#160;<strong><?php echo $lang_admin_common['Yes'] ?></strong>&#160;&#160;&#160;<input type="radio" name="form[allow_banned_email]" value="0"<?php if ($pun_config['p_allow_banned_email'] == '0') echo ' checked="checked"' ?> />&#160;<strong><?php echo $lang_admin_common['No'] ?></strong>
+										<label class="conl"><input type="radio" name="form[allow_banned_email]" value="1"<?php if ($pun_config['p_allow_banned_email'] == '1') echo ' checked="checked"' ?> />&#160;<strong><?php echo $lang_admin_common['Yes'] ?></strong></label>
+										<label class="conl"><input type="radio" name="form[allow_banned_email]" value="0"<?php if ($pun_config['p_allow_banned_email'] == '0') echo ' checked="checked"' ?> />&#160;<strong><?php echo $lang_admin_common['No'] ?></strong></label>
 										<span><?php echo $lang_admin_permissions['Banned e-mail help'] ?></span>
 									</td>
 								</tr>
 								<tr>
 									<th scope="row"><?php echo $lang_admin_permissions['Duplicate e-mail label'] ?></th>
 									<td>
-										<input type="radio" name="form[allow_dupe_email]" value="1"<?php if ($pun_config['p_allow_dupe_email'] == '1') echo ' checked="checked"' ?> />&#160;<strong><?php echo $lang_admin_common['Yes'] ?></strong>&#160;&#160;&#160;<input type="radio" name="form[allow_dupe_email]" value="0"<?php if ($pun_config['p_allow_dupe_email'] == '0') echo ' checked="checked"' ?> />&#160;<strong><?php echo $lang_admin_common['No'] ?></strong>
+										<label class="conl"><input type="radio" name="form[allow_dupe_email]" value="1"<?php if ($pun_config['p_allow_dupe_email'] == '1') echo ' checked="checked"' ?> />&#160;<strong><?php echo $lang_admin_common['Yes'] ?></strong></label>
+										<label class="conl"><input type="radio" name="form[allow_dupe_email]" value="0"<?php if ($pun_config['p_allow_dupe_email'] == '0') echo ' checked="checked"' ?> />&#160;<strong><?php echo $lang_admin_common['No'] ?></strong></label>
 										<span><?php echo $lang_admin_permissions['Duplicate e-mail help'] ?></span>
 									</td>
 								</tr>
diff --git a/admin_users.php b/admin_users.php
index a016871..bfe8e09 100644
--- a/admin_users.php
+++ b/admin_users.php
@@ -652,7 +652,8 @@
 								<tr>
 									<th scope="row"><?php echo $lang_admin_users['Ban IP label'] ?></th>
 									<td>
-										<input type="radio" name="ban_the_ip" tabindex="3" value="1" checked="checked" />&#160;<strong><?php echo $lang_admin_common['Yes'] ?></strong>&#160;&#160;&#160;<input type="radio" name="ban_the_ip" tabindex="4" value="0" checked="checked" />&#160;<strong><?php echo $lang_admin_common['No'] ?></strong>
+										<label class="conl"><input type="radio" name="ban_the_ip" tabindex="3" value="1" checked="checked" />&#160;<strong><?php echo $lang_admin_common['Yes'] ?></strong></label>
+										<label class="conl"><input type="radio" name="ban_the_ip" tabindex="4" value="0" checked="checked" />&#160;<strong><?php echo $lang_admin_common['No'] ?></strong></label>
 										<span><?php echo $lang_admin_users['Ban IP help'] ?></span>
 									</td>
 								</tr>
-- 
1.7.10


From 82bd40e78406544dd841cb1892a01a067b230ab4 Mon Sep 17 00:00:00 2001
From: Yannick Franssen <contact@studio384.be>
Date: Wed, 12 Sep 2012 13:49:15 +0200
Subject: [PATCH 35/75] #693: Fixed content type

---
 header.php                       |    2 +-
 include/template/admin.tpl       |    2 +-
 include/template/help.tpl        |    2 +-
 include/template/main.tpl        |    2 +-
 include/template/maintenance.tpl |    2 +-
 include/template/redirect.tpl    |    2 +-
 6 files changed, 6 insertions(+), 6 deletions(-)

diff --git a/header.php b/header.php
index 5ad1ca0..280a0de 100644
--- a/header.php
+++ b/header.php
@@ -17,7 +17,7 @@
 header('Pragma: no-cache'); // For HTTP/1.0 compatibility
 
 // Send the Content-type header in case the web server is setup to send something else
-header('Content-type: text/html; charset=utf-8');
+header('Content-type: application/xhtml+xml; charset=utf-8');
 
 // Load the template
 if (defined('PUN_ADMIN_CONSOLE'))
diff --git a/include/template/admin.tpl b/include/template/admin.tpl
index 06679ee..b81df2d 100644
--- a/include/template/admin.tpl
+++ b/include/template/admin.tpl
@@ -1,7 +1,7 @@
 <!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
 <html xmlns="http://www.w3.org/1999/xhtml" xml:lang="<pun_language>" lang="<pun_language>" dir="<pun_content_direction>">
 <head>
-<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
+<meta http-equiv="Content-Type" content="application/xhtml+xml; charset=utf-8" />
 <pun_head>
 </head>
 
diff --git a/include/template/help.tpl b/include/template/help.tpl
index 58fec14..7e5163a 100644
--- a/include/template/help.tpl
+++ b/include/template/help.tpl
@@ -1,7 +1,7 @@
 <!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
 <html xmlns="http://www.w3.org/1999/xhtml" xml:lang="<pun_language>" lang="<pun_language>" dir="<pun_content_direction>">
 <head>
-<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
+<meta http-equiv="Content-Type" content="application/xhtml+xml; charset=utf-8" />
 <pun_head>
 </head>
 
diff --git a/include/template/main.tpl b/include/template/main.tpl
index ea0a0b6..956f204 100644
--- a/include/template/main.tpl
+++ b/include/template/main.tpl
@@ -1,7 +1,7 @@
 <!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
 <html xmlns="http://www.w3.org/1999/xhtml" xml:lang="<pun_language>" lang="<pun_language>" dir="<pun_content_direction>">
 <head>
-<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
+<meta http-equiv="Content-Type" content="application/xhtml+xml; charset=utf-8" />
 <pun_head>
 </head>
 
diff --git a/include/template/maintenance.tpl b/include/template/maintenance.tpl
index 56edc49..92c7ff4 100644
--- a/include/template/maintenance.tpl
+++ b/include/template/maintenance.tpl
@@ -1,7 +1,7 @@
 <!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
 <html xmlns="http://www.w3.org/1999/xhtml" xml:lang="<pun_language>" lang="<pun_language>" dir="<pun_content_direction>">
 <head>
-<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
+<meta http-equiv="Content-Type" content="application/xhtml+xml; charset=utf-8" />
 <pun_head>
 </head>
 
diff --git a/include/template/redirect.tpl b/include/template/redirect.tpl
index 31f5f19..507d540 100644
--- a/include/template/redirect.tpl
+++ b/include/template/redirect.tpl
@@ -1,7 +1,7 @@
 <!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
 <html xmlns="http://www.w3.org/1999/xhtml" xml:lang="<pun_language>" lang="<pun_language>" dir="<pun_content_direction>">
 <head>
-<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
+<meta http-equiv="Content-Type" content="application/xhtml+xml; charset=utf-8" />
 <pun_head>
 </head>
 
-- 
1.7.10


From 0dd7e5268ec60b94a6916fcc9b988dbca31e0597 Mon Sep 17 00:00:00 2001
From: Yannick Franssen <contact@studio384.be>
Date: Thu, 13 Sep 2012 07:51:49 +0200
Subject: [PATCH 36/75] #682: Update 'Promote users help' text

---
 lang/English/admin_groups.php |    2 +-
 1 file changed, 1 insertion(+), 1 deletion(-)

diff --git a/lang/English/admin_groups.php b/lang/English/admin_groups.php
index edfd439..8170e8d 100644
--- a/lang/English/admin_groups.php
+++ b/lang/English/admin_groups.php
@@ -40,7 +40,7 @@
 'User title label'				=>	'User title',
 'User title help'				=>	'The rank users in this group have attained. Leave blank to use default title ("%s").',
 'Promote users label'			=>	'Promote users',
-'Promote users help'			=>	'You can promote users to a new group automatically if they reach a certain number of posts. Select "%s" to disable. For security reasons, you are not allowed to select an administrator group here. Also note that group changes for users affected by this setting may only take effect after their next post.',
+'Promote users help'			=>	'You can promote users to a new group automatically if they reach a certain number of posts. Select "%s" to disable. For security reasons, you are not allowed to select an administrator group here. Also note that group changes for users affected by this setting may only take effect after their next post. Note that the amount of posts you enter are the total amount of posts of that user, and not the amount of posts he or she has placed since he or she has this rank. ',
 'Disable promotion'				=>	'Disable promoting',
 'Mod privileges label'			=>	'Allow users moderator privileges',
 'Mod privileges help'			=>	'In order for a user in this group to have moderator abilities, he/she must be assigned to moderate one or more forums. This is done via the user administration page of the user\'s profile.',
-- 
1.7.10


From 462d641f2150b5cf465f4e13d5346d3213f1e692 Mon Sep 17 00:00:00 2001
From: Yannick Franssen <contact@studio384.be>
Date: Thu, 13 Sep 2012 16:23:00 +0200
Subject: [PATCH 37/75] #682: Updates 'Promote users help' text

---
 lang/English/admin_groups.php |    2 +-
 1 file changed, 1 insertion(+), 1 deletion(-)

diff --git a/lang/English/admin_groups.php b/lang/English/admin_groups.php
index 8170e8d..53149ac 100644
--- a/lang/English/admin_groups.php
+++ b/lang/English/admin_groups.php
@@ -40,7 +40,7 @@
 'User title label'				=>	'User title',
 'User title help'				=>	'The rank users in this group have attained. Leave blank to use default title ("%s").',
 'Promote users label'			=>	'Promote users',
-'Promote users help'			=>	'You can promote users to a new group automatically if they reach a certain number of posts. Select "%s" to disable. For security reasons, you are not allowed to select an administrator group here. Also note that group changes for users affected by this setting may only take effect after their next post. Note that the amount of posts you enter are the total amount of posts of that user, and not the amount of posts he or she has placed since he or she has this rank. ',
+'Promote users help'			=>	'You can promote users to a new group automatically if they reach a certain number of posts. Select "%s" to disable. For security reasons, you are not allowed to select an administrator group here. Also note that group changes for users affected by this setting may only take effect after their next post. Note that the amount of posts you enter is the total amount of posts of a user, not the amount of posts made as a member of this group.',
 'Disable promotion'				=>	'Disable promoting',
 'Mod privileges label'			=>	'Allow users moderator privileges',
 'Mod privileges help'			=>	'In order for a user in this group to have moderator abilities, he/she must be assigned to moderate one or more forums. This is done via the user administration page of the user\'s profile.',
-- 
1.7.10


From b6f1602cb8113492335ac23524c3d42905602394 Mon Sep 17 00:00:00 2001
From: Yannick Franssen <contact@studio384.be>
Date: Thu, 13 Sep 2012 16:39:27 +0200
Subject: [PATCH 38/75] #666: Removing database size and row count from
 admin_index.php and create admin_statistics.php

---
 admin_index.php                   |   96 +-------------------
 admin_statistics.php              |  173 +++++++++++++++++++++++++++++++++++++
 lang/English/admin_index.php      |   28 +-----
 lang/English/admin_statistics.php |   33 +++++++
 4 files changed, 212 insertions(+), 118 deletions(-)
 create mode 100644 admin_statistics.php
 create mode 100644 lang/English/admin_statistics.php

diff --git a/admin_index.php b/admin_index.php
index 5d82031..f7c8529 100644
--- a/admin_index.php
+++ b/admin_index.php
@@ -38,83 +38,6 @@
 		message(sprintf($lang_admin_index['New version available message'], '<a href="http://fluxbb.org/">FluxBB.org</a>'));
 }
 
-
-// Show phpinfo() output
-else if ($action == 'phpinfo' && $pun_user['g_id'] == PUN_ADMIN)
-{
-	// Is phpinfo() a disabled function?
-	if (strpos(strtolower((string) ini_get('disable_functions')), 'phpinfo') !== false)
-		message($lang_admin_index['PHPinfo disabled message']);
-
-	phpinfo();
-	exit;
-}
-
-
-// Get the server load averages (if possible)
-if (@file_exists('/proc/loadavg') && is_readable('/proc/loadavg'))
-{
-	// We use @ just in case
-	$fh = @fopen('/proc/loadavg', 'r');
-	$load_averages = @fread($fh, 64);
-	@fclose($fh);
-
-	if (($fh = @fopen('/proc/loadavg', 'r')))
-	{
-		$load_averages = fread($fh, 64);
-		fclose($fh);
-	}
-	else
-		$load_averages = '';
-
-	$load_averages = @explode(' ', $load_averages);
-	$server_load = isset($load_averages[2]) ? $load_averages[0].' '.$load_averages[1].' '.$load_averages[2] : $lang_admin_index['Not available'];
-}
-else if (!in_array(PHP_OS, array('WINNT', 'WIN32')) && preg_match('%averages?: ([0-9\.]+),?\s+([0-9\.]+),?\s+([0-9\.]+)%i', @exec('uptime'), $load_averages))
-	$server_load = $load_averages[1].' '.$load_averages[2].' '.$load_averages[3];
-else
-	$server_load = $lang_admin_index['Not available'];
-
-
-// Get number of current visitors
-$result = $db->query('SELECT COUNT(user_id) FROM '.$db->prefix.'online WHERE idle=0') or error('Unable to fetch online count', __FILE__, __LINE__, $db->error());
-$num_online = $db->result($result);
-
-
-// Collect some additional info about MySQL
-if ($db_type == 'mysql' || $db_type == 'mysqli' || $db_type == 'mysql_innodb' || $db_type == 'mysqli_innodb')
-{
-	// Calculate total db size/row count
-	$result = $db->query('SHOW TABLE STATUS LIKE \''.$db->prefix.'%\'') or error('Unable to fetch table status', __FILE__, __LINE__, $db->error());
-
-	$total_records = $total_size = 0;
-	while ($status = $db->fetch_assoc($result))
-	{
-		$total_records += $status['Rows'];
-		$total_size += $status['Data_length'] + $status['Index_length'];
-	}
-
-	$total_size = file_size($total_size);
-}
-
-
-// Check for the existence of various PHP opcode caches/optimizers
-if (function_exists('mmcache'))
-	$php_accelerator = '<a href="http://'.$lang_admin_index['Turck MMCache link'].'">'.$lang_admin_index['Turck MMCache'].'</a>';
-else if (isset($_PHPA))
-	$php_accelerator = '<a href="http://'.$lang_admin_index['ionCube PHP Accelerator link'].'">'.$lang_admin_index['ionCube PHP Accelerator'].'</a>';
-else if (ini_get('apc.enabled'))
-	$php_accelerator ='<a href="http://'.$lang_admin_index['Alternative PHP Cache (APC) link'].'">'.$lang_admin_index['Alternative PHP Cache (APC)'].'</a>';
-else if (ini_get('zend_optimizer.optimization_level'))
-	$php_accelerator = '<a href="http://'.$lang_admin_index['Zend Optimizer link'].'">'.$lang_admin_index['Zend Optimizer'].'</a>';
-else if (ini_get('eaccelerator.enable'))
-	$php_accelerator = '<a href="http://'.$lang_admin_index['eAccelerator link'].'">'.$lang_admin_index['eAccelerator'].'</a>';
-else if (ini_get('xcache.cacher'))
-	$php_accelerator = '<a href="http://'.$lang_admin_index['XCache link'].'">'.$lang_admin_index['XCache'].'</a>';
-else
-	$php_accelerator = $lang_admin_index['NA'];
-
-
 $page_title = array(pun_htmlspecialchars($pun_config['o_board_title']), $lang_admin_common['Admin'], $lang_admin_common['Index']);
 define('PUN_ACTIVE_PAGE', 'admin');
 require PUN_ROOT.'header.php';
@@ -141,7 +64,7 @@
 			</div>
 		</div>
 
-		<h2 class="block2"><span><?php echo $lang_admin_index['Statistics head'] ?></span></h2>
+		<h2 class="block2"><span><?php echo $lang_admin_index['About head'] ?></span></h2>
 		<div id="adstats" class="box">
 			<div class="inbox">
 				<dl>
@@ -149,23 +72,10 @@
 					<dd>
 						<?php printf($lang_admin_index['FluxBB version data']."\n", $pun_config['o_cur_version'], '<a href="admin_index.php?action=check_upgrade">'.$lang_admin_index['Check for upgrade'].'</a>') ?>
 					</dd>
-					<dt><?php echo $lang_admin_index['Server load label'] ?></dt>
+					<dt><?php echo $lang_admin_index['Server Statistics'] ?></dt>
 					<dd>
-						<?php printf($lang_admin_index['Server load data']."\n", $server_load, $num_online) ?>
+						<a href="admin_statistics.php" title="<?php $lang_admin_index['Server Statistics data'] ?>"><?php echo $lang_admin_index['Server Statistics data'] ?></a>
 					</dd>
-<?php if ($pun_user['g_id'] == PUN_ADMIN): ?>					<dt><?php echo $lang_admin_index['Environment label'] ?></dt>
-					<dd>
-						<?php printf($lang_admin_index['Environment data OS'], PHP_OS) ?><br />
-						<?php printf($lang_admin_index['Environment data version'], phpversion(), '<a href="admin_index.php?action=phpinfo">'.$lang_admin_index['Show info'].'</a>') ?><br />
-						<?php printf($lang_admin_index['Environment data acc']."\n", $php_accelerator) ?>
-					</dd>
-					<dt><?php echo $lang_admin_index['Database label'] ?></dt>
-					<dd>
-						<?php echo implode(' ', $db->get_version())."\n" ?>
-<?php if (isset($total_records) && isset($total_size)): ?>						<br /><?php printf($lang_admin_index['Database data rows']."\n", forum_number_format($total_records)) ?>
-						<br /><?php printf($lang_admin_index['Database data size']."\n", $total_size) ?>
-<?php endif; ?>					</dd>
-<?php endif; ?>
 				</dl>
 			</div>
 		</div>
diff --git a/admin_statistics.php b/admin_statistics.php
new file mode 100644
index 0000000..8d9d890
--- /dev/null
+++ b/admin_statistics.php
@@ -0,0 +1,173 @@
+<?php
+
+/**
+ * Copyright (C) 2008-2012 FluxBB
+ * based on code by Rickard Andersson copyright (C) 2002-2008 PunBB
+ * License: http://www.gnu.org/licenses/gpl.html GPL version 2 or higher
+ */
+
+// Tell header.php to use the admin template
+define('PUN_ADMIN_CONSOLE', 1);
+
+define('PUN_ROOT', dirname(__FILE__).'/');
+require PUN_ROOT.'include/common.php';
+require PUN_ROOT.'include/common_admin.php';
+
+
+if (!$pun_user['is_admmod'])
+	message($lang_common['No permission'], false, '403 Forbidden');
+
+// Load the admin_statistics.php language file
+require PUN_ROOT.'lang/'.$admin_language.'/admin_statistics.php';
+
+$action = isset($_GET['action']) ? $_GET['action'] : null;
+
+
+// Show phpinfo() output
+if ($action == 'phpinfo' && $pun_user['g_id'] == PUN_ADMIN)
+{
+	// Is phpinfo() a disabled function?
+	if (strpos(strtolower((string) ini_get('disable_functions')), 'phpinfo') !== false)
+		message($lang_admin_statistics['PHPinfo disabled message']);
+
+	phpinfo();
+	exit;
+}
+
+
+// Get the server load averages (if possible)
+if (@file_exists('/proc/loadavg') && is_readable('/proc/loadavg'))
+{
+	// We use @ just in case
+	$fh = @fopen('/proc/loadavg', 'r');
+	$load_averages = @fread($fh, 64);
+	@fclose($fh);
+
+	if (($fh = @fopen('/proc/loadavg', 'r')))
+	{
+		$load_averages = fread($fh, 64);
+		fclose($fh);
+	}
+	else
+		$load_averages = '';
+
+	$load_averages = @explode(' ', $load_averages);
+	$server_load = isset($load_averages[2]) ? $load_averages[0].' '.$load_averages[1].' '.$load_averages[2] : $lang_admin_statistics['Not available'];
+}
+else if (!in_array(PHP_OS, array('WINNT', 'WIN32')) && preg_match('%averages?: ([0-9\.]+),?\s+([0-9\.]+),?\s+([0-9\.]+)%i', @exec('uptime'), $load_averages))
+	$server_load = $load_averages[1].' '.$load_averages[2].' '.$load_averages[3];
+else
+	$server_load = $lang_admin_statistics['Not available'];
+
+
+// Get number of current visitors
+$result = $db->query('SELECT COUNT(user_id) FROM '.$db->prefix.'online WHERE idle=0') or error('Unable to fetch online count', __FILE__, __LINE__, $db->error());
+$num_online = $db->result($result);
+
+
+// Collect some additional info about MySQL
+if ($db_type == 'mysql' || $db_type == 'mysqli' || $db_type == 'mysql_innodb' || $db_type == 'mysqli_innodb')
+{
+	// Calculate total db size/row count
+	$result = $db->query('SHOW TABLE STATUS LIKE \''.$db->prefix.'%\'') or error('Unable to fetch table status', __FILE__, __LINE__, $db->error());
+
+	$total_records = $total_size = 0;
+	while ($status = $db->fetch_assoc($result))
+	{
+		$total_records += $status['Rows'];
+		$total_size += $status['Data_length'] + $status['Index_length'];
+	}
+
+	$total_size = file_size($total_size);
+}
+
+
+// Check for the existence of various PHP opcode caches/optimizers
+if (function_exists('mmcache'))
+	$php_accelerator = '<a href="http://'.$lang_admin_statistics['Turck MMCache link'].'">'.$lang_admin_statistics['Turck MMCache'].'</a>';
+else if (isset($_PHPA))
+	$php_accelerator = '<a href="http://'.$lang_admin_statistics['ionCube PHP Accelerator link'].'">'.$lang_admin_statistics['ionCube PHP Accelerator'].'</a>';
+else if (ini_get('apc.enabled'))
+	$php_accelerator ='<a href="http://'.$lang_admin_statistics['Alternative PHP Cache (APC) link'].'">'.$lang_admin_statistics['Alternative PHP Cache (APC)'].'</a>';
+else if (ini_get('zend_optimizer.optimization_level'))
+	$php_accelerator = '<a href="http://'.$lang_admin_statistics['Zend Optimizer link'].'">'.$lang_admin_statistics['Zend Optimizer'].'</a>';
+else if (ini_get('eaccelerator.enable'))
+	$php_accelerator = '<a href="http://'.$lang_admin_statistics['eAccelerator link'].'">'.$lang_admin_statistics['eAccelerator'].'</a>';
+else if (ini_get('xcache.cacher'))
+	$php_accelerator = '<a href="http://'.$lang_admin_statistics['XCache link'].'">'.$lang_admin_statistics['XCache'].'</a>';
+else
+	$php_accelerator = $lang_admin_statistics['NA'];
+	
+// Collect some statistics from the database
+if (file_exists(FORUM_CACHE_DIR.'cache_users_info.php'))
+	include FORUM_CACHE_DIR.'cache_users_info.php';
+
+if (!defined('PUN_USERS_INFO_LOADED'))
+{
+	if (!defined('FORUM_CACHE_FUNCTIONS_LOADED'))
+		require PUN_ROOT.'include/cache.php';
+
+	generate_users_info_cache();
+	require FORUM_CACHE_DIR.'cache_users_info.php';
+}
+
+$result = $db->query('SELECT SUM(num_topics), SUM(num_posts) FROM '.$db->prefix.'forums') or error('Unable to fetch topic/post count', __FILE__, __LINE__, $db->error());
+list($stats['total_topics'], $stats['total_posts']) = $db->fetch_row($result);
+
+if ($pun_user['g_view_users'] == '1')
+	$stats['newest_user'] = '<a href="profile.php?id='.$stats['last_user']['id'].'">'.pun_htmlspecialchars($stats['last_user']['username']).'</a>';
+else
+	$stats['newest_user'] = pun_htmlspecialchars($stats['last_user']['username']);
+
+if (!empty($forum_actions))
+{
+
+?>
+<div class="linksb">
+	<div class="inbox crumbsplus">
+		<p class="subscribelink clearb"><?php echo implode(' - ', $forum_actions); ?></p>
+	</div>
+</div>
+<?php
+
+}
+
+
+$page_title = array(pun_htmlspecialchars($pun_config['o_board_title']), $lang_admin_common['Admin'], $lang_admin_common['Statistics']);
+define('PUN_ACTIVE_PAGE', 'admin');
+require PUN_ROOT.'header.php';
+
+generate_admin_menu('statistics');
+
+?>
+	<div class="block">
+		<h2><span><?php echo $lang_admin_statistics['Server head'] ?></span></h2>
+		<div id="adstats" class="box">
+			<div class="inbox">
+				<dl>
+					<dt><?php echo $lang_admin_statistics['Server load label'] ?></dt>
+					<dd>
+						<?php printf($lang_admin_statistics['Server load data']."\n", $server_load, $num_online) ?>
+					</dd>
+<?php if ($pun_user['g_id'] == PUN_ADMIN): ?>					<dt><?php echo $lang_admin_statistics['Environment label'] ?></dt>
+					<dd>
+						<?php printf($lang_admin_statistics['Environment data OS'], PHP_OS) ?><br />
+						<?php printf($lang_admin_statistics['Environment data version'], phpversion(), '<a href="admin_index.php?action=phpinfo">'.$lang_admin_statistics['Show info'].'</a>') ?><br />
+						<?php printf($lang_admin_statistics['Environment data acc']."\n", $php_accelerator) ?>
+					</dd>
+					<dt><?php echo $lang_admin_statistics['Database label'] ?></dt>
+					<dd>
+						<?php echo implode(' ', $db->get_version())."\n" ?>
+<?php if (isset($total_records) && isset($total_size)): ?>						<br /><?php printf($lang_admin_statistics['Database data rows']."\n", forum_number_format($total_records)) ?>
+						<br /><?php printf($lang_admin_statistics['Database data size']."\n", $total_size) ?>
+<?php endif; ?>					</dd>
+<?php endif; ?>
+				</dl>
+			</div>
+		</div>
+	</div>
+	<div class="clearer"></div>
+</div>
+<?php
+
+require PUN_ROOT.'footer.php';
diff --git a/lang/English/admin_index.php b/lang/English/admin_index.php
index 4b0a5d8..b032340 100644
--- a/lang/English/admin_index.php
+++ b/lang/English/admin_index.php
@@ -7,7 +7,6 @@
 'Upgrade check failed message'		=>	'Check for upgrade failed for unknown reasons.',
 'Running latest version message'	=>	'You are running the latest version of FluxBB.',
 'New version available message'		=>	'A new version of FluxBB has been released. You can download the latest version at %s.',
-'PHPinfo disabled message'			=>	'The PHP function phpinfo() has been disabled on this server.',
 'Not available'						=>	'Not available',
 'Forum admin head'					=>	'Forum administration',
 'NA'								=>	'N/A',
@@ -21,31 +20,10 @@
 'Welcome 7'							=>	'Set up user groups and promotions.',
 'Welcome 8'							=>	'Prune old posts.',
 'Welcome 9'							=>	'Handle post reports.',
-'Statistics head'					=>	'Statistics',
+'About head'						=>	'About FluxBB',
 'FluxBB version label'				=>	'FluxBB version',
 'Check for upgrade'					=>	'Check for upgrade',
 'FluxBB version data'				=>	'v%s - %s',
-'Server load label'					=>	'Server load',
-'Server load data'					=>	'%s - %s user(s) online',
-'Environment label'					=>	'Environment',
-'Environment data OS'				=>	'Operating system: %s',
-'Show info'							=>	'Show info',
-'Environment data version'			=>	'PHP: %s - %s',
-'Environment data acc'				=>	'Accelerator: %s',
-'Turck MMCache'						=>	'Turck MMCache',
-'Turck MMCache link'				=>	'turck-mmcache.sourceforge.net/',
-'ionCube PHP Accelerator'			=>	'ionCube PHP Accelerator',
-'ionCube PHP Accelerator link'		=>	'www.php-accelerator.co.uk/',
-'Alternative PHP Cache (APC)'		=>	'Alternative PHP Cache (APC)',
-'Alternative PHP Cache (APC) link'	=>	'www.php.net/apc/',
-'Zend Optimizer'					=>	'Zend Optimizer',
-'Zend Optimizer link'				=>	'www.zend.com/products/guard/zend-optimizer/',
-'eAccelerator'						=>	'eAccelerator',
-'eAccelerator link'					=>	'www.eaccelerator.net/',
-'XCache'							=>	'XCache',
-'XCache link'						=>	'xcache.lighttpd.net/',
-'Database label'					=>	'Database',
-'Database data rows'				=>	'Rows: %s',
-'Database data size'				=>	'Size: %s',
-
+'Server Statistics'					=>	'Server statistics',
+'Server Statistics data'			=>	'View server statistics',
 );
diff --git a/lang/English/admin_statistics.php b/lang/English/admin_statistics.php
new file mode 100644
index 0000000..80c11ec
--- /dev/null
+++ b/lang/English/admin_statistics.php
@@ -0,0 +1,33 @@
+<?php
+
+// Language definitions used in admin_statistics.php
+$lang_admin_statistics = array(
+
+'PHPinfo disabled message'			=>	'The PHP function phpinfo() has been disabled on this server.',
+'Not available'						=>	'Not available',
+'NA'								=>	'N/A',
+'Server head'						=>	'Server Statistics',
+'Server load label'					=>	'Server load',
+'Server load data'					=>	'%s - %s user(s) online',
+'Environment label'					=>	'Environment',
+'Environment data OS'				=>	'Operating system: %s',
+'Show info'							=>	'Show info',
+'Environment data version'			=>	'PHP: %s - %s',
+'Environment data acc'				=>	'Accelerator: %s',
+'Turck MMCache'						=>	'Turck MMCache',
+'Turck MMCache link'				=>	'turck-mmcache.sourceforge.net/',
+'ionCube PHP Accelerator'			=>	'ionCube PHP Accelerator',
+'ionCube PHP Accelerator link'		=>	'www.php-accelerator.co.uk/',
+'Alternative PHP Cache (APC)'		=>	'Alternative PHP Cache (APC)',
+'Alternative PHP Cache (APC) link'	=>	'www.php.net/apc/',
+'Zend Optimizer'					=>	'Zend Optimizer',
+'Zend Optimizer link'				=>	'www.zend.com/products/guard/zend-optimizer/',
+'eAccelerator'						=>	'eAccelerator',
+'eAccelerator link'					=>	'www.eaccelerator.net/',
+'XCache'							=>	'XCache',
+'XCache link'						=>	'xcache.lighttpd.net/',
+'Database label'					=>	'Database',
+'Database data rows'				=>	'Rows: %s',
+'Database data size'				=>	'Size: %s',
+
+);
-- 
1.7.10


From ffeec328b3e8ca1cef1f7428f42de9917aa007b6 Mon Sep 17 00:00:00 2001
From: Yannick Franssen <contact@studio384.be>
Date: Thu, 13 Sep 2012 18:13:26 +0200
Subject: [PATCH 39/75] #666: Merge admin_index and admin_statistics

---
 lang/English/admin_index.php      |   28 ++++++++++++++++++++++++++++
 lang/English/admin_statistics.php |   33 ---------------------------------
 2 files changed, 28 insertions(+), 33 deletions(-)
 delete mode 100644 lang/English/admin_statistics.php

diff --git a/lang/English/admin_index.php b/lang/English/admin_index.php
index b032340..37a23fe 100644
--- a/lang/English/admin_index.php
+++ b/lang/English/admin_index.php
@@ -26,4 +26,32 @@
 'FluxBB version data'				=>	'v%s - %s',
 'Server Statistics'					=>	'Server statistics',
 'Server Statistics data'			=>	'View server statistics',
+
+// Language definitions used in admin_statistics.php
+'PHPinfo disabled message'			=>	'The PHP function phpinfo() has been disabled on this server.',
+'Not available'						=>	'Not available',
+'NA'								=>	'N/A',
+'Server head'						=>	'Server Statistics',
+'Server load label'					=>	'Server load',
+'Server load data'					=>	'%s - %s user(s) online',
+'Environment label'					=>	'Environment',
+'Environment data OS'				=>	'Operating system: %s',
+'Show info'							=>	'Show info',
+'Environment data version'			=>	'PHP: %s - %s',
+'Environment data acc'				=>	'Accelerator: %s',
+'Turck MMCache'						=>	'Turck MMCache',
+'Turck MMCache link'				=>	'turck-mmcache.sourceforge.net/',
+'ionCube PHP Accelerator'			=>	'ionCube PHP Accelerator',
+'ionCube PHP Accelerator link'		=>	'www.php-accelerator.co.uk/',
+'Alternative PHP Cache (APC)'		=>	'Alternative PHP Cache (APC)',
+'Alternative PHP Cache (APC) link'	=>	'www.php.net/apc/',
+'Zend Optimizer'					=>	'Zend Optimizer',
+'Zend Optimizer link'				=>	'www.zend.com/products/guard/zend-optimizer/',
+'eAccelerator'						=>	'eAccelerator',
+'eAccelerator link'					=>	'www.eaccelerator.net/',
+'XCache'							=>	'XCache',
+'XCache link'						=>	'xcache.lighttpd.net/',
+'Database label'					=>	'Database',
+'Database data rows'				=>	'Rows: %s',
+'Database data size'				=>	'Size: %s',
 );
diff --git a/lang/English/admin_statistics.php b/lang/English/admin_statistics.php
deleted file mode 100644
index 80c11ec..0000000
--- a/lang/English/admin_statistics.php
+++ /dev/null
@@ -1,33 +0,0 @@
-<?php
-
-// Language definitions used in admin_statistics.php
-$lang_admin_statistics = array(
-
-'PHPinfo disabled message'			=>	'The PHP function phpinfo() has been disabled on this server.',
-'Not available'						=>	'Not available',
-'NA'								=>	'N/A',
-'Server head'						=>	'Server Statistics',
-'Server load label'					=>	'Server load',
-'Server load data'					=>	'%s - %s user(s) online',
-'Environment label'					=>	'Environment',
-'Environment data OS'				=>	'Operating system: %s',
-'Show info'							=>	'Show info',
-'Environment data version'			=>	'PHP: %s - %s',
-'Environment data acc'				=>	'Accelerator: %s',
-'Turck MMCache'						=>	'Turck MMCache',
-'Turck MMCache link'				=>	'turck-mmcache.sourceforge.net/',
-'ionCube PHP Accelerator'			=>	'ionCube PHP Accelerator',
-'ionCube PHP Accelerator link'		=>	'www.php-accelerator.co.uk/',
-'Alternative PHP Cache (APC)'		=>	'Alternative PHP Cache (APC)',
-'Alternative PHP Cache (APC) link'	=>	'www.php.net/apc/',
-'Zend Optimizer'					=>	'Zend Optimizer',
-'Zend Optimizer link'				=>	'www.zend.com/products/guard/zend-optimizer/',
-'eAccelerator'						=>	'eAccelerator',
-'eAccelerator link'					=>	'www.eaccelerator.net/',
-'XCache'							=>	'XCache',
-'XCache link'						=>	'xcache.lighttpd.net/',
-'Database label'					=>	'Database',
-'Database data rows'				=>	'Rows: %s',
-'Database data size'				=>	'Size: %s',
-
-);
-- 
1.7.10


From 9d96abb420ea55914fd51ab1633444e698d1646b Mon Sep 17 00:00:00 2001
From: Franz Liedke <franz@develophp.org>
Date: Thu, 13 Sep 2012 23:44:30 +0200
Subject: [PATCH 40/75] #666: Fix included language file in
 admin_statistics.php.

---
 admin_statistics.php         |   44 +++++++++++++++++++++---------------------
 lang/English/admin_index.php |    2 --
 2 files changed, 22 insertions(+), 24 deletions(-)

diff --git a/admin_statistics.php b/admin_statistics.php
index 8d9d890..ce857e9 100644
--- a/admin_statistics.php
+++ b/admin_statistics.php
@@ -17,8 +17,8 @@
 if (!$pun_user['is_admmod'])
 	message($lang_common['No permission'], false, '403 Forbidden');
 
-// Load the admin_statistics.php language file
-require PUN_ROOT.'lang/'.$admin_language.'/admin_statistics.php';
+// Load the admin_index.php language file
+require PUN_ROOT.'lang/'.$admin_language.'/admin_index.php';
 
 $action = isset($_GET['action']) ? $_GET['action'] : null;
 
@@ -28,7 +28,7 @@
 {
 	// Is phpinfo() a disabled function?
 	if (strpos(strtolower((string) ini_get('disable_functions')), 'phpinfo') !== false)
-		message($lang_admin_statistics['PHPinfo disabled message']);
+		message($lang_admin_index['PHPinfo disabled message']);
 
 	phpinfo();
 	exit;
@@ -52,12 +52,12 @@
 		$load_averages = '';
 
 	$load_averages = @explode(' ', $load_averages);
-	$server_load = isset($load_averages[2]) ? $load_averages[0].' '.$load_averages[1].' '.$load_averages[2] : $lang_admin_statistics['Not available'];
+	$server_load = isset($load_averages[2]) ? $load_averages[0].' '.$load_averages[1].' '.$load_averages[2] : $lang_admin_index['Not available'];
 }
 else if (!in_array(PHP_OS, array('WINNT', 'WIN32')) && preg_match('%averages?: ([0-9\.]+),?\s+([0-9\.]+),?\s+([0-9\.]+)%i', @exec('uptime'), $load_averages))
 	$server_load = $load_averages[1].' '.$load_averages[2].' '.$load_averages[3];
 else
-	$server_load = $lang_admin_statistics['Not available'];
+	$server_load = $lang_admin_index['Not available'];
 
 
 // Get number of current visitors
@@ -84,19 +84,19 @@
 
 // Check for the existence of various PHP opcode caches/optimizers
 if (function_exists('mmcache'))
-	$php_accelerator = '<a href="http://'.$lang_admin_statistics['Turck MMCache link'].'">'.$lang_admin_statistics['Turck MMCache'].'</a>';
+	$php_accelerator = '<a href="http://'.$lang_admin_index['Turck MMCache link'].'">'.$lang_admin_index['Turck MMCache'].'</a>';
 else if (isset($_PHPA))
-	$php_accelerator = '<a href="http://'.$lang_admin_statistics['ionCube PHP Accelerator link'].'">'.$lang_admin_statistics['ionCube PHP Accelerator'].'</a>';
+	$php_accelerator = '<a href="http://'.$lang_admin_index['ionCube PHP Accelerator link'].'">'.$lang_admin_index['ionCube PHP Accelerator'].'</a>';
 else if (ini_get('apc.enabled'))
-	$php_accelerator ='<a href="http://'.$lang_admin_statistics['Alternative PHP Cache (APC) link'].'">'.$lang_admin_statistics['Alternative PHP Cache (APC)'].'</a>';
+	$php_accelerator ='<a href="http://'.$lang_admin_index['Alternative PHP Cache (APC) link'].'">'.$lang_admin_index['Alternative PHP Cache (APC)'].'</a>';
 else if (ini_get('zend_optimizer.optimization_level'))
-	$php_accelerator = '<a href="http://'.$lang_admin_statistics['Zend Optimizer link'].'">'.$lang_admin_statistics['Zend Optimizer'].'</a>';
+	$php_accelerator = '<a href="http://'.$lang_admin_index['Zend Optimizer link'].'">'.$lang_admin_index['Zend Optimizer'].'</a>';
 else if (ini_get('eaccelerator.enable'))
-	$php_accelerator = '<a href="http://'.$lang_admin_statistics['eAccelerator link'].'">'.$lang_admin_statistics['eAccelerator'].'</a>';
+	$php_accelerator = '<a href="http://'.$lang_admin_index['eAccelerator link'].'">'.$lang_admin_index['eAccelerator'].'</a>';
 else if (ini_get('xcache.cacher'))
-	$php_accelerator = '<a href="http://'.$lang_admin_statistics['XCache link'].'">'.$lang_admin_statistics['XCache'].'</a>';
+	$php_accelerator = '<a href="http://'.$lang_admin_index['XCache link'].'">'.$lang_admin_index['XCache'].'</a>';
 else
-	$php_accelerator = $lang_admin_statistics['NA'];
+	$php_accelerator = $lang_admin_index['NA'];
 	
 // Collect some statistics from the database
 if (file_exists(FORUM_CACHE_DIR.'cache_users_info.php'))
@@ -141,25 +141,25 @@
 
 ?>
 	<div class="block">
-		<h2><span><?php echo $lang_admin_statistics['Server head'] ?></span></h2>
+		<h2><span><?php echo $lang_admin_index['Server head'] ?></span></h2>
 		<div id="adstats" class="box">
 			<div class="inbox">
 				<dl>
-					<dt><?php echo $lang_admin_statistics['Server load label'] ?></dt>
+					<dt><?php echo $lang_admin_index['Server load label'] ?></dt>
 					<dd>
-						<?php printf($lang_admin_statistics['Server load data']."\n", $server_load, $num_online) ?>
+						<?php printf($lang_admin_index['Server load data']."\n", $server_load, $num_online) ?>
 					</dd>
-<?php if ($pun_user['g_id'] == PUN_ADMIN): ?>					<dt><?php echo $lang_admin_statistics['Environment label'] ?></dt>
+<?php if ($pun_user['g_id'] == PUN_ADMIN): ?>					<dt><?php echo $lang_admin_index['Environment label'] ?></dt>
 					<dd>
-						<?php printf($lang_admin_statistics['Environment data OS'], PHP_OS) ?><br />
-						<?php printf($lang_admin_statistics['Environment data version'], phpversion(), '<a href="admin_index.php?action=phpinfo">'.$lang_admin_statistics['Show info'].'</a>') ?><br />
-						<?php printf($lang_admin_statistics['Environment data acc']."\n", $php_accelerator) ?>
+						<?php printf($lang_admin_index['Environment data OS'], PHP_OS) ?><br />
+						<?php printf($lang_admin_index['Environment data version'], phpversion(), '<a href="admin_index.php?action=phpinfo">'.$lang_admin_index['Show info'].'</a>') ?><br />
+						<?php printf($lang_admin_index['Environment data acc']."\n", $php_accelerator) ?>
 					</dd>
-					<dt><?php echo $lang_admin_statistics['Database label'] ?></dt>
+					<dt><?php echo $lang_admin_index['Database label'] ?></dt>
 					<dd>
 						<?php echo implode(' ', $db->get_version())."\n" ?>
-<?php if (isset($total_records) && isset($total_size)): ?>						<br /><?php printf($lang_admin_statistics['Database data rows']."\n", forum_number_format($total_records)) ?>
-						<br /><?php printf($lang_admin_statistics['Database data size']."\n", $total_size) ?>
+<?php if (isset($total_records) && isset($total_size)): ?>						<br /><?php printf($lang_admin_index['Database data rows']."\n", forum_number_format($total_records)) ?>
+						<br /><?php printf($lang_admin_index['Database data size']."\n", $total_size) ?>
 <?php endif; ?>					</dd>
 <?php endif; ?>
 				</dl>
diff --git a/lang/English/admin_index.php b/lang/English/admin_index.php
index 37a23fe..61daca0 100644
--- a/lang/English/admin_index.php
+++ b/lang/English/admin_index.php
@@ -29,8 +29,6 @@
 
 // Language definitions used in admin_statistics.php
 'PHPinfo disabled message'			=>	'The PHP function phpinfo() has been disabled on this server.',
-'Not available'						=>	'Not available',
-'NA'								=>	'N/A',
 'Server head'						=>	'Server Statistics',
 'Server load label'					=>	'Server load',
 'Server load data'					=>	'%s - %s user(s) online',
-- 
1.7.10


From 641f210106232e335e68bcecaf4d0906886d9b18 Mon Sep 17 00:00:00 2001
From: JohnFLewis <johnlewis93@gmail.com>
Date: Fri, 14 Sep 2012 00:00:23 +0200
Subject: [PATCH 41/75] #710: Determine correct hostname when sending mails
 via SMTP.

Patch suggested by Mr. Anderson, thanks.
This merges pull request #49.
---
 include/email.php |   15 ++++++++++++++-
 1 file changed, 14 insertions(+), 1 deletion(-)

diff --git a/include/email.php b/include/email.php
index 20354b7..6cfe9d3 100644
--- a/include/email.php
+++ b/include/email.php
@@ -309,7 +309,20 @@ function smtp_mail($to, $subject, $message, $headers = '')
 
 	if ($pun_config['o_smtp_user'] != '' && $pun_config['o_smtp_pass'] != '')
 	{
-		fwrite($socket, 'EHLO '.$smtp_host."\r\n");
+		// Here we try to determine the *real* hostname (reverse DNS entry preferrably)
+		$local_host = php_uname('n');
+
+		// Able to resolve name to IP
+		if (($local_addr = @gethostbyname($local_host)) !== $local_host)
+		{
+			// Able to resolve IP back to name
+			if (($local_name = @gethostbyaddr($local_addr)) !== $local_addr)
+			{
+				$local_host = $local_name;
+			}
+		}
+
+		fwrite($socket, 'EHLO '.$local_host."\r\n");
 		server_parse($socket, '250');
 
 		fwrite($socket, 'AUTH LOGIN'."\r\n");
-- 
1.7.10


From 710027dc6249add4cd728a9c594d85a152146db8 Mon Sep 17 00:00:00 2001
From: Quy Ton <quy@fluxbb.org>
Date: Sun, 23 Sep 2012 19:59:41 -0700
Subject: [PATCH 42/75] #666: Added/changed language strings. Fixed link to
 phpinfo.

---
 admin_index.php               |    4 ++--
 admin_statistics.php          |    8 ++++----
 lang/English/admin_common.php |    1 +
 lang/English/admin_index.php  |    6 +++---
 4 files changed, 10 insertions(+), 9 deletions(-)

diff --git a/admin_index.php b/admin_index.php
index f7c8529..6862f7d 100644
--- a/admin_index.php
+++ b/admin_index.php
@@ -72,9 +72,9 @@
 					<dd>
 						<?php printf($lang_admin_index['FluxBB version data']."\n", $pun_config['o_cur_version'], '<a href="admin_index.php?action=check_upgrade">'.$lang_admin_index['Check for upgrade'].'</a>') ?>
 					</dd>
-					<dt><?php echo $lang_admin_index['Server Statistics'] ?></dt>
+					<dt><?php echo $lang_admin_index['Server statistics label'] ?></dt>
 					<dd>
-						<a href="admin_statistics.php" title="<?php $lang_admin_index['Server Statistics data'] ?>"><?php echo $lang_admin_index['Server Statistics data'] ?></a>
+						<a href="admin_statistics.php"><?php echo $lang_admin_index['View server statistics'] ?></a>
 					</dd>
 				</dl>
 			</div>
diff --git a/admin_statistics.php b/admin_statistics.php
index ce857e9..922e967 100644
--- a/admin_statistics.php
+++ b/admin_statistics.php
@@ -133,15 +133,15 @@
 }
 
 
-$page_title = array(pun_htmlspecialchars($pun_config['o_board_title']), $lang_admin_common['Admin'], $lang_admin_common['Statistics']);
+$page_title = array(pun_htmlspecialchars($pun_config['o_board_title']), $lang_admin_common['Admin'], $lang_admin_common['Server statistics']);
 define('PUN_ACTIVE_PAGE', 'admin');
 require PUN_ROOT.'header.php';
 
-generate_admin_menu('statistics');
+generate_admin_menu('index');
 
 ?>
 	<div class="block">
-		<h2><span><?php echo $lang_admin_index['Server head'] ?></span></h2>
+		<h2><span><?php echo $lang_admin_index['Server statistics head'] ?></span></h2>
 		<div id="adstats" class="box">
 			<div class="inbox">
 				<dl>
@@ -152,7 +152,7 @@
 <?php if ($pun_user['g_id'] == PUN_ADMIN): ?>					<dt><?php echo $lang_admin_index['Environment label'] ?></dt>
 					<dd>
 						<?php printf($lang_admin_index['Environment data OS'], PHP_OS) ?><br />
-						<?php printf($lang_admin_index['Environment data version'], phpversion(), '<a href="admin_index.php?action=phpinfo">'.$lang_admin_index['Show info'].'</a>') ?><br />
+						<?php printf($lang_admin_index['Environment data version'], phpversion(), '<a href="admin_statistics.php?action=phpinfo">'.$lang_admin_index['Show info'].'</a>') ?><br />
 						<?php printf($lang_admin_index['Environment data acc']."\n", $php_accelerator) ?>
 					</dd>
 					<dt><?php echo $lang_admin_index['Database label'] ?></dt>
diff --git a/lang/English/admin_common.php b/lang/English/admin_common.php
index 826cd35..8f2bd3a 100644
--- a/lang/English/admin_common.php
+++ b/lang/English/admin_common.php
@@ -19,6 +19,7 @@
 'Prune'					=>	'Prune',
 'Maintenance'			=>	'Maintenance',
 'Reports'				=>	'Reports',
+'Server statistics'				=>	'Server statistics',
 
 'Admin'					=>	'Admin',
 'Go back'				=>	'Go back',
diff --git a/lang/English/admin_index.php b/lang/English/admin_index.php
index 61daca0..9172231 100644
--- a/lang/English/admin_index.php
+++ b/lang/English/admin_index.php
@@ -24,12 +24,12 @@
 'FluxBB version label'				=>	'FluxBB version',
 'Check for upgrade'					=>	'Check for upgrade',
 'FluxBB version data'				=>	'v%s - %s',
-'Server Statistics'					=>	'Server statistics',
-'Server Statistics data'			=>	'View server statistics',
+'Server statistics label'					=>	'Server statistics',
+'View server statistics'			=>	'View server statistics',
 
 // Language definitions used in admin_statistics.php
 'PHPinfo disabled message'			=>	'The PHP function phpinfo() has been disabled on this server.',
-'Server head'						=>	'Server Statistics',
+'Server statistics head'						=>	'Server statistics',
 'Server load label'					=>	'Server load',
 'Server load data'					=>	'%s - %s user(s) online',
 'Environment label'					=>	'Environment',
-- 
1.7.10


From 8f68cfc0c8a0d776394b8cbbe30711107231b913 Mon Sep 17 00:00:00 2001
From: Quy Ton <quy@fluxbb.org>
Date: Mon, 24 Sep 2012 15:08:05 -0700
Subject: [PATCH 43/75] #666: Removed extraneous code

---
 admin_statistics.php |   34 ----------------------------------
 1 file changed, 34 deletions(-)

diff --git a/admin_statistics.php b/admin_statistics.php
index 922e967..901e14c 100644
--- a/admin_statistics.php
+++ b/admin_statistics.php
@@ -97,40 +97,6 @@
 	$php_accelerator = '<a href="http://'.$lang_admin_index['XCache link'].'">'.$lang_admin_index['XCache'].'</a>';
 else
 	$php_accelerator = $lang_admin_index['NA'];
-	
-// Collect some statistics from the database
-if (file_exists(FORUM_CACHE_DIR.'cache_users_info.php'))
-	include FORUM_CACHE_DIR.'cache_users_info.php';
-
-if (!defined('PUN_USERS_INFO_LOADED'))
-{
-	if (!defined('FORUM_CACHE_FUNCTIONS_LOADED'))
-		require PUN_ROOT.'include/cache.php';
-
-	generate_users_info_cache();
-	require FORUM_CACHE_DIR.'cache_users_info.php';
-}
-
-$result = $db->query('SELECT SUM(num_topics), SUM(num_posts) FROM '.$db->prefix.'forums') or error('Unable to fetch topic/post count', __FILE__, __LINE__, $db->error());
-list($stats['total_topics'], $stats['total_posts']) = $db->fetch_row($result);
-
-if ($pun_user['g_view_users'] == '1')
-	$stats['newest_user'] = '<a href="profile.php?id='.$stats['last_user']['id'].'">'.pun_htmlspecialchars($stats['last_user']['username']).'</a>';
-else
-	$stats['newest_user'] = pun_htmlspecialchars($stats['last_user']['username']);
-
-if (!empty($forum_actions))
-{
-
-?>
-<div class="linksb">
-	<div class="inbox crumbsplus">
-		<p class="subscribelink clearb"><?php echo implode(' - ', $forum_actions); ?></p>
-	</div>
-</div>
-<?php
-
-}
 
 
 $page_title = array(pun_htmlspecialchars($pun_config['o_board_title']), $lang_admin_common['Admin'], $lang_admin_common['Server statistics']);
-- 
1.7.10


From 7128740e38f54014078a7b649fc47c5bd1ea892b Mon Sep 17 00:00:00 2001
From: Quy Ton <quy@fluxbb.org>
Date: Mon, 24 Sep 2012 17:03:14 -0700
Subject: [PATCH 44/75] #742: Removed duplicate attribute in profile.php

---
 profile.php |    2 +-
 1 file changed, 1 insertion(+), 1 deletion(-)

diff --git a/profile.php b/profile.php
index 40bf420..8639352 100644
--- a/profile.php
+++ b/profile.php
@@ -288,7 +288,7 @@
 <div class="blockform">
 	<h2><span><?php echo $lang_profile['Change email'] ?></span></h2>
 	<div class="box">
-		<form id="change_email" method="post" action="profile.php?action=change_email&amp;id=<?php echo $id ?>" id="change_email" onsubmit="return process_form(this)">
+		<form id="change_email" method="post" action="profile.php?action=change_email&amp;id=<?php echo $id ?>" onsubmit="return process_form(this)">
 			<div class="inform">
 				<fieldset>
 					<legend><?php echo $lang_profile['Email legend'] ?></legend>
-- 
1.7.10


From 8778373690d1a306cc865e7e93bee0a9d22da8c8 Mon Sep 17 00:00:00 2001
From: Quy Ton <quy@fluxbb.org>
Date: Mon, 24 Sep 2012 20:03:37 -0700
Subject: [PATCH 45/75] #737: Fixed updating profile info of unverified users

---
 profile.php |    2 +-
 1 file changed, 1 insertion(+), 1 deletion(-)

diff --git a/profile.php b/profile.php
index 8639352..9f62c27 100644
--- a/profile.php
+++ b/profile.php
@@ -677,7 +677,7 @@
 else if (isset($_POST['form_sent']))
 {
 	// Fetch the user group of the user we are editing
-	$result = $db->query('SELECT u.username, u.group_id, g.g_moderator FROM '.$db->prefix.'users AS u INNER JOIN '.$db->prefix.'groups AS g ON (g.g_id=u.group_id) WHERE u.id='.$id) or error('Unable to fetch user info', __FILE__, __LINE__, $db->error());
+	$result = $db->query('SELECT u.username, u.group_id, g.g_moderator FROM '.$db->prefix.'users AS u LEFT JOIN '.$db->prefix.'groups AS g ON (g.g_id=u.group_id) WHERE u.id='.$id) or error('Unable to fetch user info', __FILE__, __LINE__, $db->error());
 	if (!$db->num_rows($result))
 		message($lang_common['Bad request'], false, '404 Not Found');
 
-- 
1.7.10


From 2f04b685149c0efca2beb35731790d48fcb5a8fd Mon Sep 17 00:00:00 2001
From: Quy Ton <quy@fluxbb.org>
Date: Thu, 27 Sep 2012 19:23:41 -0700
Subject: [PATCH 46/75] #729: Hide "Stick topic" option when posting a new
 reply.

---
 post.php |    2 +-
 1 file changed, 1 insertion(+), 1 deletion(-)

diff --git a/post.php b/post.php
index 1c407e6..6cd0542 100644
--- a/post.php
+++ b/post.php
@@ -647,7 +647,7 @@
 <?php
 
 $checkboxes = array();
-if ($is_admmod)
+if ($fid && $is_admmod)
 	$checkboxes[] = '<label><input type="checkbox" name="stick_topic" value="1" tabindex="'.($cur_index++).'"'.(isset($_POST['stick_topic']) ? ' checked="checked"' : '').' />'.$lang_common['Stick topic'].'<br /></label>';
 
 if (!$pun_user['is_guest'])
-- 
1.7.10


From 5f0e25685829ba1cfe205f64351e7f9c5a72dcc7 Mon Sep 17 00:00:00 2001
From: Quy Ton <quy@fluxbb.org>
Date: Mon, 1 Oct 2012 17:34:46 -0700
Subject: [PATCH 47/75] #738: Optimized code to remove a query inside a loop
 in admin_users.php

---
 admin_users.php |   35 ++++++++++++++++++++++-------------
 1 file changed, 22 insertions(+), 13 deletions(-)

diff --git a/admin_users.php b/admin_users.php
index bfe8e09..ec9607e 100644
--- a/admin_users.php
+++ b/admin_users.php
@@ -178,31 +178,40 @@
 			<tbody>
 <?php
 
-	$result = $db->query('SELECT DISTINCT poster_id, poster FROM '.$db->prefix.'posts WHERE poster_ip=\''.$db->escape($ip).'\' ORDER BY poster DESC') or error('Unable to fetch post info', __FILE__, __LINE__, $db->error());
+	$result = $db->query('SELECT DISTINCT poster_id, poster FROM '.$db->prefix.'posts WHERE poster_ip=\''.$db->escape($ip).'\' ORDER BY poster ASC LIMIT '.$start_from.', 50') or error('Unable to fetch post info', __FILE__, __LINE__, $db->error());
 	$num_posts = $db->num_rows($result);
 
 	if ($num_posts)
 	{
-		// Loop through users and print out some info
-		for ($i = 0; $i < $num_posts; ++$i)
+		$posters = $poster_ids = array();
+		while ($cur_poster = $db->fetch_assoc($result))
 		{
-			list($poster_id, $poster) = $db->fetch_row($result);
+			$posters[] = $cur_poster;
+			$poster_ids[] = $cur_poster['poster_id'];
+		}
 
-			$result2 = $db->query('SELECT u.id, u.username, u.email, u.title, u.num_posts, u.admin_note, g.g_id, g.g_user_title FROM '.$db->prefix.'users AS u INNER JOIN '.$db->prefix.'groups AS g ON g.g_id=u.group_id WHERE u.id>1 AND u.id='.$poster_id) or error('Unable to fetch user info', __FILE__, __LINE__, $db->error());
+		$result = $db->query('SELECT u.id, u.username, u.email, u.title, u.num_posts, u.admin_note, g.g_id, g.g_user_title FROM '.$db->prefix.'users AS u INNER JOIN '.$db->prefix.'groups AS g ON g.g_id=u.group_id WHERE u.id>1 AND u.id IN('.implode(',', $poster_ids).')') or error('Unable to fetch user info', __FILE__, __LINE__, $db->error());
 
-			if (($user_data = $db->fetch_assoc($result2)))
+		$user_data = array();
+		while ($cur_user = $db->fetch_assoc($result))
+			$user_data[$cur_user['id']] = $cur_user;
+
+		// Loop through users and print out some info
+		foreach ($posters as $cur_poster)
+		{
+			if (isset($user_data[$cur_poster['poster_id']]))
 			{
-				$user_title = get_title($user_data);
+				$user_title = get_title($user_data[$cur_poster['poster_id']]);
 
-				$actions = '<a href="admin_users.php?ip_stats='.$user_data['id'].'">'.$lang_admin_users['Results view IP link'].'</a> | <a href="search.php?action=show_user_posts&amp;user_id='.$user_data['id'].'">'.$lang_admin_users['Results show posts link'].'</a>';
+				$actions = '<a href="admin_users.php?ip_stats='.$user_data[$cur_poster['poster_id']]['id'].'">'.$lang_admin_users['Results view IP link'].'</a> | <a href="search.php?action=show_user_posts&amp;user_id='.$user_data[$cur_poster['poster_id']]['id'].'">'.$lang_admin_users['Results show posts link'].'</a>';
 
 ?>
 				<tr>
-					<td class="tcl"><?php echo '<a href="profile.php?id='.$user_data['id'].'">'.pun_htmlspecialchars($user_data['username']).'</a>' ?></td>
-					<td class="tc2"><a href="mailto:<?php echo $user_data['email'] ?>"><?php echo $user_data['email'] ?></a></td>
+					<td class="tcl"><?php echo '<a href="profile.php?id='.$user_data[$cur_poster['poster_id']]['id'].'">'.pun_htmlspecialchars($user_data[$cur_poster['poster_id']]['username']).'</a>' ?></td>
+					<td class="tc2"><a href="mailto:<?php echo $user_data[$cur_poster['poster_id']]['email'] ?>"><?php echo $user_data[$cur_poster['poster_id']]['email'] ?></a></td>
 					<td class="tc3"><?php echo $user_title ?></td>
-					<td class="tc4"><?php echo forum_number_format($user_data['num_posts']) ?></td>
-					<td class="tc5"><?php echo ($user_data['admin_note'] != '') ? pun_htmlspecialchars($user_data['admin_note']) : '&#160;' ?></td>
+					<td class="tc4"><?php echo forum_number_format($user_data[$cur_poster['poster_id']]['num_posts']) ?></td>
+					<td class="tc5"><?php echo ($user_data[$cur_poster['poster_id']]['admin_note'] != '') ? pun_htmlspecialchars($user_data[$cur_poster['poster_id']]['admin_note']) : '&#160;' ?></td>
 					<td class="tcr"><?php echo $actions ?></td>
 				</tr>
 <?php
@@ -213,7 +222,7 @@
 
 ?>
 				<tr>
-					<td class="tcl"><?php echo pun_htmlspecialchars($poster) ?></td>
+					<td class="tcl"><?php echo pun_htmlspecialchars($cur_poster['poster']) ?></td>
 					<td class="tc2">&#160;</td>
 					<td class="tc3"><?php echo $lang_admin_users['Results guest'] ?></td>
 					<td class="tc4">&#160;</td>
-- 
1.7.10


From 13a5e20693a8b3bdaafd81ae4ce973303c4ae461 Mon Sep 17 00:00:00 2001
From: Quy Ton <quy@fluxbb.org>
Date: Tue, 2 Oct 2012 10:34:53 -0700
Subject: [PATCH 48/75] #719: Fixed markup for checkboxes in search.php. Patch
 provided by Paul.

---
 search.php           |    9 +++++++--
 style/Air.css        |   22 ----------------------
 style/Cobalt.css     |   23 -----------------------
 style/Earth.css      |   22 ----------------------
 style/Fire.css       |   22 ----------------------
 style/Lithium.css    |   23 -----------------------
 style/Mercury.css    |   23 -----------------------
 style/Oxygen.css     |   23 -----------------------
 style/Radium.css     |   23 -----------------------
 style/Sulfur.css     |   23 -----------------------
 style/Technetium.css |   22 ----------------------
 11 files changed, 7 insertions(+), 228 deletions(-)

diff --git a/search.php b/search.php
index 0133411..fee1aec 100644
--- a/search.php
+++ b/search.php
@@ -815,15 +815,20 @@
 		if ($cur_forum['cid'] != $cur_category) // A new category since last iteration?
 		{
 			if ($cur_category)
+			{
+				echo "\t\t\t\t\t\t\t\t".'</div>'."\n";
 				echo "\t\t\t\t\t\t\t".'</fieldset>'."\n";
-
+			}
+			
 			echo "\t\t\t\t\t\t\t".'<fieldset><legend><span>'.pun_htmlspecialchars($cur_forum['cat_name']).'</span></legend>'."\n";
+			echo "\t\t\t\t\t\t\t\t".'<div class="rbox">';
 			$cur_category = $cur_forum['cid'];
 		}
 
-		echo "\t\t\t\t\t\t\t\t".'<div class="checklist-item"><span class="fld-input"><input type="checkbox" name="forums[]" id="forum-'.$cur_forum['fid'].'" value="'.$cur_forum['fid'].'" /></span> <label for="forum-'.$cur_forum['fid'].'">'.pun_htmlspecialchars($cur_forum['forum_name']).'</label></div>'."\n";
+		echo "\t\t\t\t\t\t\t\t".'<label><input type="checkbox" name="forums[]" id="forum-'.$cur_forum['fid'].'" value="'.$cur_forum['fid'].'" />'.pun_htmlspecialchars($cur_forum['forum_name']).'</label>'."\n";
 	}
 
+	echo "\t\t\t\t\t\t\t\t".'</div>'."\n";
 	echo "\t\t\t\t\t\t\t".'</fieldset>'."\n";
 	echo "\t\t\t\t\t\t".'</div>'."\n";
 	echo "\t\t\t\t\t\t".'</div>'."\n";
diff --git a/style/Air.css b/style/Air.css
index 7659059..8500689 100644
--- a/style/Air.css
+++ b/style/Air.css
@@ -1304,28 +1304,6 @@ MAIN FORMS
 	max-width: 25em;
 }
 
-.pun .checklist .checklist-item {
-	position: relative;
-}
-
-.pun .checklist .checklist-item label {
-	padding: 0 0 0 1.75em;
-}
-
-.pun .checklist .checklist-item .fld-input {
-	position: absolute;
-	left: 0;
-	top: 0;
-	padding: 0;
-	margin: 0;
-}
-
-.pun .checklist .checklist-item input {
-	margin: 0;
-	height: 1.55em;
-	width: 1.55em;
-}
-
 /*****************************************************************
 PROFILES (+ ADMIN MENU)
 *****************************************************************/
diff --git a/style/Cobalt.css b/style/Cobalt.css
index 6698bff..c473fd8 100644
--- a/style/Cobalt.css
+++ b/style/Cobalt.css
@@ -689,29 +689,6 @@ html, body {
 	max-width: 25em;
 	}
 
-.pun .checklist .checklist-item {
-	position: relative;
-	margin: .2em 0;
-	}
-
-.pun .checklist .checklist-item label {
-	padding: 0 0 0 2.1em;
-	}
-
-.pun .checklist .checklist-item .fld-input {
-	position: absolute;
-	left: 0;
-	top: 0;
-	padding: 0;
-	margin: 0;
-	}
-
-.pun .checklist .checklist-item input {
-	margin: 0;
-	height: 1.15em;
-	width: 1.55em;
-	}
-
 /*****************************************************************
 7. PROFILES AND ADMIN
 *****************************************************************/
diff --git a/style/Earth.css b/style/Earth.css
index 540f999..cd89f58 100644
--- a/style/Earth.css
+++ b/style/Earth.css
@@ -1303,28 +1303,6 @@ MAIN FORMS
 	max-width: 25em;
 }
 
-.pun .checklist .checklist-item {
-	position: relative;
-}
-
-.pun .checklist .checklist-item label {
-	padding: 0 0 0 1.75em;
-}
-
-.pun .checklist .checklist-item .fld-input {
-	position: absolute;
-	left: 0;
-	top: 0;
-	padding: 0;
-	margin: 0;
-}
-
-.pun .checklist .checklist-item input {
-	margin: 0;
-	height: 1.55em;
-	width: 1.55em;
-}
-
 /*****************************************************************
 PROFILES (+ ADMIN MENU)
 *****************************************************************/
diff --git a/style/Fire.css b/style/Fire.css
index 51de44d..0eb08f4 100644
--- a/style/Fire.css
+++ b/style/Fire.css
@@ -1303,28 +1303,6 @@ MAIN FORMS
 	max-width: 25em;
 }
 
-.pun .checklist .checklist-item {
-	position: relative;
-}
-
-.pun .checklist .checklist-item label {
-	padding: 0 0 0 1.75em;
-}
-
-.pun .checklist .checklist-item .fld-input {
-	position: absolute;
-	left: 0;
-	top: 0;
-	padding: 0;
-	margin: 0;
-}
-
-.pun .checklist .checklist-item input {
-	margin: 0;
-	height: 1.55em;
-	width: 1.55em;
-}
-
 /*****************************************************************
 PROFILES (+ ADMIN MENU)
 *****************************************************************/
diff --git a/style/Lithium.css b/style/Lithium.css
index 01c6082..d3c4c6e 100644
--- a/style/Lithium.css
+++ b/style/Lithium.css
@@ -689,29 +689,6 @@ html, body {
 	max-width: 25em;
 	}
 
-.pun .checklist .checklist-item {
-	position: relative;
-	margin: .2em 0;
-	}
-
-.pun .checklist .checklist-item label {
-	padding: 0 0 0 2.1em;
-	}
-
-.pun .checklist .checklist-item .fld-input {
-	position: absolute;
-	left: 0;
-	top: 0;
-	padding: 0;
-	margin: 0;
-	}
-
-.pun .checklist .checklist-item input {
-	margin: 0;
-	height: 1.15em;
-	width: 1.55em;
-	}
-
 /*****************************************************************
 7. PROFILES AND ADMIN
 *****************************************************************/
diff --git a/style/Mercury.css b/style/Mercury.css
index cffebb1..c63e668 100644
--- a/style/Mercury.css
+++ b/style/Mercury.css
@@ -689,29 +689,6 @@ html, body {
 	max-width: 25em;
 	}
 
-.pun .checklist .checklist-item {
-	position: relative;
-	margin: .2em 0;
-	}
-
-.pun .checklist .checklist-item label {
-	padding: 0 0 0 2.1em;
-	}
-
-.pun .checklist .checklist-item .fld-input {
-	position: absolute;
-	left: 0;
-	top: 0;
-	padding: 0;
-	margin: 0;
-	}
-
-.pun .checklist .checklist-item input {
-	margin: 0;
-	height: 1.15em;
-	width: 1.55em;
-	}
-
 /*****************************************************************
 7. PROFILES AND ADMIN
 *****************************************************************/
diff --git a/style/Oxygen.css b/style/Oxygen.css
index 4705bfb..51a8d17 100644
--- a/style/Oxygen.css
+++ b/style/Oxygen.css
@@ -690,29 +690,6 @@ html, body {
 	max-width: 25em;
 	}
 
-.pun .checklist .checklist-item {
-	position: relative;
-	margin: .2em 0;
-	}
-
-.pun .checklist .checklist-item label {
-	padding: 0 0 0 2.1em;
-	}
-
-.pun .checklist .checklist-item .fld-input {
-	position: absolute;
-	left: 0;
-	top: 0;
-	padding: 0;
-	margin: 0;
-	}
-
-.pun .checklist .checklist-item input {
-	margin: 0;
-	height: 1.15em;
-	width: 1.55em;
-	}
-
 /*****************************************************************
 7. PROFILES AND ADMIN
 *****************************************************************/
diff --git a/style/Radium.css b/style/Radium.css
index 8b43a10..4c74e28 100644
--- a/style/Radium.css
+++ b/style/Radium.css
@@ -689,29 +689,6 @@ html, body {
 	max-width: 25em;
 	}
 
-.pun .checklist .checklist-item {
-	position: relative;
-	margin: .2em 0;
-	}
-
-.pun .checklist .checklist-item label {
-	padding: 0 0 0 2.1em;
-	}
-
-.pun .checklist .checklist-item .fld-input {
-	position: absolute;
-	left: 0;
-	top: 0;
-	padding: 0;
-	margin: 0;
-	}
-
-.pun .checklist .checklist-item input {
-	margin: 0;
-	height: 1.15em;
-	width: 1.55em;
-	}
-
 /*****************************************************************
 7. PROFILES AND ADMIN
 *****************************************************************/
diff --git a/style/Sulfur.css b/style/Sulfur.css
index b275248..88d0fbe 100644
--- a/style/Sulfur.css
+++ b/style/Sulfur.css
@@ -689,29 +689,6 @@ html, body {
 	max-width: 25em;
 	}
 
-.pun .checklist .checklist-item {
-	position: relative;
-	margin: .2em 0;
-	}
-
-.pun .checklist .checklist-item label {
-	padding: 0 0 0 2.1em;
-	}
-
-.pun .checklist .checklist-item .fld-input {
-	position: absolute;
-	left: 0;
-	top: 0;
-	padding: 0;
-	margin: 0;
-	}
-
-.pun .checklist .checklist-item input {
-	margin: 0;
-	height: 1.15em;
-	width: 1.55em;
-	}
-
 /*****************************************************************
 7. PROFILES AND ADMIN
 *****************************************************************/
diff --git a/style/Technetium.css b/style/Technetium.css
index d8fd7be..4071641 100644
--- a/style/Technetium.css
+++ b/style/Technetium.css
@@ -803,28 +803,6 @@ body {
 	max-width: 25em;
 	}
 
-.pun .checklist .checklist-item {
-	position: relative;
-	}
-
-.pun .checklist .checklist-item label {
-	padding: 0 0 0 1.75em;
-	}
-
-.pun .checklist .checklist-item .fld-input {
-	position: absolute;
-	left: 0;
-	top: 0;
-	padding: 0;
-	margin: 0;
-	}
-
-.pun .checklist .checklist-item input {
-	margin: 0;
-	height: 1.55em;
-	width: 1.55em;
-	}
-
 /*****************************************************************
 7. PROFILES AND ADMIN
 *****************************************************************/
-- 
1.7.10


From 417964374d228786305887351df77a9c03656f89 Mon Sep 17 00:00:00 2001
From: Quy Ton <quy@fluxbb.org>
Date: Fri, 5 Oct 2012 19:56:59 -0700
Subject: [PATCH 49/75] #717: Applied clearb class to help text.

---
 admin_groups.php      |   34 +++++++++++++++++-----------------
 admin_maintenance.php |    4 ++--
 admin_permissions.php |   24 ++++++++++++------------
 3 files changed, 31 insertions(+), 31 deletions(-)

diff --git a/admin_groups.php b/admin_groups.php
index de72118..83f4637 100644
--- a/admin_groups.php
+++ b/admin_groups.php
@@ -114,7 +114,7 @@
 									<td>
 										<label class="conl"><input type="radio" name="moderator" value="1"<?php if ($group['g_moderator'] == '1') echo ' checked="checked"' ?> tabindex="5" />&#160;<strong><?php echo $lang_admin_common['Yes'] ?></strong></label>
 										<label class="conl"><input type="radio" name="moderator" value="0"<?php if ($group['g_moderator'] == '0') echo ' checked="checked"' ?> tabindex="6" />&#160;<strong><?php echo $lang_admin_common['No'] ?></strong></label>
-										<span><?php echo $lang_admin_groups['Mod privileges help'] ?></span>
+										<span class="clearb"><?php echo $lang_admin_groups['Mod privileges help'] ?></span>
 									</td>
 								</tr>
 								<tr>
@@ -122,7 +122,7 @@
 									<td>
 										<label class="conl"><input type="radio" name="mod_edit_users" value="1"<?php if ($group['g_mod_edit_users'] == '1') echo ' checked="checked"' ?> tabindex="7" />&#160;<strong><?php echo $lang_admin_common['Yes'] ?></strong></label>
 										<label class="conl"><input type="radio" name="mod_edit_users" value="0"<?php if ($group['g_mod_edit_users'] == '0') echo ' checked="checked"' ?> tabindex="8" />&#160;<strong><?php echo $lang_admin_common['No'] ?></strong></label>
-										<span><?php echo $lang_admin_groups['Edit profile help'] ?></span>
+										<span class="clearb"><?php echo $lang_admin_groups['Edit profile help'] ?></span>
 									</td>
 								</tr>
 								<tr>
@@ -130,7 +130,7 @@
 									<td>
 										<label class="conl"><input type="radio" name="mod_rename_users" value="1"<?php if ($group['g_mod_rename_users'] == '1') echo ' checked="checked"' ?> tabindex="9" />&#160;<strong><?php echo $lang_admin_common['Yes'] ?></strong></label>
 										<label class="conl"><input type="radio" name="mod_rename_users" value="0"<?php if ($group['g_mod_rename_users'] == '0') echo ' checked="checked"' ?> tabindex="10" />&#160;<strong><?php echo $lang_admin_common['No'] ?></strong></label>
-										<span><?php echo $lang_admin_groups['Rename users help'] ?></span>
+										<span class="clearb"><?php echo $lang_admin_groups['Rename users help'] ?></span>
 									</td>
 								</tr>
 								<tr>
@@ -138,7 +138,7 @@
 									<td>
 										<label class="conl"><input type="radio" name="mod_change_passwords" value="1"<?php if ($group['g_mod_change_passwords'] == '1') echo ' checked="checked"' ?> tabindex="11" />&#160;<strong><?php echo $lang_admin_common['Yes'] ?></strong></label>
 										<label class="conl"><input type="radio" name="mod_change_passwords" value="0"<?php if ($group['g_mod_change_passwords'] == '0') echo ' checked="checked"' ?> tabindex="12" />&#160;<strong><?php echo $lang_admin_common['No'] ?></strong></label>
-										<span><?php echo $lang_admin_groups['Change passwords help'] ?></span>
+										<span class="clearb"><?php echo $lang_admin_groups['Change passwords help'] ?></span>
 									</td>
 								</tr>
 								<tr>
@@ -146,7 +146,7 @@
 									<td>
 										<label class="conl"><input type="radio" name="mod_ban_users" value="1"<?php if ($group['g_mod_ban_users'] == '1') echo ' checked="checked"' ?> tabindex="13" />&#160;<strong><?php echo $lang_admin_common['Yes'] ?></strong></label>
 										<label class="conl"><input type="radio" name="mod_ban_users" value="0"<?php if ($group['g_mod_ban_users'] == '0') echo ' checked="checked"' ?> tabindex="14" />&#160;<strong><?php echo $lang_admin_common['No'] ?></strong></label>
-										<span><?php echo $lang_admin_groups['Ban users help'] ?></span>
+										<span class="clearb"><?php echo $lang_admin_groups['Ban users help'] ?></span>
 									</td>
 								</tr>
 <?php endif; endif; ?>								<tr>
@@ -154,7 +154,7 @@
 									<td>
 										<label class="conl"><input type="radio" name="read_board" value="1"<?php if ($group['g_read_board'] == '1') echo ' checked="checked"' ?> tabindex="15" />&#160;<strong><?php echo $lang_admin_common['Yes'] ?></strong></label>
 										<label class="conl"><input type="radio" name="read_board" value="0"<?php if ($group['g_read_board'] == '0') echo ' checked="checked"' ?> tabindex="16" />&#160;<strong><?php echo $lang_admin_common['No'] ?></strong></label>
-										<span><?php echo $lang_admin_groups['Read board help'] ?></span>
+										<span class="clearb"><?php echo $lang_admin_groups['Read board help'] ?></span>
 									</td>
 								</tr>
 								<tr>
@@ -162,7 +162,7 @@
 									<td>
 										<label class="conl"><input type="radio" name="view_users" value="1"<?php if ($group['g_view_users'] == '1') echo ' checked="checked"' ?> tabindex="17" />&#160;<strong><?php echo $lang_admin_common['Yes'] ?></strong></label>
 										<label class="conl"><input type="radio" name="view_users" value="0"<?php if ($group['g_view_users'] == '0') echo ' checked="checked"' ?> tabindex="18" />&#160;<strong><?php echo $lang_admin_common['No'] ?></strong></label>
-										<span><?php echo $lang_admin_groups['View user info help'] ?></span>
+										<span class="clearb"><?php echo $lang_admin_groups['View user info help'] ?></span>
 									</td>
 								</tr>
 								<tr>
@@ -170,7 +170,7 @@
 									<td>
 										<label class="conl"><input type="radio" name="post_replies" value="1"<?php if ($group['g_post_replies'] == '1') echo ' checked="checked"' ?> tabindex="19" />&#160;<strong><?php echo $lang_admin_common['Yes'] ?></strong></label>
 										<label class="conl"><input type="radio" name="post_replies" value="0"<?php if ($group['g_post_replies'] == '0') echo ' checked="checked"' ?> tabindex="20" />&#160;<strong><?php echo $lang_admin_common['No'] ?></strong></label>
-										<span><?php echo $lang_admin_groups['Post replies help'] ?></span>
+										<span class="clearb"><?php echo $lang_admin_groups['Post replies help'] ?></span>
 									</td>
 								</tr>
 								<tr>
@@ -178,7 +178,7 @@
 									<td>
 										<label class="conl"><input type="radio" name="post_topics" value="1"<?php if ($group['g_post_topics'] == '1') echo ' checked="checked"' ?> tabindex="21" />&#160;<strong><?php echo $lang_admin_common['Yes'] ?></strong></label>
 										<label class="conl"><input type="radio" name="post_topics" value="0"<?php if ($group['g_post_topics'] == '0') echo ' checked="checked"' ?> tabindex="22" />&#160;<strong><?php echo $lang_admin_common['No'] ?></strong></label>
-										<span><?php echo $lang_admin_groups['Post topics help'] ?></span>
+										<span class="clearb"><?php echo $lang_admin_groups['Post topics help'] ?></span>
 									</td>
 								</tr>
 <?php if ($group['g_id'] != PUN_GUEST): ?>								<tr>
@@ -186,7 +186,7 @@
 									<td>
 										<label class="conl"><input type="radio" name="edit_posts" value="1"<?php if ($group['g_edit_posts'] == '1') echo ' checked="checked"' ?> tabindex="23" />&#160;<strong><?php echo $lang_admin_common['Yes'] ?></strong></label>
 										<label class="conl"><input type="radio" name="edit_posts" value="0"<?php if ($group['g_edit_posts'] == '0') echo ' checked="checked"' ?> tabindex="24" />&#160;<strong><?php echo $lang_admin_common['No'] ?></strong></label>
-										<span><?php echo $lang_admin_groups['Edit posts help'] ?></span>
+										<span class="clearb"><?php echo $lang_admin_groups['Edit posts help'] ?></span>
 									</td>
 								</tr>
 								<tr>
@@ -194,7 +194,7 @@
 									<td>
 										<label class="conl"><input type="radio" name="delete_posts" value="1"<?php if ($group['g_delete_posts'] == '1') echo ' checked="checked"' ?> tabindex="25" />&#160;<strong><?php echo $lang_admin_common['Yes'] ?></strong></label>
 										<label class="conl"><input type="radio" name="delete_posts" value="0"<?php if ($group['g_delete_posts'] == '0') echo ' checked="checked"' ?> tabindex="26" />&#160;<strong><?php echo $lang_admin_common['No'] ?></strong></label>
-										<span><?php echo $lang_admin_groups['Delete posts help'] ?></span>
+										<span class="clearb"><?php echo $lang_admin_groups['Delete posts help'] ?></span>
 									</td>
 								</tr>
 								<tr>
@@ -202,7 +202,7 @@
 									<td>
 										<label class="conl"><input type="radio" name="delete_topics" value="1"<?php if ($group['g_delete_topics'] == '1') echo ' checked="checked"' ?> tabindex="27" />&#160;<strong><?php echo $lang_admin_common['Yes'] ?></strong></label>
 										<label class="conl"><input type="radio" name="delete_topics" value="0"<?php if ($group['g_delete_topics'] == '0') echo ' checked="checked"' ?> tabindex="28" />&#160;<strong><?php echo $lang_admin_common['No'] ?></strong></label>
-										<span><?php echo $lang_admin_groups['Delete topics help'] ?></span>
+										<span class="clearb"><?php echo $lang_admin_groups['Delete topics help'] ?></span>
 									</td>
 								</tr>
 <?php endif; ?>								<tr>
@@ -210,7 +210,7 @@
 									<td>
 										<label class="conl"><input type="radio" name="post_links" value="1"<?php if ($group['g_post_links'] == '1') echo ' checked="checked"' ?> tabindex="29" />&#160;<strong><?php echo $lang_admin_common['Yes'] ?></strong></label>
 										<label class="conl"><input type="radio" name="post_links" value="0"<?php if ($group['g_post_links'] == '0') echo ' checked="checked"' ?> tabindex="30" />&#160;<strong><?php echo $lang_admin_common['No'] ?></strong></label>
-										<span><?php echo $lang_admin_groups['Post links help'] ?></span>
+										<span class="clearb"><?php echo $lang_admin_groups['Post links help'] ?></span>
 									</td>
 								</tr>
 <?php if ($group['g_id'] != PUN_GUEST): ?>								<tr>
@@ -218,7 +218,7 @@
 									<td>
 										<label class="conl"><input type="radio" name="set_title" value="1"<?php if ($group['g_set_title'] == '1') echo ' checked="checked"' ?> tabindex="31" />&#160;<strong><?php echo $lang_admin_common['Yes'] ?></strong></label>
 										<label class="conl"><input type="radio" name="set_title" value="0"<?php if ($group['g_set_title'] == '0') echo ' checked="checked"' ?> tabindex="32" />&#160;<strong><?php echo $lang_admin_common['No'] ?></strong></label>
-										<span><?php echo $lang_admin_groups['Set own title help'] ?></span>
+										<span class="clearb"><?php echo $lang_admin_groups['Set own title help'] ?></span>
 									</td>
 								</tr>
 <?php endif; ?>								<tr>
@@ -226,7 +226,7 @@
 									<td>
 										<label class="conl"><input type="radio" name="search" value="1"<?php if ($group['g_search'] == '1') echo ' checked="checked"' ?> tabindex="33" />&#160;<strong><?php echo $lang_admin_common['Yes'] ?></strong></label>
 										<label class="conl"><input type="radio" name="search" value="0"<?php if ($group['g_search'] == '0') echo ' checked="checked"' ?> tabindex="34" />&#160;<strong><?php echo $lang_admin_common['No'] ?></strong></label>
-										<span><?php echo $lang_admin_groups['User search help'] ?></span>
+										<span class="clearb"><?php echo $lang_admin_groups['User search help'] ?></span>
 									</td>
 								</tr>
 								<tr>
@@ -234,7 +234,7 @@
 									<td>
 										<label class="conl"><input type="radio" name="search_users" value="1"<?php if ($group['g_search_users'] == '1') echo ' checked="checked"' ?> tabindex="35" />&#160;<strong><?php echo $lang_admin_common['Yes'] ?></strong></label>
 										<label class="conl"><input type="radio" name="search_users" value="0"<?php if ($group['g_search_users'] == '0') echo ' checked="checked"' ?> tabindex="36" />&#160;<strong><?php echo $lang_admin_common['No'] ?></strong></label>
-										<span><?php echo $lang_admin_groups['User list search help'] ?></span>
+										<span class="clearb"><?php echo $lang_admin_groups['User list search help'] ?></span>
 									</td>
 								</tr>
 <?php if ($group['g_id'] != PUN_GUEST): ?>								<tr>
@@ -242,7 +242,7 @@
 									<td>
 										<label class="conl"><input type="radio" name="send_email" value="1"<?php if ($group['g_send_email'] == '1') echo ' checked="checked"' ?> tabindex="37" />&#160;<strong><?php echo $lang_admin_common['Yes'] ?></strong></label>
 										<label class="conl"><input type="radio" name="send_email" value="0"<?php if ($group['g_send_email'] == '0') echo ' checked="checked"' ?> tabindex="38" />&#160;<strong><?php echo $lang_admin_common['No'] ?></strong></label>
-										<span><?php echo $lang_admin_groups['Send e-mails help'] ?></span>
+										<span class="clearb"><?php echo $lang_admin_groups['Send e-mails help'] ?></span>
 									</td>
 								</tr>
 <?php endif; ?>								<tr>
diff --git a/admin_maintenance.php b/admin_maintenance.php
index 471b3a5..df97a60 100644
--- a/admin_maintenance.php
+++ b/admin_maintenance.php
@@ -280,7 +280,7 @@
 								<tr>
 									<th scope="row"><?php echo $lang_admin_maintenance['Empty index label'] ?></th>
 									<td class="inputadmin">
-										<span><input type="checkbox" name="i_empty_index" value="1" tabindex="3" checked="checked" />&#160;&#160;<?php echo $lang_admin_maintenance['Empty index help'] ?></span>
+										<label><input type="checkbox" name="i_empty_index" value="1" tabindex="3" checked="checked" />&#160;&#160;<?php echo $lang_admin_maintenance['Empty index help'] ?></label>
 									</td>
 								</tr>
 							</table>
@@ -310,7 +310,7 @@
 									<td>
 										<label class="conl"><input type="radio" name="prune_sticky" value="1" tabindex="6" checked="checked" />&#160;<strong><?php echo $lang_admin_common['Yes'] ?></strong></label>
 										<label class="conl"><input type="radio" name="prune_sticky" value="0" />&#160;<strong><?php echo $lang_admin_common['No'] ?></strong></label>
-										<span><?php echo $lang_admin_maintenance['Prune sticky help'] ?></span>
+										<span class="clearb"><?php echo $lang_admin_maintenance['Prune sticky help'] ?></span>
 									</td>
 								</tr>
 								<tr>
diff --git a/admin_permissions.php b/admin_permissions.php
index d660de5..23b236d 100644
--- a/admin_permissions.php
+++ b/admin_permissions.php
@@ -69,7 +69,7 @@
 									<td>
 										<label class="conl"><input type="radio" name="form[message_bbcode]" value="1"<?php if ($pun_config['p_message_bbcode'] == '1') echo ' checked="checked"' ?> />&#160;<strong><?php echo $lang_admin_common['Yes'] ?></strong></label>
 										<label class="conl"><input type="radio" name="form[message_bbcode]" value="0"<?php if ($pun_config['p_message_bbcode'] == '0') echo ' checked="checked"' ?> />&#160;<strong><?php echo $lang_admin_common['No'] ?></strong></label>
-										<span><?php echo $lang_admin_permissions['BBCode help'] ?></span>
+										<span class="clearb"><?php echo $lang_admin_permissions['BBCode help'] ?></span>
 									</td>
 								</tr>
 								<tr>
@@ -77,7 +77,7 @@
 									<td>
 										<label class="conl"><input type="radio" name="form[message_img_tag]" value="1"<?php if ($pun_config['p_message_img_tag'] == '1') echo ' checked="checked"' ?> />&#160;<strong><?php echo $lang_admin_common['Yes'] ?></strong></label>
 										<label class="conl"><input type="radio" name="form[message_img_tag]" value="0"<?php if ($pun_config['p_message_img_tag'] == '0') echo ' checked="checked"' ?> />&#160;<strong><?php echo $lang_admin_common['No'] ?></strong></label>
-										<span><?php echo $lang_admin_permissions['Image tag help'] ?></span>
+										<span class="clearb"><?php echo $lang_admin_permissions['Image tag help'] ?></span>
 									</td>
 								</tr>
 								<tr>
@@ -85,7 +85,7 @@
 									<td>
 										<label class="conl"><input type="radio" name="form[message_all_caps]" value="1"<?php if ($pun_config['p_message_all_caps'] == '1') echo ' checked="checked"' ?> />&#160;<strong><?php echo $lang_admin_common['Yes'] ?></strong></label>
 										<label class="conl"><input type="radio" name="form[message_all_caps]" value="0"<?php if ($pun_config['p_message_all_caps'] == '0') echo ' checked="checked"' ?> />&#160;<strong><?php echo $lang_admin_common['No'] ?></strong></label>
-										<span><?php echo $lang_admin_permissions['All caps message help'] ?></span>
+										<span class="clearb"><?php echo $lang_admin_permissions['All caps message help'] ?></span>
 									</td>
 								</tr>
 								<tr>
@@ -93,7 +93,7 @@
 									<td>
 										<label class="conl"><input type="radio" name="form[subject_all_caps]" value="1"<?php if ($pun_config['p_subject_all_caps'] == '1') echo ' checked="checked"' ?> />&#160;<strong><?php echo $lang_admin_common['Yes'] ?></strong></label>
 										<label class="conl"><input type="radio" name="form[subject_all_caps]" value="0"<?php if ($pun_config['p_subject_all_caps'] == '0') echo ' checked="checked"' ?> />&#160;<strong><?php echo $lang_admin_common['No'] ?></strong></label>
-										<span><?php echo $lang_admin_permissions['All caps subject help'] ?></span>
+										<span class="clearb"><?php echo $lang_admin_permissions['All caps subject help'] ?></span>
 									</td>
 								</tr>
 								<tr>
@@ -101,7 +101,7 @@
 									<td>
 										<label class="conl"><input type="radio" name="form[force_guest_email]" value="1"<?php if ($pun_config['p_force_guest_email'] == '1') echo ' checked="checked"' ?> />&#160;<strong><?php echo $lang_admin_common['Yes'] ?></strong></label>
 										<label class="conl"><input type="radio" name="form[force_guest_email]" value="0"<?php if ($pun_config['p_force_guest_email'] == '0') echo ' checked="checked"' ?> />&#160;<strong><?php echo $lang_admin_common['No'] ?></strong></label>
-										<span><?php echo $lang_admin_permissions['Require e-mail help'] ?></span>
+										<span class="clearb"><?php echo $lang_admin_permissions['Require e-mail help'] ?></span>
 									</td>
 								</tr>
 							</table>
@@ -118,7 +118,7 @@
 									<td>
 										<label class="conl"><input type="radio" name="form[sig_bbcode]" value="1"<?php if ($pun_config['p_sig_bbcode'] == '1') echo ' checked="checked"' ?> />&#160;<strong><?php echo $lang_admin_common['Yes'] ?></strong></label>
 										<label class="conl"><input type="radio" name="form[sig_bbcode]" value="0"<?php if ($pun_config['p_sig_bbcode'] == '0') echo ' checked="checked"' ?> />&#160;<strong><?php echo $lang_admin_common['No'] ?></strong></label>
-										<span><?php echo $lang_admin_permissions['BBCode sigs help'] ?></span>
+										<span class="clearb"><?php echo $lang_admin_permissions['BBCode sigs help'] ?></span>
 									</td>
 								</tr>
 								<tr>
@@ -126,7 +126,7 @@
 									<td>
 										<label class="conl"><input type="radio" name="form[sig_img_tag]" value="1"<?php if ($pun_config['p_sig_img_tag'] == '1') echo ' checked="checked"' ?> />&#160;<strong><?php echo $lang_admin_common['Yes'] ?></strong></label>
 										<label class="conl"><input type="radio" name="form[sig_img_tag]" value="0"<?php if ($pun_config['p_sig_img_tag'] == '0') echo ' checked="checked"' ?> />&#160;<strong><?php echo $lang_admin_common['No'] ?></strong></label>
-										<span><?php echo $lang_admin_permissions['Image tag sigs help'] ?></span>
+										<span class="clearb"><?php echo $lang_admin_permissions['Image tag sigs help'] ?></span>
 									</td>
 								</tr>
 								<tr>
@@ -134,21 +134,21 @@
 									<td>
 										<label class="conl"><input type="radio" name="form[sig_all_caps]" value="1"<?php if ($pun_config['p_sig_all_caps'] == '1') echo ' checked="checked"' ?> />&#160;<strong><?php echo $lang_admin_common['Yes'] ?></strong></label>
 										<label class="conl"><input type="radio" name="form[sig_all_caps]" value="0"<?php if ($pun_config['p_sig_all_caps'] == '0') echo ' checked="checked"' ?> />&#160;<strong><?php echo $lang_admin_common['No'] ?></strong></label>
-										<span><?php echo $lang_admin_permissions['All caps sigs help'] ?></span>
+										<span class="clearb"><?php echo $lang_admin_permissions['All caps sigs help'] ?></span>
 									</td>
 								</tr>
 								<tr>
 									<th scope="row"><?php echo $lang_admin_permissions['Max sig length label'] ?></th>
 									<td>
 										<input type="text" name="form[sig_length]" size="5" maxlength="5" value="<?php echo $pun_config['p_sig_length'] ?>" />
-										<span><?php echo $lang_admin_permissions['Max sig length help'] ?></span>
+										<span class="clearb"><?php echo $lang_admin_permissions['Max sig length help'] ?></span>
 									</td>
 								</tr>
 								<tr>
 									<th scope="row"><?php echo $lang_admin_permissions['Max sig lines label'] ?></th>
 									<td>
 										<input type="text" name="form[sig_lines]" size="3" maxlength="3" value="<?php echo $pun_config['p_sig_lines'] ?>" />
-										<span><?php echo $lang_admin_permissions['Max sig lines help'] ?></span>
+										<span class="clearb"><?php echo $lang_admin_permissions['Max sig lines help'] ?></span>
 									</td>
 								</tr>
 							</table>
@@ -165,7 +165,7 @@
 									<td>
 										<label class="conl"><input type="radio" name="form[allow_banned_email]" value="1"<?php if ($pun_config['p_allow_banned_email'] == '1') echo ' checked="checked"' ?> />&#160;<strong><?php echo $lang_admin_common['Yes'] ?></strong></label>
 										<label class="conl"><input type="radio" name="form[allow_banned_email]" value="0"<?php if ($pun_config['p_allow_banned_email'] == '0') echo ' checked="checked"' ?> />&#160;<strong><?php echo $lang_admin_common['No'] ?></strong></label>
-										<span><?php echo $lang_admin_permissions['Banned e-mail help'] ?></span>
+										<span class="clearb"><?php echo $lang_admin_permissions['Banned e-mail help'] ?></span>
 									</td>
 								</tr>
 								<tr>
@@ -173,7 +173,7 @@
 									<td>
 										<label class="conl"><input type="radio" name="form[allow_dupe_email]" value="1"<?php if ($pun_config['p_allow_dupe_email'] == '1') echo ' checked="checked"' ?> />&#160;<strong><?php echo $lang_admin_common['Yes'] ?></strong></label>
 										<label class="conl"><input type="radio" name="form[allow_dupe_email]" value="0"<?php if ($pun_config['p_allow_dupe_email'] == '0') echo ' checked="checked"' ?> />&#160;<strong><?php echo $lang_admin_common['No'] ?></strong></label>
-										<span><?php echo $lang_admin_permissions['Duplicate e-mail help'] ?></span>
+										<span class="clearb"><?php echo $lang_admin_permissions['Duplicate e-mail help'] ?></span>
 									</td>
 								</tr>
 							</table>
-- 
1.7.10


From bf8144531fe828d56a1c8a2b5313bbd9d63d37fe Mon Sep 17 00:00:00 2001
From: Quy Ton <quy@fluxbb.org>
Date: Fri, 5 Oct 2012 20:11:38 -0700
Subject: [PATCH 50/75] #717: Applied clearb class to help text.

---
 admin_users.php |    2 +-
 1 file changed, 1 insertion(+), 1 deletion(-)

diff --git a/admin_users.php b/admin_users.php
index ec9607e..31a7bfa 100644
--- a/admin_users.php
+++ b/admin_users.php
@@ -663,7 +663,7 @@
 									<td>
 										<label class="conl"><input type="radio" name="ban_the_ip" tabindex="3" value="1" checked="checked" />&#160;<strong><?php echo $lang_admin_common['Yes'] ?></strong></label>
 										<label class="conl"><input type="radio" name="ban_the_ip" tabindex="4" value="0" checked="checked" />&#160;<strong><?php echo $lang_admin_common['No'] ?></strong></label>
-										<span><?php echo $lang_admin_users['Ban IP help'] ?></span>
+										<span class="clearb"><?php echo $lang_admin_users['Ban IP help'] ?></span>
 									</td>
 								</tr>
 							</table>
-- 
1.7.10


From 225873f89d7d100c9a663fdc4d42c90fae912d7b Mon Sep 17 00:00:00 2001
From: Quy Ton <quy@fluxbb.org>
Date: Fri, 5 Oct 2012 21:05:38 -0700
Subject: [PATCH 51/75] #746: Changed CSS rules to lowercases to be XHTML
 compliance.

---
 style/Air/base_admin.css     |    2 +-
 style/Earth/base_admin.css   |    2 +-
 style/Fire/base_admin.css    |    2 +-
 style/imports/base_admin.css |   84 +++++++++++++++++++++---------------------
 4 files changed, 45 insertions(+), 45 deletions(-)

diff --git a/style/Air/base_admin.css b/style/Air/base_admin.css
index 8a1c33f..fdf41b1 100644
--- a/style/Air/base_admin.css
+++ b/style/Air/base_admin.css
@@ -34,7 +34,7 @@
 	display: inline-block;
 }
 
-#adminconsole fieldset tbody th {
+#adminconsole fieldset th {
 	width: 15em;
 	font-weight: normal;
 	padding-right: 8px;
diff --git a/style/Earth/base_admin.css b/style/Earth/base_admin.css
index 8a1c33f..fdf41b1 100644
--- a/style/Earth/base_admin.css
+++ b/style/Earth/base_admin.css
@@ -34,7 +34,7 @@
 	display: inline-block;
 }
 
-#adminconsole fieldset tbody th {
+#adminconsole fieldset th {
 	width: 15em;
 	font-weight: normal;
 	padding-right: 8px;
diff --git a/style/Fire/base_admin.css b/style/Fire/base_admin.css
index 8a1c33f..fdf41b1 100644
--- a/style/Fire/base_admin.css
+++ b/style/Fire/base_admin.css
@@ -34,7 +34,7 @@
 	display: inline-block;
 }
 
-#adminconsole fieldset tbody th {
+#adminconsole fieldset th {
 	width: 15em;
 	font-weight: normal;
 	padding-right: 8px;
diff --git a/style/imports/base_admin.css b/style/imports/base_admin.css
index a6ef40c..50eaaec 100644
--- a/style/imports/base_admin.css
+++ b/style/imports/base_admin.css
@@ -1,52 +1,52 @@
-#adminconsole .block2 {MARGIN-TOP: 12px}
+#adminconsole .block2 {margin-top: 12px}
 
 /*** Admin Main Content ***/
-* HTML #adstats DD {HEIGHT: 1%}
-#adstats DD {MARGIN-LEFT: 14em; PADDING: 3px; MARGIN-BOTTOM: 5px; LINE-HEIGHT: 1.5em}
-#adstats DT {FLOAT: left; WIDTH: 13em; PADDING: 3px; LINE-HEIGHT: 1.5em}
-#adstats {PADDING: 15px 15px 5px 10px}
-#adintro {PADDING: 5px}
-#adintro P {PADDING: 10px}
-#adstats DL {PADDING: 5px 0 10px 5px}
+* html #adstats dd {height: 1%}
+#adstats dd {margin-left: 14em; padding: 3px; margin-bottom: 5px; line-height: 1.5em}
+#adstats dt {float: left; width: 13em; padding: 3px; line-height: 1.5em}
+#adstats {padding: 15px 15px 5px 10px}
+#adintro {padding: 5px}
+#adintro p {padding: 10px}
+#adstats dl {padding: 5px 0 10px 5px}
 
-#adminconsole FIELDSET TD {TEXT-ALIGN: left; PADDING: 4px; WHITE-SPACE: normal}
-#adminconsole FIELDSET TH {TEXT-ALIGN: left; PADDING: 4px; WHITE-SPACE: normal}
-#adminconsole FIELDSET TD SPAN, #adminconsole FIELDSET TH SPAN {DISPLAY: block; FONT-SIZE: 1em; FONT-WEIGHT: normal}
-#adminconsole TH {WIDTH: 15em; FONT-WEIGHT: bold}
-#adminconsole INPUT, #adminconsole SELECT, #adminconsole TEXTAREA {MARGIN-BOTTOM: 0; MARGIN-TOP: 0; FONT-WEIGHT: normal}
-#adminconsole TABLE.aligntop TH, #adminconsole TABLE.aligntop TD {VERTICAL-ALIGN: top}
-#adminconsole TABLE.aligntop TH {PADDING-TOP: 0.7em}
-#adminconsole TD, #adminconsole TH {BORDER-STYLE: solid; BORDER-WIDTH: 3px 0 3px 0}
-#adminconsole P {PADDING-BOTTOM: 6px}
-#adminconsole .topspace {PADDING-TOP: 6px}
-#adminconsole P.submittop, #adminconsole P.submitend {TEXT-ALIGN: center}
-#adminconsole TH.hidehead {COLOR: #f1f1f1}
-#adminconsole THEAD TH {PADDING-BOTTOM: 0}
-#adminconsole P.linkactions {FONT-WEIGHT: bold; PADDING-LEFT: 5px}
-#adminconsole TH INPUT, #adminconsole DIV.fsetsubmit {MARGIN-TOP: 6px}
+#adminconsole fieldset td {text-align: left; padding: 4px; white-space: normal}
+#adminconsole fieldset th {text-align: left; padding: 4px; white-space: normal}
+#adminconsole fieldset td span, #adminconsole fieldset th span {display: block; font-size: 1em; font-weight: normal}
+#adminconsole th {width: 15em; font-weight: bold}
+#adminconsole input, #adminconsole select, #adminconsole textarea {margin-bottom: 0; margin-top: 0; font-weight: normal}
+#adminconsole table.aligntop th, #adminconsole table.aligntop td {vertical-align: top}
+#adminconsole table.aligntop th {padding-top: 0.7em}
+#adminconsole td, #adminconsole th {border-style: solid; border-width: 3px 0 3px 0}
+#adminconsole p {padding-bottom: 6px}
+#adminconsole .topspace {padding-top: 6px}
+#adminconsole p.submittop, #adminconsole p.submitend {text-align: center}
+#adminconsole th.hidehead {color: #f1f1f1}
+#adminconsole thead th {padding-bottom: 0}
+#adminconsole p.linkactions {font-weight: bold; padding-left: 5px}
+#adminconsole th input, #adminconsole div.fsetsubmit {margin-top: 6px}
 
 /*** Particular table settings ***/
-#categoryedit .tcl {WIDTH: 25%}
-#censoring .tcl, #censoring .tc2 {WIDTH: 20%}
-#edforum .tcl, #edforum .tc2 {WIDTH: 8%}
-#edforum .tc2 {WIDTH: 6%}
+#categoryedit .tcl {width: 25%}
+#censoring .tcl, #censoring .tc2 {width: 20%}
+#edforum .tcl, #edforum .tc2 {width: 8%}
+#edforum .tc2 {width: 6%}
 
-TABLE#forumperms TH, TABLE#forumperms TD {WHITE-SPACE: normal; WIDTH: auto; TEXT-ALIGN: center}
-TABLE#forumperms .atcl {TEXT-ALIGN: left; WIDTH: 15em; WHITE-SPACE: nowrap}
-#adminconsole TD.nodefault {BACKGROUND-COLOR: #D59B9B}
+table#forumperms th, table#forumperms td {white-space: normal; width: auto; text-align: center}
+table#forumperms .atcl {text-align: left; width: 15em; white-space: nowrap}
+#adminconsole td.nodefault {background-color: #d59b9b}
 
 /*** User/Ban Search Result Tables ***/
-#users2 TH, #bans1 TH {TEXT-ALIGN: left}
-#users2 TH.tcmod {TEXT-ALIGN: center}
-#users2 .tcl, #bans1 .tcl {WIDTH: auto; TEXT-ALIGN: left; PADDING: 4px 6px}
-#users2 .tc2, #bans1 .tc2 {WIDTH: 18%; TEXT-ALIGN: left; PADDING: 4px 6px}
-#users2 .tc3, #users2 .tc5, #bans1 .tc3, #bans1 .tc5, #bans1 .tc6 {WIDTH: 12%; TEXT-ALIGN: left; PADDING: 4px 6px}
-#users2 .tc4, #bans1 .tc4 {WIDTH: 10%; TEXT-ALIGN: center}
-#users2 .tcr {WIDTH: 20%; WHITE-SPACE: nowrap}
-#bans1 .tcr {WIDTH: 15%; WHITE-SPACE: nowrap}
-#users2 .tcmod {WIDTH: 10%; TEXT-ALIGN: center}
-#adminconsole #linkst, #adminconsole #linksb A {FONT-WEIGHT: bold}
+#users2 th, #bans1 th {text-align: left}
+#users2 th.tcmod {text-align: center}
+#users2 .tcl, #bans1 .tcl {width: auto; text-align: left; padding: 4px 6px}
+#users2 .tc2, #bans1 .tc2 {width: 18%; text-align: left; padding: 4px 6px}
+#users2 .tc3, #users2 .tc5, #bans1 .tc3, #bans1 .tc5, #bans1 .tc6 {width: 12%; text-align: left; padding: 4px 6px}
+#users2 .tc4, #bans1 .tc4 {width: 10%; text-align: center}
+#users2 .tcr {width: 20%; white-space: nowrap}
+#bans1 .tcr {width: 15%; white-space: nowrap}
+#users2 .tcmod {width: 10%; text-align: center}
+#adminconsole #linkst, #adminconsole #linksb a {font-weight: bold}
 
 /*** Plugins ***/
-.plugin .inbox {PADDING-BOTTOM: 10px}
-.plugin p {PADDING: 10px 10px 0}
+.plugin .inbox {padding-bottom: 10px}
+.plugin p {padding: 10px 10px 0}
-- 
1.7.10


From ef2e57b38af07422eb5c03d0159e16a17ee1aa7d Mon Sep 17 00:00:00 2001
From: Quy Ton <quy@fluxbb.org>
Date: Fri, 5 Oct 2012 22:08:21 -0700
Subject: [PATCH 52/75] #747: Fixed drop-down menu from cutting off on right
 side on hovering in Firefox. Reported by 123s.

---
 style/Air.css   |    1 +
 style/Earth.css |    1 +
 style/Fire.css  |    1 +
 3 files changed, 3 insertions(+)

diff --git a/style/Air.css b/style/Air.css
index 8500689..cd0a33b 100644
--- a/style/Air.css
+++ b/style/Air.css
@@ -22,6 +22,7 @@ html, body, .pun table, .pun div, .pun form, .pun p, .pun h1, .pun h2, .pun h3,
 .pun select {
 	padding-bottom: 1px;
 	padding-top: 1px;
+	padding-right: 1px;
 }
 
 /* Content Defaults
diff --git a/style/Earth.css b/style/Earth.css
index cd89f58..834b80a 100644
--- a/style/Earth.css
+++ b/style/Earth.css
@@ -22,6 +22,7 @@ html, body, .pun table, .pun div, .pun form, .pun p, .pun h1, .pun h2, .pun h3,
 .pun select {
 	padding-bottom: 1px;
 	padding-top: 1px;
+	padding-right: 1px;
 }
 
 /* Content Defaults
diff --git a/style/Fire.css b/style/Fire.css
index 0eb08f4..3ba260a 100644
--- a/style/Fire.css
+++ b/style/Fire.css
@@ -22,6 +22,7 @@ html, body, .pun table, .pun div, .pun form, .pun p, .pun h1, .pun h2, .pun h3,
 .pun select {
 	padding-bottom: 1px;
 	padding-top: 1px;
+	padding-right: 1px;
 }
 
 /* Content Defaults
-- 
1.7.10


From d6bfa19a1a16945c6777024c3f40a0e9132bb76b Mon Sep 17 00:00:00 2001
From: Quy Ton <quy@fluxbb.org>
Date: Sun, 7 Oct 2012 18:12:15 -0700
Subject: [PATCH 53/75] #679: Don't hyperlink URLs prefixed with www/ftp if
 not in subdomain format

---
 include/parser.php |    2 +-
 1 file changed, 1 insertion(+), 1 deletion(-)

diff --git a/include/parser.php b/include/parser.php
index 9ba708b..cba4531 100644
--- a/include/parser.php
+++ b/include/parser.php
@@ -832,7 +832,7 @@ function do_clickable($text)
 	$text = ' '.$text;
 
 	$text = ucp_preg_replace('%(?<=[\s\]\)])(<)?(\[)?(\()?([\'"]?)(https?|ftp|news){1}://([\p{L}\p{N}\-]+\.([\p{L}\p{N}\-]+\.)*[\p{L}\p{N}]+(:[0-9]+)?(/(?:[^\s\[]*[^\s.,?!\[;:-])?)?)\4(?(3)(\)))(?(2)(\]))(?(1)(>))(?![^\s]*\[/(?:url|img)\])%uie', 'stripslashes(\'$1$2$3$4\').handle_url_tag(\'$5://$6\', \'$5://$6\', true).stripslashes(\'$4$10$11$12\')', $text);
-	$text = ucp_preg_replace('%(?<=[\s\]\)])(<)?(\[)?(\()?([\'"]?)(www|ftp)\.(([\p{L}\p{N}\-]+\.)*[\p{L}\p{N}]+(:[0-9]+)?(/(?:[^\s\[]*[^\s.,?!\[;:-])?)?)\4(?(3)(\)))(?(2)(\]))(?(1)(>))(?![^\s]*\[/(?:url|img)\])%uie', 'stripslashes(\'$1$2$3$4\').handle_url_tag(\'$5.$6\', \'$5.$6\', true).stripslashes(\'$4$10$11$12\')', $text);
+	$text = ucp_preg_replace('%(?<=[\s\]\)])(<)?(\[)?(\()?([\'"]?)(www|ftp)\.(([\p{L}\p{N}\-]+\.)+[\p{L}\p{N}]+(:[0-9]+)?(/(?:[^\s\[]*[^\s.,?!\[;:-])?)?)\4(?(3)(\)))(?(2)(\]))(?(1)(>))(?![^\s]*\[/(?:url|img)\])%uie', 'stripslashes(\'$1$2$3$4\').handle_url_tag(\'$5.$6\', \'$5.$6\', true).stripslashes(\'$4$10$11$12\')', $text);
 
 	return substr($text, 1);
 }
-- 
1.7.10


From f0fa997668775572e9064d49128d25df34a04ee0 Mon Sep 17 00:00:00 2001
From: Quy Ton <quy@fluxbb.org>
Date: Mon, 8 Oct 2012 10:45:31 -0700
Subject: [PATCH 54/75] #654: Display time remaining for all floods protection

---
 lang/English/login.php  |    2 +-
 lang/English/misc.php   |    4 ++--
 lang/English/post.php   |    3 +--
 lang/English/search.php |    2 +-
 login.php               |    2 +-
 misc.php                |    4 ++--
 post.php                |    2 +-
 search.php              |    2 +-
 8 files changed, 10 insertions(+), 11 deletions(-)

diff --git a/lang/English/login.php b/lang/English/login.php
index 244ee06..ee282d8 100644
--- a/lang/English/login.php
+++ b/lang/English/login.php
@@ -21,6 +21,6 @@
 
 // Forget password mail stuff
 'Forget mail'				=>	'An email has been sent to the specified address with instructions on how to change your password. If it does not arrive you can contact the forum administrator at',
-'Email flood'				=>	'This account has already requested a password reset in the past hour. Please wait a while before requesting a new password again.'
+'Email flood'				=>	'This account has already requested a password reset in the past hour. Please wait %s minutes before requesting a new password again.'
 
 );
diff --git a/lang/English/misc.php b/lang/English/misc.php
index 9bca09c..e11c027 100644
--- a/lang/English/misc.php
+++ b/lang/English/misc.php
@@ -11,7 +11,7 @@
 'No email subject'				=>	'You must enter a subject.',
 'No email message'				=>	'You must enter a message.',
 'Too long email message'		=>	'Messages cannot be longer than 65535 characters (64 KB).',
-'Email flood'					=>	'At least %s seconds have to pass between sent emails. Please wait a while and try sending again.',
+'Email flood'					=>	'At least %s seconds have to pass between sent emails. Please wait %s seconds and try sending again.',
 'Email sent redirect'			=>	'Email sent. Redirecting ',
 'Send email to'					=>	'Send email to',
 'Email subject'					=>	'Subject',
@@ -22,7 +22,7 @@
 // Report
 'No reason'						=>	'You must enter a reason.',
 'Reason too long'				=>	'Your message must be under 65535 bytes (~64kb).',
-'Report flood'					=>	'At least %s seconds have to pass between reports. Please wait a while and try sending again.',
+'Report flood'					=>	'At least %s seconds have to pass between reports. Please wait %s seconds and try sending again.',
 'Report redirect'				=>	'Post reported. Redirecting ',
 'Report post'					=>	'Report post',
 'Reason'						=>	'Reason',
diff --git a/lang/English/post.php b/lang/English/post.php
index b89804b..4784a06 100644
--- a/lang/English/post.php
+++ b/lang/English/post.php
@@ -26,8 +26,7 @@
 'Subscribe'			=>	'Subscribe to this topic',
 'Stay subscribed'	=>	'Stay subscribed to this topic',
 'Topic review'		=>	'Topic review (newest first)',
-'Flood start'		=>	'At least',
-'flood end'			=>	'seconds have to pass between posts. Please wait a little while and try posting again.',
+'Flood start'		=>	'At least %s seconds have to pass between posts. Please wait %s seconds and try posting again.',
 'Preview'			=>	'Preview', // submit button to preview message
 
 // Edit post
diff --git a/lang/English/search.php b/lang/English/search.php
index b0f7fba..7029dac 100644
--- a/lang/English/search.php
+++ b/lang/English/search.php
@@ -6,7 +6,7 @@
 // The search form
 'User search'						=>	'User search',
 'No search permission'				=>	'You do not have permission to use the search feature.',
-'Search flood'						=>	'At least %s seconds have to pass between searches. Please wait a while and try searching again.',
+'Search flood'						=>	'At least %s seconds have to pass between searches. Please wait %s seconds and try searching again.',
 'Search'							=>	'Search',
 'Search criteria legend'			=>	'Enter your search criteria',
 'Search info'						=>	'To search by keyword, enter a term or terms to search for. Separate terms with spaces. Use AND, OR and NOT to refine your search. To search by author enter the username of the author whose posts you wish to search for. Use wildcard character * for partial matches.',
diff --git a/login.php b/login.php
index 1b11631..1a9ef2f 100644
--- a/login.php
+++ b/login.php
@@ -152,7 +152,7 @@
 				while ($cur_hit = $db->fetch_assoc($result))
 				{
 					if ($cur_hit['last_email_sent'] != '' && (time() - $cur_hit['last_email_sent']) < 3600 && (time() - $cur_hit['last_email_sent']) >= 0)
-						message($lang_login['Email flood'], true);
+						message(sprintf($lang_login['Email flood'], intval((3600 - (time() - $cur_hit['last_email_sent'])) / 60)), true);
 
 					// Generate a new password and a new password activation code
 					$new_password = random_pass(8);
diff --git a/misc.php b/misc.php
index 691cce9..064884e 100644
--- a/misc.php
+++ b/misc.php
@@ -111,7 +111,7 @@
 			message($lang_misc['Too long email message']);
 
 		if ($pun_user['last_email_sent'] != '' && (time() - $pun_user['last_email_sent']) < $pun_user['g_email_flood'] && (time() - $pun_user['last_email_sent']) >= 0)
-			message(sprintf($lang_misc['Email flood'], $pun_user['g_email_flood']));
+			message(sprintf($lang_misc['Email flood'], $pun_user['g_email_flood'], $pun_user['g_email_flood'] - (time() - $pun_user['last_email_sent'])));
 
 		// Load the "form email" template
 		$mail_tpl = trim(file_get_contents(PUN_ROOT.'lang/'.$pun_user['language'].'/mail_templates/form_email.tpl'));
@@ -219,7 +219,7 @@
 			message($lang_misc['Reason too long']);
 
 		if ($pun_user['last_report_sent'] != '' && (time() - $pun_user['last_report_sent']) < $pun_user['g_report_flood'] && (time() - $pun_user['last_report_sent']) >= 0)
-			message(sprintf($lang_misc['Report flood'], $pun_user['g_report_flood']));
+			message(sprintf($lang_misc['Report flood'], $pun_user['g_report_flood'], $pun_user['g_report_flood'] - (time() - $pun_user['last_report_sent'])));
 
 		// Get the topic ID
 		$result = $db->query('SELECT topic_id FROM '.$db->prefix.'posts WHERE id='.$post_id) or error('Unable to fetch post info', __FILE__, __LINE__, $db->error());
diff --git a/post.php b/post.php
index 6cd0542..313f1c2 100644
--- a/post.php
+++ b/post.php
@@ -61,7 +61,7 @@
 {
 	// Flood protection
 	if (!isset($_POST['preview']) && $pun_user['last_post'] != '' && (time() - $pun_user['last_post']) < $pun_user['g_post_flood'])
-		$errors[] = $lang_post['Flood start'].' '.$pun_user['g_post_flood'].' '.$lang_post['flood end'];
+		$errors[] = sprintf($lang_post['Flood start'], $pun_user['g_post_flood'], $pun_user['g_post_flood'] - (time() - $pun_user['last_post']));
 
 	// If it's a new topic
 	if ($fid)
diff --git a/search.php b/search.php
index fee1aec..3994b6c 100644
--- a/search.php
+++ b/search.php
@@ -123,7 +123,7 @@
 		{
 			// Flood protection
 			if ($pun_user['last_search'] && (time() - $pun_user['last_search']) < $pun_user['g_search_flood'] && (time() - $pun_user['last_search']) >= 0)
-				message(sprintf($lang_search['Search flood'], $pun_user['g_search_flood']));
+				message(sprintf($lang_search['Search flood'], $pun_user['g_search_flood'], $pun_user['g_search_flood'] - (time() - $pun_user['last_search'])));
 
 			if (!$pun_user['is_guest'])
 				$db->query('UPDATE '.$db->prefix.'users SET last_search='.time().' WHERE id='.$pun_user['id']) or error('Unable to update user', __FILE__, __LINE__, $db->error());
-- 
1.7.10


From a48201ec060f9381c8b24f1024c034fff5327eaf Mon Sep 17 00:00:00 2001
From: Quy Ton <quy@fluxbb.org>
Date: Mon, 8 Oct 2012 18:57:49 -0700
Subject: [PATCH 55/75] #743: Append pid to redirect_url in login.php since
 referer does not have anchor information

---
 login.php |    2 ++
 1 file changed, 2 insertions(+)

diff --git a/login.php b/login.php
index 1a9ef2f..c391c92 100644
--- a/login.php
+++ b/login.php
@@ -263,6 +263,8 @@
 
 if (!isset($redirect_url))
 	$redirect_url = 'index.php';
+else if (preg_match('%viewtopic\.php\?pid=(\d+)$%', $redirect_url, $matches))
+	$redirect_url .= '#p'.$matches[1];
 
 $page_title = array(pun_htmlspecialchars($pun_config['o_board_title']), $lang_common['Login']);
 $required_fields = array('req_username' => $lang_common['Username'], 'req_password' => $lang_common['Password']);
-- 
1.7.10


From 8021fdf87bb2244945f91e1d5173bfdd5af7f5da Mon Sep 17 00:00:00 2001
From: Franz Liedke <franz@develophp.org>
Date: Tue, 9 Oct 2012 10:34:40 +0200
Subject: [PATCH 56/75] Merge pull request #54 by Studio384.

Add support links in the admin panel.
This fixes #403.
---
 admin_index.php              |    4 ++++
 lang/English/admin_index.php |    7 +++++--
 2 files changed, 9 insertions(+), 2 deletions(-)

diff --git a/admin_index.php b/admin_index.php
index 6862f7d..1cdb174 100644
--- a/admin_index.php
+++ b/admin_index.php
@@ -76,6 +76,10 @@
 					<dd>
 						<a href="admin_statistics.php"><?php echo $lang_admin_index['View server statistics'] ?></a>
 					</dd>
+					<dt><?php echo $lang_admin_index['Support label'] ?></dt>
+					<dd>
+						<a href="http://fluxbb.org/forums/index.php"><?php echo $lang_admin_index['Forum label'] ?></a> - <a href="http://fluxbb.org/community/irc.html"><?php echo $lang_admin_index['IRC label'] ?></a>
+					</dd>
 				</dl>
 			</div>
 		</div>
diff --git a/lang/English/admin_index.php b/lang/English/admin_index.php
index 9172231..a304158 100644
--- a/lang/English/admin_index.php
+++ b/lang/English/admin_index.php
@@ -24,12 +24,15 @@
 'FluxBB version label'				=>	'FluxBB version',
 'Check for upgrade'					=>	'Check for upgrade',
 'FluxBB version data'				=>	'v%s - %s',
-'Server statistics label'					=>	'Server statistics',
+'Server statistics label'			=>	'Server statistics',
 'View server statistics'			=>	'View server statistics',
+'Support label'						=>	'Support',
+'Forum label'						=>	'Forum',
+'IRC label'							=>	'IRC channel',
 
 // Language definitions used in admin_statistics.php
 'PHPinfo disabled message'			=>	'The PHP function phpinfo() has been disabled on this server.',
-'Server statistics head'						=>	'Server statistics',
+'Server statistics head'			=>	'Server statistics',
 'Server load label'					=>	'Server load',
 'Server load data'					=>	'%s - %s user(s) online',
 'Environment label'					=>	'Environment',
-- 
1.7.10


From 0011b80b7c6c3c38bf65cb1d9190454e8db2c9a5 Mon Sep 17 00:00:00 2001
From: Quy Ton <quy@fluxbb.org>
Date: Wed, 10 Oct 2012 12:44:02 -0700
Subject: [PATCH 57/75] #743: Append pid to redirect_url when using email link
 in a post.

---
 misc.php |    2 ++
 1 file changed, 2 insertions(+)

diff --git a/misc.php b/misc.php
index 064884e..b5b5219 100644
--- a/misc.php
+++ b/misc.php
@@ -164,6 +164,8 @@
 
 	if (!isset($redirect_url))
 		$redirect_url = 'profile.php?id='.$recipient_id;
+	else if (preg_match('%viewtopic\.php\?pid=(\d+)$%', $redirect_url, $matches))
+		$redirect_url .= '#p'.$matches[1];
 
 	$page_title = array(pun_htmlspecialchars($pun_config['o_board_title']), $lang_misc['Send email to'].' '.pun_htmlspecialchars($recipient));
 	$required_fields = array('req_subject' => $lang_misc['Email subject'], 'req_message' => $lang_misc['Email message']);
-- 
1.7.10


From d7bcfa3a7386ffcb84c043e96fa743111b1829a4 Mon Sep 17 00:00:00 2001
From: Quy Ton <quy@fluxbb.org>
Date: Wed, 17 Oct 2012 09:10:43 -0700
Subject: [PATCH 58/75] #681: Use pun_htmlspecialchars in redirect calls to
 set parameters in htmlspecialchars.

---
 include/functions.php |    2 +-
 login.php             |    2 +-
 misc.php              |    2 +-
 3 files changed, 3 insertions(+), 3 deletions(-)

diff --git a/include/functions.php b/include/functions.php
index 7f36e53..23b788e 100644
--- a/include/functions.php
+++ b/include/functions.php
@@ -1362,7 +1362,7 @@ function redirect($destination_url, $message)
 	$page_title = array(pun_htmlspecialchars($pun_config['o_board_title']), $lang_common['Redirecting']);
 
 ?>
-<meta http-equiv="refresh" content="<?php echo $pun_config['o_redirect_delay'] ?>;URL=<?php echo str_replace(array('<', '>', '"'), array('&lt;', '&gt;', '&quot;'), $destination_url) ?>" />
+<meta http-equiv="refresh" content="<?php echo $pun_config['o_redirect_delay'] ?>;URL=<?php echo $destination_url ?>" />
 <title><?php echo generate_page_title($page_title) ?></title>
 <link rel="stylesheet" type="text/css" href="style/<?php echo $pun_user['style'].'.css' ?>" />
 <?php
diff --git a/login.php b/login.php
index c391c92..d41accd 100644
--- a/login.php
+++ b/login.php
@@ -84,7 +84,7 @@
 	// Reset tracked topics
 	set_tracked_topics(null);
 
-	redirect(htmlspecialchars($_POST['redirect_url']), $lang_login['Login redirect']);
+	redirect(pun_htmlspecialchars($_POST['redirect_url']), $lang_login['Login redirect']);
 }
 
 
diff --git a/misc.php b/misc.php
index b5b5219..304d316 100644
--- a/misc.php
+++ b/misc.php
@@ -133,7 +133,7 @@
 
 		$db->query('UPDATE '.$db->prefix.'users SET last_email_sent='.time().' WHERE id='.$pun_user['id']) or error('Unable to update user', __FILE__, __LINE__, $db->error());
 
-		redirect(htmlspecialchars($_POST['redirect_url']), $lang_misc['Email sent redirect']);
+		redirect(pun_htmlspecialchars($_POST['redirect_url']), $lang_misc['Email sent redirect']);
 	}
 
 
-- 
1.7.10


From 35e3df98ea1e186c36b01c46b1668325734ba28f Mon Sep 17 00:00:00 2001
From: Quy Ton <quy@fluxbb.org>
Date: Thu, 18 Oct 2012 11:54:37 -0700
Subject: [PATCH 59/75] #693: Add function to serve XHTML with the correct
 MIME type

---
 header.php                       |    4 +++-
 include/functions.php            |   21 +++++++++++++++++++--
 include/template/admin.tpl       |    1 -
 include/template/help.tpl        |    1 -
 include/template/main.tpl        |    1 -
 include/template/maintenance.tpl |    1 -
 include/template/redirect.tpl    |    1 -
 7 files changed, 22 insertions(+), 8 deletions(-)

diff --git a/header.php b/header.php
index 280a0de..362588a 100644
--- a/header.php
+++ b/header.php
@@ -17,7 +17,7 @@
 header('Pragma: no-cache'); // For HTTP/1.0 compatibility
 
 // Send the Content-type header in case the web server is setup to send something else
-header('Content-type: application/xhtml+xml; charset=utf-8');
+header('Content-type: '.get_mime().'; charset=utf-8');
 
 // Load the template
 if (defined('PUN_ADMIN_CONSOLE'))
@@ -78,6 +78,8 @@
 // Define $p if it's not set to avoid a PHP notice
 $p = isset($p) ? $p : null;
 
+echo '<meta http-equiv="Content-Type" content="'.get_mime().'; charset=utf-8" />'."\n";
+
 // Is this a page that we want search index spiders to index?
 if (!defined('PUN_ALLOW_INDEX'))
 	echo '<meta name="ROBOTS" content="NOINDEX, FOLLOW" />'."\n";
diff --git a/include/functions.php b/include/functions.php
index 23b788e..ff8ef77 100644
--- a/include/functions.php
+++ b/include/functions.php
@@ -1182,7 +1182,7 @@ function maintenance_message()
 	header('Pragma: no-cache'); // For HTTP/1.0 compatibility
 
 	// Send the Content-type header in case the web server is setup to send something else
-	header('Content-type: text/html; charset=utf-8');
+	header('Content-type: '.get_mime().'; charset=utf-8');
 
 	// Deal with newlines, tabs and multiple spaces
 	$pattern = array("\t", '  ', '  ');
@@ -1240,6 +1240,7 @@ function maintenance_message()
 	$page_title = array(pun_htmlspecialchars($pun_config['o_board_title']), $lang_common['Maintenance']);
 
 ?>
+<meta http-equiv="Content-Type" content="<?php echo get_mime() ?>; charset=utf-8" />
 <title><?php echo generate_page_title($page_title) ?></title>
 <link rel="stylesheet" type="text/css" href="style/<?php echo $pun_user['style'].'.css' ?>" />
 <?php
@@ -1309,7 +1310,7 @@ function redirect($destination_url, $message)
 	header('Pragma: no-cache'); // For HTTP/1.0 compatibility
 
 	// Send the Content-type header in case the web server is setup to send something else
-	header('Content-type: text/html; charset=utf-8');
+	header('Content-type: '.get_mime().'; charset=utf-8');
 
 	if (file_exists(PUN_ROOT.'style/'.$pun_user['style'].'/redirect.tpl'))
 	{
@@ -1362,6 +1363,7 @@ function redirect($destination_url, $message)
 	$page_title = array(pun_htmlspecialchars($pun_config['o_board_title']), $lang_common['Redirecting']);
 
 ?>
+<meta http-equiv="Content-Type" content="<?php echo get_mime() ?>; charset=utf-8" />
 <meta http-equiv="refresh" content="<?php echo $pun_config['o_redirect_delay'] ?>;URL=<?php echo $destination_url ?>" />
 <title><?php echo generate_page_title($page_title) ?></title>
 <link rel="stylesheet" type="text/css" href="style/<?php echo $pun_user['style'].'.css' ?>" />
@@ -2010,6 +2012,21 @@ function forum_is_writable($path)
 }
 
 
+//
+// This function returns the correct mime type to serve with XHTML
+//
+function get_mime()
+{
+	if (isset($_SERVER['HTTP_ACCEPT']) && strpos($_SERVER['HTTP_ACCEPT'], 'application/xhtml+xml') !== false)
+		return 'application/xhtml+xml';
+	// special check for the W3C validation service
+	else if (isset($_SERVER['HTTP_USER_AGENT']) && strpos($_SERVER['HTTP_USER_AGENT'], 'W3C_Validator') !== false)
+		return 'application/xhtml+xml';
+	else
+		return 'text/html';
+}
+
+
 // DEBUG FUNCTIONS BELOW
 
 //
diff --git a/include/template/admin.tpl b/include/template/admin.tpl
index b81df2d..daf8e54 100644
--- a/include/template/admin.tpl
+++ b/include/template/admin.tpl
@@ -1,7 +1,6 @@
 <!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
 <html xmlns="http://www.w3.org/1999/xhtml" xml:lang="<pun_language>" lang="<pun_language>" dir="<pun_content_direction>">
 <head>
-<meta http-equiv="Content-Type" content="application/xhtml+xml; charset=utf-8" />
 <pun_head>
 </head>
 
diff --git a/include/template/help.tpl b/include/template/help.tpl
index 7e5163a..ec93d77 100644
--- a/include/template/help.tpl
+++ b/include/template/help.tpl
@@ -1,7 +1,6 @@
 <!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
 <html xmlns="http://www.w3.org/1999/xhtml" xml:lang="<pun_language>" lang="<pun_language>" dir="<pun_content_direction>">
 <head>
-<meta http-equiv="Content-Type" content="application/xhtml+xml; charset=utf-8" />
 <pun_head>
 </head>
 
diff --git a/include/template/main.tpl b/include/template/main.tpl
index 956f204..135e299 100644
--- a/include/template/main.tpl
+++ b/include/template/main.tpl
@@ -1,7 +1,6 @@
 <!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
 <html xmlns="http://www.w3.org/1999/xhtml" xml:lang="<pun_language>" lang="<pun_language>" dir="<pun_content_direction>">
 <head>
-<meta http-equiv="Content-Type" content="application/xhtml+xml; charset=utf-8" />
 <pun_head>
 </head>
 
diff --git a/include/template/maintenance.tpl b/include/template/maintenance.tpl
index 92c7ff4..f3283ea 100644
--- a/include/template/maintenance.tpl
+++ b/include/template/maintenance.tpl
@@ -1,7 +1,6 @@
 <!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
 <html xmlns="http://www.w3.org/1999/xhtml" xml:lang="<pun_language>" lang="<pun_language>" dir="<pun_content_direction>">
 <head>
-<meta http-equiv="Content-Type" content="application/xhtml+xml; charset=utf-8" />
 <pun_head>
 </head>
 
diff --git a/include/template/redirect.tpl b/include/template/redirect.tpl
index 507d540..ec475b0 100644
--- a/include/template/redirect.tpl
+++ b/include/template/redirect.tpl
@@ -1,7 +1,6 @@
 <!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
 <html xmlns="http://www.w3.org/1999/xhtml" xml:lang="<pun_language>" lang="<pun_language>" dir="<pun_content_direction>">
 <head>
-<meta http-equiv="Content-Type" content="application/xhtml+xml; charset=utf-8" />
 <pun_head>
 </head>
 
-- 
1.7.10


From 04aa2592bb45e1ad5b3bb9cc89177e69eb41fca2 Mon Sep 17 00:00:00 2001
From: Studio384 <yannick.franssen@hotmail.com>
Date: Fri, 19 Oct 2012 23:58:39 +0200
Subject: [PATCH 60/75] #751: Technetium doesn't use border radius in IE

---
 style/Technetium.css |  479 ++++++++++++++++++++++++--------------------------
 1 file changed, 232 insertions(+), 247 deletions(-)

diff --git a/style/Technetium.css b/style/Technetium.css
index 4071641..5534597 100644
--- a/style/Technetium.css
+++ b/style/Technetium.css
@@ -1,7 +1,5 @@
 /*****************************************************************
 Technitium theme CSS
-
-Yes, it is valid CSS 3, but unfortunately border-radius doesn't seem to work correctly in my Firefox version so I have to give it the moz versions, which break the validator. Sorry.
 *****************************************************************/
 
 /*****************************************************************
@@ -17,11 +15,11 @@ Yes, it is valid CSS 3, but unfortunately border-radius doesn't seem to work cor
 	margin: 0;
 	padding: 0;
 	border: 0;
-	}
+}
 
 .pun ul, .pun ol {
 	list-style: none
-	}
+}
 
 
 /* Structural Settings
@@ -34,7 +32,7 @@ body {
 .pun {
 	width: 95%;
 	margin: 0 auto;
-	}
+}
 
 .pun .clearer, .pun .nosize {
 	height: 0;
@@ -42,30 +40,30 @@ body {
 	line-height: 0;
 	font-size: 0;
 	overflow: hidden
-	}
+}
 
 .pun .clearer, .pun .clearb {
 	clear: both
-	}
+}
 
 .pun .nosize {
 	position: absolute;
 	left: -9999em;
 	text-indent: -9999em;
 	width: 0;
-	}
+}
 
 * html .inbox, * html .inform, * html .pun, * html .tclcon, * html .codebox {
 	height: 1px
-	}
+}
 
 .pun, .pun .inbox, .pun .inform, .pun .tclcon, .pun .codebox {
 	min-height: 1px
-	}
+}
 
 .clearl {
 	clear: left;
-	}
+}
 
 /* Hidden Elements
 ----------------------------------------------------------------*/
@@ -78,7 +76,7 @@ body {
 	width: 0;
 	left: -9999em;
 	text-indent: -9999em;
-	}
+}
 
 /*****************************************************************
 2. TEXT & CONTENT
@@ -89,33 +87,33 @@ body {
 
 .pun {
 	font: 10pt Georgia, Times, "Times New Roman", serif
-	}
+}
 
 .pun table, .pun td, .pun th, .pun input, .pun select, .pun optgroup, .pun textarea, .pun samp, .pun legend {
 	font-size: 1em;
 	font-family: Georgia, Times, "Times New Roman", serif;
-	}
+}
 
 .pun pre, .pun code {
 	font-size: 1.182em;
 	font-family: consolas, monaco, "bitstream vera sans mono", "courier new", courier, monospace
-	}
+}
 
 .pun pre code {
 	font-size: 1em;
-	}
+}
 
 .pun strong {
 	font-weight: bold;
-	}
+}
 
 .pun em {
 	font-style: italic;
-	}
+}
 
 #vf td {
 	font-size: 1.1em;
-	}
+}
 
 
 /* Content Defaults
@@ -124,44 +122,42 @@ body {
 .pun p, .pun ul, .pun ol, .pun dl {
 	font-size: 1em;
 	padding: 3px 0;
-	}
+}
 
 .pun h2 {
 	font-size: 1.5em;
 	font-weight: normal;
 	padding: 4px 6px;
 	padding: 6px;
-	-moz-border-radius-topleft: 0.3em;
-	-moz-border-radius-topright: 0.3em;
-	-webkit-border-top-left-radius: 0.3em;
-	-webkit-border-top-right-radius: 0.3em;
-	}
+	border-radius-topleft: 0.3em;
+	border-radius-topright: 0.3em;
+}
 
 .pun h2 #brdmenu {
 	font-size: 1.1em;
-	}
+}
 
 .pun .blockpost h2 {
 	font-size: 1.0em;
 	padding: 8px;
-	}
+}
 
 .pun h3 {
 	font-size: 1.091em;
 	padding: 3px 0;
-	}
+}
 
 .pun table p, .pun table h3 {
 	padding: 0;
-	}
+}
 
 .pun span.warntext, .pun p.warntext {
 	font-weight: bold
-	}
+}
 
 .pun .postleft dl dt {
 	font-size: 1.4em;
-	}
+}
 
 /* User Content (Announcements, Rules, Posts)
 ----------------------------------------------------------------*/
@@ -169,77 +165,77 @@ body {
 .pun .usercontent p, .pun .postmsg p {
 	padding: 0.5em 0;
 	line-height: 1.6em;
-	}
+}
 
 .pun .usercontent ul, .pun .postmsg ul {
 	padding: 0.75em 1em 0.75em 2.5em;
 	list-style: disc
-	}
+}
 
 .pun .usercontent ol, .pun .postmsg ol {
 	padding: 0.75em 1em 0.75em 2.5em;
 	list-style: decimal
-	}
+}
 
 .pun .usercontent ol.alpha, .pun .postmsg ol.alpha {
 	list-style: lower-alpha
-	}
+}
 
 .pun .usercontent li ol, .pun .usercontent li ul, .pun .postmsg li ol, .pun .postmsg li ul {
 	padding: 0.25em 1em 0.75em 2.5em
-	}
+}
 
 .pun .usercontent li p, .pun .postmsg li p {
 	padding: 0
-	}
+}
 
 .pun .usercontent h1 {
 	font-size: 1.4em;
 	font-weight: bold;
 	padding: 0.75em 0 0 0
-	}
+}
 
 .pun .usercontent h2 {
 	font-size: 1.2em;
 	font-weight: bold;
 	padding: 0.75em 0 0 0
-	}
+}
 
 .pun .usercontent h3 {
 	font-size: 1.1em;
 	font-weight: bold;
 	padding: 0.75em 0 0 0
-	}
+}
 
 .pun .usercontent h4, .pun .usercontent h5, .pun .usercontent h6 {
 	font-size: 1em;
 	font-weight: bold;
 	padding: 0.75em 0 0 0
-	}
+}
 
 .pun .quotebox cite {
 	font-weight: bold;
 	font-style: normal;
 	padding: 0.75em 0.75em 0 0.75em
-	}
+}
 
 .pun span.bbu {
 	text-decoration: underline
-	}
+}
 
 .pun span.bbs, .pun del {
 	text-decoration: line-through;
-	}
+}
 
 .pun .postmsg ins, #punhelp samp ins {
 	text-decoration: none;
-	}
+}
 
 .pun div.postmsg h5, #punhelp h5 {
 	font-size: 1.1em;
 	font-weight: bold;
 	padding: 0.75em 0 0 0;
-	}
+}
 
 /*****************************************************************
 3. COMMON STYLES
@@ -250,12 +246,12 @@ body {
 
 .pun {
 	margin: 12px 20px
-	}
+}
 
 #punredirect, #punmaint, #puninstall, #pundb_update {
 	margin: 50px 20% 12px 20%;
 	width: auto;
-	}
+}
 
 
 /* Vertical Element Spacing
@@ -263,35 +259,35 @@ body {
 
 #brdheader {
 	margin: 0 0 12px 0;
-	}
+}
 
 #announce, #brdstats {
 	margin: 12px 0 12px 0;
-	}
+}
 
 .pun .blocktable, .pun .block, .pun .blockform, .pun .block2col, #postreview {
 	margin-bottom: 12px
-	}
+}
 
 #punindex .blocktable, .pun .blockpost {
 	margin-bottom: 6px
-	}
+}
 
 #postreview .box {
 	margin-bottom: 3px;
-	}
+}
 
 .pun .block2col .blockform, .pun .block2col .block {
 	margin-bottom: 0px
-	}
+}
 
 .pun .linkst, .pun .linksb {
 	margin-top: -12px
-	}
+}
 
 .pun .postlinksb {
 	margin-top: -6px
-	}
+}
 
 
 /* External Borders
@@ -300,7 +296,7 @@ body {
 .pun .box {
 	border-style: solid;
 	border-width: 1px;
-	}
+}
 
 
 .pun h2 {
@@ -315,7 +311,7 @@ body {
 
 .pun .block .inbox, .pun .blockmenu .inbox {
 	padding: 3px 6px
-	}
+}
 
 /*****************************************************************
 4. COMMON BOARD ELEMENTS
@@ -328,20 +324,20 @@ body {
 	font-size: 1.5em;
 	line-height: 1.1em;
 	padding: 3px 0 0 0;
-	}
+}
 
 #brdmenu {
 	font-size:1.2em;
-	}
+}
 
 #brddesc {
 	padding: 3px 0;
-	}
+}
 
 #brddesc * {
 	padding-top: 0;
 	padding-bottom: 0;
-	}
+}
 
 
 #brdmenu li {
@@ -349,19 +345,19 @@ body {
 	margin-right: 10px;
 	margin-top: 12px;
 	margin-bottom: 12px;
-	}
+}
 
 
 #brdmenu a:link, #brdmenu a:visited {
 	text-decoration: none;
 	text-shadow: #FFF 1px -1px 0.4em;
 	padding: 0.2em;
-	}
+}
 
 #brdwelcome .conl {
 	float: left;
 	white-space: nowrap;
-	}
+}
 
 #brdwelcome li {
 	float:left;
@@ -371,87 +367,87 @@ body {
 
 #brdwelcome .conl li strong:after {
 	content: '.'
-	}
+}
 
 #brdwelcome .conr {
 	float: right;
 	text-align: right;
-	}
+}
 
 #brdwelcome .conr li {
 	float: right;
 	text-align: right;
-	}
+}
 
 /* Breadcrumbs and Post Links
 ----------------------------------------------------------------*/
 
 .pun .linkst {
 	padding: 8px 6px 3px 6px
-	}
+}
 
 .pun .linksb, .pun .postlinksb {
 	padding: 3px 6px 8px 6px
-	}
+}
 
 .pun .crumbs {
 	clear: both;
 	width: 100%;
 	overflow: hidden;
-	}
+}
 
 .pun .crumbs li {
 	display: inline;
 	white-space: nowrap;
 	font-weight: bold;
-	}
+}
 
 .pun .linkst .crumbs {
 	font-size: 1.3em;
-	}
+}
 
 .pun .pagelink {
 	float: left;
 	display: block;
 	white-space: normal;
-	}
+}
 
 .pun .postlink {
 	font-size: 1.1em;
 	font-weight: bold;
 	white-space: wrap;
 	text-decoration: none;
-	}
+}
 
 .pun .linkst .postlink {
 	position: relative;
 	margin-top: -0.2em;
 	margin-bottom: 0.5em;
-	}
+}
 
 .pun .linksb .postlink, .pun .postlinksb .postlink {
 	position: relative;
 	margin-top: 0.5em;
 	margin-bottom: -0.5em;
-	}
+}
 
 .pun .postlink, .pun .modbuttons {
 	float: right;
 	text-align: right;
-	}
+}
 
 .pun .modbuttons {
 	padding: 1px 0;
 	white-space: nowrap;
-	}
+}
 
 .pun .modbuttons input {
 	margin-left: 6px;
-	}
+}
 
 #punindex .subscribelink {
 	margin-top: 6px;
-	}
+}
 
 /* Board Footer
 ----------------------------------------------------------------*/
@@ -460,21 +456,21 @@ body {
 	border-bottom-style: solid;
 	border-bottom-width: 1px;
 	text-align: center;
-	}
+}
 
 #brdfooter #modcontrols dd {
 	display: inline;
 	margin-right: 10px;
-	}
+}
 
 #brdfooter .conl {
 	float: left;
-	}
+}
 
 #brdfooter .conr {
 	float: right;
 	text-align: right;
-	}
+}
 
 #brdfooter #feedlinks span {
 	background:url("Technetium/feed.png") no-repeat scroll left center transparent;
@@ -488,16 +484,16 @@ body {
 
 #brdstats .conl {
 	float: left;
-	}
+}
 
 #brdstats .conr {
 	float: right;
 	text-align: right;
-	}
+}
 
 #onlinelist dd, #onlinelist dt {
 	display: inline;
-	}
+}
 
 
 /*****************************************************************
@@ -509,80 +505,80 @@ body {
 	border-collapse: collapse;
 	border-spacing: 0;
 	empty-cells: show;
-	}
+}
 
 .pun .blocktable table {
 	table-layout: fixed;
-	}
+}
 
 .pun td, .pun th {
 	padding: 4px 6px;
 	line-height: 1.4em;
 	text-align: left;
 	font-weight: normal;
-	}
+}
 
 .pun td {
 	border-style: solid none none solid;
 	border-width: 1px;
-	}
+}
 
 .pun .tcl {
 	border-left: 0;
 	width: auto;
-	}
+}
 
 .pun .tc2, .pun .tc3, .pun .tcmod {
 	width: 10%;
 	text-align: center;
 	padding: 4px 0;
-	}
+}
 
 .pun .tcr {
 	width: 30%;
-	}
+}
 
 .pun .tcl h3 {
 	font-size: 1.3em;
 	font-weight: bold;
-	}
+}
 
 .pun .tcl span.newtext, .pun .tcl span.pagestext {
 	white-space: nowrap
-	}
+}
 
 .pun .tcl p {
 	padding: 5px 0 0 0
-	}
+}
 
 #punsearch #vf .tc2 {
 	width: 18%;
 	text-align: left;
 	padding: 4px 6px;
-	}
+}
 
 #users1 .tcr {
 	width: 25%
-	}
+}
 
 #users1 .tc2 {
 	width: 25%;
 	text-align: left;
 	padding: 4px 6px;
-	}
+}
 
 #debug .tcl {
 	width: 10%
-	}
+}
 
 #debug .tcr {
 	width: 90%;
 	white-space: normal
-	}
+}
 
 #punindex .tcr .byuser {
 	display: block
-	}
+}
 
 .pun .blocktable .tclcon {
 	padding: 0 11px 0 12px;
@@ -590,26 +586,26 @@ body {
 	height: 1%;
 	min-height: 1px;
 	position: relative;
-	}
+}
 
 .pun .blocktable .tclcon div {
 	width: 100%;
 	overflow: hidden;
-	}
+}
 
 .pun .icon {
 	height: 24px;
 	width: 24px;
 	overflow: hidden;
 	float: left;
-	}
+}
 
 .pun .icon div {
 	position: absolute;
 	left: -9999em;
 	text-indent: -9999em;
 	height: 0;
-	}
+}
 
 .pun .iposted .ipost {
 	position: absolute;
@@ -619,11 +615,11 @@ body {
 	padding-left: 4px;
 	text-align: center;
 	top: 0;
-	}
+}
 
 .pun .stickytext {
 	display: none;
-	}
+}
 
 .pun .movedtext {
 	display: none;
@@ -631,7 +627,7 @@ body {
 
 .pun .closedtext {
 	font-weight: bold;
-	}
+}
 /*****************************************************************
 6. MAIN FORMS
 *****************************************************************/
@@ -642,11 +638,11 @@ body {
 	padding: 9px 10px;
 	border-style: solid;
 	border-width: 1px;
-	}
+}
 
 .pun .forminfo h3 {
 	font-weight: bold;
-	}
+}
 
 
 
@@ -707,31 +703,31 @@ body {
 .pun label {
 	display: block;
 	padding: 3px 0
-	}
+}
 
 .pun label.conl {
 	float: left;
 	overflow: visible;
 	margin-right: 10px
-	}
+}
 
 .pun select {
 	padding-top: 1px;
 	padding-bottom: 1px;
-	}
+}
 
 .pun fieldset .rbox {
-	}
+}
 
 .pun fieldset .rbox br {
 	display: none;
-	}
+}
 
 .pun fieldset .rbox label {
 	padding: 3px 0 3px 25px;
 	position: relative;
 	vertical-align: middle;
-	}
+}
 
 .pun fieldset .rbox input {
 	margin: 0 9px 0 -25px;
@@ -739,50 +735,50 @@ body {
 	width: 16px;
 	position: relative;
 	vertical-align: middle;
-	}
+}
 
 .pun .txtarea {
 	width: 90%
-	}
+}
 
 .pun .txtarea textarea, .pun input.longinput {
 	width: 100%
-	}
+}
 
 .pun .bblinks {
 	padding-bottom: 10px;
 	padding-left: 4px
-	}
+}
 
 .pun .bblinks li {
 	display: inline;
 	padding-right: 20px
-	}
+}
 
 .pun .blockform .buttons {
 	padding-left: 18px;
 	padding-bottom: 5px;
-	}
+}
 
 .pun .blockform .buttons input {
 	margin-right: 8px;
-	}
+}
 
 #posterror ul {
 	list-style: square;
 	padding: 3px 0 3px 24px;
-	}
+}
 
 .pun .deletemsg {
 	border-style: solid;
 	border-width: 1px;
 	padding: 6px 15px;
-	}
+}
 
 .pun .multiselect {
 	float: left;
 	padding-bottom: 7px;
-	}
+}
 
 .pun .checklist {
 	border-width: 1px;
@@ -792,16 +788,16 @@ body {
 	overflow: auto;
 	padding: 0.25em 0.5em;
 	margin: 0.25em 16px 0 0.15em;
-	}
+}
 
 .pun .checklist legend {
 	padding: 0;
-	}
+}
 
 .pun .checklist legend span {
 	width: auto;
 	max-width: 25em;
-	}
+}
 
 /*****************************************************************
 7. PROFILES AND ADMIN
@@ -809,51 +805,51 @@ body {
 
 .pun .block2col {
 	padding-bottom: 1px
-	}
+}
 
 .pun .block2col .blockform, .pun .block2col .block {
 	margin-left: 14em
-	}
+}
 
 .pun .blockmenu {
 	float:left;
 	width: 13em
-	}
+}
 
 .pun .blockmenu li {
 	padding: 3px 0;
 	font-weight: bold;
-	}
+}
 
 .pun .blockmenu a:link, .pun .blockmenu a:visited {
 	text-decoration: none
-	}
+}
 
 .pun .blockmenu a:hover, .pun .blockmenu a:active {
 	text-decoration: underline
-	}
+}
 
 #viewprofile dl {
 	float: left;
 	width: 100%;
 	overflow: hidden
-	}
+}
 
 #viewprofile dd {
 	margin-left: 14em;
 	padding: 3px;
-	}
+}
 
 #viewprofile dt {
 	float: left;
 	width: 13em;
 	margin: 3px 0;
-	}
+}
 
 #profileavatar img {
 	float: right;
 	margin-left: 1em
-	}
+}
 
 /*****************************************************************
 8. MAIN POSTS
@@ -861,24 +857,24 @@ body {
 
 .pun .blockpost h2 a:link, .pun .blockpost h2 a:visited {
 	text-decoration: none;
-	}
+}
 
 .pun .blockpost h2 a:hover, .pun .blockpost h2 a:active {
 	text-decoration: underline;
-	}
+}
 
 .pun .blockpost h2 .conr {
 	float: right;
 	text-align: right;
-	}
+}
 
 #punsearch .blockpost h2 span {
 	white-space: nowrap;
-	}
+}
 
 .pun .blockpost .box {
 	overflow: hidden;
-	}
+}
 
 .pun .postleft, .pun .postfootleft {
 	float:left;
@@ -886,82 +882,82 @@ body {
 	overflow: hidden;
 	position: relative;
 	overflow: hidden;
-	}
+}
 
 .pun .postleft dl {
 	padding: 0.5em 6px;
-	}
+}
 
 .pun .postleft .usercontacts, .pun .postleft .icon {
 	margin-top: 6px
-	}
+}
 
 .pun .postleft .postavatar, .pun .postleft .usertitle {
 	margin-bottom: 6px;
 	display: block;
-	}
+}
 
 .pun .blockpost dt {
 	font-size: 1.091em;
 	font-weight: bold;
-	}
+}
 
 .pun .blockpost dt a:link, .pun .blockpost dt a:visited {
 	text-decoration: none;
-	}
+}
 
 .pun .blockpost dt a:hover, .pun .blockpost dt a:active {
 	text-decoration: underline;
-	}
+}
 
 .pun .postright, .pun .postfootright {
 	border-left-width: 18em;
 	border-left-style: solid
-	}
+}
 
 #postpreview .postright {
 	border-left: 0
-	}
+}
 
 .pun .postright {
 	padding: 0 6px;
-	}
+}
 
 .pun .postfootright, .pun .multidelete {
 	text-align: right
-	}
+}
 
 .pun .postmsg {
 	width:98%;
 	overflow: hidden;
 	padding-bottom: 6px;
 	word-wrap: break-word;
-	}
+}
 
 .pun .postfootright ul, .pun .postfootright div, .pun .postfootright p,
 .pun .postfootleft p {
 	padding: 6px 6px 6px 6px;
-	}
+}
 
 .pun .postfootright li {
 	display: inline;
-	}
+}
 
 .pun .postfootright li:before {
 	content: " | ";
-	}
+}
 
 .pun .postfootright li:first-child:before {
 	content: "";
-	}
+}
 
 .pun .postfootright a:link, .pun .postfootright a:visited {
 	text-decoration: none
-	}
+}
 
 .pun .postfootright a:hover, .pun .postfootright a:active {
 	text-decoration: underline
-	}
+}
 
 
 .pun .quotebox, .pun .codebox {
@@ -970,51 +966,51 @@ body {
 	border-left: 5px solid;
 	margin: 0.75em 1em;
 	padding: 0 0.75em;
-	}
+}
 
 .pun .quotebox cite {
 	display: block;
 	padding: 0.75em 0 0 0;
-	}
+}
 
 .pun .quotebox blockquote {
 	width: 100%;
 	overflow: hidden
-	}
+}
 
 .pun .codebox pre {
 	overflow: auto;
 	width: 100%;
 	overflow-y:hidden
-	}
+}
 
 * html .pun .codebox pre {
 	padding-bottom: 10px;
-	}
+}
 
 *+html .pun .codebox pre {
 	padding-bottom: 10px
-	}
+}
 
 .pun .codebox pre code {
 	display: block;
 	padding: 0.75em;
-	}
+}
 
 .pun .codebox pre.vscroll {
 	height: 32em;
 	overflow: auto;
 	overflow-y: auto
-	}
+}
 
 .pun .postmsg .postimg img, .pun .postmsg a .postimg img {
 	max-width: 100%;
 	vertical-align: middle;
-	}
+}
 
 .pun .postmsg img {
 	vertical-align: bottom;
-	}
+}
 
 .pun .postsignature hr {
 	margin-left: 0px;
@@ -1022,7 +1018,7 @@ body {
 	text-align: left;
 	height: 1px;
 	border:none
-	}
+}
 
 .pun .blockpost label {
 	padding: 3px 6px;
@@ -1030,13 +1026,13 @@ body {
 	border-width: 1px;
 	vertical-align: middle;
 	display: inline-block;
-	}
+}
 
 .pun .blockpost label * {
 	vertical-align: middle;
 	margin: 0;
 	padding: 0;
-	}
+}
 
 
 /****************************************************************/
@@ -1045,11 +1041,11 @@ body {
 
 #punhelp h2 {
 	margin-top: 12px
-	}
+}
 
 #punhelp div.box {
 	padding: 10px
-	}
+}
 
 /*****************************************************************
 COLOUR SCHEME
@@ -1061,18 +1057,18 @@ COLOUR SCHEME
 body {
 	background: #fff url("Technetium/bg.png") repeat-x top;
 	color: #122434
-	}
+}
 
 .pun {
 	color: #122434
-	}
+}
 
 .pun .box, #adminconsole fieldset th {
 	background-color: #FBFCFD;
 	background-image: url("Technetium/light-shade.png");
 	background-position: bottom;
 	background-repeat: repeat-x;
-	}
+}
 
 .pun td.tc2, .pun td.tc3, .pun td.tcmod, #postpreview, #viewprofile dd, .pun .forminfo,
 #brdfooter #modcontrols, #adminconsole fieldset td, .pun .blockmenu .box, #adstats dd {
@@ -1080,7 +1076,7 @@ body {
 	background-image: url("Technetium/light-shade.png");
 	background-repeat: repeat-x;
 	background-position: bottom;
-	}
+}
 
 .pun h2, #brdmenu {
 	background-color: #C5D8EB;
@@ -1088,7 +1084,7 @@ body {
 	background-image: url("Technetium/dark-shade.png");
 	background-repeat: repeat-x;
 	background-position: top;
-	}
+}
 
 .pun h2  {
 	background-color: #C5D8EB;
@@ -1096,11 +1092,11 @@ body {
 	background-repeat: repeat-x;
 	color: #122434;
 	text-shadow: #FFF 1px -1px 0.7em;
-	}
+}
 
 .pun #announce h2  {
 	display: none;
-	}
+}
 
 .box #announce-block {
 	background-color: #FDFCE3;
@@ -1110,43 +1106,43 @@ body {
 	background-color: #EFF3F8;
 	background-image: url("Technetium/light-shade.png");
 	background-repeat: repeat-x;
-	}
+}
 
 .pun td {
 	background-image: url("Technetium/light-shade.png");
 	background-color: #FBFCFD;
 	background-position: bottom;
 	background-repeat: repeat-x;
-	}
+}
 
 .pun .isticky td {
 	background-color: #E4EBF1;
-	}
+}
 
 .pun .iclosed td {
 	background-color: #ECEEF0
-	}
+}
 
 .pun .iclosed.isticky td {
 	background-color: #CDD6E0;
-	}
+}
 
 .pun legend {
 	color: #122434
-	}
+}
 
 .pun .blockmenu li.isactive a, #posterror li strong {
 	color: #333
-	}
+}
 
 .pun .usercontent * {
 	background: transparent;
 	color: #333
-	}
+}
 
 #adminmenu .box {
 	background: #FBFCFD;
-	}
+}
 
 .pun .postlink a:link, .pun .postlink a:visited, .pun .postlink a:active  {
 	background-color:#F0F5FA;
@@ -1158,18 +1154,12 @@ body {
 	padding: 0.3em;
 	border-radius: 0.4em;
 	position: relative;
-	-moz-border-radius: 0.4em;
-	-webkit-border-top-left-radius: 0.4em;
-	-webkit-border-top-right-radius: 0.4em;
-	-webkit-border-bottom-left-radius: 0.4em;
-	-webkit-border-bottom-right-radius: 0.4em;
-
-	}
+}
 
 .pun .postlink a:hover {
 	background-color: #C0D6E9;
 	color: #000;
-	}
+}
 
 #brdheader .box {
 	background-color:#F0F5FA;
@@ -1178,19 +1168,14 @@ body {
 	background-position: top;
 	color:#122434;
 	border-radius: 0.4em;
-	-moz-border-radius: 0.4em;
-	-webkit-border-top-left-radius: 0.4em;
-	-webkit-border-top-right-radius: 0.4em;
-	-webkit-border-bottom-left-radius: 0.4em;
-	-webkit-border-bottom-right-radius: 0.4em;
-	}
+}
 
 .pun #brdtitle {
 	background-color: #D1E1EF;
 	background-image: url("Technetium/inv-shade.png");
 	background-repeat: repeat-x;
 	text-shadow: #FFF 1px -1px 0.4em;
-	}
+}
 
 
 .pun .infldset, #pundelete .deletemsg, #adintro .inbox, #adstats .inbox {
@@ -1202,56 +1187,56 @@ body {
 	list-style-type: disc;
 	margin-left: 8px;
 	padding-left: 16px;
-	}
+}
 
 .pun .multiselect {
 	color: #122434;
-	}
+}
 
 .pun .checklist {
 	background: white;
 	border-color: #A2B5CC;
-	}
+}
 
 /* Posts
 ----------------------------------------------------------------*/
 
 .pun .blockpost .box, .pun .postright, .pun .postfootright, .pun .deletemsg {
 	background-color: #F8FAFD;
-	}
+}
 
 .pun .postright, .pun .postfootright {
 	border-left-color: #F0F5FA
-	}
+}
 
 .pun .postleft, .pun .postfootleft, .pun .blockpost label, .pun .codebox, .pun .quotebox {
 	background-color: #F0F5FA
-	}
+}
 
 #punhelp .codebox, #punhelp .quotebox {
 	background-color: #f9f9f9;
-	}
+}
 
 .pun .blockpost h2 {
 	background-color: #F0F5FA;
-	}
+}
 
 .pun .blockpost h2 span.conr {
 	color: #aabdcd
-	}
+}
 
 .pun hr {
 	background-color: #333;
 	color: #333
-	}
+}
 
 .pun .quotebox {
 	background-color: #FAFCFE;
-	}
+}
 
 .pun .postmsg ins, #punhelp samp ins {
 	background-color: #ff0;
-	}
+}
 
 /* Borders
 ----------------------------------------------------------------*/
@@ -1266,11 +1251,11 @@ body {
 
 .pun td {
 	border-color: #A2B5CC;
-	}
+}
 
 .pun th, .pun fieldset {
 	border-color: #A2B5CC;
-	}
+}
 
 #adminconsole td, #adminconsole th {
 	border-style:solid;
@@ -1287,15 +1272,15 @@ body {
 
 .pun .forminfo, .pun .blockpost label, .pun .deletemsg {
 	border-color: #aca899 #fff #fff #aca899;
-	}
+}
 
 .pun .quotebox, .pun .codebox {
 	border-color: #BCD2E9;
-	}
+}
 
 .pun .postlink a:link, .pun .postlink a:visited {
 	border-color: #C0D6E9
-	}
+}
 
 
 /* Links
@@ -1304,51 +1289,51 @@ body {
 .pun a:link, .pun a:visited {
 	color: #1F537B;
 	text-decoration: none;
-	}
+}
 
 .pun a:hover, .pun a:active, .pun a:focus {
 	color: #9E1D00
-	}
+}
 
 #brdmenu li a:active, #brdmenu li a:link, #brdmenu li a:visited {
 	color: #1F2E3D;
-	}
+}
 
 #brdmenu li a:hover {
 	color: #000;
 	text-shadow: #8895A2 1px -1px 0.4em;
-	}
+}
 
 #vf a {
 	font-weight: bold;
-	}
+}
 
 .pun .postreport a:link, .pun .postreport a:visited,
 .pun .iclosed td.tcl a:link, .pun .iclosed td.tcl a:visited {
 	color: #888
-	}
+}
 
 .pun .isticky.iclosed td.tcl a:link, .pun .isticky.iclosed td.tcl a:visited {
 	color: #475F6B !important;
-	}
+}
 
 .pun .isticky.iclosed td.tcl a:hover {
 	color: #577382 !important;
-	}
+}
 
 
 .pun .postreport a:hover, .pun .postreport a:active,
 .pun .iclosed td.tcl a:hover, .pun .iclosed td.tcl a:active {
 	color: #aaa
-	}
+}
 
 .pun .maintenancelink a:link, .pun .maintenancelink a:visited {
 	color: #b42000
-	}
+}
 
 .pun .maintenancelink a:hover, .pun .maintenancelink a:active {
 	color: #b42000
-	}
+}
 
 
 /* Status Indicators
@@ -1356,32 +1341,32 @@ body {
 
 .pun .icon {
 	background-image:url(Technetium/icon-nonew.png);
-	}
+}
 
 .pun .iredirect .icon {
 	background-image:url(Technetium/icon-moved.png);
-	}
+}
 
 .pun .inew .icon{
 	background-image:url(Technetium/icon-new.png);
-	}
+}
 
 .pun .iclosed .icon  {
 	background-image:url(Technetium/icon-closed.png);
-	}
+}
 
 .pun .isticky .icon {
 	background-image:url(Technetium/icon-nonew-sticky.png);
-	}
+}
 
 .pun .isticky.inew .icon {
 	background-image:url(Technetium/icon-new-sticky.png);
-	}
+}
 
 .pun .iclosed.isticky .icon {
 	background-image:url(Technetium/icon-closed-sticky.png);
-	}
+}
 
 .pun .imoved .icon {
 	background-image:url(Technetium/icon-moved.png);
-	}
+}
\ No newline at end of file
-- 
1.7.10


From ae99f6aff7b77aeac6bc1e8629db2d3bb48f5ad1 Mon Sep 17 00:00:00 2001
From: Studio384 <yannick.franssen@hotmail.com>
Date: Sat, 20 Oct 2012 00:12:37 +0200
Subject: [PATCH 61/75] #751: Technetium doesn't use border radius in IE

---
 style/Technetium.css |    3 +--
 1 file changed, 1 insertion(+), 2 deletions(-)

diff --git a/style/Technetium.css b/style/Technetium.css
index 5534597..8416e18 100644
--- a/style/Technetium.css
+++ b/style/Technetium.css
@@ -129,8 +129,7 @@ body {
 	font-weight: normal;
 	padding: 4px 6px;
 	padding: 6px;
-	border-radius-topleft: 0.3em;
-	border-radius-topright: 0.3em;
+	border-radius: 0.3em 0.3em 0 0;
 }
 
 .pun h2 #brdmenu {
-- 
1.7.10


From 13095376ac59765e72b05a26a2d7c2e42a8c9151 Mon Sep 17 00:00:00 2001
From: Quy Ton <quy@fluxbb.org>
Date: Sun, 21 Oct 2012 10:43:50 -0700
Subject: [PATCH 62/75] #755: Verify URL is a valid URL format before
 hyperlinking in parser. Reported by adaur.

---
 include/parser.php |    3 +++
 1 file changed, 3 insertions(+)

diff --git a/include/parser.php b/include/parser.php
index cba4531..85a3cac 100644
--- a/include/parser.php
+++ b/include/parser.php
@@ -661,6 +661,9 @@ function handle_url_tag($url, $link = '', $bbcode = false)
 	else if (!preg_match('#^([a-z0-9]{3,6})://#', $url)) // Else if it doesn't start with abcdef://, we add http://
 		$full_url = 'http://'.$full_url;
 
+	if ($bbcode === false && url_valid($full_url) === false)
+		$bbcode = true;
+
 	// Ok, not very pretty :-)
 	if ($bbcode)
 	{
-- 
1.7.10


From 6de8f792a75545557a0325110a041ac18964d785 Mon Sep 17 00:00:00 2001
From: adaur <adaur.underground@gmail.com>
Date: Sun, 28 Oct 2012 17:45:17 +0100
Subject: [PATCH 63/75] #757: pun_include: Allow files from subdirectories

---
 header.php |   18 +++++++++++++-----
 1 file changed, 13 insertions(+), 5 deletions(-)

diff --git a/header.php b/header.php
index 362588a..5bd58f0 100644
--- a/header.php
+++ b/header.php
@@ -41,17 +41,25 @@
 $tpl_main = file_get_contents($tpl_file);
 
 // START SUBST - <pun_include "*">
-preg_match_all('%<pun_include "([^/\\\\]*?)\.(php[45]?|inc|html?|txt)">%i', $tpl_main, $pun_includes, PREG_SET_ORDER);
+preg_match_all('%<pun_include "(.*?)">%i', $tpl_main, $pun_includes, PREG_SET_ORDER);
 
 foreach ($pun_includes as $cur_include)
 {
 	ob_start();
 
+	$file_info = pathinfo($cur_include[1]);
+	
+	if (!in_array($file_info['extension'], array('php', 'php4', 'php5', 'inc', 'html', 'txt'))) // Allow some extensions
+		error(sprintf($lang_common['Pun include extension'], htmlspecialchars($cur_include[0]), basename($tpl_file), htmlspecialchars($file_info['extension'])));
+		
+	if (strpos($file_info['dirname'], '..') !== false) // Don't allow directory traversal
+		error(sprintf($lang_common['Pun include directory'], htmlspecialchars($cur_include[0]), basename($tpl_file)));
+
 	// Allow for overriding user includes, too.
-	if (file_exists($tpl_inc_dir.$cur_include[1].'.'.$cur_include[2]))
-		require $tpl_inc_dir.$cur_include[1].'.'.$cur_include[2];
-	else if (file_exists(PUN_ROOT.'include/user/'.$cur_include[1].'.'.$cur_include[2]))
-		require PUN_ROOT.'include/user/'.$cur_include[1].'.'.$cur_include[2];
+	if (file_exists($tpl_inc_dir.$cur_include[1]))
+		require $tpl_inc_dir.$cur_include[1];
+	else if (file_exists(PUN_ROOT.'include/user/'.$cur_include[1]))
+		require PUN_ROOT.'include/user/'.$cur_include[1];
 	else
 		error(sprintf($lang_common['Pun include error'], htmlspecialchars($cur_include[0]), basename($tpl_file)));
 
-- 
1.7.10


From 47beb0273008bbdce38472eb8c7c4ca7ba80ac15 Mon Sep 17 00:00:00 2001
From: adaur <adaur.underground@gmail.com>
Date: Sun, 28 Oct 2012 17:45:53 +0100
Subject: [PATCH 64/75] #757: pun_include: Allow files from subdirectories

---
 lang/English/common.php |    4 +++-
 1 file changed, 3 insertions(+), 1 deletion(-)

diff --git a/lang/English/common.php b/lang/English/common.php
index edc7a80..ceb765f 100644
--- a/lang/English/common.php
+++ b/lang/English/common.php
@@ -17,7 +17,9 @@
 'No permission'						=>	'You do not have permission to access this page.',
 'Bad referrer'						=>	'Bad HTTP_REFERER. You were referred to this page from an unauthorized source. If the problem persists please make sure that \'Base URL\' is correctly set in Admin/Options and that you are visiting the forum by navigating to that URL. More information regarding the referrer check can be found in the FluxBB documentation.',
 'No cookie'							=>	'You appear to have logged in successfully, however a cookie has not been set. Please check your settings and if applicable, enable cookies for this website.',
-'Pun include error'					=>	'Unable to process user include %s from template %s. There is no such file in neither the template directory nor in the user include directory.',
+'Pun include extension'  			=>	'Unable to process user include %s from template %s. "%s" files are not allowed',
+'Pun include directory'				=>	'Unable to process user include %s from template %s. Directory traversal is not allowed',
+'Pun include error'					=>	'Unable to process user include %s from template %s. There is no such file in neither the template directory nor in the user include directory',
 
 // Miscellaneous
 'Announcement'						=>	'Announcement',
-- 
1.7.10


From 65e5d8adc2714179e1b9c6c108d74c37587dff52 Mon Sep 17 00:00:00 2001
From: adaur <adaur.underground@gmail.com>
Date: Tue, 30 Oct 2012 20:33:24 +0100
Subject: [PATCH 65/75] Update header.php

---
 header.php |    6 +++---
 1 file changed, 3 insertions(+), 3 deletions(-)

diff --git a/header.php b/header.php
index 5bd58f0..718d83e 100644
--- a/header.php
+++ b/header.php
@@ -50,10 +50,10 @@
 	$file_info = pathinfo($cur_include[1]);
 	
 	if (!in_array($file_info['extension'], array('php', 'php4', 'php5', 'inc', 'html', 'txt'))) // Allow some extensions
-		error(sprintf($lang_common['Pun include extension'], htmlspecialchars($cur_include[0]), basename($tpl_file), htmlspecialchars($file_info['extension'])));
+		error(sprintf($lang_common['Pun include extension'], pun_htmlspecialchars($cur_include[0]), basename($tpl_file), pun_htmlspecialchars($file_info['extension'])));
 		
 	if (strpos($file_info['dirname'], '..') !== false) // Don't allow directory traversal
-		error(sprintf($lang_common['Pun include directory'], htmlspecialchars($cur_include[0]), basename($tpl_file)));
+		error(sprintf($lang_common['Pun include directory'], pun_htmlspecialchars($cur_include[0]), basename($tpl_file)));
 
 	// Allow for overriding user includes, too.
 	if (file_exists($tpl_inc_dir.$cur_include[1]))
@@ -61,7 +61,7 @@
 	else if (file_exists(PUN_ROOT.'include/user/'.$cur_include[1]))
 		require PUN_ROOT.'include/user/'.$cur_include[1];
 	else
-		error(sprintf($lang_common['Pun include error'], htmlspecialchars($cur_include[0]), basename($tpl_file)));
+		error(sprintf($lang_common['Pun include error'], pun_htmlspecialchars($cur_include[0]), basename($tpl_file)));
 
 	$tpl_temp = ob_get_contents();
 	$tpl_main = str_replace($cur_include[0], $tpl_temp, $tpl_main);
-- 
1.7.10


From 2e86070c67ed268b546783b9fa2df2469d81edda Mon Sep 17 00:00:00 2001
From: adaur <adaur.underground@gmail.com>
Date: Wed, 31 Oct 2012 11:39:06 +0100
Subject: [PATCH 66/75] Updating regex to a less greedy one (thanks Franz)

---
 header.php |    2 +-
 1 file changed, 1 insertion(+), 1 deletion(-)

diff --git a/header.php b/header.php
index 718d83e..7c5b204 100644
--- a/header.php
+++ b/header.php
@@ -41,7 +41,7 @@
 $tpl_main = file_get_contents($tpl_file);
 
 // START SUBST - <pun_include "*">
-preg_match_all('%<pun_include "(.*?)">%i', $tpl_main, $pun_includes, PREG_SET_ORDER);
+preg_match_all('%<pun_include "([^"]+)">%i', $tpl_main, $pun_includes, PREG_SET_ORDER);
 
 foreach ($pun_includes as $cur_include)
 {
-- 
1.7.10


From eadf5ed8a771109d5b037ba777058aa254d5f8b8 Mon Sep 17 00:00:00 2001
From: Quy Ton <quy@fluxbb.org>
Date: Thu, 1 Nov 2012 09:37:00 -0700
Subject: [PATCH 67/75] Fix spelling; remove/add blank space

---
 include/email.php     |    2 +-
 include/functions.php |    4 ++--
 moderate.php          |    2 +-
 3 files changed, 4 insertions(+), 4 deletions(-)

diff --git a/include/email.php b/include/email.php
index 6cfe9d3..930e963 100644
--- a/include/email.php
+++ b/include/email.php
@@ -309,7 +309,7 @@ function smtp_mail($to, $subject, $message, $headers = '')
 
 	if ($pun_config['o_smtp_user'] != '' && $pun_config['o_smtp_pass'] != '')
 	{
-		// Here we try to determine the *real* hostname (reverse DNS entry preferrably)
+		// Here we try to determine the *real* hostname (reverse DNS entry preferably)
 		$local_host = php_uname('n');
 
 		// Able to resolve name to IP
diff --git a/include/functions.php b/include/functions.php
index ff8ef77..e3b60a5 100644
--- a/include/functions.php
+++ b/include/functions.php
@@ -853,7 +853,7 @@ function paginate($num_pages, $cur_page, $link)
 	{
 		// Add a previous page link
 		if ($num_pages > 1 && $cur_page > 1)
-			$pages[] = '<a rel="prev" '.(empty($pages) ? ' class="item1"' : '').' href="'.$link.'&amp;p='.($cur_page - 1).'">'.$lang_common['Previous'].'</a>';
+			$pages[] = '<a rel="prev"'.(empty($pages) ? ' class="item1"' : '').' href="'.$link.'&amp;p='.($cur_page - 1).'">'.$lang_common['Previous'].'</a>';
 
 		if ($cur_page > 3)
 		{
@@ -884,7 +884,7 @@ function paginate($num_pages, $cur_page, $link)
 
 		// Add a next page link
 		if ($num_pages > 1 && !$link_to_all && $cur_page < $num_pages)
-			$pages[] = '<a rel="next" '.(empty($pages) ? ' class="item1"' : '').' href="'.$link.'&amp;p='.($cur_page +1).'">'.$lang_common['Next'].'</a>';
+			$pages[] = '<a rel="next"'.(empty($pages) ? ' class="item1"' : '').' href="'.$link.'&amp;p='.($cur_page +1).'">'.$lang_common['Next'].'</a>';
 	}
 
 	return implode(' ', $pages);
diff --git a/moderate.php b/moderate.php
index 4555e31..b56115c 100644
--- a/moderate.php
+++ b/moderate.php
@@ -710,7 +710,7 @@
 					</div>
 				</fieldset>
 			</div>
-			<p class="buttons"><input type="submit" name="delete_topics_comply" value="<?php echo $lang_misc['Delete'] ?>" /><a href="javascript:history.go(-1)"><?php echo $lang_common['Go back'] ?></a></p>
+			<p class="buttons"><input type="submit" name="delete_topics_comply" value="<?php echo $lang_misc['Delete'] ?>" /> <a href="javascript:history.go(-1)"><?php echo $lang_common['Go back'] ?></a></p>
 		</form>
 	</div>
 </div>
-- 
1.7.10


From 45eb195d67b9ea79c61aa58c4f762f35bfbde448 Mon Sep 17 00:00:00 2001
From: Quy Ton <quy@fluxbb.org>
Date: Sun, 4 Nov 2012 10:15:49 -0800
Subject: [PATCH 68/75] #760: Change example email address to use RFC 2606
 reserved example domain

---
 help.php |    4 ++--
 1 file changed, 2 insertions(+), 2 deletions(-)

diff --git a/help.php b/help.php
index d6e367d..7ab702c 100644
--- a/help.php
+++ b/help.php
@@ -56,8 +56,8 @@
 		<p><a name="url"></a><code>[url=<?php echo pun_htmlspecialchars(get_base_url(true).'/') ?>]<?php echo pun_htmlspecialchars($pun_config['o_board_title']) ?>[/url]</code> <?php echo $lang_help['produces'] ?> <samp><a href="<?php echo pun_htmlspecialchars(get_base_url(true).'/') ?>"><?php echo pun_htmlspecialchars($pun_config['o_board_title']) ?></a></samp></p>
 		<p><code>[url]<?php echo pun_htmlspecialchars(get_base_url(true).'/') ?>[/url]</code> <?php echo $lang_help['produces'] ?> <samp><a href="<?php echo pun_htmlspecialchars(get_base_url(true).'/') ?>"><?php echo pun_htmlspecialchars(get_base_url(true).'/') ?></a></samp></p>
 		<p><code>[url=/help.php]<?php echo $lang_help['This help page'] ?>[/url]</code> <?php echo $lang_help['produces'] ?> <samp><a href="<?php echo pun_htmlspecialchars(get_base_url(true).'/help.php') ?>"><?php echo $lang_help['This help page'] ?></a></samp></p>
-		<p><code>[email]myname@mydomain.com[/email]</code> <?php echo $lang_help['produces'] ?> <samp><a href="mailto:myname@mydomain.com">myname@mydomain.com</a></samp></p>
-		<p><code>[email=myname@mydomain.com]<?php echo $lang_help['My email address'] ?>[/email]</code> <?php echo $lang_help['produces'] ?> <samp><a href="mailto:myname@mydomain.com"><?php echo $lang_help['My email address'] ?></a></samp></p>
+		<p><code>[email]myname@example.com[/email]</code> <?php echo $lang_help['produces'] ?> <samp><a href="mailto:myname@example.com">myname@example.com</a></samp></p>
+		<p><code>[email=myname@example.com]<?php echo $lang_help['My email address'] ?>[/email]</code> <?php echo $lang_help['produces'] ?> <samp><a href="mailto:myname@example.com"><?php echo $lang_help['My email address'] ?></a></samp></p>
 		<p><code>[topic=1]<?php echo $lang_help['Test topic'] ?>[/topic]</code> <?php echo $lang_help['produces'] ?> <samp><a href="<?php echo pun_htmlspecialchars(get_base_url(true).'/viewtopic.php?id=1') ?>"><?php echo $lang_help['Test topic'] ?></a></samp></p>
 		<p><code>[topic]1[/topic]</code> <?php echo $lang_help['produces'] ?> <samp><a href="<?php echo pun_htmlspecialchars(get_base_url(true).'/viewtopic.php?id=1') ?>"><?php echo pun_htmlspecialchars(get_base_url(true).'/viewtopic.php?id=1') ?></a></samp></p>
 		<p><code>[post=1]<?php echo $lang_help['Test post'] ?>[/post]</code> <?php echo $lang_help['produces'] ?> <samp><a href="<?php echo pun_htmlspecialchars(get_base_url(true).'/viewtopic.php?pid=1#p1') ?>"><?php echo $lang_help['Test post'] ?></a></samp></p>
-- 
1.7.10


From 18cbb4e86eb7cab9d25746523ddf28d9590c4625 Mon Sep 17 00:00:00 2001
From: Quy Ton <quy@fluxbb.org>
Date: Tue, 6 Nov 2012 07:37:45 -0800
Subject: [PATCH 69/75] #689: Fix spelling in admin_bans.php

---
 admin_bans.php |    2 +-
 1 file changed, 1 insertion(+), 1 deletion(-)

diff --git a/admin_bans.php b/admin_bans.php
index 8b70428..8a13d95 100644
--- a/admin_bans.php
+++ b/admin_bans.php
@@ -506,7 +506,7 @@
 
 		<h2 class="block2"><span><?php echo $lang_admin_bans['Ban search head'] ?></span></h2>
 		<div class="box">
-			<form id="find_band" method="get" action="admin_bans.php">
+			<form id="find_bans" method="get" action="admin_bans.php">
 				<p class="submittop"><input type="submit" name="find_ban" value="<?php echo $lang_admin_bans['Submit search'] ?>" tabindex="3" /></p>
 				<div class="inform">
 					<fieldset>
-- 
1.7.10


From 32144060c105885d588b615d1de39532a550420c Mon Sep 17 00:00:00 2001
From: Quy Ton <quy@fluxbb.org>
Date: Fri, 9 Nov 2012 18:47:17 -0800
Subject: [PATCH 70/75] Change the maxlength of pagination options to 2 since
 the max value is 75.

---
 admin_options.php |    4 ++--
 profile.php       |    4 ++--
 2 files changed, 4 insertions(+), 4 deletions(-)

diff --git a/admin_options.php b/admin_options.php
index a2c73cc..c4decaa 100644
--- a/admin_options.php
+++ b/admin_options.php
@@ -466,14 +466,14 @@
 								<tr>
 									<th scope="row"><?php echo $lang_admin_options['Topics per page label'] ?></th>
 									<td>
-										<input type="text" name="form[disp_topics_default]" size="3" maxlength="3" value="<?php echo $pun_config['o_disp_topics_default'] ?>" />
+										<input type="text" name="form[disp_topics_default]" size="3" maxlength="2" value="<?php echo $pun_config['o_disp_topics_default'] ?>" />
 										<span><?php echo $lang_admin_options['Topics per page help'] ?></span>
 									</td>
 								</tr>
 								<tr>
 									<th scope="row"><?php echo $lang_admin_options['Posts per page label'] ?></th>
 									<td>
-										<input type="text" name="form[disp_posts_default]" size="3" maxlength="3" value="<?php echo $pun_config['o_disp_posts_default'] ?>" />
+										<input type="text" name="form[disp_posts_default]" size="3" maxlength="2" value="<?php echo $pun_config['o_disp_posts_default'] ?>" />
 										<span><?php echo $lang_admin_options['Posts per page help'] ?></span>
 									</td>
 								</tr>
diff --git a/profile.php b/profile.php
index 9f62c27..123fd5e 100644
--- a/profile.php
+++ b/profile.php
@@ -1624,8 +1624,8 @@
 					<fieldset>
 						<legend><?php echo $lang_profile['Pagination legend'] ?></legend>
 						<div class="infldset">
-							<label class="conl"><?php echo $lang_profile['Topics per page'] ?><br /><input type="text" name="form[disp_topics]" value="<?php echo $user['disp_topics'] ?>" size="6" maxlength="3" /><br /></label>
-							<label class="conl"><?php echo $lang_profile['Posts per page'] ?><br /><input type="text" name="form[disp_posts]" value="<?php echo $user['disp_posts'] ?>" size="6" maxlength="3" /><br /></label>
+							<label class="conl"><?php echo $lang_profile['Topics per page'] ?><br /><input type="text" name="form[disp_topics]" value="<?php echo $user['disp_topics'] ?>" size="6" maxlength="2" /><br /></label>
+							<label class="conl"><?php echo $lang_profile['Posts per page'] ?><br /><input type="text" name="form[disp_posts]" value="<?php echo $user['disp_posts'] ?>" size="6" maxlength="2" /><br /></label>
 							<p class="clearb"><?php echo $lang_profile['Paginate info'] ?> <?php echo $lang_profile['Leave blank'] ?></p>
 						</div>
 					</fieldset>
-- 
1.7.10


From 39dfba1930af593d7358ce4ca49520b07eb27678 Mon Sep 17 00:00:00 2001
From: Quy Ton <quy@fluxbb.org>
Date: Fri, 9 Nov 2012 19:50:29 -0800
Subject: [PATCH 71/75] Change markup of breadcrumbs in viewforum/viewtopic
 same as in search

---
 viewforum.php |    4 ++--
 viewtopic.php |    4 ++--
 2 files changed, 4 insertions(+), 4 deletions(-)

diff --git a/viewforum.php b/viewforum.php
index b629019..e562376 100644
--- a/viewforum.php
+++ b/viewforum.php
@@ -108,7 +108,7 @@
 	<div class="inbox crumbsplus">
 		<ul class="crumbs">
 			<li><a href="index.php"><?php echo $lang_common['Index'] ?></a></li>
-			<li><span>&#160;</span><a href="viewforum.php?id=<?php echo $id ?>"><strong><?php echo pun_htmlspecialchars($cur_forum['forum_name']) ?></strong></a></li>
+			<li><span>&#160;</span><strong><a href="viewforum.php?id=<?php echo $id ?>"><?php echo pun_htmlspecialchars($cur_forum['forum_name']) ?></a></strong></li>
 		</ul>
 		<div class="pagepost">
 			<p class="pagelink conl"><?php echo $paging_links ?></p>
@@ -287,7 +287,7 @@
 		</div>
 		<ul class="crumbs">
 			<li><a href="index.php"><?php echo $lang_common['Index'] ?></a></li>
-			<li><span>&#160;</span><a href="viewforum.php?id=<?php echo $id ?>"><strong><?php echo pun_htmlspecialchars($cur_forum['forum_name']) ?></strong></a></li>
+			<li><span>&#160;</span><strong><a href="viewforum.php?id=<?php echo $id ?>"><?php echo pun_htmlspecialchars($cur_forum['forum_name']) ?></a></strong></li>
 		</ul>
 <?php echo (!empty($forum_actions) ? "\t\t".'<p class="subscribelink clearb">'.implode(' - ', $forum_actions).'</p>'."\n" : '') ?>
 		<div class="clearer"></div>
diff --git a/viewtopic.php b/viewtopic.php
index df3cb14..00ddd47 100644
--- a/viewtopic.php
+++ b/viewtopic.php
@@ -180,7 +180,7 @@
 		<ul class="crumbs">
 			<li><a href="index.php"><?php echo $lang_common['Index'] ?></a></li>
 			<li><span>&#160;</span><a href="viewforum.php?id=<?php echo $cur_topic['forum_id'] ?>"><?php echo pun_htmlspecialchars($cur_topic['forum_name']) ?></a></li>
-			<li><span>&#160;</span><a href="viewtopic.php?id=<?php echo $id ?>"><strong><?php echo pun_htmlspecialchars($cur_topic['subject']) ?></strong></a></li>
+			<li><span>&#160;</span><strong><a href="viewtopic.php?id=<?php echo $id ?>"><?php echo pun_htmlspecialchars($cur_topic['subject']) ?></a></strong></li>
 		</ul>
 		<div class="pagepost">
 			<p class="pagelink conl"><?php echo $paging_links ?></p>
@@ -386,7 +386,7 @@
 		<ul class="crumbs">
 			<li><a href="index.php"><?php echo $lang_common['Index'] ?></a></li>
 			<li><span>&#160;</span><a href="viewforum.php?id=<?php echo $cur_topic['forum_id'] ?>"><?php echo pun_htmlspecialchars($cur_topic['forum_name']) ?></a></li>
-			<li><span>&#160;</span><a href="viewtopic.php?id=<?php echo $id ?>"><strong><?php echo pun_htmlspecialchars($cur_topic['subject']) ?></strong></a></li>
+			<li><span>&#160;</span><strong><a href="viewtopic.php?id=<?php echo $id ?>"><?php echo pun_htmlspecialchars($cur_topic['subject']) ?></a></strong></li>
 		</ul>
 <?php echo $subscraction ?>
 		<div class="clearer"></div>
-- 
1.7.10


From 5e25c882113287142e4c61a22a9fd53932cabb35 Mon Sep 17 00:00:00 2001
From: Franz Liedke <franz@develophp.org>
Date: Tue, 13 Nov 2012 01:22:10 +0100
Subject: [PATCH 72/75] #762: Fix SQLite's add_field() function messing up the
 order of fields.

---
 include/dblayer/sqlite.php |   18 ++++++++++++++++--
 1 file changed, 16 insertions(+), 2 deletions(-)

diff --git a/include/dblayer/sqlite.php b/include/dblayer/sqlite.php
index 8d917c7..6661840 100644
--- a/include/dblayer/sqlite.php
+++ b/include/dblayer/sqlite.php
@@ -420,7 +420,7 @@ function get_table_info($table_name, $no_prefix = false)
 	}
 
 
-	function add_field($table_name, $field_name, $field_type, $allow_null, $default_value = null, $after_field = 0, $no_prefix = false)
+	function add_field($table_name, $field_name, $field_type, $allow_null, $default_value = null, $after_field = null, $no_prefix = false)
 	{
 		if ($this->field_exists($table_name, $field_name, $no_prefix))
 			return true;
@@ -444,7 +444,21 @@ function add_field($table_name, $field_name, $field_type, $allow_null, $default_
 		$query .= ' DEFAULT '.$default_value;
 
 		$old_columns = array_keys($table['columns']);
-		array_insert($table['columns'], $after_field, $query, $field_name);
+
+		// Determine the proper offset
+		if (!is_null($after_field))
+			$offset = array_search($after_field, array_keys($table['columns']), true) + 1;
+		else
+			$offset = count($table['columns']);
+
+		// Out of bounds checks
+		if ($offset > count($table['columns']))
+			$offset = count($table['columns']);
+		else if ($offset < 0)
+			$offset = 0;
+
+		if (!is_null($field_name) && $field_name !== '')
+			$table['columns'] = array_merge(array_slice($table['columns'], 0, $offset), array($field_name => $query), array_slice($table['columns'], $offset));
 
 		$new_table = 'CREATE TABLE '.($no_prefix ? '' : $this->prefix).$this->escape($table_name).' (';
 
-- 
1.7.10


From 9c3acc47e756103e8c97fad5a2ebf82c85508b30 Mon Sep 17 00:00:00 2001
From: Quy Ton <quy@fluxbb.org>
Date: Mon, 12 Nov 2012 19:18:01 -0800
Subject: [PATCH 73/75] #685: Remove empty BBCode tags inside other BBCode
 tags before preparsing to prevent issues such as
 orphan tags.

---
 include/parser.php |   16 ++++++++++++++++
 1 file changed, 16 insertions(+)

diff --git a/include/parser.php b/include/parser.php
index 85a3cac..45db684 100644
--- a/include/parser.php
+++ b/include/parser.php
@@ -66,6 +66,22 @@ function preparse_bbcode($text, &$errors, $is_signature = false)
 {
 	global $pun_config, $lang_common, $lang_post, $re_list;
 
+	// Remove empty tags
+	while (($new_text = strip_empty_bbcode($text)) !== false)
+	{
+		if ($new_text != $text)
+		{
+			$text = $new_text;
+			if ($new_text == '')
+			{
+				$errors[] = $lang_post['Empty after strip'];
+				return '';
+			}
+		}
+		else
+			break;
+	}
+
 	if ($is_signature)
 	{
 		global $lang_profile;
-- 
1.7.10


From 2d52c3a077e906d68b6b02781e48704d37d36d5a Mon Sep 17 00:00:00 2001
From: Franz Liedke <franz@develophp.org>
Date: Tue, 13 Nov 2012 15:30:17 +0100
Subject: [PATCH 74/75] #673: Escape poster IP in viewtopic page.

Reported by @adaur, thank you!
---
 viewtopic.php |    2 +-
 1 file changed, 1 insertion(+), 1 deletion(-)

diff --git a/viewtopic.php b/viewtopic.php
index 00ddd47..24032f2 100644
--- a/viewtopic.php
+++ b/viewtopic.php
@@ -276,7 +276,7 @@
 
 		if ($pun_user['is_admmod'])
 		{
-			$user_info[] = '<dd><span><a href="moderate.php?get_host='.$cur_post['id'].'" title="'.$cur_post['poster_ip'].'">'.$lang_topic['IP address logged'].'</a></span></dd>';
+			$user_info[] = '<dd><span><a href="moderate.php?get_host='.$cur_post['id'].'" title="'.pun_htmlspecialchars($cur_post['poster_ip']).'">'.$lang_topic['IP address logged'].'</a></span></dd>';
 
 			if ($cur_post['admin_note'] != '')
 				$user_info[] = '<dd><span>'.$lang_topic['Note'].' <strong>'.pun_htmlspecialchars($cur_post['admin_note']).'</strong></span></dd>';
-- 
1.7.10


From 51a168e1a9762dd17a68fd932d756117a08c6912 Mon Sep 17 00:00:00 2001
From: Franz Liedke <franz@develophp.org>
Date: Tue, 13 Nov 2012 15:31:41 +0100
Subject: [PATCH 75/75] Tag the v1.5.1 release.

---
 db_update.php      |    2 +-
 include/common.php |    2 +-
 install.php        |    2 +-
 3 files changed, 3 insertions(+), 3 deletions(-)

diff --git a/db_update.php b/db_update.php
index cdabdfd..0dea9fb 100644
--- a/db_update.php
+++ b/db_update.php
@@ -7,7 +7,7 @@
  */
 
 // The FluxBB version this script updates to
-define('UPDATE_TO', '1.5.0');
+define('UPDATE_TO', '1.5.1');
 
 define('UPDATE_TO_DB_REVISION', 18);
 define('UPDATE_TO_SI_REVISION', 2);
diff --git a/include/common.php b/include/common.php
index 2bab0f0..7a4aef3 100644
--- a/include/common.php
+++ b/include/common.php
@@ -10,7 +10,7 @@
 	exit('The constant PUN_ROOT must be defined and point to a valid FluxBB installation root directory.');
 
 // Define the version and database revision that this code was written for
-define('FORUM_VERSION', '1.5.0');
+define('FORUM_VERSION', '1.5.1');
 
 define('FORUM_DB_REVISION', 18);
 define('FORUM_SI_REVISION', 2);
diff --git a/install.php b/install.php
index efe5de5..310418b 100644
--- a/install.php
+++ b/install.php
@@ -7,7 +7,7 @@
  */
 
 // The FluxBB version this script installs
-define('FORUM_VERSION', '1.5.0');
+define('FORUM_VERSION', '1.5.1');
 
 define('FORUM_DB_REVISION', 18);
 define('FORUM_SI_REVISION', 2);
-- 
1.7.10
