<?php$page_title = 'Maintenance - Mod Share';if ($_GET['tool'] == 'rebuildsearch') {	$count = isset($_GET['count']) ? intval($_GET['count']) : 30;	$start = isset($_GET['start']) ? intval($_GET['start']) : 0;	echo '<p>Rebuilding search index. This might take a while.</p>';	$entries = array();		if ($start == 0) {		$db->query('DELETE FROM search_index') or error('Failed to empty search_index', __FILE__, __LINE__, $db->error());	}		$result = $db->query('SELECT description,title,id FROM projects WHERE id>' . $start . ' ORDER BY id ASC LIMIT ' . $count) or error('Failed to get project list', __FILE__, __LINE__, $db->error());	$i = 0;	while (list($desc,$title,$id) = $db->fetch_row($result)) {		$i++;		$words = array_merge(split_into_words($title),split_into_words($desc));		foreach ($words as $val) {			$entries[] = '(' . $id . ',\'' . $db->escape($val) . '\')';		}		$lastid =  $id;	}		$db->query('INSERT INTO search_index(project,word)	VALUES' . implode(',',$entries)) or error('Failed to insert terms', __FILE__, __LINE__, $db->error());		if ($i == $count) {		echo '<script type="text/javascript">//<![CDATA[window.location = \'?tool=rebuildsearch&count=' . $count . '&start=' . $lastid . '\';//]]></script>';	} else {		echo '<p>Done!</p>';	}		return;}?><h2>Maintenance tools</h2><ul>	<li><a href="?tool=rebuildsearch">Rebuild search index</a></li></ul>