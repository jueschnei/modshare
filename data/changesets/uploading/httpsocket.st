'From MIT Squeak 0.9.4 (June 1, 2003) [No updates present.] on 17 December 2012 at 2:13:00 pm'!!HTTPSocket class methodsFor: 'uploading'!httpPostProject: t1 args: t2 accept: t3 request: t4 progressDlg: t5 	| t6 t7 t8 t9 t10 t11 t12 t13 t14 t15 t16 t17 t18 t19 t20 t21 |	Socket initializeNetwork.	t5 percentDone: 20.	t11 _ (t1 asLowercase beginsWith: 'http://')				ifTrue: [t1 copyFrom: 8 to: t1 size]				ifFalse: [t1].	t6 _ t11 copyUpTo: $/.	t19 _ t6.	(t6 includes: $:)		ifTrue: 			[t16 _ (t6 copyFrom: (t6 indexOf: $:)							+ 1 to: t6 size) asNumber.			t6 _ t6 copyUpTo: $:]		ifFalse: [t16 _ self defaultPort].	t5 percentDone: 25.	t12 _ t11 copyFrom: (t11 indexOf: $/)				to: t11 size.	t12 size = 0 ifTrue: [t12 _ '/'].	HTTPProxyServer		ifNotNil: 			[t12 _ 'http://' , t6 , ':' , t16 printString , t12.			t6 _ HTTPProxyServer.			t16 _ HTTPProxyPort].	t5 percentDone: 30.	t17 _ WriteStream on: String new.	t18 _ true.	t2 associationsDo: [:t22 | t22 value do: 			[:t23 | 			t18				ifTrue: [t18 _ false]				ifFalse: [t17 nextPut: $&].			t17 nextPutAll: t22 key encodeForHTTP.			t17 nextPut: $=.			t17 nextPutAll: t23 encodeForHTTP]].	t5 percentDone: 35.	self		try: 			[t7 _ NetNameResolver addressForName: t6 timeout: 20.			t7 ~~ nil]		ifGiveUp: 			[t5 message: 'Could not resolve the server address.Check your connection.';			 title: 'Failed'.			^ nil].	t5 percentDone: 50.	t8 _ HTTPSocket new.	t8 connectTo: t7 port: t16.	t8 waitForConnectionUntil: self standardDeadline.	Transcript cr; show: t1; cr.	t8 sendCommand: 'POST ' , t12 , ' HTTP/1.0' , CrLf , (t3 ifNil: ['']				ifNotNil: ['ACCEPT: ' , t3 , CrLf]) , 'ACCEPT: text/html' , CrLf , HTTPBlabEmail , t4 , 'User-Agent: Squeak 1.31' , CrLf , 'Content-type: application/x-www-form-urlencoded' , CrLf , 'Content-length: ' , t17 contents size printString , CrLf , 'Host: ' , t19 , CrLf.	t8 sendCommand: t17 contents.	t5 percentDone: 60.	t13 _ t8 getResponseUpTo: CrLf , CrLf ignoring: (String with: CR).	t13 size < 3 ifTrue: [^ t5 message: 'The server did not send back any data';		 title: 'Error'].	t9 _ t13 at: 1.	t14 _ t13 at: 3.	t5 percentDone: 90.	[t8 header: t9]		ifError: [^ t5 message: 'The response is missing the header.';			 title: 'Error'].	t10 _ t8 getHeader: 'content-length'.	t10 ifNotNil: [t10 _ t10 asNumber].	t20 _ t8 getHeader: 'content-type'.	t8 responseCode first = $3		ifTrue: 			[t21 _ t8 getHeader: 'location'.			t21				ifNotNil: 					[Transcript show: 'redirecting to: ' , t21;					 cr.					t8 destroy.					^ self						httpPostProject: t21						args: t2						progressDlg: t5]].	t15 _ t8 getRestOfBuffer: t14 totalLength: t10.	t8 responseCode = '401'		ifTrue: 			[t5 message: 'Error 401: UnauthorisedThe server refused the authentication';			 title: 'Failed'.			^ t9 , t15 contents].	t8 responseCode = '404'		ifTrue: 			[t5 message: 'Error 404: Not Found.The upload page is either down or inexistent.';			 title: 'Failed'.			^ t9 , t15 contents].	t8 responseCode = '400'		ifTrue: 			[t5 message: 'Error 400: Bad Request.The server refused the upload..';			 title: 'Failed'.			^ t9 , t15 contents].	t8 destroy.	(t15 contents findString: 'success')		> 0		ifTrue: [t5 message: 'Your project has been uploaded to Mod Share!!';			 title: 'Success!!']		ifFalse: [t5 message: 'Upload failed. :(' , t15 contents;			 title: 'Failed'].	^ MIMEDocument		contentType: t20		content: t15 contents		url: t1! !!HTTPSocket class methodsFor: 'uploading'!httpPostProject: t1 args: t2 progressDlg: t3 	^ self		httpPostProject: t1		args: t2		accept: 'application/octet-stream'		request: ''		progressDlg: t3! !